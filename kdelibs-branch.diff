Index: interfaces/kscript/sample/shellscript.desktop
===================================================================
--- interfaces/kscript/sample/shellscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/kscript/sample/shellscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,7 +15,7 @@
 Name[es]=Ejecutor de script para intérprete de comandos de bash
 Name[et]=Bash shelli skripti käivitaja
 Name[eu]=Bash shell script-aren abiarazlea
-Name[fa]=مجری نویسه‌ی پوسته‌ی بش
+Name[fa]=اجرا کنندۀ دست‌نوشتۀ پوستۀ bash
 Name[fi]=Komentotulkkiohjelmien käynnistäjä
 Name[fr]=Lanceur de scripts shell Bash
 Name[fy]=Bash Flues Skript Rinner
@@ -46,7 +46,7 @@
 Name[ro]=Executor scripturi de interpretor
 Name[ru]=Запуск скриптов bash
 Name[rw]=Mutangiza Gaporogaramu Bash Shell
-Name[se]=Skálžu skripta
+Name[se]=Skálžu-skriptavuodji
 Name[sk]=Spustenie Bash shell skriptu
 Name[sl]=Zaganjalnik lupinski skriptov
 Name[sq]=Egzekutuesi i skriptave të Guacës Bash
@@ -84,7 +84,7 @@
 Comment[es]=Ejecuta procedimientos del intérprete de comandos bash desde dentro de la aplicación.
 Comment[et]=Käivitab bash shelli skripte rakendustes.
 Comment[eu]=Aplikazioaren baitatik bash-eko shell script-ak abiarazteko.
-Comment[fa]=نویسه‌‌های پوسته‌ی بش را از داخل یک برنامه اجرا می‌کند.
+Comment[fa]=دست‌نوشته‌های پوستۀ bash را از درون کاربرد اجرا می‌کند.
 Comment[fi]=Suorittaa Bash-komentotulkkiohjelmia ohjelman sisästä
 Comment[fr]=Exécute des scripts shell Bash depuis l'intérieur de l'application.
 Comment[fy]=Bash flues skript rint yn de applikaasje.
@@ -108,7 +108,7 @@
 Comment[mn]=Програм дотроос Bash-Shell-Скрипт ажиллуулах.
 Comment[ms]=Laksanakan skrip cengkerang bash di dalam aplikasi.
 Comment[nb]=Kjører bash skallskript fra innsiden av programmet.
-Comment[nds]=Dor köönt Programmen mit Bash-Shellskripten utföhren.
+Comment[nds]=Dor köönt Programmen Bash-Konsoolskripten mit utföhren.
 Comment[nl]=Voert Bash-shellscripts uit binnen de toepassing.
 Comment[nn]=Køyrer Bash-skalskript innanfrå programmet.
 Comment[pa]=ਇੱਕ ਕਾਰਜ ਵਿੱਚ ਬੈਸ਼ ਸ਼ੈਲ ਸਕ੍ਰਿਪਟਾਂ ਚਲਾਉਣ ਲਈ ਸਹਾਇਕ ਹੈ
Index: interfaces/kscript/scriptinterface.desktop
===================================================================
--- interfaces/kscript/scriptinterface.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/kscript/scriptinterface.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Este es un motor de script genérico para probar el interfaz de script.
 Comment[et]=Üldise skriptimootori testskript liidese testimiseks.
 Comment[eu]=Hau script motoreen proba generikoa da script-aren interfazea probatzeko.
-Comment[fa]=این موتور نویسه‌ی آزمایش عمومی  برای آزمایش واسط نویسه است.
+Comment[fa]=این یک موتور دست‌نوشتۀ آزمون عمومی برای آزمایش واسط دست‌نوشته می‌باشد.
 Comment[fi]=Tämä on yleinen skriptitestimoottori skriptin käyttöliittymän testaamiseen
 Comment[fo]=Hetta er ein almen royndarforritsskipan til at nároyna fjølvisforritsmarkamótið.
 Comment[fr]=Ceci est un moteur de script de test générique pour expérimenter l'interface de script.
Index: interfaces/kimproxy/interface/dcopinstantmessenger.desktop
===================================================================
--- interfaces/kimproxy/interface/dcopinstantmessenger.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/kimproxy/interface/dcopinstantmessenger.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Instant Messenger con un interfaz DCOP
 Comment[et]=Kiirsuhtlemisrakendus DCOP-liidesega
 Comment[eu]=Berehalako mezularitza DCOP interfazearekin
+Comment[fa]=پیام‌رسان فوری با یک واسط DCOP
 Comment[fi]=Pikaviestiohjelma, jossa on DCOP-rajapinta
 Comment[fr]=Messagerie instantanée munie d'une interface DCOP
 Comment[fy]=Instant Messenger mei in DCOP-interface 
Index: interfaces/kimproxy/interface/kcm_instantmessenger.desktop
===================================================================
--- interfaces/kimproxy/interface/kcm_instantmessenger.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/kimproxy/interface/kcm_instantmessenger.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -10,6 +10,7 @@
 Name[eo]=Tujmesaĝilo
 Name[et]=Kiirsuhtlus
 Name[eu]=Berehalako mezularitza
+Name[fa]=پیام‌رسان فوری
 Name[fi]=Pikaviestiohjelma
 Name[fr]=Messagerie instantanée
 Name[ga]=Clár teachtaireachtaí meandaracha
@@ -64,6 +65,7 @@
 Comment[es]=El Instant Messenger permite conversación en dos sentidos entre indivíduos y grupos.
 Comment[et]=Kiirsuhtlus võimaldab üksikisikute ja gruppide kahepoolset vestlust.
 Comment[eu]=Berehalako mezularitzak banan-banako edo taldeen arteko berriketan aritzeko.
+Comment[fa]=پیام‌رسان فوری امکان گپ دو طرفه بین افراد و گروهها را می‌دهد
 Comment[fi]=Pikaviestiohjelman avulla voidaan keskustella kahden kesken tai ryhmässä.
 Comment[fr]=La messagerie instantanée permet un dialogue bidirectionnel entre individus et groupes.
 Comment[fy]=Mei de instant messenger kinne jo twaspraak hâlde mei in yndividu en groepen.
Index: interfaces/kspeech/dcoptexttospeech.desktop
===================================================================
--- interfaces/kspeech/dcoptexttospeech.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/kspeech/dcoptexttospeech.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Texto a servicio de voz con un interfaz DCOP
 Comment[et]=Teksti kõneks muutmise teenus DCOP-liidesega
 Comment[eu]='Testua-ahoskatzea' zerbitzua DCOP interfazearekin
+Comment[fa]=خدمت متن به سخن با یک واسط DCOP
 Comment[fi]=Teksti-Puheeksi palvelu DCOP-rajapinnalla
 Comment[fr]=Service de synthèse vocale munie d'une interface DCOP
 Comment[fy]=tekst-ta-prate mei in DCOP-ynterface
Index: interfaces/ktexteditor/ktexteditoreditor.desktop
===================================================================
--- interfaces/ktexteditor/ktexteditoreditor.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/ktexteditor/ktexteditoreditor.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Componente incrustable de editor de textos (sin separación Doc/Vista)
 Comment[et]=Põimitav tekstiredaktori komponent
 Comment[eu]=Testu-editorearen kapsulatutako osagaia (Dok/Ikusi bereizketarik gabe)
-Comment[fa]=بخش ویرایشگر متن نهفته (بدون نمایش/راهنمای مجزا)
+Comment[fa]=مولفۀ ویرایشگرمتن نهفته ) بدون سند/نمای مجزا(
 Comment[fi]=Upotettava tekstimuokkauskomponentti (ilman Asiakirja/Näkymä-jakoa)
 Comment[fr]=Composant d'édition de texte intégrable (sans séparation doc / vue)
 Comment[fy]=Yn te sluten tekstbewurkerkomponint (sûnder skieding fan tekst/werjefte)
Index: interfaces/ktexteditor/kcm_ktexteditor.desktop
===================================================================
--- interfaces/ktexteditor/kcm_ktexteditor.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/ktexteditor/kcm_ktexteditor.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -90,7 +90,7 @@
 Comment[es]=El servicio del editor de texto proporciona aplicaciones con un visor de textos y un editor de textos. Las aplicaciones KDE que suministran propiedades de edición deberían utilizar este servicio.
 Comment[et]=Tekstiredaktori teenus annab rakendustele komponendi teksti vaatamiseks ja redigeerimiseks. Seda kasutavad kõik KDE rakendused, mis tegelevad teksti redigeerimisega.
 Comment[eu]=Testu-editorearen zerbitzuak testu-ikustailea eta editorea duten aplikazioak eskaintzen ditu. Testuak editatzeko aukera ematen duten KDE aplikazioek erabili beharko lukete zerbitzu hau.
-Comment[fa]=سرویس ویرایشگر متن یک نمایشگر و ویرایشگر برای برنامه‌ها مهیا می‌سازد. برنامه‌های KDE که امکانات ویرایش متن مهیا می‌سازند باید از این سرویس استفاده کنند.
+Comment[fa]=خدمت ویرایشگر متن، کاربردهایی را توسط یک مشاهده‌گر و ویرایشگر متن، فراهم می‌کند. کاربردهای KDE که امکانات ویرایش متن را فراهم می‌کنند باید از این خدمت استفاده نمایند. 
 Comment[fi]=Tekstieditoripalvelu tarjoaa sovelluksille tekstinäyttäjän- ja muokkaimen. KDE-sovelluksien, jotka tarjoavat tekstinmuokkauspalveluita, tulisi käyttää tätä palvelua.
 Comment[fo]=Tekstritiltænastuni gera forrit út við ein tekstvísari og -ritil. KDE-forrit ið geva nýtarin møguleiki fyri at rætta tekst eiga at nýta hesa tænasta.
 Comment[fr]=Le service d'édition de texte fournit des applications comportant un afficheur de texte et un éditeur. Les applications KDE qui fournissent des fonctions d'édition de texte devraient utiliser ce service.
Index: interfaces/ktexteditor/ktexteditor.desktop
===================================================================
--- interfaces/ktexteditor/ktexteditor.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/ktexteditor/ktexteditor.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Componente incrustable de editor de textos (con separación Doc/Vista)
 Comment[et]=Põimitav tekstiredaktori komponent (dokument/vaade eraldamisega)
 Comment[eu]=Testu-editorearen kapsulatutako osagaia (Dok/Ikusi bereizketarekin)
-Comment[fa]=بخش ویرایشگر متن نهفته (با نمایش/راهنمای مجزا)
+Comment[fa]=مولفۀ ویرایشگر متن نهفته )با سند/ نمای مجزا(
 Comment[fi]=Upotettava tekstimuokkauskomponentti (Asiakirja/Näkymä-jaolla)
 Comment[fr]=Composant d'édition de texte intégrable (avec séparation doc / vue)
 Comment[fy]=Yn te sluten tekstbewurkerkomponint (mei skieding fan tekst/werjefte)
Index: interfaces/ktexteditor/ktexteditorplugin.desktop
===================================================================
--- interfaces/ktexteditor/ktexteditorplugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ interfaces/ktexteditor/ktexteditorplugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Plugin de KTextEditor
 Comment[et]=KTextEditori plugin
 Comment[eu]=KTextEditor plugin-a
-Comment[fa]=متصل‌کننده‌ی KTextEditor
+Comment[fa]=وصلۀ KTextEditor
 Comment[fi]=KTextEditor-lisäosa
 Comment[fr]=Module externe KTextEditor
 Comment[fy]=KTextFerwurker-plugin
Index: kate/plugins/kdatatool/ktexteditor_kdatatool.desktop
===================================================================
--- kate/plugins/kdatatool/ktexteditor_kdatatool.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/plugins/kdatatool/ktexteditor_kdatatool.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Name[es]=Plugin KDataTool de KTextEditor
 Name[et]=KTextEditori KDataTool plugin
 Name[eu]=KTextEditor-en KDataTool plugin-a
-Name[fa]=متصل‌کننده‌ی ابزار KData KTextEditor 
+Name[fa]=وصلۀ ابزار KTextEditor KData
 Name[fi]=KTextEditor KDataTool -lisäosa
 Name[fr]=Module externe KDataTool pour KTextEditor
 Name[fy]=KTextEditor-plugin foar KDatatool
@@ -89,7 +89,7 @@
 Comment[es]=Activa herramientas como el thesaurus y el corrector ortográfico (si instalados)
 Comment[et]=Andmete tööriistad, näiteks thesaurus ja õigekirja kontroll
 Comment[eu]=Gaitu thesaurus-a eta ortografia zuzentzailea bezalako tresnak (instalatua badaude)
-Comment[fa]=فعال‌سازی ابزار اطلاعات مانند غلط‌یاب و همانندیاب (در صورت نصب)
+Comment[fa]=ابزارهای داده، مانند واژه‌نامه و غلط‌گیر را فعال سازید )اگر نصب شده باشد(
 Comment[fi]=Käytä datatyökaluja, kuten oikolukua ja sanakirjaa (jos asennettuna)
 Comment[fr]=Activer les outils de données comme le thésaurus et la correction orthographique (s'ils sont installés)
 Comment[fy]=Aktivearjen fan dataprogramma's, lykas de tesaurus en stavering (wannear't dy ynstallearre binne)
Index: kate/plugins/insertfile/ktexteditor_insertfile.desktop
===================================================================
--- kate/plugins/insertfile/ktexteditor_insertfile.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/plugins/insertfile/ktexteditor_insertfile.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Name[es]=Plugin de inserción de archivos de KTextEditor
 Name[et]=KTextEditori faili lisamise plugin
 Name[eu]=Fitxategiak txertatzeko KTextEditor-en plugin-a
-Name[fa]=متصل‌کننده‌ی پرونده‌ی ورود KTextEditor
+Name[fa]=وصلۀ پروندۀ درج KTextEditor
 Name[fi]=KTextEditorin 'Lisää tiedosto'-laajennus
 Name[fr]=Module externe du fichier d'insertion de KTextEditor
 Name[fy]=KTextEditor-plugin foar it ynfoegjen fan triemmen
@@ -88,6 +88,7 @@
 Comment[es]=Insertar cualquier archivo legible en la posición del cursor
 Comment[et]=Suvalise loetava faili lisamine kursori asukohta
 Comment[eu]=Kurtsorearen posizioan fitxategi irakurgarri bat txertatzen du
+Comment[fa]=درج هر پروندۀ قابل خواندن در موقعیت مکان‌نما 
 Comment[fi]=Lisää mikä tahansa luettava tiedosto kursorin kohdalle
 Comment[fr]=Insérer tout fichier lisible à la position du curseur
 Comment[fy]=Els lêsber Triem by it rinnerke ynfoegje
Index: kate/plugins/autobookmarker/ktexteditor_autobookmarker.desktop
===================================================================
--- kate/plugins/autobookmarker/ktexteditor_autobookmarker.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/plugins/autobookmarker/ktexteditor_autobookmarker.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Name[es]=Automarcadores de KTextEditor
 Name[et]=KTextEditori järjehoidjate märkija
 Name[eu]=KTextEditor-en laster-markatzaile automatikoa
+Name[fa]=چوب الف خودکار KTextEditor
 Name[fi]=KTextEditorin automaattinen kirjanmerkkien tekijä
 Name[fr]=Signets automatiques KTextEditor
 Name[fy]=Automatyske Blêdwizer foar de KTekstbewurker
@@ -69,6 +70,7 @@
 Comment[es]=Pone marcadores en las líneas que coinciden con un patrón definido al cargar documentos.
 Comment[et]=Määrab dokumendi avamisel vastavalt mustrile ridadele järjehoidjad
 Comment[eu]=Eredu batekin bat datozen lerroen laster-markak ezartzen ditu dokumentuak kargatzean
+Comment[fa]=وقتی که مستندات بار می‌شود، چوب الفها را روی خطوط مطابق با الگو تنظیم کنید 
 Comment[fi]=Määrittele kirjanmerkkejä riveille, jotka vastaavat kuviota, kun asiakirjoja avataan
 Comment[fr]=Positionne des signets sur les lignes qui correspondent à un motif quand les documents sont chargés
 Comment[fy]=Blêdwizer ynstelle om by it laden fan dokuminten oerienkomstige patroanen 
Index: kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop
===================================================================
--- kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -13,6 +13,7 @@
 Name[es]=Plugin de completado de palabras de KTextEditor
 Name[et]=KTextEditori sõna lõpetamise plugin
 Name[eu]=KTextEditor-en hitzen osaketarako plugin-a
+Name[fa]=وصلۀ تکمیل واژۀ KTextEditor 
 Name[fi]=KTextEditorin sanojen täydennyslaajennus
 Name[fr]=Module externe de complètement des mots de KTextEditor
 Name[fy]=KTextEditor plugin foar it kompleet meitje fan wurden
@@ -43,7 +44,7 @@
 Name[ro]=Modul completare cuvinte pentru KTextEditor
 Name[ru]=Модуль автодополнения слов KTextEditor
 Name[rw]=Icomeka ry'Iyuzuza Jambo rya KMuhinduziUmwandiko
-Name[se]=KTextEditor:a sátneollašuhttin lassemoduvla
+Name[se]=KTextEditor:a sátneollašuhttinlassemoduvla
 Name[sk]=Modul pre doplnenie slov pre KTextEditor
 Name[sl]=Vstavek KTextEditor za dopolnjevanje besed
 Name[sr]=KTextEditor прикључак за довршавање речи
@@ -72,6 +73,7 @@
 Comment[es]=Completado de palabras direccional o de menú emergente en el documento.
 Comment[et]=Lõpetamine vastavalt suunale või hüpikvariantide alusel dokumendi sõnade põhjal
 Comment[eu]=Dokumentuko hitzen osaketarako plugin-a
+Comment[fa]=تکمیل جهت داریا مبنی بربالاپراز کلمات موجوددرسند
 Comment[fi]=Asiakirjasta löytyvillä sanoilla täydentäminen
 Comment[fr]=Complètement basé sur la direction ou un menu à partir des mots du document
 Comment[fy]=kompleet meitsje fan wurden yn it dokumint op Direktsjeneel of popup-basearje 
Index: kate/plugins/isearch/ktexteditor_isearch.desktop
===================================================================
--- kate/plugins/isearch/ktexteditor_isearch.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/plugins/isearch/ktexteditor_isearch.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Name[es]=Plugin de búsqueda incremental de KTextEditor
 Name[et]=KTextEditori täpsustava otsingu plugin
 Name[eu]=KTextEditor-en bilaketa inkrementalerako plugin-a
-Name[fa]=متصل‌کننده‌ی موتور افزودنی KTextEditor
+Name[fa]=وصلۀ جستجوی نموی KTextEditor
 Name[fi]=KTextEditorin tarkentuvan haun laajennus
 Name[fr]=Module externe de recherche incrémentale pour KTextEditor
 Name[fy]=KTextEditor-plugin foar sykaksjes yn meardere stappen
@@ -85,6 +85,7 @@
 Comment[es]=También conocido como "Búsqueda mientras teclea"
 Comment[et]=Tuntud ka kui "otsimine vastavalt kirjutamisele"
 Comment[eu]="Idaztean bilatu" bezala ere ezaguna
+Comment[fa]=همچنین شناخته شده به عنوان »وقتی که جستجو راتحریرمی‌کنید«
 Comment[fi]=Tunnetaan myös nimellä "Hae kun kirjoitat"
 Comment[fr]=Aussi connu comme « Recherche pendant la saisie »
 Comment[fy]=Ek bekend as"ûnder it typen sykje"
Index: kate/part/kateconfig.h
===================================================================
--- kate/part/kateconfig.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateconfig.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -178,7 +178,8 @@
       cfReplaceTabsDyn=   0x2000000,
       cfRemoveTrailingDyn=0x4000000,
       cfDoxygenAutoTyping=0x8000000 ,    // Remove for KDE 4.0 (put in indenters)
-      cfMixedIndent = 0x10000000
+      cfMixedIndent = 0x10000000,
+      cfIndentPastedText = 0x20000000
     };
 
     uint configFlags () const;
Index: kate/part/katedocument.h
===================================================================
--- kate/part/katedocument.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/katedocument.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -993,7 +993,12 @@
     */
     static bool checkColorValue( QString value, QColor &col );
 
+    /**
+     * helper regex to capture the document variables
+     */
     static QRegExp kvLine;
+    static QRegExp kvLineWildcard;
+    static QRegExp kvLineMime;
     static QRegExp kvVar;
 
     KIO::TransferJob *m_job;
Index: kate/part/katedocument.cpp
===================================================================
--- kate/part/katedocument.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/katedocument.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2895,8 +2895,8 @@
       {
         QChar end_ch;
         bool complete = true;
-        QChar prevChar = textLine->getChar(view->cursorColumn()-1);
-        QChar nextChar = textLine->getChar(view->cursorColumn());
+        QChar prevChar = textLine->getChar(view->cursorColumnReal()-1);
+        QChar nextChar = textLine->getChar(view->cursorColumnReal());
         switch(ch) {
           case '(': end_ch = ')'; break;
           case '[': end_ch = ']'; break;
@@ -3176,7 +3176,8 @@
   if (view->blockSelectionMode())
     view->setCursorPositionInternal (line+lines, column);
 
-  if (m_indenter->canProcessLine())
+  if (m_indenter->canProcessLine()
+      && config()->configFlags() & KateDocumentConfig::cfIndentPastedText)
   {
     editStart();
 
@@ -4513,6 +4514,8 @@
       add view stuff
 */
 QRegExp KateDocument::kvLine = QRegExp("kate:(.*)");
+QRegExp KateDocument::kvLineWildcard = QRegExp("kate-wildcard\\((.*)\\):(.*)");
+QRegExp KateDocument::kvLineMime = QRegExp("kate-mimetype\\((.*)\\):(.*)");
 QRegExp KateDocument::kvVar = QRegExp("([\\w\\-]+)\\s+([^;]+)");
 
 void KateDocument::readVariables(bool onlyViewAndRenderer)
@@ -4552,122 +4555,171 @@
 
 void KateDocument::readVariableLine( QString t, bool onlyViewAndRenderer )
 {
+  // simple check first, no regex
+  // no kate inside, no vars, simple...
+  if (t.find("kate") < 0)
+    return;
+
+  // found vars, if any
+  QString s;
+
   if ( kvLine.search( t ) > -1 )
   {
-    QStringList vvl; // view variable names
-    vvl << "dynamic-word-wrap" << "dynamic-word-wrap-indicators"
-        << "line-numbers" << "icon-border" << "folding-markers"
-        << "bookmark-sorting" << "auto-center-lines"
-        << "icon-bar-color"
-        // renderer
-        << "background-color" << "selection-color"
-        << "current-line-color" << "bracket-highlight-color"
-        << "word-wrap-marker-color"
-        << "font" << "font-size" << "scheme";
-    int p( 0 );
-    QString s = kvLine.cap(1);
-    QString  var, val;
-    while ( (p = kvVar.search( s, p )) > -1 )
+    s = kvLine.cap(1);
+
+    kdDebug (13020) << "normal variable line kate: matched: " << s << endl;
+  }
+  else if (kvLineWildcard.search( t ) > -1) // regex given
+  {
+    QStringList wildcards (QStringList::split(';', kvLineWildcard.cap(1)));
+    QString nameOfFile = url().fileName();
+
+    bool found = false;
+    for (int i = 0; !found && i < wildcards.size(); ++i)
     {
-      p += kvVar.matchedLength();
-      var = kvVar.cap( 1 );
-      val = kvVar.cap( 2 ).stripWhiteSpace();
-      bool state; // store booleans here
-      int n; // store ints here
+      QRegExp wildcard (wildcards[i], true/*Qt::CaseSensitive*/, true/*QRegExp::Wildcard*/);
 
-      // only apply view & renderer config stuff
-      if (onlyViewAndRenderer)
+      found = wildcard.exactMatch (nameOfFile);
+    }
+
+    // nothing usable found...
+    if (!found)
+      return;
+
+    s = kvLineWildcard.cap(2);
+
+    kdDebug (13020) << "guarded variable line kate-wildcard: matched: " << s << endl;
+  }
+  else if (kvLineMime.search( t ) > -1) // mime-type given
+  {
+    QStringList types (QStringList::split(';', kvLineMime.cap(1)));
+
+    // no matching type found
+    if (!types.contains (mimeType ()))
+      return;
+
+    s = kvLineMime.cap(2);
+
+    kdDebug (13020) << "guarded variable line kate-mimetype: matched: " << s << endl;
+  }
+  else // nothing found
+  {
+    return;
+  }
+
+  QStringList vvl; // view variable names
+  vvl << "dynamic-word-wrap" << "dynamic-word-wrap-indicators"
+      << "line-numbers" << "icon-border" << "folding-markers"
+      << "bookmark-sorting" << "auto-center-lines"
+      << "icon-bar-color"
+      // renderer
+      << "background-color" << "selection-color"
+      << "current-line-color" << "bracket-highlight-color"
+      << "word-wrap-marker-color"
+      << "font" << "font-size" << "scheme";
+  int p( 0 );
+
+  QString  var, val;
+  while ( (p = kvVar.search( s, p )) > -1 )
+  {
+    p += kvVar.matchedLength();
+    var = kvVar.cap( 1 );
+    val = kvVar.cap( 2 ).stripWhiteSpace();
+    bool state; // store booleans here
+    int n; // store ints here
+
+    // only apply view & renderer config stuff
+    if (onlyViewAndRenderer)
+    {
+      if ( vvl.contains( var ) ) // FIXME define above
+        setViewVariable( var, val );
+    }
+    else
+    {
+      // BOOL  SETTINGS
+      if ( var == "word-wrap" && checkBoolValue( val, &state ) )
+        setWordWrap( state ); // ??? FIXME CHECK
+      else if ( var == "block-selection"  && checkBoolValue( val, &state ) )
+        setBlockSelectionMode( state );
+      // KateConfig::configFlags
+      // FIXME should this be optimized to only a few calls? how?
+      else if ( var == "backspace-indents" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfBackspaceIndents, state );
+      else if ( var == "replace-tabs" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfReplaceTabsDyn, state );
+      else if ( var == "remove-trailing-space" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfRemoveTrailingDyn, state );
+      else if ( var == "wrap-cursor" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfWrapCursor, state );
+      else if ( var == "auto-brackets" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfAutoBrackets, state );
+      else if ( var == "overwrite-mode" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfOvr, state );
+      else if ( var == "keep-indent-profile" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfKeepIndentProfile, state );
+      else if ( var == "keep-extra-spaces" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfKeepExtraSpaces, state );
+      else if ( var == "tab-indents" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfTabIndents, state );
+      else if ( var == "show-tabs" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfShowTabs, state );
+      else if ( var == "space-indent" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfSpaceIndent, state );
+      else if ( var == "smart-home" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfSmartHome, state );
+      else if ( var == "replace-trailing-space-save" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfRemoveSpaces, state );
+      else if ( var == "auto-insert-doxygen" && checkBoolValue( val, &state) )
+        m_config->setConfigFlags( KateDocumentConfig::cfDoxygenAutoTyping, state);
+      else if ( var == "mixed-indent" && checkBoolValue( val, &state ) )
+        m_config->setConfigFlags( KateDocumentConfig::cfMixedIndent, state );
+
+      // INTEGER SETTINGS
+      else if ( var == "tab-width" && checkIntValue( val, &n ) )
+        m_config->setTabWidth( n );
+      else if ( var == "indent-width"  && checkIntValue( val, &n ) )
+        m_config->setIndentationWidth( n );
+      else if ( var == "indent-mode" )
       {
-        if ( vvl.contains( var ) ) // FIXME define above
-          setViewVariable( var, val );
+        if ( checkIntValue( val, &n ) )
+          m_config->setIndentationMode( n );
+        else
+          m_config->setIndentationMode( KateAutoIndent::modeNumber( val) );
       }
-      else
+      else if ( var == "word-wrap-column" && n > 0  && checkIntValue( val, &n ) ) // uint, but hard word wrap at 0 will be no fun ;)
+        m_config->setWordWrapAt( n );
+      else if ( var == "undo-steps"  && n >= 0  && checkIntValue( val, &n ) )
+        setUndoSteps( n );
+
+      // STRING SETTINGS
+      else if ( var == "eol" || var == "end-of-line" )
       {
-        // BOOL  SETTINGS
-        if ( var == "word-wrap" && checkBoolValue( val, &state ) )
-          setWordWrap( state ); // ??? FIXME CHECK
-        else if ( var == "block-selection"  && checkBoolValue( val, &state ) )
-          setBlockSelectionMode( state );
-        // KateConfig::configFlags
-        // FIXME should this be optimized to only a few calls? how?
-        else if ( var == "backspace-indents" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfBackspaceIndents, state );
-        else if ( var == "replace-tabs" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfReplaceTabsDyn, state );
-        else if ( var == "remove-trailing-space" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfRemoveTrailingDyn, state );
-        else if ( var == "wrap-cursor" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfWrapCursor, state );
-        else if ( var == "auto-brackets" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfAutoBrackets, state );
-        else if ( var == "overwrite-mode" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfOvr, state );
-        else if ( var == "keep-indent-profile" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfKeepIndentProfile, state );
-        else if ( var == "keep-extra-spaces" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfKeepExtraSpaces, state );
-        else if ( var == "tab-indents" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfTabIndents, state );
-        else if ( var == "show-tabs" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfShowTabs, state );
-        else if ( var == "space-indent" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfSpaceIndent, state );
-        else if ( var == "smart-home" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfSmartHome, state );
-        else if ( var == "replace-trailing-space-save" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfRemoveSpaces, state );
-        else if ( var == "auto-insert-doxygen" && checkBoolValue( val, &state) )
-          m_config->setConfigFlags( KateDocumentConfig::cfDoxygenAutoTyping, state);
-        else if ( var == "mixed-indent" && checkBoolValue( val, &state ) )
-          m_config->setConfigFlags( KateDocumentConfig::cfMixedIndent, state );
-
-        // INTEGER SETTINGS
-        else if ( var == "tab-width" && checkIntValue( val, &n ) )
-          m_config->setTabWidth( n );
-        else if ( var == "indent-width"  && checkIntValue( val, &n ) )
-          m_config->setIndentationWidth( n );
-        else if ( var == "indent-mode" )
+        QStringList l;
+        l << "unix" << "dos" << "mac";
+        if ( (n = l.findIndex( val.lower() )) != -1 )
+          m_config->setEol( n );
+      }
+      else if ( var == "encoding" )
+        m_config->setEncoding( val );
+      else if ( var == "syntax" || var == "hl" )
+      {
+        for ( uint i=0; i < hlModeCount(); i++ )
         {
-          if ( checkIntValue( val, &n ) )
-            m_config->setIndentationMode( n );
-          else
-            m_config->setIndentationMode( KateAutoIndent::modeNumber( val) );
-        }
-        else if ( var == "word-wrap-column" && n > 0  && checkIntValue( val, &n ) ) // uint, but hard word wrap at 0 will be no fun ;)
-          m_config->setWordWrapAt( n );
-        else if ( var == "undo-steps"  && n >= 0  && checkIntValue( val, &n ) )
-          setUndoSteps( n );
-
-        // STRING SETTINGS
-        else if ( var == "eol" || var == "end-of-line" )
-        {
-          QStringList l;
-          l << "unix" << "dos" << "mac";
-          if ( (n = l.findIndex( val.lower() )) != -1 )
-            m_config->setEol( n );
-        }
-        else if ( var == "encoding" )
-          m_config->setEncoding( val );
-        else if ( var == "syntax" || var == "hl" )
-        {
-          for ( uint i=0; i < hlModeCount(); i++ )
+          if ( hlModeName( i ).lower() == val.lower() )
           {
-            if ( hlModeName( i ).lower() == val.lower() )
-            {
-              setHlMode( i );
-              break;
-            }
+            setHlMode( i );
+            break;
           }
         }
+      }
 
-        // VIEW SETTINGS
-        else if ( vvl.contains( var ) )
-          setViewVariable( var, val );
-        else
-        {
-          m_storedVariables.insert( var, val );
-          emit variableChanged( var, val );
-        }
+      // VIEW SETTINGS
+      else if ( vvl.contains( var ) )
+        setViewVariable( var, val );
+      else
+      {
+        m_storedVariables.insert( var, val );
+        emit variableChanged( var, val );
       }
     }
   }
Index: kate/part/kateautoindent.h
===================================================================
--- kate/part/kateautoindent.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateautoindent.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -67,8 +67,10 @@
  * This baseclass is a real dummy, does nothing beside remembering the document it belongs too,
  * only to have the object around
  */
-class KateAutoIndent
+class KateAutoIndent : public QObject
 {
+  Q_OBJECT
+
   /**
    * Static methods to create and list indention modes
    */
@@ -133,11 +135,13 @@
      */
     virtual ~KateAutoIndent ();
 
+  public slots:
     /**
      * Update indenter's configuration (indention width, attributes etc.)
      */
     virtual void updateConfig () {};
 
+  public:
     /**
      * does this indenter support processNewLine
      * @return can you do it?
@@ -212,6 +216,8 @@
  */
 class KateNormalIndent : public KateAutoIndent
 {
+  Q_OBJECT
+
 public:
     /**
      * Constructor
@@ -224,11 +230,13 @@
      */
   virtual ~KateNormalIndent ();
 
+public slots:
     /**
      * Update indenter's configuration (indention width, attributes etc.)
      */
   virtual void updateConfig ();
 
+public:
     /**
      * does this indenter support processNewLine
      * @return can you do it?
@@ -326,6 +334,7 @@
   uchar keywordAttrib;
   uchar normalAttrib;
   uchar extensionAttrib;
+  uchar preprocessorAttrib;
 
   bool  useSpaces;    //!< Should we use spaces or tabs to indent
   bool  mixedIndent;  //!< Optimize indent by mixing spaces and tabs, ala emacs
@@ -334,6 +343,8 @@
 
 class KateCSmartIndent : public KateNormalIndent
 {
+  Q_OBJECT
+
   public:
     KateCSmartIndent (KateDocument *doc);
     ~KateCSmartIndent ();
@@ -363,6 +374,8 @@
 
 class KatePythonIndent : public KateNormalIndent
 {
+  Q_OBJECT
+
   public:
     KatePythonIndent (KateDocument *doc);
     ~KatePythonIndent ();
@@ -381,6 +394,8 @@
 
 class KateXmlIndent : public KateNormalIndent
 {
+  Q_OBJECT
+
   public:
     KateXmlIndent (KateDocument *doc);
     ~KateXmlIndent ();
@@ -408,6 +423,8 @@
 
 class KateCSAndSIndent : public KateNormalIndent
 {
+  Q_OBJECT
+
   public:
     KateCSAndSIndent (KateDocument *doc);
     ~KateCSAndSIndent ();
@@ -467,9 +484,10 @@
  * The idea is to provide a somewhat intelligent indentation for perl, php,
  * bash, scheme and in general formats with humble indentation needs.
  */
-class KateVarIndent :  public QObject, public KateNormalIndent
+class KateVarIndent : public KateNormalIndent
 {
   Q_OBJECT
+
   public:
     /**
      * Purely for readability, couples we know and love
@@ -519,6 +537,8 @@
 
 class KateScriptIndent : public KateNormalIndent
 {
+  Q_OBJECT
+
   public:
     KateScriptIndent( KateDocument *doc );
     ~KateScriptIndent();
Index: kate/part/test_regression.h
===================================================================
--- kate/part/test_regression.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ kate/part/test_regression.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,186 @@
+/**
+ * This file is part of the KDE project
+ *
+ * Copyright (C) 2001,2003 Peter Kelly (pmk@post.com)
+ * Copyright 2006 Leo Savernik (l.savernik@aon.at)
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public License
+ * along with this library; see the file COPYING.LIB.  If not, write to
+ * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ * Boston, MA 02110-1301, USA.
+ *
+ */
+
+#ifndef TEST_REGRESSION_H
+#define TEST_REGRESSION_H
+
+#include <katejscript.h>
+#include <kateview.h>
+#include <kurl.h>
+#include <qobject.h>
+#include <qstringlist.h>
+#include <kjs/ustring.h>
+#include <kjs/object.h>
+#include <kjs/interpreter.h>
+
+class KateDocument;
+class KateView;
+class RegressionTest;
+class QTimer;
+
+namespace KParts {
+  class URLArgs;
+}
+
+/**
+ * @internal
+ * The backbone of Kate's automatic regression tests.
+ */
+class TestJScriptEnv : public KateJScript
+{
+  public:
+    TestJScriptEnv(KateDocument *part);
+    virtual ~TestJScriptEnv();
+
+    /** returns the global scope */
+    KJS::Object global() const { return *m_global; }
+    /** returns the script interpreter */
+    KJS::Interpreter &interpreter() { return *m_interpreter; }
+    /** returns the document scope */
+    KJS::Object document() const { return *m_document; }
+    /** returns the view scope */
+    KJS::Object view() const { return *m_view; }
+};
+
+/**
+ * @internal
+ */
+class KateViewObject : public KJS::ObjectImp
+{
+  public:
+    KateViewObject(KJS::ExecState *exec, KateView *v, KJS::ObjectImp *fallback);
+    virtual ~KateViewObject();
+
+    virtual const KJS::ClassInfo *classInfo() const;
+    virtual KJS::Value get(KJS::ExecState *exec, const KJS::Identifier &propertyName) const;
+
+  private:
+    // evil hack I: class layout of katejscript/KateJSView must be duplicated
+    // here, structurally as well as functionally
+    KateView *view;
+    // end evil hack
+    KJS::ObjectImp *fallback;
+};
+
+/**
+ * @internal
+ */
+class KateViewFunction : public KJS::ObjectImp
+{
+  public:
+    KateViewFunction(KJS::ExecState *exec, KateView *v, int _id, int length);
+
+    bool implementsCall() const;
+    KJS::Value call(KJS::ExecState *exec, KJS::Object &thisObj, const KJS::List &args);
+
+    enum { KeyReturn, Type };
+  private:
+    KateView *m_view;
+    int id;
+};
+
+/**
+ * @internal
+ */
+class RegressionTest : public QObject
+{
+  Q_OBJECT
+public:
+
+    RegressionTest(KateDocument *part, const QString &baseDir,
+                   const QString &outputDir, bool _genOutput);
+    ~RegressionTest();
+
+    enum OutputType { ResultDocument };
+    void testStaticFile(const QString& filename, const QStringList &commands);
+    enum CheckResult { Failure = 0, Success = 1, Ignored = 2 };
+    CheckResult checkOutput(const QString& againstFilename);
+    enum FailureType { NoFailure = 0, AllFailure = 1, ResultFailure = 4, NewFailure = 65536 };
+    bool runTests(QString relPath = QString::null, bool mustExist = false, int known_failure = NoFailure);
+    bool reportResult( bool passed, const QString & description = QString::null, bool *newfailure = 0 );
+    bool reportResult(CheckResult result, const QString & description = QString::null, bool *newfailure = 0 );
+    void createMissingDirs(const QString &path);
+
+    void setFailureSnapshotConfig(KConfig *cfg, const QString &snapshotname);
+    void setFailureSnapshotSaver(KConfig *cfg, const QString &snapshotname);
+
+    void createLink( const QString& test, int failures );
+    void doFailureReport( const QString& test, int failures );
+
+    KateDocument *m_part;
+    KateView *m_view;
+    QString m_baseDir;
+    QString m_outputDir;
+    bool m_genOutput;
+    QString m_currentBase;
+    KConfig *m_failureComp;
+    KConfig *m_failureSave;
+
+    QString m_currentOutput;
+    QString m_currentCategory;
+    QString m_currentTest;
+
+    bool m_keepOutput;
+    bool m_getOutput;
+    bool m_showGui;
+    int m_passes_work;
+    int m_passes_fail;
+    int m_passes_new;
+    int m_failures_work;
+    int m_failures_fail;
+    int m_failures_new;
+    int m_errors;
+    bool saw_failure;
+    bool ignore_errors;
+    int m_known_failures;
+
+    static RegressionTest *curr;
+
+private:
+    void printDescription(const QString& description);
+
+    static bool svnIgnored( const QString &filename );
+
+private:
+    /**
+     * evaluate script given by \c filename within the context of \c interp.
+     * @param ignore if \c true don't evaluate if script does not exist but
+     * return true nonetheless.
+     * @return true if script was valid, false otherwise
+     */
+    bool evalJS( KJS::Interpreter &interp, const QString &filename, bool ignore = false);
+    /**
+     * concatenate contents of all list files down to but not including the
+     * tests directory.
+     * @param relPath relative path against tests-directory
+     * @param filename file name of the list files
+     */
+    QStringList concatListFiles(const QString &relPath, const QString &filename);
+
+private slots:
+    void slotOpenURL(const KURL &url, const KParts::URLArgs &args);
+    void resizeTopLevelWidget( int, int );
+
+};
+
+#endif
Index: kate/part/katedialogs.h
===================================================================
--- kate/part/katedialogs.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/katedialogs.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -122,7 +122,7 @@
     void indenterSelected (int);
 
   protected:
-    enum { numFlags = 7 };
+    enum { numFlags = 8 };
     static const int flags[numFlags];
     QCheckBox *opt[numFlags];
     KIntNumInput *indentationWidth;
Index: kate/part/kateviewhelpers.cpp
===================================================================
--- kate/part/kateviewhelpers.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateviewhelpers.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -583,7 +583,7 @@
 ".+++++++++.",
 "..........."};
 
-static const char * bookmark_xpm[] = {
+static const char * const bookmark_xpm[] = {
 "14 13 82 1",
 "   c None",
 ".  c #F27D01",
@@ -684,9 +684,6 @@
 const int iconPaneWidth = 16;
 const int halfIPW = 8;
 
-static QPixmap minus_px ((const char**)minus_xpm);
-static QPixmap plus_px ((const char**)plus_xpm);
-
 KateIconBorder::KateIconBorder ( KateViewInternal* internalView, QWidget *parent )
   : QWidget(parent, "", Qt::WStaticContents | Qt::WRepaintNoErase | Qt::WResizeNoErase )
   , m_view( internalView->m_view )
@@ -848,6 +845,9 @@
 
 void KateIconBorder::paintBorder (int /*x*/, int y, int /*width*/, int height)
 {
+  static QPixmap minus_px ((const char**)minus_xpm);
+  static QPixmap plus_px ((const char**)plus_xpm);
+
   uint h = m_view->renderer()->config()->fontStruct()->fontHeight;
   uint startz = (y / h);
   uint endz = startz + 1 + (height / h);
Index: kate/part/kateconfig.cpp
===================================================================
--- kate/part/kateconfig.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateconfig.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -168,7 +168,8 @@
     | KateDocumentConfig::cfKeepIndentProfile
     | KateDocumentConfig::cfWrapCursor
     | KateDocumentConfig::cfShowTabs
-    | KateDocumentConfig::cfSmartHome));
+    | KateDocumentConfig::cfSmartHome
+    | KateDocumentConfig::cfIndentPastedText));
 
   setEncoding (config->readEntry("Encoding", ""));
 
Index: kate/part/kateviewinternal.cpp
===================================================================
--- kate/part/kateviewinternal.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateviewinternal.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -870,7 +870,10 @@
 void KateViewInternal::updateMicroFocusHint()
 {
     int line = displayViewLine(displayCursor, true);
-    if (line == -1)
+    /* Check for hasFocus() to avoid crashes in QXIMInputContext as in bug #131266.
+    This is only a workaround until somebody can find the real reason of the crash
+    (probably it's in Qt). */
+    if (line == -1 || !hasFocus()) 
         return;
 
     KateRenderer *renderer = m_view->renderer();
@@ -1258,20 +1261,17 @@
     m_view->m_codeCompletion->handleKey(&e);
     return;
   }
-  
-  // FIXME: Both "smart end" and "smart home" use the current range's last/first character
-  //        when jumping to the "absolute" extreme. For 4.0 and 3.5.5 (kling)
-  bool alreadyAtEndOfLine = false;
 
-  if (m_view->dynWordWrap() && currentRange().wrap) {
+  KateLineRange range = currentRange();
+
+  if (m_view->dynWordWrap() && range.wrap) {
     // Allow us to go to the real end if we're already at the end of the view line
-    if (cursor.col() < currentRange().endCol - 1) {
-      KateTextCursor c(cursor.line(), currentRange().endCol - 1);
+    if (cursor.col() < range.endCol - 1) {
+      KateTextCursor c(cursor.line(), range.endCol - 1);
       updateSelection( c, sel );
       updateCursor( c );
       return;
     }
-    alreadyAtEndOfLine = true;
   }
 
   if( !(m_doc->configFlags() & KateDocument::cfSmartHome) ) {
@@ -1286,23 +1286,16 @@
 
   // "Smart End", as requested in bugs #78258 and #106970
   KateTextCursor c = cursor;
-  int lc = l->lastChar();
 
-  // Apparently, currentRange().endCol differs by 1 depending on m_view->dynWordWrap()...
-  int endOfLine = currentRange().endCol - (m_view->dynWordWrap() ? 1 : 0);
-
-  if (lc < 0 || c.col() == (lc + 1)) {
-    if (alreadyAtEndOfLine) {
-      moveEdge(right, sel);
-      return;
-    }
-    c.setCol(endOfLine);
+  // If the cursor is already the real end, jump to last non-space character.
+  // Otherwise, go to the real end ... obviously.
+  if (c.col() == m_doc->lineLength(c.line())) {
+    c.setCol(l->lastChar() + 1);
+    updateSelection(c, sel);
+    updateCursor(c, true);
   } else {
-    c.setCol(lc + 1);
+    moveEdge(right, sel);
   }
-
-  updateSelection( c, sel );
-  updateCursor( c, true );
 }
 
 KateLineRange KateViewInternal::range(int realLine, const KateLineRange* previous)
@@ -2682,8 +2675,6 @@
           selStartCached = m_view->selectStart;
           selEndCached = m_view->selectEnd;
 
-          cursor.setCol(0);
-          updateCursor( cursor, true );
           e->accept ();
           return;
         }
@@ -2746,6 +2737,11 @@
         selectAnchor = KateTextCursor (m_view->selEndLine(), m_view->selEndCol());
         selStartCached = m_view->selectStart;
         selEndCached = m_view->selectEnd;
+
+        // if we didn't actually select anything, restore the selection mode
+        // -- see bug #131369 (kling)
+        if (!m_view->hasSelection())
+          m_selectionMode = Default;
       }
 
       // Move cursor to end of selected word
@@ -2755,9 +2751,6 @@
         m_view->copy();
         QApplication::clipboard()->setSelectionMode( false );
 
-        cursor.setPos(m_view->selectEnd);
-        updateCursor( cursor, true );
-
         selStartCached = m_view->selectStart;
         selEndCached = m_view->selectEnd;
       }
Index: kate/part/kateautoindent.cpp
===================================================================
--- kate/part/kateautoindent.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/kateautoindent.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -31,6 +31,8 @@
 #include <kdebug.h>
 #include <kpopupmenu.h>
 
+#include <cctype>
+
 //BEGIN KateAutoIndent
 
 KateAutoIndent *KateAutoIndent::createIndenter (KateDocument *doc, uint mode)
@@ -146,7 +148,7 @@
 }
 
 KateAutoIndent::KateAutoIndent (KateDocument *_doc)
-: doc(_doc)
+: QObject(), doc(_doc)
 {
 }
 KateAutoIndent::~KateAutoIndent ()
@@ -168,7 +170,7 @@
 
   popupMenu()->clear ();
   for (uint z=0; z<modes.size(); ++z)
-    popupMenu()->insertItem ( '&' + KateAutoIndent::modeDescription(z), this, SLOT(setMode(int)), 0,  z);
+    popupMenu()->insertItem ( '&' + KateAutoIndent::modeDescription(z).replace('&', "&&"), this, SLOT(setMode(int)), 0,  z);
 
   popupMenu()->setItemChecked (doc->config()->indentationMode(), true);
 }
@@ -184,7 +186,10 @@
 KateNormalIndent::KateNormalIndent (KateDocument *_doc)
  : KateAutoIndent (_doc)
 {
+  // if highlighting changes, update attributes
+  connect(_doc, SIGNAL(hlChanged()), this, SLOT(updateConfig()));
 }
+
 KateNormalIndent::~KateNormalIndent ()
 {
 }
@@ -209,6 +214,7 @@
   keywordAttrib = 255;
   normalAttrib = 255;
   extensionAttrib = 255;
+  preprocessorAttrib = 255;
 
   KateHlItemDataList items;
   doc->highlight()->getKateHlItemDataListCopy (0, items);
@@ -256,6 +262,10 @@
     {
       extensionAttrib = i;
     }
+    else if (name.find("Preprocessor") != -1 && preprocessorAttrib == 255)
+    {
+      preprocessorAttrib = i;
+    }
   }
 }
 
@@ -318,16 +328,20 @@
     uchar attrib = cur.currentAttrib();
     const QString hlFile = doc->highlight()->hlKeyForAttrib( attrib );
 
-    if (attrib != commentAttrib && attrib != regionAttrib && attrib != alertAttrib && !hlFile.endsWith("doxygen.xml"))
+    if (attrib != commentAttrib && attrib != regionAttrib && attrib != alertAttrib && attrib != preprocessorAttrib && !hlFile.endsWith("doxygen.xml"))
     {
       QChar c = cur.currentChar();
       if (!c.isNull() && !c.isSpace())
         break;
     }
 
-    // Make sure col is 0 if we spill into next line  i.e. count the '\n' as a character
     if (!cur.moveForward(1))
+    {
+      // not able to move forward, so set cur to max
+      cur = max;
       break;
+    }
+    // Make sure col is 0 if we spill into next line  i.e. count the '\n' as a character
     if (curLine != cur.line())
     {
       if (!newline)
@@ -551,10 +565,14 @@
   {
     KateTextLine::Ptr textLine = doc->plainKateTextLine(line);
     bool insideDoxygen = false;
+    bool justAfterDoxygen = false;
     if (textLine->attribute(first) == doxyCommentAttrib || textLine->attribute(textLine->lastChar()) == doxyCommentAttrib)
     {
-      if (!textLine->stringAtPos(textLine->lastChar()-1, "*/"))
+      const int last = textLine->lastChar();
+      if (last <= 0 || !(justAfterDoxygen = textLine->stringAtPos(last-1, "*/")))
         insideDoxygen = true;
+      if (justAfterDoxygen)
+        justAfterDoxygen &= textLine->string().find("/**") < 0;
       while (textLine->attribute(first) != doxyCommentAttrib && first <= textLine->lastChar())
         first++;
       if (textLine->stringAtPos(first, "//"))
@@ -583,6 +601,21 @@
 
       return true;
     }
+    // Align position with beginning of doxygen comment. Otherwise the
+    // indentation is one too much.
+    else if (justAfterDoxygen)
+    {
+      textLine = doc->plainKateTextLine(begin.line());
+      first = textLine->firstChar();
+      int indent = findOpeningComment(begin);
+      QString filler = tabString (indent);
+      
+      doc->removeText (begin.line(), 0, begin.line(), first);
+      doc->insertText (begin.line(), 0, filler);
+      begin.setCol(filler.length());
+      
+      return true;
+    }
   }
 
   return false;
@@ -622,7 +655,12 @@
 
 void KateCSmartIndent::processChar(QChar c)
 {
-  static const QString triggers("}{)/:;#n");
+  // You may be curious about 'n' among the triggers:
+  // It is used to discriminate C#'s #region/#endregion which are indented
+  // against normal preprocessing statements which aren't indented.
+  static const QString triggers("}{)/:#n");
+  static const QString firstTriggers("}{)/:#");
+  static const QString lastTriggers(":n");
   if (triggers.find(c) < 0)
     return;
 
@@ -630,31 +668,39 @@
   KateDocCursor begin(view->cursorLine(), 0, doc);
 
   KateTextLine::Ptr textLine = doc->plainKateTextLine(begin.line());
+  const int first = textLine->firstChar();
+  const QChar firstChar = textLine->getChar(first);
   if (c == 'n')
   {
-    if (textLine->getChar(textLine->firstChar()) != '#')
+    if (firstChar != '#')
       return;
   }
 
-  if ( textLine->attribute( begin.col() ) == doxyCommentAttrib )
+  if ( c == '/' )
   {
     // dominik: if line is "* /", change it to "*/"
-    if ( c == '/' )
+    if ( textLine->attribute( begin.col() ) == doxyCommentAttrib )
     {
-      int first = textLine->firstChar();
       // if the first char exists and is a '*', and the next non-space-char
       // is already the just typed '/', concatenate it to "*/".
       if ( first != -1
-           && textLine->getChar( first ) == '*'
-           && textLine->nextNonSpaceChar( first+1 ) == view->cursorColumn()-1 )
-        doc->removeText( view->cursorLine(), first+1, view->cursorLine(), view->cursorColumn()-1);
+           && firstChar == '*'
+           && textLine->nextNonSpaceChar( first+1 ) == view->cursorColumnReal()-1 )
+        doc->removeText( view->cursorLine(), first+1, view->cursorLine(), view->cursorColumnReal()-1);
     }
 
-    // anders: don't change the indent of doxygen lines here.
+    // ls: never have comments change the indentation.
     return;
   }
 
-  processLine(begin);
+  // ls: only reindent line if the user actually expects it
+  // I. e. take action on single braces on line or last colon, but inhibit
+  // any reindentation if any of those characters appear amidst some section
+  // of the line
+  const QChar lastChar = textLine->getChar(textLine->lastChar());
+  if ((c == firstChar && firstTriggers.find(firstChar) >= 0)
+      || (c == lastChar && lastTriggers.find(lastChar) >= 0))
+    processLine(begin);
 }
 
 
@@ -1494,7 +1540,7 @@
   bool doxygenAutoInsert = doc->config()->configFlags() & KateDocumentConfig::cfDoxygenAutoTyping;
 
   // starts with *: indent one space more to line up *s
-  if ( textLine->stringAtPos(first, "*") )
+  if ( first >= 0 && textLine->stringAtPos(first, "*") )
     indent = indent + " ";
   // does not start with *: insert one if user wants that
   else if ( doxygenAutoInsert )
@@ -1538,44 +1584,62 @@
  * Does the line @p line start with a label?
  * @note May also return @c true if the line starts in a continuation.
  */
-bool KateCSAndSIndent::startsWithLabel( int line )
-{
-  KateTextLine::Ptr indentLine = doc->plainKateTextLine( line );
+bool KateCSAndSIndent::startsWithLabel( int line ) 
+{ 
+  // Get the current line.
+  KateTextLine::Ptr indentLine = doc->plainKateTextLine(line);
   const int indentFirst = indentLine->firstChar();
-
+  
+  // Not entirely sure what this check does.
   int attrib = indentLine->attribute(indentFirst);
   if (attrib != 0 && attrib != keywordAttrib && attrib != normalAttrib && attrib != extensionAttrib)
     return false;
-
+  
+  // Get the line text.
   const QString lineContents = indentLine->string();
-  static const QString symbols = QString::fromLatin1(";:[]{}");
-  const int last = indentLine->lastChar();
-  for ( int n = indentFirst + 1; n <= last; ++n )
+  const int indentLast = indentLine->lastChar();
+  bool whitespaceFound = false;
+  for ( int n = indentFirst; n <= indentLast; ++n )
   {
-    QChar c = lineContents[n];
-    // FIXME: symbols inside comments are not skipped
-    if ( !symbols.contains(c) )
-      continue;
-
-    // if we find a symbol other than a :, this is not a label.
-    if ( c != ':' )
-      return false;
-
-    // : but not ::, this is a label.
-    if ( lineContents[n+1] != ':' )
+    // Get the character as latin1. Can't use QChar::isLetterOrNumber()
+    // as that includes non 0-9 numbers.
+    char c = lineContents[n].latin1();
+    if ( c == ':' )
+    {
+      // See if the next character is ':' - if so, skip to the character after it.
+      if ( n < lineContents.length() - 1 )
+      {
+        if ( lineContents[n+1].latin1() == ':' )
+        {
+          n += 2;
+          continue;
+        }
+      }
+      // Right this is the relevent ':'.
+      if ( n == indentFirst)
+      {
+        // Just a line with a : on it.
+        return false;
+      }
+      // It is a label of some kind!
       return true;
-
-    // xy::[^:] is a scope-resolution operator. can occur in case X::Y: for instance.
-    // skip both :s and keep going.
-    if ( lineContents[n+2] != ':' )
+    }
+    if (isspace(c))
     {
-      ++n;
-      continue;
+      if (!whitespaceFound)
+      {
+        if (lineContents.mid(indentFirst, n - indentFirst) == "case")
+          return true;
+        else if (lineContents.mid(indentFirst, n - indentFirst) == "class")
+          return false;
+        whitespaceFound = true;
+      }
     }
-
-    // xy::: outside a continuation is a label followed by a scope-resolution operator.
-    // more than 3 :s is illegal, so we don't care that's not indented.
-    return true;
+    // All other characters don't indent.
+    else if ( !isalnum(c) && c != '_' )
+    {
+      return false;
+    }
   }
   return false;
 }
@@ -1967,8 +2031,8 @@
       // is already the just typed '/', concatenate it to "*/".
       if ( first != -1
            && textLine->getChar( first ) == '*'
-           && textLine->nextNonSpaceChar( first+1 ) == view->cursorColumn()-1 )
-        doc->removeText( view->cursorLine(), first+1, view->cursorLine(), view->cursorColumn()-1);
+           && textLine->nextNonSpaceChar( first+1 ) == view->cursorColumnReal()-1 )
+        doc->removeText( view->cursorLine(), first+1, view->cursorLine(), view->cursorColumnReal()-1);
     }
 
     // anders: don't change the indent of doxygen lines here.
@@ -1990,7 +2054,7 @@
 };
 
 KateVarIndent::KateVarIndent( KateDocument *doc )
-: QObject( 0, "variable indenter"), KateNormalIndent( doc )
+: KateNormalIndent( doc )
 {
   d = new KateVarIndentPrivate;
   d->reIndentAfter = QRegExp( doc->variable( "var-indent-indent-after" ) );
@@ -2038,8 +2102,6 @@
 
 void KateVarIndent::processLine ( KateDocCursor &line )
 {
-  updateConfig(); // ### is it really nessecary *each time* ??
-
   QString indent; // store the indent string here
 
   // find the first line with content that is not starting with comment text,
Index: kate/part/test_regression.cpp
===================================================================
--- kate/part/test_regression.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ kate/part/test_regression.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,1127 @@
+/**
+ * This file is part of the KDE project
+ *
+ * Copyright (C) 2001,2003 Peter Kelly (pmk@post.com)
+ * Copyright (C) 2003,2004 Stephan Kulow (coolo@kde.org)
+ * Copyright (C) 2004 Dirk Mueller ( mueller@kde.org )
+ * Copyright 2006 Leo Savernik (l.savernik@aon.at)
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public License
+ * along with this library; see the file COPYING.LIB.  If not, write to
+ * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ * Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include <stdlib.h>
+#include <sys/time.h>
+#include <sys/resource.h>
+#include <sys/types.h>
+#include <unistd.h>
+#include <pwd.h>
+#include <signal.h>
+
+#include <kapplication.h>
+#include <kstandarddirs.h>
+#include <qimage.h>
+#include <qfile.h>
+#include "test_regression.h"
+#include <unistd.h>
+#include <stdio.h>
+
+#include <kaction.h>
+#include <kcmdlineargs.h>
+#include "katefactory.h"
+#include <kio/job.h>
+#include <kmainwindow.h>
+#include <ksimpleconfig.h>
+#include <kglobalsettings.h>
+
+#include <qcolor.h>
+#include <qcursor.h>
+#include <qdir.h>
+#include <qevent.h>
+#include <qobject.h>
+#include <qpushbutton.h>
+#include <qscrollview.h>
+#include <qstring.h>
+#include <qregexp.h>
+#include <qtextstream.h>
+#include <qvaluelist.h>
+#include <qwidget.h>
+#include <qfileinfo.h>
+#include <qtimer.h>
+#include <kstatusbar.h>
+#include <qfileinfo.h>
+
+#include "katedocument.h"
+#include "kateview.h"
+#include <kparts/browserextension.h>
+#include "katejscript.h"
+#include "katedocumenthelpers.h"
+#include "kateconfig.h"
+#include "../interfaces/katecmd.h"
+
+using namespace KJS;
+
+#define BASE_DIR_CONFIG "/.testkateregression-3.5"
+
+//BEGIN TestJScriptEnv
+
+TestJScriptEnv::TestJScriptEnv(KateDocument *part) {
+  ExecState *exec = m_interpreter->globalExec();
+
+  KJS::ObjectImp *wd = wrapDocument(m_interpreter->globalExec(), part);
+  KateView *v = static_cast<KateView *>(part->widget());
+  KJS::ObjectImp *wv = new KateViewObject(exec, v, wrapView(m_interpreter->globalExec(), v));
+
+  *m_view = KJS::Object(wv);
+  *m_document = KJS::Object(wd);
+
+  // add convenience shortcuts
+  m_interpreter->globalObject().put(exec, "d", *m_document);
+  m_interpreter->globalObject().put(exec, "v", *m_view);
+
+}
+
+TestJScriptEnv::~TestJScriptEnv() {
+}
+
+//END TestJScriptEnv
+
+//BEGIN KateViewObject
+
+KateViewObject::KateViewObject(ExecState *exec, KateView *v, ObjectImp *fallback)
+  : view(v), fallback(fallback)
+{
+    fallback->ref();
+
+    putDirect("keyReturn", new KateViewFunction(exec,v,KateViewFunction::KeyReturn,0), DontEnum);
+    putDirect("enter", new KateViewFunction(exec,v,KateViewFunction::KeyReturn,0), DontEnum);
+    putDirect("type", new KateViewFunction(exec,v,KateViewFunction::Type,1), DontEnum);
+}
+
+KateViewObject::~KateViewObject()
+{
+    fallback->deref();
+}
+
+const ClassInfo *KateViewObject::classInfo() const {
+    // evil hack II: disguise as fallback, otherwise we can't fall back
+    return fallback->classInfo();
+}
+
+Value KateViewObject::get(ExecState *exec, const Identifier &propertyName) const
+{
+    ValueImp *val = getDirect(propertyName);
+    if (val)
+        return Value(val);
+
+    return fallback->get(exec, propertyName);
+}
+
+//END KateViewObject
+
+//BEGIN KateViewFunction
+
+KateViewFunction::KateViewFunction(ExecState */*exec*/, KateView *v, int _id, int length)
+{
+    m_view = v;
+    id = _id;
+    putDirect("length",length);
+}
+
+bool KateViewFunction::implementsCall() const
+{
+    return true;
+}
+
+Value KateViewFunction::call(ExecState *exec, Object &/*thisObj*/, const List &args)
+{
+    Value result = Undefined();
+
+    switch (id) {
+        case KeyReturn: {
+            m_view->keyReturn();
+            break;
+        }
+        case Type: {
+            UString str = args[0].toString(exec);
+            QString res = str.qstring();
+            result = Boolean(m_view->doc()->typeChars(m_view, res));
+            break;
+        }
+    }
+
+    return result;
+}
+
+//END KateViewFunction
+
+// -------------------------------------------------------------------------
+
+const char failureSnapshotPrefix[] = "testkateregressionrc-FS.";
+
+static QString findMostRecentFailureSnapshot() {
+    QDir dir(kapp->dirs()->saveLocation("config"),
+             QString(failureSnapshotPrefix)+"*",
+             QDir::Time, QDir::Files);
+    return dir[0].mid(sizeof failureSnapshotPrefix - 1);
+}
+
+static KCmdLineOptions options[] =
+{
+    { "b", 0, 0 },
+    { "base <base_dir>", "Directory containing tests, basedir and output directories.", 0},
+    { "cmp-failures <snapshot>", "Compare failures of this testrun against snapshot <snapshot>. Defaults to the most recently captured failure snapshot or none if none exists.", 0 },
+    { "d", 0, 0 },
+    { "debug", "Do not supress debug output", 0},
+    { "g", 0, 0 } ,
+    { "genoutput", "Regenerate baseline (instead of checking)", 0 } ,
+    { "keep-output", "Keep output files even on success", 0 },
+    { "save-failures <snapshot>", "Save failures of this testrun as failure snapshot <snapshot>", 0 },
+    { "s", 0, 0 } ,
+    { "show", "Show the window while running tests", 0 } ,
+    { "t", 0, 0 } ,
+    { "test <filename>", "Only run a single test. Multiple options allowed.", 0 } ,
+    { "o", 0, 0 },
+    { "output <directory>", "Put output in <directory> instead of <base_dir>/output", 0 } ,
+    { "+[base_dir]", "Directory containing tests,basedir and output directories. Only regarded if -b is not specified.", 0 } ,
+    { "+[testcases]", "Relative path to testcase, or directory of testcases to be run (equivalent to -t).", 0 } ,
+    KCmdLineLastOption
+};
+
+int main(int argc, char *argv[])
+{
+    // forget about any settings
+    passwd* pw = getpwuid( getuid() );
+    if (!pw) {
+        fprintf(stderr, "dang, I don't even know who I am.\n");
+        exit(1);
+    }
+
+    QString kh("/var/tmp/%1_kate_non_existent");
+    kh = kh.arg( pw->pw_name );
+    setenv( "KDEHOME", kh.latin1(), 1 );
+    setenv( "LC_ALL", "C", 1 );
+    setenv( "LANG", "C", 1 );
+
+//     signal( SIGALRM, signal_handler );
+
+    KCmdLineArgs::init(argc, argv, "testregression", "TestRegression",
+                       "Regression tester for kate", "1.0");
+    KCmdLineArgs::addCmdLineOptions(options);
+
+    KCmdLineArgs *args = KCmdLineArgs::parsedArgs( );
+
+    QCString baseDir = args->getOption("base");
+    QCString baseDirConfigFile(::getenv("HOME") + QCString(BASE_DIR_CONFIG));
+    {
+        QFile baseDirConfig(baseDirConfigFile);
+        if (baseDirConfig.open(IO_ReadOnly)) {
+            QTextStream bds(&baseDirConfig);
+            baseDir = bds.readLine().latin1();
+        }
+    }
+
+    if ( args->count() < 1 && baseDir.isEmpty() ) {
+        printf("For regression testing, make sure to have checked out the kate regression\n"
+               "testsuite from svn:\n"
+               "\tsvn co \"https://<user>@svn.kde.org:/home/kde/trunk/tests/katetests/regression\"\n"
+               "Remember the root path into which you checked out the testsuite.\n"
+               "\n");
+	printf("%s needs the root path of the kate regression\n"
+               "testsuite to function properly\n"
+               "By default, the root path is looked up in the file\n"
+               "\t%s\n"
+               "If it doesn't exist yet, create it by invoking\n"
+               "\techo \"<root-path>\" > %s\n"
+               "You may override the location by specifying the root explicitly on the\n"
+               "command line with option -b\n"
+               "", KCmdLineArgs::appName(),
+               (const char *)baseDirConfigFile,
+               (const char *)baseDirConfigFile);
+	::exit( 1 );
+    }
+
+    int testcase_index = 0;
+    if (baseDir.isEmpty()) baseDir = args->arg(testcase_index++);
+
+    QFileInfo bdInfo(baseDir);
+    baseDir = QFile::encodeName(bdInfo.absFilePath());
+
+    const char *subdirs[] = {"tests", "baseline", "output", "resources"};
+    for ( int i = 0; i < 2; i++ ) {
+        QFileInfo sourceDir(QFile::encodeName( baseDir ) + "/" + subdirs[i]);
+        if ( !sourceDir.exists() || !sourceDir.isDir() ) {
+            fprintf(stderr,"ERROR: Source directory \"%s/%s\": no such directory.\n", (const char *)baseDir, subdirs[i]);
+            exit(1);
+        }
+    }
+
+    KApplication a;
+    a.disableAutoDcopRegistration();
+    a.setStyle("windows");
+    KSimpleConfig cfg( "testkateregressionrc" );
+    cfg.setGroup("Kate Document Defaults");
+    cfg.writeEntry("Basic Config Flags",
+      KateDocumentConfig::cfBackspaceIndents
+//       | KateDocumentConfig::cfWordWrap
+//       | KateDocumentConfig::cfRemoveSpaces
+      | KateDocumentConfig::cfWrapCursor
+//       | KateDocumentConfig::cfAutoBrackets
+//       | KateDocumentConfig::cfTabIndentsMode
+//       | KateDocumentConfig::cfOvr
+      | KateDocumentConfig::cfKeepIndentProfile
+      | KateDocumentConfig::cfKeepExtraSpaces
+      | KateDocumentConfig::cfTabIndents
+      | KateDocumentConfig::cfShowTabs
+      | KateDocumentConfig::cfSpaceIndent
+      | KateDocumentConfig::cfSmartHome
+      | KateDocumentConfig::cfTabInsertsTab
+//       | KateDocumentConfig::cfReplaceTabsDyn
+//       | KateDocumentConfig::cfRemoveTrailingDyn
+      | KateDocumentConfig::cfDoxygenAutoTyping
+//       | KateDocumentConfig::cfMixedIndent
+      | KateDocumentConfig::cfIndentPastedText
+    );
+    cfg.sync();
+
+    int rv = 1;
+
+    {
+        KSimpleConfig dc( "kdebugrc" );
+        // FIXME adapt to kate
+        static int areas[] = { 1000, 13000, 13001, 13002, 13010,
+                               13020, 13025, 13030, 13033, 13035,
+                               13040, 13050, 13051, 7000, 7006, 170,
+                               171, 7101, 7002, 7019, 7027, 7014,
+                               7001, 7011, 6070, 6080, 6090, 0};
+        int channel = args->isSet( "debug" ) ? 2 : 4;
+        for ( int i = 0; areas[i]; ++i ) {
+            dc.setGroup( QString::number( areas[i] ) );
+            dc.writeEntry( "InfoOutput", channel );
+        }
+        dc.sync();
+
+        kdClearDebugConfig();
+    }
+
+    // create widgets
+    KateFactory *fac = KateFactory::self();
+    KMainWindow *toplevel = new KMainWindow();
+    KateDocument *part = new KateDocument(/*bSingleViewMode*/true,
+                                          /*bBrowserView*/false,
+                                          /*bReadOnly*/false,
+                                          /*parentWidget*/toplevel,
+                                          /*widgetName*/"testkate");
+    part->readConfig(&cfg);
+
+    toplevel->setCentralWidget( part->widget() );
+
+    Q_ASSERT(part->config()->configFlags() & KateDocumentConfig::cfDoxygenAutoTyping);
+
+    bool visual = false;
+    if (args->isSet("show"))
+	visual = true;
+
+    a.setTopWidget(part->widget());
+    a.setMainWidget( toplevel );
+    if ( visual )
+        toplevel->show();
+
+    // we're not interested
+    toplevel->statusBar()->hide();
+
+    if (!getenv("KDE_DEBUG")) {
+        // set ulimits
+        rlimit vmem_limit = { 256*1024*1024, RLIM_INFINITY };	// 256Mb Memory should suffice
+        setrlimit(RLIMIT_AS, &vmem_limit);
+        rlimit stack_limit = { 8*1024*1024, RLIM_INFINITY };	// 8Mb Memory should suffice
+        setrlimit(RLIMIT_STACK, &stack_limit);
+    }
+
+    // run the tests
+    RegressionTest *regressionTest = new RegressionTest(part,
+                                                        baseDir,
+                                                        args->getOption("output"),
+                                                        args->isSet("genoutput"));
+    QObject::connect(part->browserExtension(), SIGNAL(openURLRequest(const KURL &, const KParts::URLArgs &)),
+		     regressionTest, SLOT(slotOpenURL(const KURL&, const KParts::URLArgs &)));
+    QObject::connect(part->browserExtension(), SIGNAL(resizeTopLevelWidget( int, int )),
+		     regressionTest, SLOT(resizeTopLevelWidget( int, int )));
+
+    regressionTest->m_keepOutput = args->isSet("keep-output");
+    regressionTest->m_showGui = args->isSet("show");
+
+    {
+        QString failureSnapshot = args->getOption("cmp-failures");
+        if (failureSnapshot.isEmpty())
+            failureSnapshot = findMostRecentFailureSnapshot();
+        if (!failureSnapshot.isEmpty())
+            regressionTest->setFailureSnapshotConfig(
+                    new KSimpleConfig(failureSnapshotPrefix + failureSnapshot, true),
+                    failureSnapshot);
+    }
+
+    if (args->isSet("save-failures")) {
+        QString failureSaver = args->getOption("save-failures");
+        regressionTest->setFailureSnapshotSaver(
+                new KSimpleConfig(failureSnapshotPrefix + failureSaver, false),
+                failureSaver);
+    }
+
+    bool result = false;
+    QCStringList tests = args->getOptionList("test");
+    // merge testcases specified on command line
+    for (; testcase_index < args->count(); testcase_index++)
+        tests << args->arg(testcase_index);
+    if (tests.count() > 0)
+        for (QValueListConstIterator<QCString> it = tests.begin(); it != tests.end(); ++it) {
+	    result = regressionTest->runTests(*it,true);
+            if (!result) break;
+        }
+    else
+	result = regressionTest->runTests();
+
+    if (result) {
+	if (args->isSet("genoutput")) {
+	    printf("\nOutput generation completed.\n");
+	}
+	else {
+	    printf("\nTests completed.\n");
+            printf("Total:    %d\n",
+                   regressionTest->m_passes_work+
+                   regressionTest->m_passes_fail+
+                   regressionTest->m_failures_work+
+                   regressionTest->m_failures_fail+
+                   regressionTest->m_errors);
+	    printf("Passes:   %d",regressionTest->m_passes_work);
+            if ( regressionTest->m_passes_fail )
+                printf( " (%d unexpected passes)", regressionTest->m_passes_fail );
+            if (regressionTest->m_passes_new)
+                printf(" (%d new since %s)", regressionTest->m_passes_new, regressionTest->m_failureComp->group().latin1());
+            printf( "\n" );
+	    printf("Failures: %d",regressionTest->m_failures_work);
+            if ( regressionTest->m_failures_fail )
+                printf( " (%d expected failures)", regressionTest->m_failures_fail );
+            if ( regressionTest->m_failures_new )
+                printf(" (%d new since %s)", regressionTest->m_failures_new, regressionTest->m_failureComp->group().latin1());
+            printf( "\n" );
+            if ( regressionTest->m_errors )
+                printf("Errors:   %d\n",regressionTest->m_errors);
+
+            QFile list( regressionTest->m_outputDir + "/links.html" );
+            list.open( IO_WriteOnly|IO_Append );
+            QString link, cl;
+            link = QString( "<hr>%1 failures. (%2 expected failures)" )
+                   .arg(regressionTest->m_failures_work )
+                   .arg( regressionTest->m_failures_fail );
+            if (regressionTest->m_failures_new)
+                link += QString(" <span style=\"color:red;font-weight:bold\">(%1 new failures since %2)</span>")
+                        .arg(regressionTest->m_failures_new)
+                        .arg(regressionTest->m_failureComp->group());
+            if (regressionTest->m_passes_new)
+                link += QString(" <p style=\"color:green;font-weight:bold\">%1 new passes since %2</p>")
+                        .arg(regressionTest->m_passes_new)
+                        .arg(regressionTest->m_failureComp->group());
+            list.writeBlock( link.latin1(), link.length() );
+            list.close();
+	}
+    }
+
+    // Only return a 0 exit code if all tests were successful
+    if (regressionTest->m_failures_work == 0 && regressionTest->m_errors == 0)
+	rv = 0;
+
+    // cleanup
+    delete regressionTest;
+    delete part;
+    delete toplevel;
+//     delete fac;
+
+    return rv;
+}
+
+// -------------------------------------------------------------------------
+
+RegressionTest *RegressionTest::curr = 0;
+
+RegressionTest::RegressionTest(KateDocument *part, const QString &baseDir,
+                               const QString &outputDir, bool _genOutput)
+  : QObject(part)
+{
+    m_part = part;
+    m_view = static_cast<KateView *>(m_part->widget());
+    m_baseDir = baseDir;
+    m_baseDir = m_baseDir.replace( "//", "/" );
+    if ( m_baseDir.endsWith( "/" ) )
+        m_baseDir = m_baseDir.left( m_baseDir.length() - 1 );
+    if (outputDir.isEmpty())
+        m_outputDir = m_baseDir + "/output";
+    else
+        m_outputDir = outputDir;
+    createMissingDirs(m_outputDir + "/");
+    m_keepOutput = false;
+    m_genOutput = _genOutput;
+    m_failureComp = 0;
+    m_failureSave = 0;
+    m_showGui = false;
+    m_passes_work = m_passes_fail = m_passes_new = 0;
+    m_failures_work = m_failures_fail = m_failures_new = 0;
+    m_errors = 0;
+
+    ::unlink( QFile::encodeName( m_outputDir + "/links.html" ) );
+    QFile f( m_outputDir + "/empty.html" );
+    QString s;
+    f.open( IO_WriteOnly | IO_Truncate );
+    s = "<html><body>Follow the white rabbit";
+    f.writeBlock( s.latin1(), s.length() );
+    f.close();
+    f.setName( m_outputDir + "/index.html" );
+    f.open( IO_WriteOnly | IO_Truncate );
+    s = "<html><frameset cols=150,*><frame src=links.html><frame name=content src=empty.html>";
+    f.writeBlock( s.latin1(), s.length() );
+    f.close();
+
+    curr = this;
+}
+
+#include <qobjectlist.h>
+
+static QStringList readListFile( const QString &filename )
+{
+    // Read ignore file for this directory
+    QString ignoreFilename = filename;
+    QFileInfo ignoreInfo(ignoreFilename);
+    QStringList ignoreFiles;
+    if (ignoreInfo.exists()) {
+        QFile ignoreFile(ignoreFilename);
+        if (!ignoreFile.open(IO_ReadOnly)) {
+            fprintf(stderr,"Can't open %s\n",ignoreFilename.latin1());
+            exit(1);
+        }
+        QTextStream ignoreStream(&ignoreFile);
+        QString line;
+        while (!(line = ignoreStream.readLine()).isNull())
+            ignoreFiles.append(line);
+        ignoreFile.close();
+    }
+    return ignoreFiles;
+}
+
+RegressionTest::~RegressionTest()
+{
+    // Important! Delete comparison config *first* as saver config
+    // might point to the same physical file.
+    delete m_failureComp;
+    delete m_failureSave;
+}
+
+void RegressionTest::setFailureSnapshotConfig(KConfig *cfg, const QString &sname)
+{
+    Q_ASSERT(cfg);
+    m_failureComp = cfg;
+    m_failureComp->setGroup(sname);
+}
+
+void RegressionTest::setFailureSnapshotSaver(KConfig *cfg, const QString &sname)
+{
+    Q_ASSERT(cfg);
+    m_failureSave = cfg;
+    m_failureSave->setGroup(sname);
+}
+
+QStringList RegressionTest::concatListFiles(const QString &relPath, const QString &filename)
+{
+    QStringList cmds;
+    int pos = relPath.findRev('/');
+    if (pos >= 0)
+        cmds += concatListFiles(relPath.left(pos), filename);
+    cmds += readListFile(m_baseDir + "/tests/" + relPath + "/" + filename);
+    return cmds;
+}
+
+bool RegressionTest::runTests(QString relPath, bool mustExist, int known_failure)
+{
+    m_currentOutput = QString::null;
+
+    if (!QFile(m_baseDir + "/tests/"+relPath).exists()) {
+	fprintf(stderr,"%s: No such file or directory\n",relPath.latin1());
+	return false;
+    }
+
+    QString fullPath = m_baseDir + "/tests/"+relPath;
+    QFileInfo info(fullPath);
+
+    if (!info.exists() && mustExist) {
+	fprintf(stderr,"%s: No such file or directory\n",relPath.latin1());
+	return false;
+    }
+
+    if (!info.isReadable() && mustExist) {
+	fprintf(stderr,"%s: Access denied\n",relPath.latin1());
+	return false;
+    }
+
+    if (info.isDir()) {
+        QStringList ignoreFiles = readListFile(  m_baseDir + "/tests/"+relPath+"/ignore" );
+        QStringList failureFiles = readListFile(  m_baseDir + "/tests/"+relPath+"/KNOWN_FAILURES" );
+
+	// Run each test in this directory, recusively
+	QDir sourceDir(m_baseDir + "/tests/"+relPath);
+	for (uint fileno = 0; fileno < sourceDir.count(); fileno++) {
+	    QString filename = sourceDir[fileno];
+	    QString relFilename = relPath.isEmpty() ? filename : relPath+"/"+filename;
+
+            if (filename.startsWith(".") || ignoreFiles.contains(filename) )
+                continue;
+            int failure_type = NoFailure;
+            if ( failureFiles.contains( filename ) )
+                failure_type |= AllFailure;
+            if ( failureFiles.contains ( filename + "-result" ) )
+                failure_type |= ResultFailure;
+            runTests(relFilename, false, failure_type);
+	}
+    }
+    else if (info.isFile()) {
+
+	QString relativeDir = QFileInfo(relPath).dirPath();
+	QString filename = info.fileName();
+	m_currentBase = m_baseDir + "/tests/"+relativeDir;
+	m_currentCategory = relativeDir;
+	m_currentTest = filename;
+        m_known_failures = known_failure;
+        // gather commands
+        QStringList commands = concatListFiles(relPath, ".kateconfig-commands");
+	if ( filename.endsWith(".txt") ) {
+#if 0
+            if ( relPath.startsWith( "domts/" ) && !m_runJS )
+                return true;
+	    if ( relPath.startsWith( "ecma/" ) && !m_runJS )
+	        return true;
+#endif
+//             if ( m_runHTML )
+                testStaticFile(relPath, commands);
+	}
+	else if (mustExist) {
+	    fprintf(stderr,"%s: Not a valid test file (must be .txt)\n",relPath.latin1());
+	    return false;
+	}
+    } else if (mustExist) {
+        fprintf(stderr,"%s: Not a regular file\n",relPath.latin1());
+        return false;
+    }
+
+    return true;
+}
+
+void RegressionTest::createLink( const QString& test, int failures )
+{
+    createMissingDirs( m_outputDir + "/" + test + "-compare.html" );
+
+    QFile list( m_outputDir + "/links.html" );
+    list.open( IO_WriteOnly|IO_Append );
+    QString link;
+    link = QString( "<a href=\"%1\" target=\"content\" title=\"%2\">" )
+           .arg( test + "-compare.html" )
+           .arg( test );
+    link += m_currentTest;
+    link += "</a> ";
+    if (failures & NewFailure)
+        link += "<span style=\"font-weight:bold;color:red\">";
+    link += "[";
+    if ( failures & ResultFailure )
+        link += "R";
+    link += "]";
+    if (failures & NewFailure)
+        link += "</span>";
+    link += "<br>\n";
+    list.writeBlock( link.latin1(), link.length() );
+    list.close();
+}
+
+/** returns the path in a way that is relatively reachable from base.
+ * @param base base directory (must not include trailing slash)
+ * @param path directory/file to be relatively reached by base
+ * @return path with all elements replaced by .. and concerning path elements
+ *	to be relatively reachable from base.
+ */
+static QString makeRelativePath(const QString &base, const QString &path)
+{
+    QString absBase = QFileInfo(base).absFilePath();
+    QString absPath = QFileInfo(path).absFilePath();
+//     kdDebug() << "absPath: \"" << absPath << "\"" << endl;
+//     kdDebug() << "absBase: \"" << absBase << "\"" << endl;
+
+    // walk up to common ancestor directory
+    int pos = 0;
+    do {
+        pos++;
+        int newpos = absBase.find('/', pos);
+        if (newpos == -1) newpos = absBase.length();
+        QConstString cmpPathComp(absPath.unicode() + pos, newpos - pos);
+        QConstString cmpBaseComp(absBase.unicode() + pos, newpos - pos);
+//         kdDebug() << "cmpPathComp: \"" << cmpPathComp.string() << "\"" << endl;
+//         kdDebug() << "cmpBaseComp: \"" << cmpBaseComp.string() << "\"" << endl;
+//         kdDebug() << "pos: " << pos << " newpos: " << newpos << endl;
+        if (cmpPathComp.string() != cmpBaseComp.string()) { pos--; break; }
+        pos = newpos;
+    } while (pos < (int)absBase.length() && pos < (int)absPath.length());
+    int basepos = pos < (int)absBase.length() ? pos + 1 : pos;
+    int pathpos = pos < (int)absPath.length() ? pos + 1 : pos;
+
+//     kdDebug() << "basepos " << basepos << " pathpos " << pathpos << endl;
+
+    QString rel;
+    {
+        QConstString relBase(absBase.unicode() + basepos, absBase.length() - basepos);
+        QConstString relPath(absPath.unicode() + pathpos, absPath.length() - pathpos);
+        // generate as many .. as there are path elements in relBase
+        if (relBase.string().length() > 0) {
+            for (int i = relBase.string().contains('/'); i > 0; --i)
+                rel += "../";
+            rel += "..";
+            if (relPath.string().length() > 0) rel += "/";
+        }
+        rel += relPath.string();
+    }
+    return rel;
+}
+
+/** processes events for at least \c msec milliseconds */
+static void pause(int msec)
+{
+    QTime t;
+    t.start();
+    do {
+        kapp->processEvents();
+    } while (t.elapsed() < msec);
+}
+
+void RegressionTest::doFailureReport( const QString& test, int failures )
+{
+    if ( failures == NoFailure ) {
+        ::unlink( QFile::encodeName( m_outputDir + "/" + test + "-compare.html" ) );
+        return;
+    }
+
+    createLink( test, failures );
+
+    QFile compare( m_outputDir + "/" + test + "-compare.html" );
+
+    QString testFile = QFileInfo(test).fileName();
+
+    QString renderDiff;
+    QString domDiff;
+
+    QString relOutputDir = makeRelativePath(m_baseDir, m_outputDir);
+
+    // are blocking reads possible with KProcess?
+    char pwd[PATH_MAX];
+    (void) getcwd( pwd, PATH_MAX );
+    chdir( QFile::encodeName( m_baseDir ) );
+
+    if ( failures & ResultFailure ) {
+        domDiff += "<pre>";
+        FILE *pipe = popen( QString::fromLatin1( "diff -u baseline/%1-result %3/%2-result" )
+                            .arg ( test, test, relOutputDir ).latin1(), "r" );
+        QTextIStream *is = new QTextIStream( pipe );
+        for ( int line = 0; line < 100 && !is->eof(); ++line ) {
+            QString line = is->readLine();
+            line = line.replace( '<', "&lt;" );
+            line = line.replace( '>', "&gt;" );
+            domDiff += line  + "\n";
+        }
+        delete is;
+        pclose( pipe );
+        domDiff += "</pre>";
+    }
+
+    chdir( pwd );
+
+    // create a relative path so that it works via web as well. ugly
+    QString relpath = makeRelativePath(m_outputDir + "/"
+        + QFileInfo(test).dirPath(), m_baseDir);
+
+    compare.open( IO_WriteOnly|IO_Truncate );
+    QString cl;
+    cl = QString( "<html><head><title>%1</title>" ).arg( test );
+    cl += QString( "<script>\n"
+                  "var pics = new Array();\n"
+                  "pics[0]=new Image();\n"
+                  "pics[0].src = '%1';\n"
+                  "pics[1]=new Image();\n"
+                  "pics[1].src = '%2';\n"
+                  "var doflicker = 1;\n"
+                  "var t = 1;\n"
+                  "var lastb=0;\n" )
+          .arg( relpath+"/baseline/"+test+"-dump.png" )
+          .arg( testFile+"-dump.png" );
+    cl += QString( "function toggleVisible(visible) {\n"
+                  "     document.getElementById('render').style.visibility= visible == 'render' ? 'visible' : 'hidden';\n"
+                  "     document.getElementById('image').style.visibility= visible == 'image' ? 'visible' : 'hidden';\n"
+                  "     document.getElementById('dom').style.visibility= visible == 'dom' ? 'visible' : 'hidden';\n"
+                  "}\n"
+                  "function show() { document.getElementById('image').src = pics[t].src; "
+                  "document.getElementById('image').style.borderColor = t && !doflicker ? 'red' : 'gray';\n"
+                  "toggleVisible('image');\n"
+                   "}" );
+    cl += QString ( "function runSlideShow(){\n"
+                  "   document.getElementById('image').src = pics[t].src;\n"
+                  "   if (doflicker)\n"
+                  "       t = 1 - t;\n"
+                  "   setTimeout('runSlideShow()', 200);\n"
+                  "}\n"
+                  "function m(b) { if (b == lastb) return; document.getElementById('b'+b).className='buttondown';\n"
+                  "                var e = document.getElementById('b'+lastb);\n"
+                  "                 if(e) e.className='button';\n"
+                  "                 lastb = b;\n"
+                  "}\n"
+                  "function showRender() { doflicker=0;toggleVisible('render')\n"
+                  "}\n"
+                  "function showDom() { doflicker=0;toggleVisible('dom')\n"
+                  "}\n"
+                   "</script>\n");
+
+    cl += QString ("<style>\n"
+                   ".buttondown { cursor: pointer; padding: 0px 20px; color: white; background-color: blue; border: inset blue 2px;}\n"
+                   ".button { cursor: pointer; padding: 0px 20px; color: black; background-color: white; border: outset blue 2px;}\n"
+                   ".diff { position: absolute; left: 10px; top: 100px; visibility: hidden; border: 1px black solid; background-color: white; color: black; /* width: 800; height: 600; overflow: scroll; */ }\n"
+                   "</style>\n" );
+
+    cl += QString( "<body onload=\"m(5); toggleVisible('dom');\"" );
+    cl += QString(" text=black bgcolor=gray>\n<h1>%3</h1>\n" ).arg( test );
+    if ( renderDiff.length() )
+        cl += "<span id='b4' class='button' onclick='showRender();m(4)'>R-DIFF</span>&nbsp;\n";
+    if ( domDiff.length() )
+        cl += "<span id='b5' class='button' onclick='showDom();m(5);'>D-DIFF</span>&nbsp;\n";
+    // The test file always exists - except for checkOutput called from *.js files
+    if ( QFile::exists( m_baseDir + "/tests/"+ test ) )
+        cl += QString( "<a class=button href=\"%1\">HTML</a>&nbsp;" )
+              .arg( relpath+"/tests/"+test );
+
+    cl += QString( "<hr>"
+                   "<img style='border: solid 5px gray' src=\"%1\" id='image'>" )
+          .arg( relpath+"/baseline/"+test+"-dump.png" );
+
+    cl += "<div id='render' class='diff'>" + renderDiff + "</div>";
+    cl += "<div id='dom' class='diff'>" + domDiff + "</div>";
+
+    cl += "</body></html>";
+    compare.writeBlock( cl.latin1(), cl.length() );
+    compare.close();
+}
+
+void RegressionTest::testStaticFile(const QString & filename, const QStringList &commands)
+{
+    qApp->mainWidget()->resize( 800, 600); // restore size
+
+    // Set arguments
+    KParts::URLArgs args;
+    if (filename.endsWith(".txt")) args.serviceType = "text/plain";
+    m_part->browserExtension()->setURLArgs(args);
+    // load page
+    KURL url;
+    url.setProtocol("file");
+    url.setPath(QFileInfo(m_baseDir + "/tests/"+filename).absFilePath());
+    m_part->openURL(url);
+
+    // inject commands
+    for (QStringList::ConstIterator cit = commands.begin(); cit != commands.end(); ++cit) {
+        QString str = (*cit).stripWhiteSpace();
+        if (str.isEmpty() || str.startsWith("#")) continue;
+        Kate::Command *cmd = KateCmd::self()->queryCommand(str);
+        if (cmd) {
+            QString msg;
+            if (!cmd->exec(m_view, str, msg))
+                fprintf(stderr, "ERROR executing command '%s': %s\n", str.latin1(), msg.latin1());
+        }
+    }
+
+    pause(200);
+
+    Q_ASSERT(m_part->config()->configFlags() & KateDocumentConfig::cfDoxygenAutoTyping);
+
+    bool script_error = false;
+    {
+        // Execute script
+        TestJScriptEnv jsenv(m_part);
+        script_error = evalJS(jsenv.interpreter(), m_baseDir + "/tests/"+QFileInfo(filename).dirPath()+"/.kateconfig-script", true)
+            && evalJS(jsenv.interpreter(), m_baseDir + "/tests/"+filename+"-script");
+    }
+
+    int back_known_failures = m_known_failures;
+
+    if (!script_error) goto bail_out;
+
+    if (m_showGui) kapp->processEvents();
+
+    if ( m_genOutput ) {
+        reportResult(checkOutput(filename+"-result"), "result");
+    } else {
+        int failures = NoFailure;
+
+        // compare with output file
+        if ( m_known_failures & ResultFailure)
+            m_known_failures = AllFailure;
+        bool newfail;
+        if ( !reportResult( checkOutput(filename+"-result"), "result", &newfail ) )
+            failures |= ResultFailure;
+        if (newfail)
+            failures |= NewFailure;
+
+        doFailureReport(filename, failures );
+    }
+
+bail_out:
+    m_known_failures = back_known_failures;
+    m_part->setModified(false);
+    m_part->closeURL();
+}
+
+bool RegressionTest::evalJS(Interpreter &interp, const QString &filename, bool ignore_nonexistent)
+{
+    QString fullSourceName = filename;
+    QFile sourceFile(fullSourceName);
+
+    if (!sourceFile.open(IO_ReadOnly)) {
+        if (!ignore_nonexistent) {
+            fprintf(stderr,"ERROR reading file %s\n",fullSourceName.latin1());
+            m_errors++;
+        }
+        return ignore_nonexistent;
+    }
+
+    QTextStream stream ( &sourceFile );
+    stream.setEncoding( QTextStream::UnicodeUTF8 );
+    QString code = stream.read();
+    sourceFile.close();
+
+    saw_failure = false;
+    ignore_errors = false;
+    Completion c = interp.evaluate(UString( code ) );
+
+    if ( /*report_result &&*/ !ignore_errors) {
+        if (c.complType() == Throw) {
+            QString errmsg = c.value().toString(interp.globalExec()).qstring();
+            printf( "ERROR: %s (%s)\n",filename.latin1(), errmsg.latin1());
+            m_errors++;
+            return false;
+        }
+    }
+    return true;
+}
+
+class GlobalImp : public ObjectImp {
+public:
+  virtual UString className() const { return "global"; }
+};
+
+RegressionTest::CheckResult RegressionTest::checkOutput(const QString &againstFilename)
+{
+    QString absFilename = QFileInfo(m_baseDir + "/baseline/" + againstFilename).absFilePath();
+    if ( svnIgnored( absFilename ) ) {
+        m_known_failures = NoFailure;
+        return Ignored;
+    }
+
+    QString data = m_part->text();
+
+    CheckResult result = Success;
+
+    // compare result to existing file
+    QString outputFilename = QFileInfo(m_outputDir + "/" + againstFilename).absFilePath();
+    bool kf = false;
+    if ( m_known_failures & AllFailure )
+        kf = true;
+    if ( kf )
+        outputFilename += "-KF";
+
+    if ( m_genOutput )
+        outputFilename = absFilename;
+
+    QFile file(absFilename);
+    if (file.open(IO_ReadOnly)) {
+        QTextStream stream ( &file );
+        stream.setEncoding( QTextStream::UnicodeUTF8 );
+
+        QString fileData = stream.read();
+
+        result = ( fileData == data ) ? Success : Failure;
+        if ( !m_genOutput && result == Success && !m_keepOutput ) {
+            ::unlink( QFile::encodeName( outputFilename ) );
+            return Success;
+        }
+    } else if (!m_genOutput) {
+        fprintf(stderr, "Error reading file %s\n", absFilename.latin1());
+        result = Failure;
+    }
+
+    // generate result file
+    createMissingDirs( outputFilename );
+    QFile file2(outputFilename);
+    if (!file2.open(IO_WriteOnly)) {
+        fprintf(stderr,"Error writing to file %s\n",outputFilename.latin1());
+        exit(1);
+    }
+
+    QTextStream stream2(&file2);
+    stream2.setEncoding( QTextStream::UnicodeUTF8 );
+    stream2 << data;
+    if ( m_genOutput )
+        printf("Generated %s\n", outputFilename.latin1());
+
+    return result;
+}
+
+bool RegressionTest::reportResult(CheckResult result, const QString & description, bool *newfail)
+{
+    if ( result == Ignored ) {
+        //printf("IGNORED: ");
+        //printDescription( description );
+        return true; // no error
+    } else
+        return reportResult( result == Success, description, newfail );
+}
+
+bool RegressionTest::reportResult(bool passed, const QString & description, bool *newfail)
+{
+    if (newfail) *newfail = false;
+
+    if (m_genOutput)
+	return true;
+
+    QString filename(m_currentTest + "-" + description);
+    if (!m_currentCategory.isEmpty())
+        filename = m_currentCategory + "/" + filename;
+
+    const bool oldfailed = m_failureComp && m_failureComp->readNumEntry(filename);
+    if (passed) {
+        if ( m_known_failures & AllFailure ) {
+            printf("PASS (unexpected!)");
+            m_passes_fail++;
+        } else {
+            printf("PASS");
+            m_passes_work++;
+        }
+        if (oldfailed) {
+            printf(" (new)");
+            m_passes_new++;
+        }
+        if (m_failureSave)
+            m_failureSave->deleteEntry(filename);
+    }
+    else {
+        if ( m_known_failures & AllFailure ) {
+            printf("FAIL (known)");
+            m_failures_fail++;
+            passed = true; // we knew about it
+        } else {
+            printf("FAIL");
+            m_failures_work++;
+        }
+        if (!oldfailed && m_failureComp) {
+            printf(" (new)");
+            m_failures_new++;
+            if (newfail) *newfail = true;
+        }
+        if (m_failureSave)
+            m_failureSave->writeEntry(filename, 1);
+    }
+    printf(": ");
+
+    printDescription( description );
+    return passed;
+}
+
+void RegressionTest::printDescription(const QString& description)
+{
+    if (!m_currentCategory.isEmpty())
+	printf("%s/", m_currentCategory.latin1());
+
+    printf("%s", m_currentTest.latin1());
+
+    if (!description.isEmpty()) {
+        QString desc = description;
+        desc.replace( '\n', ' ' );
+	printf(" [%s]", desc.latin1());
+    }
+
+    printf("\n");
+    fflush(stdout);
+}
+
+void RegressionTest::createMissingDirs(const QString & filename)
+{
+    QFileInfo dif(filename);
+    QFileInfo dirInfo( dif.dirPath() );
+    if (dirInfo.exists())
+	return;
+
+    QStringList pathComponents;
+    QFileInfo parentDir = dirInfo;
+    pathComponents.prepend(parentDir.absFilePath());
+    while (!parentDir.exists()) {
+	QString parentPath = parentDir.absFilePath();
+	int slashPos = parentPath.findRev('/');
+	if (slashPos < 0)
+	    break;
+	parentPath = parentPath.left(slashPos);
+	pathComponents.prepend(parentPath);
+	parentDir = QFileInfo(parentPath);
+    }
+    for (uint pathno = 1; pathno < pathComponents.count(); pathno++) {
+	if (!QFileInfo(pathComponents[pathno]).exists() &&
+	    !QDir(pathComponents[pathno-1]).mkdir(pathComponents[pathno])) {
+	    fprintf(stderr,"Error creating directory %s\n",pathComponents[pathno].latin1());
+	    exit(1);
+	}
+    }
+}
+
+void RegressionTest::slotOpenURL(const KURL &url, const KParts::URLArgs &args)
+{
+    m_part->browserExtension()->setURLArgs( args );
+
+    m_part->openURL(url);
+}
+
+bool RegressionTest::svnIgnored( const QString &filename )
+{
+    QFileInfo fi( filename );
+    QString ignoreFilename = fi.dirPath() + "/svnignore";
+    QFile ignoreFile(ignoreFilename);
+    if (!ignoreFile.open(IO_ReadOnly))
+        return false;
+
+    QTextStream ignoreStream(&ignoreFile);
+    QString line;
+    while (!(line = ignoreStream.readLine()).isNull()) {
+        if ( line == fi.fileName() )
+            return true;
+    }
+    ignoreFile.close();
+    return false;
+}
+
+void RegressionTest::resizeTopLevelWidget( int w, int h )
+{
+    qApp->mainWidget()->resize( w, h );
+    // Since we're not visible, this doesn't have an immediate effect, QWidget posts the event
+    QApplication::sendPostedEvents( 0, QEvent::Resize );
+}
+
+#include "test_regression.moc"
+
+// kate: indent-width 4
Index: kate/part/katedialogs.cpp
===================================================================
--- kate/part/katedialogs.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/katedialogs.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -140,7 +140,8 @@
     KateDocument::cfTabIndents,
     KateDocument::cfBackspaceIndents,
     KateDocumentConfig::cfDoxygenAutoTyping,
-    KateDocumentConfig::cfMixedIndent
+    KateDocumentConfig::cfMixedIndent,
+    KateDocumentConfig::cfIndentPastedText
 };
 
 KateIndentConfigTab::KateIndentConfigTab(QWidget *parent)
@@ -160,6 +161,7 @@
   m_configPage = new QPushButton(SmallIconSet("configure"), i18n("Configure..."), indentLayout);
 
   opt[5] = new QCheckBox(i18n("Insert leading Doxygen \"*\" when typing"), gbAuto);
+  opt[7] = new QCheckBox(i18n("Adjust indentation of code pasted from the clipboard"), gbAuto);
 
   QVGroupBox *gbSpaces = new QVGroupBox(i18n("Indentation with Spaces"), this);
   QVBox *spaceLayout = new QVBox(gbSpaces);
@@ -191,6 +193,7 @@
   opt[4]->setChecked(configFlags & flags[4]);
   opt[5]->setChecked(configFlags & flags[5]);
   opt[6]->setChecked(configFlags & flags[6]);
+  opt[7]->setChecked(configFlags & flags[7]);
 
   layout->addWidget(gbAuto);
   layout->addWidget(gbSpaces);
@@ -218,6 +221,9 @@
         "style comment."));
   QWhatsThis::add( opt[6], i18n(
       "Use a mix of tab and space characters for indentation.") );
+  QWhatsThis::add( opt[7], i18n(
+      "If this option is selected, pasted code from the clipboard is indented. "
+      "Triggering the <b>undo</b>-action removes the indentation.") );
   QWhatsThis::add(indentationWidth, i18n("The number of spaces to indent with."));
 
   QWhatsThis::add(m_configPage, i18n(
@@ -242,6 +248,7 @@
   connect( opt[4], SIGNAL( toggled(bool) ), this, SLOT( slotChanged() ) );
   connect( opt[5], SIGNAL( toggled(bool) ), this, SLOT( slotChanged() ) );
   connect( opt[6], SIGNAL( toggled(bool) ), this, SLOT( slotChanged() ) );
+  connect( opt[7], SIGNAL( toggled(bool) ), this, SLOT( slotChanged() ) );
 
   connect(indentationWidth, SIGNAL(valueChanged(int)), this, SLOT(slotChanged()));
 
Index: kate/part/Makefile.am
===================================================================
--- kate/part/Makefile.am	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/part/Makefile.am	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,6 +1,8 @@
 kde_module_LTLIBRARIES = libkatepart.la
 
-libkatepart_la_SOURCES = katesearch.cpp katebuffer.cpp katecmds.cpp \
+noinst_LTLIBRARIES = libkate.la
+
+libkate_la_SOURCES = katesearch.cpp katebuffer.cpp katecmds.cpp \
   kateundo.cpp katecursor.cpp katedialogs.cpp katedocument.cpp \
   katefactory.cpp katehighlight.cpp katesyntaxdocument.cpp \
   katetextline.cpp kateview.cpp kateconfig.cpp kateviewhelpers.cpp \
@@ -12,8 +14,10 @@
   katetemplatehandler.cpp katejscript.cpp katespell.cpp kateindentscriptabstracts.cpp \
   kateluaindentscript.cpp
 
-libkatepart_la_LIBADD = ../interfaces/libkatepartinterfaces.la $(top_builddir)/kdeprint/libkdeprint.la $(top_builddir)/kutils/libkutils.la $(top_builddir)/kjs/libkjs.la $(LUA_LIBS)
+libkatepart_la_SOURCES = dummy.cpp
 
+libkatepart_la_LIBADD = libkate.la ../interfaces/libkatepartinterfaces.la $(top_builddir)/kdeprint/libkdeprint.la $(top_builddir)/kutils/libkutils.la $(top_builddir)/kjs/libkjs.la $(LUA_LIBS)
+
 libkatepart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 
 INCLUDES= -I../interfaces -I$(top_srcdir) -I$(top_srcdir)/kdeprint -I$(top_srcdir)/interfaces  -I$(top_srcdir)/interfaces/kregexpeditor -I$(top_srcdir)/kdefx -I$(top_srcdir)/kutils -I$(top_builddir)/kjs $(LUA_INCLUDES) $(all_includes)
@@ -24,8 +28,17 @@
 
 CREATE_HASH_TABLE = $(top_srcdir)/kjs/create_hash_table
 
+dummy.cpp: $(srcdir)/Makefile.am
+	touch $@
+
 katejscript.lut.h : $(srcdir)/katejscript.cpp $(CREATE_HASH_TABLE)
 	$(PERL) $(CREATE_HASH_TABLE) $(srcdir)/katejscript.cpp > $@
 katejscript.lo: katejscript.lut.h
 
 CLEANFILES = $(LUT_FILES)
+
+## test program
+TESTS  = testkateregression
+check_PROGRAMS = testkateregression
+testkateregression_SOURCES = test_regression.cpp
+testkateregression_LDADD = $(libkatepart_la_LIBADD)
Index: kate/scripts/jstest.desktop
===================================================================
--- kate/scripts/jstest.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/scripts/jstest.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -9,6 +9,7 @@
 Name[es]=Prueba JavaScript de Kate Part
 Name[et]=Kate komponendi JavaScripti test
 Name[eu]=Kate zatiaren JavaScript proba
+Name[fa]=آزمون دست‌نوشته جاوا  Kate Part
 Name[fi]=Kate Part JavaScript -testi
 Name[fr]=Test du module JavaScript pour Kate
 Name[fy]=Kate-part JavaSkript-test
@@ -57,6 +58,7 @@
 Comment[es]=Guión para probar el part de scripting de kate
 Comment[et]=Skript Kate komponendi skriptimisomaduste testimiseks
 Comment[eu]=Script-a Kate zatiaren script-ak probatzeko.
+Comment[fa]=دست‌نوشته برای آزمون دست‌نوشته هایKate Part
 Comment[fi]=Skripti kate partin skriptien testaukseen
 Comment[fr]=Script testant le module de scripting de Kate
 Comment[fy]=Skript foar it testen fan Kate-part's skriptmooglikheid
Index: kate/data/katepart.desktop
===================================================================
--- kate/data/katepart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/data/katepart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Name[es]=Editor de texto avanzado empotrable
 Name[et]=Põimitud võimas tekstiredaktor
 Name[eu]=Kapsulatutako testu-editore aurreratua
-Name[fa]=ویرایشگر متن پیشرفته‌ی نهفته
+Name[fa]=ویرایشگر متن پیشرفتۀ نهفته
 Name[fi]=Upotettava kehittynyt tekstieditori
 Name[fr]=Éditeur de texte avancé intégré
 Name[fy]=Ynsletten avansearre tekstbewurker
Index: kate/data/latex.xml
===================================================================
--- kate/data/latex.xml	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/data/latex.xml	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,123 +1,274 @@
-<?xml version="1.0" encoding="UTF-8"?>
+<?xml version="1.01" encoding="UTF-8"?>
 <!DOCTYPE language SYSTEM "language.dtd">
-<language name="LaTeX" version="1.14" section="Markup" kateversion="2.4" extensions="*.tex; *.ltx; *.dtx; *.sty; *.cls;" mimetype="text/x-tex" casesensitive="1" author="Jeroen Wijnhout (Jeroen.Wijnhout@kdemail.net)" license="LGPL" >
+<language name="LaTeX" version="1.22" section="Markup" kateversion="2.3" extensions="*.tex; *.ltx; *.dtx; *.sty; *.cls;" mimetype="text/x-tex" casesensitive="1" author="Jeroen Wijnhout (Jeroen.Wijnhout@kdemail.net)+Holger Danielsson (holger.danielsson@t-online.de)+Michel Ludwig (michel.ludwig@kdemail.net)" license="LGPL" >
   <highlighting>
     <contexts>
+      <!-- Normal text -->
       <context name="Normal Text" attribute="Normal Text" lineEndContext="#stay">
         <RegExpr String="\\begin(?=[^a-zA-Z])" attribute="Structure" context="FindEnvironment" beginRegion="block" />
         <RegExpr String="\\end(?=[^a-zA-Z])" attribute="Structure" context="FindEnvironment" endRegion="block" />
-        <RegExpr String="\\(label|pageref|ref|cite)(?=[^a-zA-Z])" attribute="Structure" context="Label"/>
-        <RegExpr String="\\(part|chapter|section|subsection|subsubsection|paragraph|subparagraph)(?=[^a-zA-Z])" attribute="Structure" context="#stay"/>
-        <StringDetect String="\renewcommand" attribute="Keyword" context="ToEndOfLine"/>
-        <StringDetect String="\newcommand" attribute="Keyword" context="ToEndOfLine"/>
+        <RegExpr String="\\(label|pageref|ref|vpageref|vref|cite)(?=[^a-zA-Z])" attribute="Structure" context="Label"/>
+        <RegExpr String="\\(part|chapter|section|subsection|subsubsection|paragraph|subparagraph)\*?(?=[^a-zA-Z])" attribute="Structure" context="#stay"/>
+        <RegExpr String="\\(re)?newcommand(?=[^a-zA-Z])" attribute="Keyword" context="NewCommand"/>
+        <RegExpr String="\\def(?=[^a-zA-Z])" attribute="Keyword" context="DefCommand"/>
         <StringDetect String="\(" attribute="Math" context="MathMode" beginRegion="mathMode" />
-        <StringDetect String="\[" attribute="Math" context="MathMode" beginRegion="mathMode" />
+        <StringDetect String="\[" attribute="Math" context="MathModeEquation" beginRegion="mathMode" />
         <DetectChar char="\" attribute="Keyword" context="ContrSeq"/>
-
-        <StringDetect String="$$" attribute="Math" context="MathMode" beginRegion="mathMode" />
+        <StringDetect String="$$" attribute="Math" context="MathModeDisplay" beginRegion="mathMode" />
         <DetectChar char="$" attribute="Math" context="MathMode" beginRegion="mathMode" />
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
         <RegExpr String="%\s*BEGIN.*$" attribute="Region Marker" context="#stay" beginRegion="regionMarker" firstNonSpace="true" />
         <RegExpr String="%\s*END.*$" attribute="Region Marker" context="#stay" endRegion="regionMarker" firstNonSpace="true" />
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+      </context>
+
+      <!-- LaTeX commands \newcommand and \renewcommand -->
+      <context name="NewCommand" attribute="Normal Text" lineEndContext="#stay" fallthrough="true" fallthroughContext="#pop">
+        <RegExpr String="\s*\{\s*\\[a-zA-Z]+\s*\}(\[\d\](\[[^\]]+\])?)?\{" attribute="Normal Text" context="CommandParameterStart"/>
+        <DetectChar char="}" attribute="Error" context="#pop"/>
+      </context>
+
+      <!-- LaTeX command \def -->
+      <context name="DefCommand" attribute="Normal Text" lineEndContext="#stay" fallthrough="true" fallthroughContext="#pop">
+        <RegExpr String="\s*\\[a-zA-Z]+[^\{]*\{" attribute="Normal Text" context="CommandParameterStart"/>
+        <DetectChar char="}" attribute="Error" context="#pop"/>
+      </context>
+
+      <!-- parse command argument -->
+      <context name="CommandParameterStart" attribute="Normal Text" lineEndContext="#stay">
+        <DetectChar char="{" attribute="Normal Text" context="CommandParameter"/>
+        <DetectChar char="}" attribute="Normal Text" context="#pop#pop"/>
+        <RegExpr String="\\." attribute="Normal Text" context="#stay" />
         <DetectChar char="%" attribute="Comment" context="Comment"/>
       </context>
+      <context name="CommandParameter" attribute="Normal Text" lineEndContext="#stay">
+        <DetectChar char="{" attribute="Normal Text" context="CommandParameter"/>
+        <DetectChar char="}" attribute="Normal Text" context="#pop"/>
+        <RegExpr String="\\." attribute="Normal Text" context="#stay" />
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
+      </context>
+
+      <!-- LaTeX command in text mode -->
       <context name="ContrSeq" attribute="Keyword" lineEndContext="#pop">
         <StringDetect String="verb*" attribute="Keyword" context="Verb"/>
-        <StringDetect String="verb" attribute="Keyword" context="Verb"/>
-        <RegExpr String="[a-zA-Z]+" attribute="Keyword" context="#pop"/>
+        <RegExpr String="verb(?=[^a-zA-Z])" attribute="Keyword" context="Verb"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="[a-zA-Z]+\*?" attribute="Keyword" context="#pop"/>
         <RegExpr String="[^a-zA-Z]" attribute="Keyword" context="#pop" />
       </context>
       <context name="ToEndOfLine" attribute="Normal Text" lineEndContext="#pop">
       </context>
 
+      <!-- verb command -->
+      <context name="Verb" attribute="Verbatim" lineEndContext="#pop#pop" >
+        <RegExpr String="(.)" attribute="Normal Text" dynamic="true" context="VerbEnd" />
+      </context>
+      <context name="VerbEnd" attribute="Verbatim" lineEndContext="#pop#pop#pop" dynamic="true" >
+        <StringDetect String="%1" attribute="Normal Text" context="#pop#pop#pop" dynamic="true" />
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="[^%1\xd7]*" attribute="Verbatim" context="#stay" dynamic="true" />
+      </context>
+
+      <!-- label -->
+      <context name="Label" attribute="Normal Text" lineEndContext="#pop#pop" fallthrough="true" fallthroughContext="#pop#pop">
+        <RegExpr String="\s*\{\s*" attribute="Normal Text" context="#stay"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="[^\}\{\xd7]+" attribute="Environment" context="#stay"/>
+        <RegExpr String="\s*\}\s*" attribute="Normal Text" context="#pop"/>
+      </context>
+
+      <!-- start of an environment -->
       <context name="FindEnvironment" attribute="Normal Text" lineEndContext="#stay">
         <DetectChar char="{" attribute="Normal Text" context="Environment"/>
         <RegExpr String="\S" attribute="Normal Text" context="#pop"/>
       </context>
+
+      <!-- filter the environment name and check the type -->
       <context name="Environment" attribute="Environment" lineEndContext="#stay">
-        <DetectChar char="}" attribute="Normal Text" context="#pop#pop"/>
-        <DetectChar char="]" attribute="Normal Text" context="#pop#pop"/>
-        <RegExpr String="(semiverbatim|verbatim|lstlisting|boxedverbatim|Verbatim)\*?" attribute="Environment" context="VerbatimEnv"/>
-        <RegExpr String="(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|alignat|flalign)\*?" attribute="Environment" context="MathEnv"/>
+        <RegExpr String="(lstlisting|(B|L)?Verbatim)" attribute="Environment" context="VerbatimEnvParam"/>
+        <RegExpr String="(verbatim|boxedverbatim)" attribute="Environment" context="VerbatimEnv"/>
+        <RegExpr String="(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|flalign)" attribute="Environment" context="MathEnv"/>
+        <RegExpr String="(alignat|xalignat|xxalignat)" attribute="Environment" context="MathEnvParam"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="[a-zA-Z]" attribute="Environment" context="LatexEnv"/>
+        <RegExpr String="\s+" attribute="Error" context="#pop"/>
+        <RegExpr String="[^a-zA-Z\xd7]" attribute="Error" context="#pop"/>
       </context>
 
-      <context name="Label" attribute="Normal Text" lineEndContext="#pop#pop" fallthrough="true" fallthroughContext="#pop#pop">
-        <RegExpr String="\s*\{\s*" attribute="Normal Text" context="#stay"/>
-        <RegExpr String="[^\}\{]+" attribute="Environment" context="#stay"/>
-        <RegExpr String="\s*\}\s*" attribute="Normal Text" context="#pop"/>
+      <!-- environment type 1: normal -->
+      <context name="LatexEnv" attribute="Environment" lineEndContext="#stay">
+        <DetectChar char="}" attribute="Normal Text" context="#pop#pop#pop"/>
+        <RegExpr String="[a-zA-Z]+" attribute="Environment" context="#stay"/>
+        <RegExpr String="\s+" attribute="Error" context="#stay"/>
+       <IncludeRules context="EnvCommon" />
       </context>
 
-      <context name="Verb" attribute="Verbatim" lineEndContext="#pop" fallthrough="true" fallthroughContext="#pop">
-        <RegExpr String="(.).*\1" attribute="Verbatim" context="#pop#pop" minimal="true"/>
-      </context>
-      <context name="VerbatimEnv" attribute="Environment" lineEndContext="#stay">
-        <DetectChar char="*" attribute="Normal Text" context="#stay"/>
+      <!-- environment type 2: verbatim without parameter -->
+      <context name="VerbatimEnv" attribute="Environment" lineEndContext="#stay" fallthrough="true" fallthroughContext="#pop#pop#pop">
         <DetectChar char="}" attribute="Normal Text" context="Verbatim"/>
-        <RegExpr String="\S" attribute="Normal Text" context="#pop"/>
+        <RegExpr String="[a-zA-Z]" attribute="Environment" lookAhead="true" context="#pop"/>
+        <IncludeRules context="EnvCommon" />
+       </context>
+
+      <!-- environment type 3: verbatim with optional parameter -->
+      <context name="VerbatimEnvParam" attribute="Normal Text" lineEndContext="#stay">
+        <Detect2Chars char="}" char1="[" attribute="Normal Text" context="#stay" />
+        <DetectChar char="}" attribute="Normal Text" context="Verbatim"/>
+        <DetectChar char="]" attribute="Normal Text" context="Verbatim"/>
       </context>
+
+      <!-- parse verbatim text -->
       <context name="Verbatim" attribute="Verbatim" lineEndContext="#stay">
-        <RegExpr String="\\end(?=\{(semiverbatim|verbatim|lstlisting|boxedverbatim|Verbatim)\*?\})" attribute="Structure"  context="VerbFindEnd"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="\\end(?=\s*\{(verbatim|lstlisting|boxedverbatim|(B|L)?Verbatim)\*?\})" attribute="Structure"  context="VerbFindEnd"/>
       </context>
+
+      <!-- end of verbatim environment -->
       <context name="VerbFindEnd" attribute="Normal Text" lineEndContext="#pop" fallthrough="true" fallthroughContext="#pop">
-        <DetectChar char="{" attribute="Normal Text" context="#stay"/>
-        <RegExpr String="(semiverbatim|verbatim|lstlisting|boxedverbatim|Verbatim)\*?" attribute="Environment" context="#stay"/>
+        <RegExpr String="\s*\{" attribute="Normal Text" context="#stay"/>
+        <RegExpr String="(verbatim|lstlisting|boxedverbatim|(B|L)?Verbatim)\*?" attribute="Environment" context="#stay"/>
         <DetectChar char="}" attribute="Normal Text" context="#pop#pop#pop#pop#pop" endRegion="block"/>
       </context>
 
-      <context name="MathMode" attribute="Math" lineEndContext="#stay">
-        <Detect2Chars char="\" char1="]" attribute="Math" context="#pop" endRegion="mathMode" />
-        <Detect2Chars char="\" char1=")" attribute="Math" context="#pop" endRegion="mathMode" />
+      <!-- environment type 4: math environment with its own mathmode -->
+      <context name="MathEnv" attribute="Environment" lineEndContext="#stay">
+        <DetectChar char="}" attribute="Normal Text" context="MathModeEnv"/>
+        <RegExpr String="[a-zA-Z]" attribute="Environment" lookAhead="true" context="#pop"/>
+        <IncludeRules context="EnvCommon" />
+      </context>
+
+      <!-- environment type 5: math environment with its own mathmode and parameter -->
+      <context name="MathEnvParam" attribute="Normal Text" lineEndContext="#stay">
+        <RegExpr String="\}\{[^\}]*\}" attribute="Normal Text" context="MathModeEnv"/>
+        <DetectChar char="}" attribute="Normal Text" context="MathModeEnv"/>
+        <RegExpr String="[a-zA-Z]" attribute="Environment" lookAhead="true" context="#pop"/>
+        <IncludeRules context="EnvCommon" />
+      </context>
+
+      <!-- environment common -->
+      <context name="EnvCommon" attribute="Environment" lineEndContext="#stay">
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="\*(?=\})" attribute="Environment" context="#stay"/>
+        <RegExpr String="\*[^\}]*" attribute="Error" context="#pop#pop#pop"/>
+        <RegExpr String="[^a-zA-Z\xd7][^\}]*" attribute="Error" context="#pop#pop#pop"/>
+      </context>
+
+      <!-- parse math environment -->
+      <context name="MathModeEnv" attribute="Math" lineEndContext="#stay">
+        <RegExpr String="\\end(?=\s*\{(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|flalign|alignat|xalignat|xxalignat)\*?\})" attribute="Structure" context="MathFindEnd"/>
         <RegExpr String="\\begin(?=[^a-zA-Z])" attribute="Keyword Mathmode" context="#stay" beginRegion="block" />
         <RegExpr String="\\end(?=[^a-zA-Z])" attribute="Keyword Mathmode" context="#stay" endRegion="block" />
+        <StringDetect String="\(" attribute="Error" context="#stay" />
+        <StringDetect String="\[" attribute="Error" context="#stay" />
+        <StringDetect String="\)" attribute="Error" context="#stay" />
+        <StringDetect String="\]" attribute="Error" context="#stay" />
+        <RegExpr String="\\(text|intertext|mbox)\s*(?=\{)" attribute="Keyword Mathmode" context="MathModeText" />
         <DetectChar char="\" attribute="Keyword Mathmode" context="MathContrSeq"/>
-        <StringDetect String="$$" attribute="Math" context="#pop" endRegion="mathMode" />
-        <DetectChar char="$" attribute="Math" context="#pop" endRegion="mathMode" />
+        <StringDetect String="$$" attribute="Error" context="#stay" />
+        <DetectChar char="$" attribute="Error" context="#stay" />
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
         <RegExpr String="%\s*BEGIN.*$" attribute="Region Marker" context="#stay" beginRegion="regionMarker" firstNonSpace="true"/>
         <RegExpr String="%\s*END.*$" attribute="Region Marker" context="#stay" endRegion="regionMarker" firstNonSpace="true"/>
-        <DetectChar char="%" attribute="Comment" context="Comment"/>
       </context>
-      <context name="MathModeEnv" attribute="Math" lineEndContext="#stay">
-        <RegExpr String="\\end(?=\s*\{\s*[a-zA-Z]*(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|alignat|flalign)\*?\s*\})" attribute="Structure" context="MathFindEnd"/>
+
+      <!-- end of math environment -->
+      <context name="MathFindEnd" attribute="Normal Text" lineEndContext="#pop" fallthrough="true" fallthroughContext="#pop">
+        <RegExpr String="\s*\{" attribute="Normal Text" context="#stay"/>
+        <RegExpr String="(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|flalign|alignat|xalignat|xxalignat)\*?" attribute="Environment" context="#stay"/>
+        <DetectChar char="}" attribute="Normal Text" context="#pop#pop#pop#pop#pop"  endRegion="block"/>
+      </context>
+
+      <!-- math mode: starting with $ or \( -->
+      <context name="MathMode" attribute="Math" lineEndContext="#stay">
+        <StringDetect String="$$" attribute="Error" context="#stay" />
+        <DetectChar char="$" attribute="Math" context="#pop" endRegion="mathMode" />
+        <Detect2Chars char="\" char1=")" attribute="Math" context="#pop" endRegion="mathMode" />
+        <Detect2Chars char="\" char1="]" attribute="Error" context="#stay" />
+        <IncludeRules context="MathModeCommon" />
+      </context>
+
+      <!-- math mode: starting with $$ -->
+      <context name="MathModeDisplay" attribute="Math" lineEndContext="#stay">
+        <StringDetect String="$$" attribute="Math" context="#pop" endRegion="mathMode" />
+        <DetectChar char="$" attribute="Error" context="#stay" />
+        <Detect2Chars char="\" char1="]" attribute="Error" context="#stay" />
+        <Detect2Chars char="\" char1=")" attribute="Error" context="#stay" />
+        <IncludeRules context="MathModeCommon" />
+      </context>
+
+      <!-- math mode: starting with \[ -->
+      <context name="MathModeEquation" attribute="Math" lineEndContext="#stay">
+        <Detect2Chars char="\" char1="]" attribute="Math" context="#pop" endRegion="mathMode" />
+        <StringDetect String="$$" attribute="Error" context="#stay" />
+        <DetectChar char="$" attribute="Error" context="#stay" />
+        <Detect2Chars char="\" char1=")" attribute="Error" context="#stay" />
+        <IncludeRules context="MathModeCommon" />
+      </context>
+
+      <!-- math mode common -->
+      <context name="MathModeCommon" attribute="Math" lineEndContext="#stay">
+        <RegExpr String="\\(begin|end)\s*\{(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|flalign|alignat|xalignat|xxalignat)\*?\}" attribute="Error" context="#stay"/>
         <RegExpr String="\\begin(?=[^a-zA-Z])" attribute="Keyword Mathmode" context="#stay" beginRegion="block" />
         <RegExpr String="\\end(?=[^a-zA-Z])" attribute="Keyword Mathmode" context="#stay" endRegion="block" />
-        <StringDetect String="\(" attribute="Math" context="MathMode" beginRegion="mathMode" />
-        <StringDetect String="\[" attribute="Math" context="MathMode" beginRegion="mathMode" />
+        <RegExpr String="\\(text|intertext|mbox)\s*(?=\{)" attribute="Keyword Mathmode" context="MathModeText" />
         <DetectChar char="\" attribute="Keyword Mathmode" context="MathContrSeq"/>
-        <StringDetect String="$$" attribute="Math" context="MathMode" beginRegion="mathMode" />
-        <DetectChar char="$" attribute="Math" context="MathMode" beginRegion="mathMode" />
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
         <RegExpr String="%\s*BEGIN.*$" attribute="Region Marker" context="#stay" beginRegion="regionMarker" firstNonSpace="true"/>
         <RegExpr String="%\s*END.*$" attribute="Region Marker" context="#stay" endRegion="regionMarker" firstNonSpace="true"/>
-        <DetectChar char="%" attribute="Comment" context="Comment"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
       </context>
-      <context name="MathEnv" attribute="Environment" lineEndContext="#stay">
-        <DetectChar char="}" attribute="Normal Text" context="MathModeEnv"/>
-        <RegExpr String="\S" attribute="Normal Text" context="#pop"/>
+
+      <!-- command in mathmode -->
+      <context name="MathContrSeq" attribute="Keyword Mathmode" lineEndContext="#pop">
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <RegExpr String="[a-zA-Z]+\*?" attribute="Keyword Mathmode" context="#pop"/>
+        <RegExpr String="[^a-zA-Z]" attribute="Keyword Mathmode" context="#pop" /> 
       </context>
-      <context name="MathFindEnd" attribute="Normal Text" lineEndContext="#pop" fallthrough="true" fallthroughContext="#pop">
-        <DetectChar char="{" attribute="Normal Text" context="#stay"/>
-        <RegExpr String="[a-zA-Z]*(equation|displaymath|eqnarray|subeqnarray|math|multline|gather|align|alignat|flalign)\*?" attribute="Environment" context="#stay"/>
-        <DetectSpaces />
-        <DetectChar char="}" attribute="Normal Text" context="#pop#pop#pop#pop#pop"  endRegion="block"/>
+
+      <!-- text in mathmode -->
+      <context name="MathModeText" attribute="Normal Text" lineEndContext="#stay" >
+         <DetectChar char="{" attribute="Normal Text" context="MathModeTextParameterStart"/>
       </context>
-      <context name="MathContrSeq" attribute="Keyword Mathmode" lineEndContext="#pop">
-        <RegExpr String="[a-zA-Z]+" attribute="Keyword Mathmode" context="#pop"/>
-        <RegExpr String="[^a-zA-Z]" attribute="Keyword Mathmode" context="#pop" />
+
+      <context name="MathModeTextParameterStart" attribute="Normal Text" lineEndContext="#stay" >
+        <RegExpr String="\\." attribute="Normal Text" context="#stay"/> 
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <DetectChar char="{" attribute="Normal Text" context="MathModeTextParameter"/>
+        <DetectChar char="}" attribute="Normal Text" context="#pop#pop"/>
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
       </context>
 
+      <context name="MathModeTextParameter" attribute="Normal Text" lineEndContext="#stay" >
+        <RegExpr String="\\." attribute="Normal Text" context="#stay"/> 
+        <DetectChar char="{" attribute="Normal Text" context="MathModeTextParameter"/>
+        <DetectChar char="}" attribute="Normal Text" context="#pop"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
+        <DetectChar char="%" attribute="Comment" context="Comment"/>
+      </context>
+
+     <!-- comment -->
       <context name="Comment" attribute="Comment" lineEndContext="#pop">
+      	<RegExpr String="(FIXME|TODO):?" attribute="Alert" context="#stay"/>
+        <DetectChar char="&#xd7;" attribute="Bullet" context="#stay"/>
       </context>
     </contexts>
+
     <itemDatas>
       <itemData name="Normal Text" defStyleNum="dsNormal"/>
       <itemData name="Keyword" defStyleNum="dsNormal" color="#800000" selColor="#60FFFF" bold="0" italic="0"/>
       <itemData name="Comment" defStyleNum="dsComment"/>
+      <itemData name="Error" defStyleNum="dsAlert"/>
       <itemData name="Math" defStyleNum="dsNormal" color="#00A000" selColor="#FF40FF"  bold="0" italic="0"/>
       <itemData name="Structure" defStyleNum="dsNormal" color="#F00000" selColor="#80FFD0" bold="0" italic="0"/>
       <itemData name="Keyword Mathmode" defStyleNum="dsNormal" color="#606000" selColor="#FFD0FF" bold="0" italic="0"/>
       <itemData name="Environment" defStyleNum="dsNormal" color="#0000D0" selColor="#FFFF90" bold="0" italic="0"/>
       <itemData name="Verbatim" defStyleNum="dsNormal" color="#a08000" selColor="#80D0FF" bold="0" italic="0"/>
-      <itemData name="Region Marker" defStyleNum="dsRegionMarker"/>
-    </itemDatas>
+      <itemData name="Region Marker" defStyleNum="dsRegionMarker" />
+      <itemData name="Bullet" defStyleNum="dsNormal" color="#FF00C4" bold="1" underline="1"/>
+      <itemData name="Alert" defStyleNum="dsAlert" />
+     </itemDatas>
   </highlighting>
+
   <general>
     <keywords weakDeliminator="\" wordWrapDeliminator=",{}[]"/>
     <comments>
Index: kate/data/php.xml
===================================================================
--- kate/data/php.xml	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/data/php.xml	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -11,6 +11,7 @@
     <list name="control structures">
       <item>as</item>
       <item>case</item>
+      <item>default</item>
       <item>if</item>
       <item>else</item>
       <item>elseif</item>
@@ -38,7 +39,6 @@
       <item> catch </item>
       <item> class </item>
       <item> const </item>
-      <item> default </item>
       <item> extends </item>
       <item> final </item>
       <item> function </item>
Index: kate/data/cpp.xml
===================================================================
--- kate/data/cpp.xml	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kate/data/cpp.xml	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE language SYSTEM "language.dtd">
-<language name="C++" version="1.36" kateversion="2.4" section="Sources" extensions="*.c++;*.cxx;*.cpp;*.cc;*.C;*.h;*.H;*.h++;*.hxx;*.hpp;*.hcc;*.moc" mimetype="text/x-c++src;text/x-c++hdr;text/x-chdr" priority="9">
+<language name="C++" version="1.37" kateversion="2.4" section="Sources" extensions="*.c++;*.cxx;*.cpp;*.cc;*.C;*.h;*.H;*.h++;*.hxx;*.hpp;*.hcc;*.moc" mimetype="text/x-c++src;text/x-c++hdr;text/x-chdr" priority="9">
   <highlighting>
     <list name="keywords">
       <item> asm </item>
@@ -88,6 +88,7 @@
       <item> Q_CLEANUP_RESOURCE </item>
       <item> Q_GLOBAL_STATIC </item>
       <item> Q_GLOBAL_STATIC_WITH_ARGS </item>
+      <item> Q_DECLARE_INTERFACE </item>
       <item> Q_DECLARE_TYPEINFO </item>
       <item> Q_DECLARE_SHARED </item>
       <item> Q_DECLARE_FLAGS </item>
Index: kdefx/kcpuinfo.cpp
===================================================================
--- kdefx/kcpuinfo.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdefx/kcpuinfo.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -35,14 +35,6 @@
 #  define HAVE_GNU_INLINE_ASM
 #endif
 
-
-// Copied from kdecore/kdemacros.h
-#if __GNUC__ - 0 > 3 || (__GNUC__ - 0 == 3 && __GNUC_MINOR__ - 0 > 4)
-#  define KDE_NO_EXPORT __attribute__ ((visibility("hidden")))
-#else
-#  define KDE_NO_EXPORT
-#endif
-
 typedef void (*kde_sighandler_t) (int);
 
 #ifdef __i386__
@@ -72,7 +64,7 @@
 
 static int getCpuFeatures()
 {
-    int features = 0;
+    volatile int features = 0;
 
 #if defined( HAVE_GNU_INLINE_ASM )
 #if defined( __i386__ )
Index: kcmshell/main.cpp
===================================================================
--- kcmshell/main.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kcmshell/main.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -102,6 +102,10 @@
         return 0;
     }
 
+    // avoid finding random non-kde applications
+    if ( module.left( 4 ) != "kde-" && service->library().isEmpty() )
+        return locateModule( "kde-" + module );
+
     if(!KCModuleLoader::testModule( module ))
     {
         kdDebug(780) << "According to \"" << module << "\"'s test function, it should Not be loaded." << endl;
Index: doc/kspell/index.docbook
===================================================================
--- doc/kspell/index.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ doc/kspell/index.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -9,6 +9,7 @@
 
 <bookinfo>
 <title>The &kspell; Handbook</title>
+
 <authorgroup>
 <author>&David.Sweet; &David.Sweet.mail;</author>
 
@@ -20,9 +21,7 @@
 <releaseinfo>1.00.00</releaseinfo>
 <abstract>
 <para>&kspell; is the spelling checker used by &kde; applications such
-as &kate;, &kmail;, and &kword;. It is a <acronym>GUI</acronym>
-frontend to <application>International ISpell</application> and
-<application>ASpell</application>.</para>
+as &kate;, &kmail;, and &kword;. It is a &GUI; frontend to <application>International ISpell</application> and <application>ASpell</application>.</para>
 
 </abstract>
 <keywordset>
@@ -61,10 +60,10 @@
 
 <para>To keep your original spelling, click on <guilabel>Ignore</guilabel>.</para>
 
-<para>To stop the spell checking -- keeping the changes you've already made -- click
+<para>To stop the spellchecking -- keeping the changes you've already made -- click
 on <guibutton>Stop</guibutton>.</para>
 
-<para>To stop the spell checking and cancel the changes you've already made, click on
+<para>To stop the spellchecking and cancel the changes you've already made, click on
 <guibutton>Cancel</guibutton>.</para>
 
 <para>Clicking on <guibutton>Replace All</guibutton> will initially perform the same function as
@@ -88,7 +87,7 @@
 <sect1 id="dictionaries">
 <title>Dictionaries</title>
 
-<para>You can choose the dictionary to use for spell checking from the list of
+<para>You can choose the dictionary to use for spellchecking from the list of
 installed dictionaries.</para>
 </sect1>
 
@@ -153,8 +152,14 @@
 <para>You may email the author/maintainer with questions and/or comments at
 &David.Sweet.mail;.</para>
 
+<para>
+Documentation Copyright &copy; 2003 &David.Sweet; &David.Sweet.mail;
+</para>
+
 <!-- TRANS:CREDIT_FOR_TRANSLATORS -->
 
+&underFDL;               <!-- FDL: do not remove -->
+
 </chapter>
 &documentation.index; 
 </book>
Index: arts/knotify/knotify.desktop
===================================================================
--- arts/knotify/knotify.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ arts/knotify/knotify.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -42,7 +42,7 @@
 Comment[es]=Demonio de notificación de KDE
 Comment[et]=KDE süsteemsete märguannete deemon
 Comment[eu]=KDEko jakinarazpenaren daemona
-Comment[fa]=برنامه اعلام KDE
+Comment[fa]=شبح اخطار KDE
 Comment[fi]=KDE:n huomautuspalvelin
 Comment[fo]=Áminningarandi KDE's
 Comment[fr]=Démon de notifications de KDE
Index: mimetypes/all.desktop
===================================================================
--- mimetypes/all.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/all.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Todos los archivos y directorios
 Comment[et]=Kõik failid ja kataloogid
 Comment[eu]=Fitxategi eta karpeta guztiak
-Comment[fa]=تمام پرونده‌ها و پوشه‌ها
+Comment[fa]=همۀ پرونده‌ها و پوشه‌ها
 Comment[fi]=Kaikki tiedostot ja kansiot
 Comment[fr]=Tous les fichiers et dossiers
 Comment[fy]=Alle Triemmen en Mappen
Index: mimetypes/audio/x-oggflac.desktop
===================================================================
--- mimetypes/audio/x-oggflac.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-oggflac.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Audio FLAC de Ogg
 Comment[et]=Ogg FLAC audiofail
 Comment[eu]=Ogg FLAC audioa
-Comment[fa]=صوتی Ogg FLAC
+Comment[fa]=Ogg FLAC صوتی
 Comment[fi]=Ogg FLAC -ääni
 Comment[fr]=Son Ogg Flac
 Comment[ga]=Fuaim Ogg FLAC
Index: mimetypes/audio/vnd.rn-realaudio.desktop
===================================================================
--- mimetypes/audio/vnd.rn-realaudio.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/vnd.rn-realaudio.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Archivo de RealAudio
 Comment[et]=RealAudio fail
 Comment[eu]=RealAudio fitxategia
-Comment[fa]=پرونده‌ی RealAudio
+Comment[fa]=پروندۀ RealAudio
 Comment[fi]=RealAudio tiedosto
 Comment[fr]=Fichier ReadAudio
 Comment[fy]=RealAudio triem
Index: mimetypes/audio/x-aiff.desktop
===================================================================
--- mimetypes/audio/x-aiff.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-aiff.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Sonido AIFF/Amiga
 Comment[et]=AIFF/Amiga audiofail
 Comment[eu]=AIFF/Amiga audioa
-Comment[fa]=صدای AIFF/Amiga
+Comment[fa]=صوتی A IFF/Amiga
 Comment[fi]=AIFF/Amiga-ääni
 Comment[fr]=Son AIFF / Amiga
 Comment[fy]=AIFF-/Amiga-audio
Index: mimetypes/audio/mpegurl.desktop
===================================================================
--- mimetypes/audio/mpegurl.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/mpegurl.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Sonido MPEG esquema 3 por transmisión
 Comment[et]=MPEG layer 3 audiovoog
 Comment[eu]=MPEG Layer 3 audio jarioa
-Comment[fa]=صدای جریانی MPEG لایه ۳
+Comment[fa]=صوت جریانی لایه ۳ MPEG
 Comment[fi]=Streamattu MPEG 3-tason musiikki
 Comment[fr]=Flux MPEG niveau 3 audio
 Comment[fy]=Streaming MPEG Layer3-audio
Index: mimetypes/audio/x-musepack.desktop
===================================================================
--- mimetypes/audio/x-musepack.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-musepack.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[eo]=Musepack-sondosiero
 Comment[et]=Musepack audiofail
 Comment[eu]=Musepack audioa
+Comment[fa]=Musepack صوتی
 Comment[fi]=Musepack-ääni
 Comment[fr]=Son Musepack
 Comment[ga]=Fuaim Musepack
Index: mimetypes/audio/x-mpegurl.desktop
===================================================================
--- mimetypes/audio/x-mpegurl.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-mpegurl.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Sonido MPEG esquema 3 por transmisión
 Comment[et]=MPEG layer 3 audiovoog
 Comment[eu]=MPEG Layer 3 audio jarioa
-Comment[fa]=صدای جریانی MPEG لایه ۳
+Comment[fa]=صوت جریانی لایه ۳ MPEG
 Comment[fi]=Streamattu MPEG 3-tason musiikki
 Comment[fr]=Flux MPEG niveau 3 audio
 Comment[fy]=Streaming MPEG Layer3-audio
Index: mimetypes/audio/basic.desktop
===================================================================
--- mimetypes/audio/basic.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/basic.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Sonido ULAW (Sun)
 Comment[et]=ULAW (Sun) audiofail
 Comment[eu]=ULAW (Sun) audioa
-Comment[fa]=صدای ULAW (سان)
+Comment[fa]=صوتی ULAW (Sun)
 Comment[fi]=ULAW (Sun) -ääni
 Comment[fr]=Son ULAW (Sun)
 Comment[fy]=ULAW (Sun) audiotriem
Index: mimetypes/audio/prs.sid.desktop
===================================================================
--- mimetypes/audio/prs.sid.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/prs.sid.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Música C64 SID
 Comment[et]=C64 SID muusikafail
 Comment[eu]=C64 SID musika
+Comment[fa]=موسیقی C64 SID
 Comment[fi]=C64 SID -musiikki
 Comment[fr]=Musique C64 SID
 Comment[fy]=C64 SID Muzyk
Index: mimetypes/audio/x-mod.desktop
===================================================================
--- mimetypes/audio/x-mod.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-mod.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Sonido SoundTracker de Amiga
 Comment[et]=Amiga soundtrackeri audiofail
 Comment[eu]=Amiga Soundtracker audioa
-Comment[fa]=صدای Amiga Soundtracker
+Comment[fa]=Amiga Soundtracker صوتی
 Comment[fi]=Amiga Soundtracker-musiikki
 Comment[fr]=Son Soundtracker Amiga
 Comment[fy]=Amiga Soundtracker-audio
Index: mimetypes/audio/x-pn-realaudio.desktop
===================================================================
--- mimetypes/audio/x-pn-realaudio.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-pn-realaudio.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo de RealAudio
 Comment[et]=RealAudio fail
 Comment[eu]=RealAudio fitxategia
-Comment[fa]=پرونده‌ی RealAudio
+Comment[fa]=پروندۀ RealAudio
 Comment[fi]=RealAudio tiedosto
 Comment[fr]=Fichier ReadAudio
 Comment[fy]=RealAudio triem
Index: mimetypes/audio/x-matroska.desktop
===================================================================
--- mimetypes/audio/x-matroska.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-matroska.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Audio de Matroska
 Comment[et]=Matroska audiofail
 Comment[eu]=Matroska audioa
-Comment[fa]=صوتی Matroska
+Comment[fa]=Matroska صوتی
 Comment[fi]=Matroska-ääni
 Comment[fr]=Son Matroska
 Comment[ga]=Fuaim Matroska
Index: mimetypes/audio/x-midi.desktop
===================================================================
--- mimetypes/audio/x-midi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-midi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Sonido MIDI
 Comment[et]=MIDI audiofail
 Comment[eu]=MIDI audioa
-Comment[fa]=صدای MIDI
+Comment[fa]=MIDIصوتی 
 Comment[fi]=MIDI-musiikki
 Comment[fr]=Son MIDI
 Comment[fy]=MIDI-audio
Index: mimetypes/audio/mpeg.desktop
===================================================================
--- mimetypes/audio/mpeg.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/mpeg.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,6 +22,7 @@
 Comment[es]=Audio de MPEG
 Comment[et]=MPEG audiofail
 Comment[eu]=MPEG audioa
+Comment[fa]=صوتی MPEG
 Comment[fi]=MPEG-ääni
 Comment[fr]=Son MPEG
 Comment[ga]=Fuaim MPEG
Index: mimetypes/audio/x-adpcm.desktop
===================================================================
--- mimetypes/audio/x-adpcm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-adpcm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Sonido PCM
 Comment[et]=PCM audiofail
 Comment[eu]=PCM audioa
-Comment[fa]=صدای PCM
+Comment[fa]=صوتی PCM
 Comment[fi]=PCM-ääni
 Comment[fr]=Son PCM
 Comment[fy]=PCM-audio
Index: mimetypes/audio/x-scpls.desktop
===================================================================
--- mimetypes/audio/x-scpls.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-scpls.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Lista de reproducción MP3 de ShoutCast
 Comment[et]=ShoutCasti MP3 esitusnimekiri
 Comment[eu]=MP3 ShoutCast erreprodukzio-zerrenda
-Comment[fa]=سیاهه‌پخش MP3 ShoutCast
+Comment[fa]=فهرست پخش  MP3 ShoutCast
 Comment[fi]=MP3 ShoutCast-soittolista
 Comment[fr]=Liste de lecture Mpeg3 ShoutCast
 Comment[fy]=MP3-ShoutCast-ôfspyllist
Index: mimetypes/audio/x-speex.desktop
===================================================================
--- mimetypes/audio/x-speex.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-speex.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Audio de Speex
 Comment[et]=Speex audiofail
 Comment[eu]=Speex audioa
-Comment[fa]=صوتی Speex
+Comment[fa]=Speex صوتی
 Comment[fi]=Speex-ääni
 Comment[fr]=Son Speex
 Comment[ga]=Fuaim Speex
Index: mimetypes/audio/x-wav.desktop
===================================================================
--- mimetypes/audio/x-wav.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-wav.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Sonido WAV
 Comment[et]=WAV audiofail
 Comment[eu]=WAV audioa
-Comment[fa]=صدای WAV
+Comment[fa]=WAV صوتی
 Comment[fi]=WAV-ääni
 Comment[fr]=Son WAV
 Comment[fy]=WAV-audio
Index: mimetypes/audio/x-mp2.desktop
===================================================================
--- mimetypes/audio/x-mp2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-mp2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,6 +21,7 @@
 Comment[es]=Audio MPEG capa 2
 Comment[et]=MPEG layer 2 audiofail
 Comment[eu]=MPEG Layer 2 audioa
+Comment[fa]=صوت لایۀ ۲ MPEG
 Comment[fi]=MPEG 2-tason musiikki
 Comment[fr]=Son MPEG niveau 2
 Comment[gl]=Son MPEG Capa 2
Index: mimetypes/audio/x-mp3.desktop
===================================================================
--- mimetypes/audio/x-mp3.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-mp3.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Sonido MPEG esquema 3
 Comment[et]=MPEG layer 3 audiofail
 Comment[eu]=MPEG Layer 3 audioa
-Comment[fa]=صدای MPEG لایه ۳
+Comment[fa]=صوت لایۀ ۳ MPEG
 Comment[fi]=MPEG 3-tason musiikki
 Comment[fr]=Son MPEG niveau 3
 Comment[fy]=MPEG Layer3-audio
Index: mimetypes/audio/x-ms-wma.desktop
===================================================================
--- mimetypes/audio/x-ms-wma.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/audio/x-ms-wma.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[eo]=Vindoza Meta-sondosiero
 Comment[et]=Windows Media audiofail
 Comment[eu]=Windows Media audioa
+Comment[fa]=رسانۀ صوتی ویندوز
 Comment[fi]=Windows Media -ääni
 Comment[fr]=Son Windows Media
 Comment[gl]=Vídeo de Windows Media
Index: mimetypes/multipart/x-mixed-replace.desktop
===================================================================
--- mimetypes/multipart/x-mixed-replace.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/multipart/x-mixed-replace.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Flujo de datos (envio del servidor)
 Comment[et]=Andmevoog (server push)
 Comment[eu]=Datu korrontea (Server push)
-Comment[fa]=جریان داده (فشار کارگزار)
+Comment[fa]=جریان داده (فشار کارساز)
 Comment[fi]=Tietovirta (palvelin työntää)
 Comment[fr]=Flux de données (serveur push)
 Comment[fy]=Datastream (server push)
Index: mimetypes/multipart/mixed.desktop
===================================================================
--- mimetypes/multipart/mixed.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/multipart/mixed.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Documento compuesto
 Comment[et]=Dokumentide kogum
 Comment[eu]=Dokumentu konposatua
-Comment[fa]=سند ترکیبی
+Comment[fa]=سند مرکب
 Comment[fi]=Yhdistelmäasiakirja
 Comment[fr]=Document composé
 Comment[fy]=Gearstald dokumint
Index: mimetypes/image/x-portable-pixmap.desktop
===================================================================
--- mimetypes/image/x-portable-pixmap.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-portable-pixmap.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Imagen portable Pixmap
 Comment[et]=Portable pikselraster-pildifail
 Comment[eu]=Pixmap irudi eramangarria
-Comment[fa]=تصویر عکس‌نقش قابل حمل
+Comment[fa]=تصویر نگاشت تصویر دانه‌ای حمل پذیر
 Comment[fi]=Portable Pixmap -kuva
 Comment[fr]=Image Pixmap portable
 Comment[fy]=Portable Pixmap-ôfbylding
Index: mimetypes/image/x-dds.desktop
===================================================================
--- mimetypes/image/x-dds.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-dds.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Comment[de]=DirectDraw-Oberfläche
 Comment[eo]=Rekta desegnosurfaco
 Comment[eu]=DirectDraw gainazala
+Comment[fa]=سطح DirectDraw
 Comment[fi]=DirectDraw-taso
 Comment[fr]=Surface DirectDraw
 Comment[gl]=Superfície DirectDraw
Index: mimetypes/image/x-xcf-gimp.desktop
===================================================================
--- mimetypes/image/x-xcf-gimp.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-xcf-gimp.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[es]=Formato de imagen nativo de GIMP
 Comment[et]=GIMP-i pildifail
 Comment[eu]=GIMP jatorridun irudi-formatua
-Comment[fa]=قالب تصویر طبیعی گیمپ
+Comment[fa]=قالب تصویر طبیعی GIMP
 Comment[fi]=GIMP:n tiedostomuoto
 Comment[fr]=Format graphique natif de GIMP
 Comment[fy]=GIMP's eigen ôfbyldingsyndieling
Index: mimetypes/image/x-hdr.desktop
===================================================================
--- mimetypes/image/x-hdr.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-hdr.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Comment[es]=Imagen de gran rango dinámico
 Comment[et]=High Dynamic Range pildifail
 Comment[eu]=Dinamika Altuko Barrutiko irudia
+Comment[fa]=تصویر با گسترۀ پویایی بالا
 Comment[fi]=Korkeatasoinen muuttuvien arvoalueiden kuva
 Comment[fr]=Image à définition dynamique haute
 Comment[fy]=High Dynamic Range-ôfbylding
Index: mimetypes/image/x-vnd.trolltech.qpicture.desktop
===================================================================
--- mimetypes/image/x-vnd.trolltech.qpicture.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-vnd.trolltech.qpicture.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Metaarchivo QPicture
 Comment[et]=QPicture MetaFile
 Comment[eu]=QPicture metafitxategia
-Comment[fa]=پرونده‌ی فوق موضوعی QPicture
+Comment[fa]=فراپروندۀ QPicture
 Comment[fi]=QPicture-metatiedosto
 Comment[fr]=Métafichier QPicture
 Comment[fy]=QPicture Metatriem
Index: mimetypes/image/svg+xml.desktop
===================================================================
--- mimetypes/image/svg+xml.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/svg+xml.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Gráficos vectoriales escalables
 Comment[et]=Skaleeritav vektorgraafika
 Comment[eu]=Bektore eskalagarridun grafikoak
+Comment[fa]=نگارۀ برداری مقیاس‌پذیر
 Comment[fr]=Graphisme vectoriel modulable (SVG)
 Comment[fy]=SVG(Scalable Vector Graphics)-ôfbylding
 Comment[ga]=Scalable Vector Graphics (SVG)
Index: mimetypes/image/x-xbm.desktop
===================================================================
--- mimetypes/image/x-xbm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-xbm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Imagen mapa de bits de X
 Comment[et]=X bittraster-pildifail
 Comment[eu]=X BitMap irudia
-Comment[fa]=تصویر X BitMap
+Comment[fa]=تصویر نگاشت بیت X
 Comment[fi]=X-bittikarttakuva
 Comment[fr]=Image XBitmap
 Comment[fy]=X BitMap-ôfbylding
Index: mimetypes/image/x-eps.desktop
===================================================================
--- mimetypes/image/x-eps.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-eps.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Imagen PostScript encapsulado
 Comment[et]=Kapseldatud PostScript pildifail
 Comment[eu]=Kapsulatutako PostScript irudia
-Comment[fa]=تصویر PostScript کپسوله شده
+Comment[fa]=تصویر پست اسکریپت کپسوله‌شده
 Comment[fi]=Encapsulated PostScript -kuva
 Comment[fr]=Image PostScript encapsulé
 Comment[fy]=Ynsletten PostScript-ôfbylding
Index: mimetypes/image/x-exr.desktop
===================================================================
--- mimetypes/image/x-exr.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-exr.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Imagen ILM EXR
 Comment[et]=ILM EXR pildifail
 Comment[eu]=ILM EXR irudia
+Comment[fa]=تصویر ILM EXR
 Comment[fi]=ILM EXR -kuva
 Comment[fr]=Image ILM EXR
 Comment[fy]=ILM EXR ôfbylding
Index: mimetypes/image/cgm.desktop
===================================================================
--- mimetypes/image/cgm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/cgm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Metaarchivo de gráficos por ordenador
 Comment[et]=Arvutigraafika metafail
 Comment[eu]=Konputagailuaren grafikoen metafitxategia
-Comment[fa]=فوق پرونده‌ی گرافیک‌های رایانه‌ای
+Comment[fa]=فراپروندۀ نگاره‌ای رایانه‌ای
 Comment[fi]=Computer Graphics -metatiedosto
 Comment[fr]=Métafichier graphique
 Comment[fy]=Computer Graphics Meta-triem
Index: mimetypes/image/x-msod.desktop
===================================================================
--- mimetypes/image/x-msod.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-msod.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,6 +23,7 @@
 Comment[es]=Dibujo de Microsoft Office
 Comment[et]=MS Office'i joonistus
 Comment[eu]=Microsoft Office marrazketa
+Comment[fa]=ترسیم میکروسافت آفیس
 Comment[fi]=Microsoft Office -piirros
 Comment[fy]=MS Office-tekening
 Comment[ga]=Líníocht Microsoft Office
Index: mimetypes/image/x-xpm.desktop
===================================================================
--- mimetypes/image/x-xpm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-xpm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Imagen mapa de pixels de X
 Comment[et]=X pikselraster-pildifail
 Comment[eu]=X PixMap irudia
-Comment[fa]=تصویر عکس‌نقش X
+Comment[fa]=تصویر نگاشت تصویر دانه‌ای X
 Comment[fi]=X-kuvakartta
 Comment[fr]=Image XPixmap
 Comment[fy]=X PixMap-ôfbylding
Index: mimetypes/image/x-xcursor.desktop
===================================================================
--- mimetypes/image/x-xcursor.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-xcursor.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Cursor de ratón X11
 Comment[et]=X11 hiirekursor
 Comment[eu]=X11 saguaren kurtsorea
-Comment[fa]=مکان‌نمای موش X11
+Comment[fa]=مکان‌نمای موشی X11
 Comment[fi]=X11-hiiriosoitin
 Comment[fr]=Curseur de souris X11
 Comment[fy]=X11 mûs rinnerke
Index: mimetypes/image/x-djvu-2.desktop
===================================================================
--- mimetypes/image/x-djvu-2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-djvu-2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Documento DjVu
 Comment[et]=DjVu dokument
 Comment[eu]=DjVu dokumentua
+Comment[fa]=سند DjVu
 Comment[fi]=DjVu-asiakirja
 Comment[fr]=Document DjVu
 Comment[fy]=DjVu-dokumint
Index: mimetypes/image/x-djvu.desktop
===================================================================
--- mimetypes/image/x-djvu.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-djvu.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Documento DjVu
 Comment[et]=DjVu dokument
 Comment[eu]=DjVu dokumentua
+Comment[fa]=سند DjVu
 Comment[fi]=DjVu-asiakirja
 Comment[fr]=Document DjVu
 Comment[fy]=DjVu-dokumint
Index: mimetypes/image/x-rgb.desktop
===================================================================
--- mimetypes/image/x-rgb.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-rgb.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,6 +21,7 @@
 Comment[es]=Imagen SGI (RGB)
 Comment[et]=SGI pildifail (RGB)
 Comment[eu]=SGI irudia (RGB)
+Comment[fa]=تصویر SGI (RGB)
 Comment[fi]=SGI-kuva (RGB)
 Comment[fr]=Image SGI (RVB)
 Comment[fy]=SGI ôfbylding (RBG)
Index: mimetypes/image/x-portable-greymap.desktop
===================================================================
--- mimetypes/image/x-portable-greymap.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-portable-greymap.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Imagen portable Graymap
 Comment[et]=Portable Graymap pildifail
 Comment[eu]=Graymap irudi eramangarria
-Comment[fa]=تصویر نقش‌خاکستری قابل حمل
+Comment[fa]=تصویر نگاشت خاکستری حمل پذیر
 Comment[fi]=Portable Graymap -kuva
 Comment[fr]=Image Graymap portable
 Comment[fy]=Portable Graymap-ôfbylding
Index: mimetypes/image/fax-g3.desktop
===================================================================
--- mimetypes/image/fax-g3.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/fax-g3.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Fax g3 CCITT
 Comment[et]=CCITT g3 fax
 Comment[eu]=CCITT G3 faxa
-Comment[fa]=دورنگار CCITT G۳
+Comment[fa]=دورنگار CCITT G3
 Comment[fi]=CCITT G3 -faksi
 Comment[fr]=Fax CCITT groupe 3
 Comment[fy]=CCITT G3-fax
Index: mimetypes/image/x-portable-bitmap.desktop
===================================================================
--- mimetypes/image/x-portable-bitmap.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-portable-bitmap.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Imagen Bitmap portable
 Comment[et]=Portable bittraster-pildifail
 Comment[eu]=Bitmap irudi eramangarria
-Comment[fa]=تصویر نقش‌بیت قابل حمل
+Comment[fa]=تصویر نگاشت بیت حمل پذیر
 Comment[fi]=Portable Bitmap -kuva
 Comment[fr]=Image Bitmap portable
 Comment[fy]=Portable Bitmap-ôfbylding
Index: mimetypes/image/x-raw.desktop
===================================================================
--- mimetypes/image/x-raw.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-raw.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Imagen RAW de cámara
 Comment[et]=Kaamera toorpilt
 Comment[eu]=RAW kamara fitxategia
+Comment[fa]=تصویر دوربین RAW
 Comment[fi]=RAW-kameratiedosto
 Comment[fr]=Image RAW d'appareil photo
 Comment[fy]=RAW-fototastelôfbylding
@@ -27,12 +28,16 @@
 Comment[lt]=RAW foto atvaizdas
 Comment[mk]=RAW-слика од камера
 Comment[ms]=Imej Kamera RAW
+Comment[nb]=RAW-kamerabilde
 Comment[nds]=Kamerbild in RAW-Formaat
 Comment[nl]=RAW-camera-afbeelding
+Comment[nn]=RAW-kamerabilete
 Comment[pl]=Obrazek w formacie RAW
 Comment[pt]=Imagem RAW da Máquina Fotográfica
 Comment[pt_BR]=Imagem RAW da Máquina Fotográfica
 Comment[ro]=Imagine foto brută
+Comment[ru]=Необработанное изображение фотоаппарата
+Comment[se]=RAW-govvenapparáhttagovva
 Comment[sk]=RAW fotografický obrázok
 Comment[sl]=Slika RAW s fotoaparata
 Comment[sr]=Сирова слика са камере
Index: mimetypes/image/x-wmf.desktop
===================================================================
--- mimetypes/image/x-wmf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-wmf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[eo]=Vindoza Meta-grafiko-dosiero
 Comment[es]=Metaarchivo de Windows
 Comment[eu]=Windows metafitxategia
-Comment[fa]=فوق‌پرونده‌ی ویندوز
+Comment[fa]=فراپروندۀ پنجره‌ها
 Comment[fi]=Windows-metatiedosto
 Comment[fr]=Métafichier Windows
 Comment[fy]=Windows Metatriem
Index: mimetypes/image/x-xfig.desktop
===================================================================
--- mimetypes/image/x-xfig.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/x-xfig.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo de XFig
 Comment[et]=XFigi fail
 Comment[eu]=XFig fitxategia
-Comment[fa]=پرونده‌ی XFig
+Comment[fa]=پروندۀ XFig
 Comment[fi]=XFig-tiedosto
 Comment[fr]=Dessin XFig
 Comment[fy]=XFig-triem
Index: mimetypes/image/fits.desktop
===================================================================
--- mimetypes/image/fits.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/image/fits.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Imagen FITS
 Comment[et]=FITS pildifail
 Comment[eu]=FITS irudia
+Comment[fa]=تصویر FITS
 Comment[fi]=FITS-kuva
 Comment[fr]=Image FITS
 Comment[fy]=FITS-ôfbylding
Index: mimetypes/allfiles.desktop
===================================================================
--- mimetypes/allfiles.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/allfiles.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Todos los archivos
 Comment[et]=Kõik failid
 Comment[eu]=Fitxategi guztiak
-Comment[fa]=تمام پرونده‌ها
+Comment[fa]=همۀ پرونده‌ها
 Comment[fi]=Kaikki tiedostot
 Comment[fr]=Tous les fichiers
 Comment[fy]=Alle triemmen
Index: mimetypes/application/chm.desktop
===================================================================
--- mimetypes/application/chm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/chm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Comment[es]=Documento de ayuda HTML
 Comment[et]=HTML abi dokument
 Comment[eu]=HTML laguntzako dokumentua
+Comment[fa]=سند کمک زنگام
 Comment[fi]=HTML help-asiakirja
 Comment[fr]=Document d'aide HTML
 Comment[fy]=HTML Helpdokumint
Index: mimetypes/application/x-graphite.desktop
===================================================================
--- mimetypes/application/x-graphite.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-graphite.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Gráfica científica Graphite
 Comment[et]=Graphite Scientific graafik
 Comment[eu]=Graphite Scientific grafikoak
-Comment[fa]=گراف علمی Graphite
+Comment[fa]=گراف علمی گرافیت
 Comment[fi]=Graphite-kuvaaja
 Comment[fr]=Graphite - Courbes scientifiques
 Comment[fy]=Graphite - wittenskiplike grafyk
Index: mimetypes/application/x-pkcs12.desktop
===================================================================
--- mimetypes/application/x-pkcs12.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-pkcs12.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Paquete de certificado PKCS#12
 Comment[et]=PKCS#12 sertifikaatide kogum
 Comment[eu]=PKCS#12 ziurtagiri multzoa
-Comment[fa]=گواهینامه‌ی همراه‌شده‌ی PKCS شماره‌ی ۱۲
+Comment[fa]=بستۀ گواهینامه PKCS#12
 Comment[fi]=PKCS#12-sertifikaattikokoelma
 Comment[fr]=Ensemble de certificats PKCS#12
 Comment[fy]=PKCS#12 sertifikaatbondel
Index: mimetypes/application/sieve.desktop
===================================================================
--- mimetypes/application/sieve.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/sieve.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Script de filtro de correo SIEVE
 Comment[et]=SIEVE e-kirjade filtri skript
 Comment[eu]=Posta iragazteko SIEVE script-a
-Comment[fa]=نویسه‌ي صافی پست SIEVE
+Comment[fa]=دست‌نوشته پالایۀ نامۀ SIEVE
 Comment[fi]=SIEVE-sähköpostisuodin
 Comment[fr]=Script de filtre de courrier SIEVE
 Comment[fy]=Filterskript foar SIEVE Mail
Index: mimetypes/application/x-tex-pk.desktop
===================================================================
--- mimetypes/application/x-tex-pk.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tex-pk.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Fuente empaquetada
 Comment[et]=Pakitud fondifail
 Comment[eu]=Letra-tipo paketatua
-Comment[fa]=قلم جمع
+Comment[fa]=قلم بسته‌ای
 Comment[fi]=Pakattu kirjasin
 Comment[fr]=Police de caractères compactée
 Comment[fy]=Komprimearre lettertype
Index: mimetypes/application/x-vnd.kde.kexi.desktop
===================================================================
--- mimetypes/application/x-vnd.kde.kexi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-vnd.kde.kexi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Archivo de proyecto Kexi
 Comment[et]=Kexi projektifail
 Comment[eu]=Kexi proiektuko fitxategia
-Comment[fa]=پرونده‌ی پروژه‌ای Kexi
+Comment[fa]=پروندۀ پروژه Kexi
 Comment[fi]=Kexi Project -tiedosto
 Comment[fr]=Fichier de projet Kexi
 Comment[fy]=Kexi Project Triem
Index: mimetypes/application/x-cpio.desktop
===================================================================
--- mimetypes/application/x-cpio.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-cpio.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo CPIO
 Comment[et]=CPIO arhiiv
 Comment[eu]=CPIO fitxategia
-Comment[fa]=آرشیو CPIO
+Comment[fa]=بایگانی CPIO
 Comment[fi]=CPIO-paketti
 Comment[fr]=Archive CPIO
 Comment[fy]=CPIO-argyf
Index: mimetypes/application/x-magicpoint.desktop
===================================================================
--- mimetypes/application/x-magicpoint.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-magicpoint.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Presentación de MagicPoint
 Comment[et]=MagicPointi esitlus
 Comment[eu]=MagicPoint aurkezpena
-Comment[fa]=نمایش MagicPoint
+Comment[fa]=ارائه نقطه جادویی
 Comment[fi]=MagicPoint-esitys
 Comment[fr]=Présentation Magicpoint
 Comment[fy]=MagicPoint Presentaasje
Index: mimetypes/application/vnd.mozilla.xul+xml.desktop
===================================================================
--- mimetypes/application/vnd.mozilla.xul+xml.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.mozilla.xul+xml.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Archivo XUL de Mozilla
 Comment[et]=Mozilla XUL-fail
 Comment[eu]=Mozilla XUL fitxategia
+Comment[fa]=پروندۀ Mozilla XUL
 Comment[fi]=Mozilla XUL-tiedosto
 Comment[fr]=Fichier XUL Mozilla
 Comment[fy]=Mozilla XUL Triem
Index: mimetypes/application/x-mplayer2.desktop
===================================================================
--- mimetypes/application/x-mplayer2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-mplayer2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -7,18 +7,31 @@
 Icon=multimedia
 X-KDE-AutoEmbed=true
 Comment=Microsoft Media Format
+Comment[ca]=Format Microsoft Media
+Comment[cs]=Microsoft Media formát
 Comment[da]=Microsoft medieformat
 Comment[de]=Microsoft-Media-Format
+Comment[el]=Τύπος Microsoft Media
 Comment[es]=Formator de medios de Microsoft
 Comment[et]=Microsoft Media
 Comment[fr]=Format Microsoft Media
+Comment[hr]=Microsoft Media oblik
 Comment[hu]=Microsoft Media-fájl
+Comment[is]=Microsoft Media snið
+Comment[it]=Formato Microsoft Media
 Comment[ja]=Microsoft メディアフォーマット
+Comment[km]=ទ្រង់ទ្រាយ Microsoft មេឌៀ
+Comment[nb]=Microsoft Media-format
 Comment[nds]=Microsoft-Medienformaat
 Comment[nl]=Microsoft mediaformaat
+Comment[nn]=Microsoft Media-format
+Comment[pl]=Format Microsoft Media
 Comment[pt]=Formato Multimédia da Microsoft
 Comment[pt_BR]=Formato Multimédia da Microsoft
+Comment[ro]=Format media Microsoft
+Comment[ru]=Microsoft Media
 Comment[sk]=Microsoft Media formát
+Comment[sl]=Microsoftov medijski format
 Comment[sr]=Microsoft-ов медијски формат
 Comment[sr@Latn]=Microsoft-ov medijski format
 Comment[sv]=Microsoft media-format
Index: mimetypes/application/x-bittorrent.desktop
===================================================================
--- mimetypes/application/x-bittorrent.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-bittorrent.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[es]=Descarga BitTorrent
 Comment[et]=BitTorrent allalaadimine
 Comment[eu]=BitTorrent deskarga
-Comment[fa]=بارگیری BitTorrent
+Comment[fa]=بارگذاری BitTorrent 
 Comment[fi]=BitTorrent-lataus
 Comment[fr]=Téléchargement BitTorrent
 Comment[fy]=Ynlade BitTorrent
Index: mimetypes/application/x-sharedlib.desktop
===================================================================
--- mimetypes/application/x-sharedlib.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-sharedlib.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Biblioteca compartida
 Comment[et]=Jagatud teek
 Comment[eu]=Biblioteka partekatua
-Comment[fa]=کتابخانه‌ی اشتراکی
+Comment[fa]=کتابخانۀ مشترک
 Comment[fi]=Jaettu kirjasto
 Comment[fr]=Bibliothèque partagée
 Comment[fy]=Dielde bibleteek
Index: mimetypes/application/vnd.sun.xml.base.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.base.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.base.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -13,6 +13,7 @@
 Comment[es]=Base de datos de OpenOffice.org
 Comment[et]=OpenOffice.org-i andmebaas
 Comment[eu]=OpenOffice.org datu-basea
+Comment[fa]=دادگان OpenOffice.org
 Comment[fi]=OpenOffice.org-tietokanta
 Comment[fr]=Base de données OpenOffice.org
 Comment[fy]=OpenOffice.org-databank
Index: mimetypes/application/x-linguist.desktop
===================================================================
--- mimetypes/application/x-linguist.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-linguist.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Archivo fuente de traducción de Qt
 Comment[et]=Qt Translationi lähtetekst
 Comment[eu]=Qt itzulpenerako iturburuko fitxategia
-Comment[fa]=پرونده‌ی کد ترجمه‌ها‌ی Qt
+Comment[fa]=پروندۀ منیع ترجمهQt
 Comment[fi]=Qr-käännöstiedosto
 Comment[fr]=Fichier source de traduction QT
 Comment[fy]=Qt Fertaal Boarnetriem
Index: mimetypes/application/x-tbz.desktop
===================================================================
--- mimetypes/application/x-tbz.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tbz.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -13,6 +13,7 @@
 Comment[es]=Archivo Tar comprimido con Bzip2
 Comment[et]=Bzip2-tihendusega tar-arhiiv
 Comment[eu]=Tar+BZIP artxiboa
+Comment[fa]=بایگانی‌بان Bzip2-ed
 Comment[fi]=Bzip2-pakattu Tar-paketti
 Comment[fr]=Archive Tar compactée par Bzip2
 Comment[fy]=Mei Bzip2 ynpakt Tar-argyf
Index: mimetypes/application/x-zip-compressed.desktop
===================================================================
--- mimetypes/application/x-zip-compressed.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-zip-compressed.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo Zip
 Comment[et]=Zip-arhiiv
 Comment[eu]=Zip fitxategia
-Comment[fa]=آرشیو زیپ
+Comment[fa]=بایگانی فشرده
 Comment[fi]=Zip-paketti
 Comment[fr]=Archive Zip
 Comment[fy]=Zip-argyf
Index: mimetypes/application/x-kugar.desktop
===================================================================
--- mimetypes/application/x-kugar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-kugar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo de datos de Kugar
 Comment[et]=Kugari andmefail
 Comment[eu]=Kugar datu-fitxategia
-Comment[fa]=پرونده‌ی داده‌ی Kugar
+Comment[fa]=پروندۀ داده Kugar
 Comment[fi]=Kugar-datatiedosto
 Comment[fr]=Fichier de données Kugar
 Comment[fy]=Kugar Datatriem
Index: mimetypes/application/x-gzip.desktop
===================================================================
--- mimetypes/application/x-gzip.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-gzip.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo comprimido Gzip
 Comment[et]=Gzip arhiiv
 Comment[eu]=Gzip fitxategia
-Comment[fa]=پرونده‌ی Gzip
+Comment[fa]=پروندۀ Gzip 
 Comment[fi]=Gzip-paketti
 Comment[fr]=Fichier compacté par Gzip
 Comment[fy]=Gzip-triem
Index: mimetypes/application/vnd.palm.desktop
===================================================================
--- mimetypes/application/vnd.palm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.palm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Documento Palm
 Comment[et]=Palmi dokument
 Comment[eu]=Palm dokumentua
-Comment[fa]=سند Palm
+Comment[fa]=سند رایانۀ جیبی
 Comment[fi]=Palm-asiakirja
 Comment[fr]=Document Palm
 Comment[fy]=Palm Dokumint
Index: mimetypes/application/x-tzo.desktop
===================================================================
--- mimetypes/application/x-tzo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tzo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo Tar comprimido en Lzop
 Comment[et]=Lzopitud TAR-arhiiv
 Comment[eu]=Lzop-Tar artxiboa
-Comment[fa]=آرشیو Lzop شده‌ی Tar
+Comment[fa]=بایگانی‌بان Lzopped 
 Comment[fi]=Lzop-pakattu Tar-paketti
 Comment[fr]=Archive Tar compactée par Lzop
 Comment[fy]=Mei Lzop komprimearre Tar-argyf
Index: mimetypes/application/x-font-ghostscript.desktop
===================================================================
--- mimetypes/application/x-font-ghostscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-ghostscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Fuente Ghostscript
 Comment[et]=Ghostscripti font
 Comment[eu]=Ghostscript-en letra-tipoa
-Comment[fa]=قلم Ghostscript
+Comment[fa]=قلم Ghostscript 
 Comment[fi]=GhostScript-kirjasin
 Comment[fr]=Police de caractères Ghostscript
 Comment[fy]=Ghostscript-lettertype
Index: mimetypes/application/vnd.oasis.opendocument.spreadsheet-template.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.spreadsheet-template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.spreadsheet-template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Plantilla de hoja de cálculo de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument arvutustabeli mall
 Comment[eu]=OASIS OpenDocument kalkulu-orriaren txantiloia
+Comment[fa]=قالب صفحه گسترده سندباز OASIS
 Comment[fi]=OASIS OpenDocument -taulukkopohja
 Comment[fr]=Modèle de feuille de calcul OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument rekkenboerdsjabloan
Index: mimetypes/application/x-python-bytecode.desktop
===================================================================
--- mimetypes/application/x-python-bytecode.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-python-bytecode.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Código byte de Python
 Comment[et]=Pythoni baitkood
 Comment[eu]=Python bytekodea
-Comment[fa]=کدبایت Python
+Comment[fa]=کد بایت Python
 Comment[fi]=Python-tavukoodi
 Comment[fr]=Bytecode Python
 Comment[fy]=Python bytekoade
Index: mimetypes/application/x-webarchive.desktop
===================================================================
--- mimetypes/application/x-webarchive.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-webarchive.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Comment[es]=Archivo web
 Comment[et]=Veebiarhiiv
 Comment[eu]=Web fitxategia
+Comment[fa]=بایگانی وب
 Comment[fi]=www-paketti
 Comment[fr]=Archive Web
 Comment[fy]=Webargyf
Index: mimetypes/application/pkcs7-signature.desktop
===================================================================
--- mimetypes/application/pkcs7-signature.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pkcs7-signature.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Firma suelta S/MIME
 Comment[et]=Eraldiseisev S/MIME signatuur
 Comment[eu]=Uztartu gabeko S/MIME sinadura
-Comment[fa]=امضای غیر متصل S/MIME
+Comment[fa]=امضاء جداشدۀ  S/MIME
 Comment[fi]=Irroitettu S/MIME-allekirjoitus
 Comment[fr]=Signature S/MIME détachée
 Comment[fy]=loskeppele S/MIME-sinjatuer
Index: mimetypes/application/pgp.desktop
===================================================================
--- mimetypes/application/pgp.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pgp.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Mensaje cifrado o firmado PGP/MIME
 Comment[et]=PGP-ga krüptitud või signeeritud kiri
 Comment[eu]=PGPrekin zifratutako edo sinatutako mezua
-Comment[fa]=پیام رمزینه یا امضا شده توسط PGP
+Comment[fa]=پیام علامت‌دار یا رمزبندی‌شده PGP 
 Comment[fi]=PGP-salattu tai -allekirjoitettu viesti
 Comment[fr]=Message signé ou crypté par PGP
 Comment[fy]=PGP fersifere of Tekene Berjocht
Index: mimetypes/application/vnd.oasis.opendocument.text.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.text.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.text.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=texto de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument tekstidokument
 Comment[eu]=OASIS OpenDocument testua
+Comment[fa]=متن سندباز OASIS
 Comment[fi]=OASIS OpenDocument -teksti
 Comment[fr]=Document texte OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument tekst
Index: mimetypes/application/x-ruby.desktop
===================================================================
--- mimetypes/application/x-ruby.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-ruby.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[es]=Programa en Ruby
 Comment[et]=Ruby rakendus
 Comment[eu]=Ruby programa
-Comment[fa]=برنامه‌ی Ruby
+Comment[fa]=برنامۀ Ruby
 Comment[fi]=Ruby-ohjelma
 Comment[fr]=Programme Ruby
 Comment[fy]=Ruby Programma
Index: mimetypes/application/x-gettext.desktop
===================================================================
--- mimetypes/application/x-gettext.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-gettext.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Catálogo de mensajes de GNU Gettext
 Comment[et]=GNU Gettexti teadete kataloog
 Comment[eu]=GNU Gettext mezuen katalogoa
-Comment[fa]=کاتالوگ پیام‌های GNU Gettext
+Comment[fa]=فهرست پیام Gettext گنو
 Comment[fi]=GNU Gettext -viestilista
 Comment[fr]=Catalogue de messages GNU Gettext
 Comment[fy]=GNU Gettext Berjocht Katalog
Index: mimetypes/application/x-tgif.desktop
===================================================================
--- mimetypes/application/x-tgif.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tgif.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Documento TGIF
 Comment[et]=TGIF dokument
 Comment[eu]=TGIF dokumentua
-Comment[fa]=سندTGIF
+Comment[fa]=سند TGIF
 Comment[fi]=TGIF-asiakirja
 Comment[fr]=Document TGif
 Comment[fy]=TGIF-dokumint
Index: mimetypes/application/vnd.oasis.opendocument.text-template.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.text-template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.text-template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Plantilla de documento de texto de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument tekstidokumendi mall
 Comment[eu]=OASIS OpenDocument testu-txantiloia
+Comment[fa]=قالب متن سندباز OASIS
 Comment[fi]=OASIS OpenDocument -tekstiasiakirjapohja
 Comment[fr]=Modèle de document texte OASIS OpenDocument
 Comment[fy]=OpenOffice.org tekstsjabloan
Index: mimetypes/application/vnd.sun.xml.writer.master.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.writer.master.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.writer.master.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Documento de texto maestro de OpenOffice.org
 Comment[et]=OpenOffice.org-i peatekstidokument
 Comment[eu]=OpenOffice.org testu-dokumentu maisua
+Comment[fa]=سند متنی اصلی OpenOffice.org
 Comment[fi]=OpenOffice.org-päätekstiasiakirja
 Comment[fr]=Document texte maître OpenOffice.org
 Comment[fy]=OpenOffice.org Haad tekst Dokumint
Index: mimetypes/application/x-font-otf.desktop
===================================================================
--- mimetypes/application/x-font-otf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-otf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Fuente OpenType
 Comment[et]=OpenType'i font
 Comment[eu]=OpenType-en letra-tipoa
-Comment[fa]=قلم OpenType
+Comment[fa]=قلم نوع باز
 Comment[fi]=OpenType-kirjasin
 Comment[fr]=Police de caractères OpenType
 Comment[fy]=OpenType lettertype
Index: mimetypes/application/smil.desktop
===================================================================
--- mimetypes/application/smil.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/smil.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Lenguaje de integración multimedia sincronizada
 Comment[et]=Sünkroniseeritud Multimeedia Integreerimise Keel
 Comment[eu]=Sinkronizatutako Multimedia integrazioaren lengoaia
-Comment[fa]=زبان تکمیلی چندرسانه‌ای هماهنگ
+Comment[fa]=زبان مجتمع‌سازی چند رسانه‌ای همگام‌شده
 Comment[fi]=Synkronoitu multimedianintergoimiskieli
 Comment[fr]=Langage d'intégration multimédia synchronisée
 Comment[fy]=Synchronized Multimedia Integration Language (SMIL)
Index: mimetypes/application/vnd.sun.xml.calc.template.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.calc.template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.calc.template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Plantilla de hoja de cálculo de OpenOffice.org
 Comment[et]=OpenOffice.org-i arvutustabeli mall
 Comment[eu]=OpenOffice.org kalkulu-orrien txantiloia
+Comment[fa]=قالب صفحه گسترده OpenOffice.org
 Comment[fi]=OpenOffice.org-taulukkopohja
 Comment[fr]=Modèle de feuille de calcul OpenOffice.org
 Comment[fy]=OpenOffice.org Rekkenboerd Sjabloan
Index: mimetypes/application/x-bzip.desktop
===================================================================
--- mimetypes/application/x-bzip.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-bzip.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo comprimido Bzip
 Comment[et]=Bzip-arhiiv
 Comment[eu]=Bzip fitxategia
-Comment[fa]=پرونده‌ی Bzip
+Comment[fa]=پروندۀ Bzip
 Comment[fi]=Bzip-tiedosto
 Comment[fr]=Fichier compacté par Bzip
 Comment[fy]=Bzip-Triem
Index: mimetypes/application/xml-dtd.desktop
===================================================================
--- mimetypes/application/xml-dtd.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/xml-dtd.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -13,6 +13,7 @@
 Comment[es]=Documento DTD XML
 Comment[et]=XML DTD-dokument
 Comment[eu]=XML DTD dokumentua
+Comment[fa]=سند XML DTD
 Comment[fi]=XML DTD -asiakirja
 Comment[fr]=Document DTD en XML
 Comment[fy]=XML DTD-dokumint
Index: mimetypes/application/x-arc.desktop
===================================================================
--- mimetypes/application/x-arc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-arc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo ARC
 Comment[et]=ARC arhiiv
 Comment[eu]=ARC fitxategia
-Comment[fa]=آرشیو ARC
+Comment[fa]=بایگانی ARC
 Comment[fi]=ARC-paketti
 Comment[fr]=Archive ARC
 Comment[fy]=ARC Argyf
Index: mimetypes/application/pkcs7-mime.desktop
===================================================================
--- mimetypes/application/pkcs7-mime.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pkcs7-mime.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Datos formateados PKCS#7 (S/MIME)
 Comment[et]=PKCS#7 (S/MIME) vormindatud andmed
 Comment[eu]=PKCS#7 (S/MIME) datu formateatuak
-Comment[fa]=داده‌ی قالب‌بندی شده‌ی PKCS شماره‌ی ۷ (S/MIME)
+Comment[fa]=دادۀ قالب‌بندی شدۀ)PKCS#7 (S/MIME
 Comment[fi]=PKCS#7 (S/MIME) -muotoinen tieto
 Comment[fr]=Données formatées PKCS#7 (S/MIME)
 Comment[fy]=PKCS#7-opmakke data (S/MIME)
Index: mimetypes/application/x-zoo.desktop
===================================================================
--- mimetypes/application/x-zoo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-zoo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo Zoo
 Comment[et]=Zoo-arhiiv
 Comment[eu]=Zoo fitxategia
-Comment[fa]=آرشیو Zoo
+Comment[fa]=بایگانی Zoo
 Comment[fi]=Zoo-paketti
 Comment[fr]=Archive Zoo
 Comment[fy]=Zoo-argyf
Index: mimetypes/application/vnd.sun.xml.writer.template.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.writer.template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.writer.template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Plantilla de documento de texto de OpenOffice.org
 Comment[et]=OpenOffice.org-i tekstidokumendi mall
 Comment[eu]=OpenOffice.org testu-dokumentu txantiloia
+Comment[fa]=قالب سند متنی OpenOffice.org
 Comment[fi]=OpenOffice.org-tekstiasiakirjapohja
 Comment[fr]=Modèle de document texte OpenOffice.org
 Comment[fy]=OpenOffice.org Tekst Dokumint Sjabloan
Index: mimetypes/application/x-font-pcf.desktop
===================================================================
--- mimetypes/application/x-font-pcf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-pcf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Fuente bitmap PCF
 Comment[et]=PCF bittrasterfont
 Comment[eu]=PCF bitmap-en letra-tipoa
-Comment[fa]=قلم نقش‌بیت PCF
+Comment[fa]=قلم نگاشت بیت PCF
 Comment[fi]=PCF-bittikarttakirjasin
 Comment[fr]=Police de caractères bitmap PCF
 Comment[fy]=PCF Bitmap-lettertype
Index: mimetypes/application/x-arj.desktop
===================================================================
--- mimetypes/application/x-arj.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-arj.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo comprimido ARJ
 Comment[et]=ARJ arhiiv
 Comment[eu]=ARJ fitxategia
-Comment[fa]=آرشیو ARJ
+Comment[fa]=بایگانی ARJ
 Comment[fi]=ARJ-paketti
 Comment[fr]=Archive ARJ
 Comment[fy]=ARJ-Argyf
Index: mimetypes/application/vnd.oasis.opendocument.presentation-template.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.presentation-template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.presentation-template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Plantilla de presentación de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument esitlusemall
 Comment[eu]=OASIS OpenDocument aurkezpen-txantiloia
+Comment[fa]=قالب ارائه سندباز OASIS
 Comment[fi]=OASIS OpenDocument -esityspohja
 Comment[fr]=Modèle de présentation OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument presintaasjesjabloan
Index: mimetypes/application/x-trash.desktop
===================================================================
--- mimetypes/application/x-trash.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-trash.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo de copia de seguridad
 Comment[et]=Varukoopia
 Comment[eu]=Babeskopiaren fitxategia
-Comment[fa]=پرونده‌ی پشتیبان
+Comment[fa]=پروندۀ پشتیبان
 Comment[fi]=Varmuuskopiotiedosto
 Comment[fr]=Fichier de sauvegarde
 Comment[fy]=Reserve-oerskrift
@@ -56,7 +56,7 @@
 Comment[ro]=Fişier de rezervă
 Comment[ru]=Файл запасной копии
 Comment[rw]=Idosiye y'Ingoboka
-Comment[se]=Liigekopiija
+Comment[se]=Liigemáŋgus
 Comment[sk]=Záložný súbor
 Comment[sl]=Rezervna datoteka
 Comment[sq]=Skedë Rezervë
Index: mimetypes/application/x-siag.desktop
===================================================================
--- mimetypes/application/x-siag.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-siag.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Hoja de cálculo de Siag
 Comment[et]=Siagi tabel
 Comment[eu]=Siag kalkulu-orria
-Comment[fa]=صفحه‌گسترده‌ی Siag
+Comment[fa]=صفحه گسترده Siag
 Comment[fi]=Siag-taulukko
 Comment[fr]=Feuille de calcul Siag
 Comment[fy]=Siag Rekkenboerd
Index: mimetypes/application/x-egon.desktop
===================================================================
--- mimetypes/application/x-egon.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-egon.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[eo]=Egon-vivigilo
 Comment[es]=Archivo de Egon Animator
 Comment[et]=Egon animaator
-Comment[fa]=متحرک ساز Egon
+Comment[fa]=پویانمای Egon
 Comment[fi]=Egon-animaattori
 Comment[fr]=Animateur Egon
 Comment[fy]=Egon-animaasjeprogramma
Index: mimetypes/application/x-ace.desktop
===================================================================
--- mimetypes/application/x-ace.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-ace.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo ACE
 Comment[et]=ACE arhiiv
 Comment[eu]=ACE fitxategia
-Comment[fa]=آرشیو ACE
+Comment[fa]=بایگانی ACE
 Comment[fi]=ACE-paketti
 Comment[fr]=Archive ACE
 Comment[fy]=ACE Argyf
Index: mimetypes/application/x-kde-wallet.desktop
===================================================================
--- mimetypes/application/x-kde-wallet.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-kde-wallet.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo de cartera de KDE
 Comment[et]=KDE turvalaeka fail
 Comment[eu]=KDE Wallet fitxategia
-Comment[fa]=پرونده‌ی کیفی KDE
+Comment[fa]=پروندۀ KDE Wallet
 Comment[fi]=KDE Wallet -tiedosto
 Comment[fr]=Fichiers de KDEWallet
 Comment[fy]=KDE Wallet Triem
Index: mimetypes/application/x-mimearchive.desktop
===================================================================
--- mimetypes/application/x-mimearchive.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-mimearchive.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Archivo web MIME encapsulado
 Comment[et]=MIME kapselduses veebiarhiiv
 Comment[eu]=Kapsulatutako Mime-a duen web artxiboa
+Comment[fa]=بایگانی وب کپسوله‌شدۀ مایم
 Comment[fi]=Mime pakattu www-paketti
 Comment[fr]=Archive Web encapsulé MIME
 Comment[fy]=Mime Ynsletten webargyf
Index: mimetypes/application/x-deb.desktop
===================================================================
--- mimetypes/application/x-deb.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-deb.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Paquete Debian
 Comment[et]=Debiani pakett
 Comment[eu]=Debian paketea
-Comment[fa]=بسته‌ی دبیان
+Comment[fa]=بستۀ دبیان
 Comment[fi]=Debian-paketti
 Comment[fr]=Paquetage Debian
 Comment[fy]=Debian Pakket
Index: mimetypes/application/x-ica.desktop
===================================================================
--- mimetypes/application/x-ica.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-ica.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Cliente de configuración Citrix ICA
 Comment[et]=Citrix ICA kliendi seadistus
 Comment[eu]=Citrix ICA bezeroaren konfigurazioa
+Comment[fa]=پیکربندی کارخواه  Citrix ICA
 Comment[fi]=Citrix ICA -asiakkaan asetukset
 Comment[fr]=Configuration automatique du client Citrix ICA
 Comment[fy]=Citrix ICA Brûkers Ynstelling
Index: mimetypes/application/x-rpm.desktop
===================================================================
--- mimetypes/application/x-rpm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-rpm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo de paquete RPM
 Comment[et]=RPM-pakett
 Comment[eu]=RPM pakete fitxategia
-Comment[fa]=پرونده‌ی RPM Package
+Comment[fa]=پروندۀ بستۀ RPM
 Comment[fi]=RPM-paketti
 Comment[fr]=Paquetage RPM
 Comment[fy]=RPM-pakket
Index: mimetypes/application/x-java-jnlp-file.desktop
===================================================================
--- mimetypes/application/x-java-jnlp-file.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-java-jnlp-file.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Comment[es]=Aplicación de Java Web Start
 Comment[et]=Java Web Start rakendus
 Comment[eu]=Web hasierako Java aplikazioa
+Comment[fa]=کاربرد آغاز وب جاوا
 Comment[fi]=Java Web Start -sovelma
 Comment[fr]=Application Java Web Start
 Comment[fy]=Java Web Start-applikaasje
Index: mimetypes/application/x-designer.desktop
===================================================================
--- mimetypes/application/x-designer.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-designer.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo de Qt Designer
 Comment[et]=Qt Disaineri fail
 Comment[eu]=Qt diseinuko fitxategia
-Comment[fa]=پرونده‌ی Qt Designer
+Comment[fa]=پروندۀ Qt Designer
 Comment[fi]=Qt Designer -tiedosto
 Comment[fr]=Fichier Qt-Designer
 Comment[fy]=Qt Designer-triem
Index: mimetypes/application/vnd.sun.xml.writer.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.writer.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.writer.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Documento de texto de OpenOffice.org
 Comment[et]=OpenOffice.org-i tekstidokument
 Comment[eu]=OpenOffice.org testu-dokumentua
-Comment[fa]= سند متنی OpenOffice.org
+Comment[fa]=سند متنی OpenOffice.org
 Comment[fi]=OpenOffice.org-tekstiasiakirja
 Comment[fr]=Document texte OpenOffice.org
 Comment[fy]=OpenOffice.org Tekst Dokumint
Index: mimetypes/application/x-perl.desktop
===================================================================
--- mimetypes/application/x-perl.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-perl.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Programa en Perl
 Comment[et]=Perli rakendus
 Comment[eu]=Perl programa
+Comment[fa]=برنامۀ پرل
 Comment[fi]=PERL-ohjelma
 Comment[fr]=Programme Perl
 Comment[fy]=Perl-programma
Index: mimetypes/application/x-java-applet.desktop
===================================================================
--- mimetypes/application/x-java-applet.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-java-applet.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Applet de Java
 Comment[et]=Java aplett
 Comment[eu]=Javaren applet-a
-Comment[fa]=برنامک Java
+Comment[fa]=برنامک جاوا
 Comment[fi]=Java-sovelma
 Comment[fr]=Applet Java
 Comment[ga]=Feidhmchláirín Java
@@ -38,6 +38,7 @@
 Comment[mk]=Java-аплет
 Comment[mn]=Java-Апплет
 Comment[ms]=Aplet Java
+Comment[nb]=Java-miniprogram
 Comment[nds]=Java-Programm
 Comment[nn]=Java-miniprogram
 Comment[pa]=ਜਾਵਾ(Java) ਐਪਲਿਟ
Index: mimetypes/application/postscript.desktop
===================================================================
--- mimetypes/application/postscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/postscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Documento PostScript
 Comment[et]=PostScript-dokument
 Comment[eu]=PostScript dokumentua
-Comment[fa]=سند PostScript
+Comment[fa]=سند پست اسکریپت
 Comment[fi]=Postscript-asiakirja
 Comment[fr]=Document PostScript
 Comment[fy]=PostScript-dokumint
Index: mimetypes/application/vnd.oasis.opendocument.graphics-template.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.graphics-template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.graphics-template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Plantilla de documento gráfico de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument joonistusemall
 Comment[eu]=OASIS OpenDocument grafiko-txantiloia
+Comment[fa]=قالب نگارۀ سندباز OASIS
 Comment[fi]=OASIS OpenDocument -piirrospohja
 Comment[fr]=Modèle de graphiques OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument grafyske foarstellings sjabloan
Index: mimetypes/application/vnd.oasis.opendocument.presentation.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.presentation.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.presentation.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Presentación de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument esitlus
 Comment[eu]=OASIS OpenDocument aurkezpena
+Comment[fa]=ارائه سندبازOASIS
 Comment[fi]=OASIS OpenDocument -esitys
 Comment[fr]=Présentation OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument presintaasje
Index: mimetypes/application/x-xliff.desktop
===================================================================
--- mimetypes/application/x-xliff.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-xliff.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Archivo de traducción XLIFF
 Comment[et]=XLIFF tõlkefail
 Comment[eu]=XLIFF itzulpen fitxategia
+Comment[fa]=پروندۀ ترجمۀ XLIFF
 Comment[fi]=XLIFF-käännöstiedosto
 Comment[fr]=Fichier de traduction XLIFF
 Comment[fy]=XLIFF-FertalingsTriem
Index: mimetypes/application/x-karbon.desktop
===================================================================
--- mimetypes/application/x-karbon.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-karbon.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento de Karbon14
 Comment[et]=Karbon14 dokument
 Comment[eu]=Karbon14 dokumentua
-Comment[fa]=سند Karbon۱۴
+Comment[fa]=سند Karbon14
 Comment[fi]=Karbon14-asiakirja
 Comment[fr]=Document Karbon14
 Comment[fy]=Karbon14 dokumint
Index: mimetypes/application/x-jar.desktop
===================================================================
--- mimetypes/application/x-jar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-jar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo Java
 Comment[et]=Java arhiiv
 Comment[eu]=Java artxiboa
-Comment[fa]=آرشیو Java
+Comment[fa]=بایگانی جاوا
 Comment[fi]=Java-paketti
 Comment[fr]=Archive Java
 Comment[fy]=Java-argyf
Index: mimetypes/application/java.desktop
===================================================================
--- mimetypes/application/java.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/java.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Clase Java
 Comment[et]=Java klass
 Comment[eu]=Java klasea
-Comment[fa]=طبقه‌ي Java
+Comment[fa]=ردۀ جاوا
 Comment[fi]=Java-luokka
 Comment[fr]=Classe Java
 Comment[fy]=Java-klasse
Index: mimetypes/application/pgp-encrypted.desktop
===================================================================
--- mimetypes/application/pgp-encrypted.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pgp-encrypted.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Cabecera de mensaje cifrado PGP/MIME
 Comment[et]=PGP/MIME krüptitud kirja päis
 Comment[eu]=PGP/MIME mezu enkriptatuaren goiburua
-Comment[fa]=سربرگ پیام رمزینه شده‌ی PGP/MIME
+Comment[fa]=سرآیند پیام رمزبندی‌شده PGP/MIME
 Comment[fi]=PGP/MIME-salattu viestiotsikko
 Comment[fr]=En-tête de message crypté PGP / MIME
 Comment[fy]=PGP/MIME-fersifere koptekst fan berjocht
Index: mimetypes/application/x-ogg.desktop
===================================================================
--- mimetypes/application/x-ogg.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-ogg.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Multimedia Ogg
 Comment[et]=Ogg multimeedia
 Comment[eu]=Ogg multimedia
-Comment[fa]=Ogg چندرسانه‌ای
+Comment[fa]=چند رسانه‌ایOgg 
 Comment[fi]=Ogg-multimediatiedosto
 Comment[fr]=Multimédia Ogg
 Comment[fy]=Ogg Multymedia
Index: mimetypes/application/vnd.oasis.opendocument.image.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.image.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.image.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Imagen de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument pilt
 Comment[eu]=OASIS OpenDocument irudia
+Comment[fa]=تصویر سندباز OASIS
 Comment[fi]=OASIS OpenDocument -kuva
 Comment[fr]=Image OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument ôfbylding
Index: mimetypes/application/vnd.sun.xml.impress.template.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.impress.template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.impress.template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Plantilla de presentación de OpenOffice.org
 Comment[et]=OpenOffice.org-i esitlusemall
 Comment[eu]=OpenOffice.org aurkezpen-txantiloia
+Comment[fa]=قالب ارائه OpenOffice.org
 Comment[fi]=OpenOffice.org-esityspohja
 Comment[fr]=Modèle de présentation OpenOffice.org
 Comment[fy]=OpenOffice.org Presentaasje Sjabloan
Index: mimetypes/application/x-archive.desktop
===================================================================
--- mimetypes/application/x-archive.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-archive.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo Ar
 Comment[et]=Ar arhiiv
 Comment[eu]=Ar fitxategia
-Comment[fa]=آرشیو Ar
+Comment[fa]=بایگانی Ar
 Comment[fi]=Ar-paketti
 Comment[fr]=Archive AR
 Comment[fy]=Ar-Argyf
Index: mimetypes/application/vnd.rn-realmedia.desktop
===================================================================
--- mimetypes/application/vnd.rn-realmedia.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.rn-realmedia.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo de RealMedia
 Comment[et]=RealMedia fail
 Comment[eu]=RealMedia fitxategia
-Comment[fa]=پرونده‌ی RealMedia
+Comment[fa]=پروندۀ RealMedia
 Comment[fi]=RealMedia-tiedosto
 Comment[fr]=Fichier RealMedia
 Comment[fy]=RealMedia Triem
Index: mimetypes/application/x-rar.desktop
===================================================================
--- mimetypes/application/x-rar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-rar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo RAR
 Comment[et]=Rar arhiiv
 Comment[eu]=Rar artxiboa
-Comment[fa]=آرشیو Rar
+Comment[fa]=بایگانی Rar
 Comment[fi]=Rar-paketti
 Comment[fr]=Archive Rar
 Comment[fy]=Rar-argyf
Index: mimetypes/application/vnd.stardivision.math.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.math.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.math.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,6 +21,7 @@
 Comment[es]=Documentos matemáticos de StarOffice
 Comment[et]=StarOffice Math'i dokument
 Comment[eu]=StarOffice matematika
+Comment[fa]=سند StarOffice Math
 Comment[fi]=StarOffice Math -asiakirja
 Comment[fr]=Document StarOffice Math
 Comment[fy]=StarOffice Rekken Dokumint
Index: mimetypes/application/x-iso.desktop
===================================================================
--- mimetypes/application/x-iso.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-iso.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[es]=Archivo de imagen ISO9660
 Comment[et]=ISO9660 tõmmisefail
 Comment[eu]=ISO9660 irudi-fitxategia
+Comment[fa]=پروندۀ تصویر ISO9660
 Comment[fi]=ISO9660 binäärikuva
 Comment[fr]=Fichier image ISO9660
 Comment[fy]=ISO9660 Ofbylding Triem
Index: mimetypes/application/x-font-snf.desktop
===================================================================
--- mimetypes/application/x-font-snf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-snf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Fuente bitmap SNF
 Comment[et]=SNF bittrasterfont
 Comment[eu]=SNF bitmap-en letra-tipoa
-Comment[fa]=قلم نقش‌بیت SNF
+Comment[fa]=قلم نگاشت بیت SNF
 Comment[fi]=SNF-bittikarttakirjasin
 Comment[fr]=Police de caractères bitmap SNF
 Comment[fy]=SNF Bitmap-lettertype
Index: mimetypes/application/pgp-keys.desktop
===================================================================
--- mimetypes/application/pgp-keys.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pgp-keys.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Paquete de certificado OpenPGP
 Comment[et]=OpenPGP võtmepaar
 Comment[eu]=OpenPGP gako multzoa
-Comment[fa]=کلید همراه شده‌ی OpenPGP
+Comment[fa]=دسته کلید OpenPGP
 Comment[fi]=OpenPGP-avainnippu
 Comment[fr]=Ensemble de clés OpenPGP
 Comment[fy]=OpenPGP Kaai Bondel
Index: mimetypes/application/x-compress.desktop
===================================================================
--- mimetypes/application/x-compress.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-compress.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo comprimido de UNIX
 Comment[et]=UNIX arhiiv
 Comment[eu]=UNIX fitxategi konprimitua
-Comment[fa]=پرونده‌ی فشرده شده‌ی یونیکس
+Comment[fa]=پروندۀ فشردۀ یونیکس
 Comment[fi]=UNIX-pakattu tiedosto
 Comment[fr]=Fichier compacté UNIX
 Comment[fy]=UNIX-komprimearre triem
Index: mimetypes/application/msexcel.desktop
===================================================================
--- mimetypes/application/msexcel.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/msexcel.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Hoja de cálculo de Microsoft Excel
 Comment[et]=Microsoft Exceli tabel
 Comment[eu]=Microsoft Excel kalkulu-orria
-Comment[fa]=صفحه‌ی گسترده‌ی مایکروسافت اکسل
+Comment[fa]=صفحه گسترده میکروسافت اکسل
 Comment[fi]=Microsoft Excel -taulukko
 Comment[fr]=Feuille de calcul Microsoft Excel
 Comment[fy]=Microsoft Excel-Rekkenboerd
Index: mimetypes/application/x-applixspread.desktop
===================================================================
--- mimetypes/application/x-applixspread.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-applixspread.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento hoja de cálculo de Applix
 Comment[et]=Applixi arvutustabel
 Comment[eu]=Applix kalkulu-orria
-Comment[fa]=سند صفحه‌گسترده‌ی Applix
+Comment[fa]=سند صفحه گسترده  Applix
 Comment[fi]=Applix taulukkolaskenta-asiakirja
 Comment[fr]=Document Applix Spreadsheets
 Comment[fy]=Applix Rekkenboerd dokumint
Index: mimetypes/application/x-font-ttc.desktop
===================================================================
--- mimetypes/application/x-font-ttc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-ttc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Colección de fuentes TrueType
 Comment[et]=TrueType fondikogu
 Comment[eu]=TrueType letra-tipoen bilduma
-Comment[fa]=مجموعه‌ی قلم‌های TrueType
+Comment[fa]=مجموعه قلم حقیقی
 Comment[fi]=TrueType-kirjasinkokoelma
 Comment[fr]=Jeu de polices de caractères Truetype
 Comment[fy]=TrueType lettertype Samling
Index: mimetypes/application/vnd.ms-excel.desktop
===================================================================
--- mimetypes/application/vnd.ms-excel.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.ms-excel.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Hoja de cálculo de Microsoft Excel
 Comment[et]=Microsoft Exceli tabel
 Comment[eu]=Microsoft Excel kalkulu-orria
-Comment[fa]=صفحه‌ی گسترده‌ی مایکروسافت اکسل
+Comment[fa]=صفحه گسترده میکروسافت اکسل
 Comment[fi]=Microsoft Excel -taulukko
 Comment[fr]=Feuille de calcul Microsoft Excel
 Comment[fy]=Microsoft Excel-Rekkenboerd
Index: mimetypes/application/x-bz2dvi.desktop
===================================================================
--- mimetypes/application/x-bz2dvi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-bz2dvi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Archivo DVI comprimido con Bzip2
 Comment[et]=Bzip2 tihendusega DVI-fail
 Comment[eu]=Bzip2-ek konprimitutako DVI fitxategia
+Comment[fa]=پروندۀ DVI فشرده‌شدۀ Bzip2
 Comment[fi]=Bzip2-pakattu DVI-tiedosto
 Comment[fr]=Fichier DVI compacté avec Bzip2
 Comment[fy]=Bzip2 komprimearre DVI Triem
Index: mimetypes/application/x-7z.desktop
===================================================================
--- mimetypes/application/x-7z.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-7z.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Archivo Zip-7
 Comment[et]=7-Zip arhiiv
 Comment[eu]=7-Zip fitxategia
+Comment[fa]=بایگانی 7-Zip
 Comment[fi]=7-Zip-paketti
 Comment[fr]=Archive 7-Zip
 Comment[fy]=7-zip-Argyf
@@ -62,3 +63,8 @@
 Comment[zh_CN]=7-Zip 归档
 Comment[zh_HK]=7-Zip 壓縮檔
 Comment[zh_TW]=7-Zip 壓縮文件
+
+[Property::X-KDE-LocalProtocol]
+Type=QString
+Value=p7zip
+
Index: mimetypes/application/x-font-ttf.desktop
===================================================================
--- mimetypes/application/x-font-ttf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-ttf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Fuente TrueType
 Comment[et]=TrueType font
 Comment[eu]=TrueType letra-tipoa
-Comment[fa]=قلم TrueType
+Comment[fa]=قلم حقیقی
 Comment[fi]=TrueType-kirjasin
 Comment[fr]=Police de caractères Truetype
 Comment[fy]=TrueType lettertype
Index: mimetypes/application/x-msaccess.desktop
===================================================================
--- mimetypes/application/x-msaccess.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-msaccess.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Base de datos de Microsoft Access
 Comment[et]=Microsoft Accessi andmebaas
 Comment[eu]=Microsoft Access datu-basea
-Comment[fa]=بانک اطلاعاتی مایکروسافت اکسس
+Comment[fa]=دادگان میکروسافت اکسس
 Comment[fi]=Microsoft Access -tietokanta
 Comment[fr]=Base de données Microsoft Access
 Comment[fy]=Microsoft Access Databank
Index: mimetypes/application/x-zip.desktop
===================================================================
--- mimetypes/application/x-zip.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-zip.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo Zip
 Comment[et]=Zip-arhiiv
 Comment[eu]=Zip fitxategia
-Comment[fa]=آرشیو زیپ
+Comment[fa]=بایگانی فشرده
 Comment[fi]=Zip-paketti
 Comment[fr]=Archive Zip
 Comment[fy]=Zip-argyf
Index: mimetypes/application/vnd.ms-powerpoint.desktop
===================================================================
--- mimetypes/application/vnd.ms-powerpoint.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.ms-powerpoint.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Presentación de Microsoft PowerPoint
 Comment[et]=Microsoft PowerPointi esitlus
 Comment[eu]=Microsoft PowerPoint aurkezpena
-Comment[fa]=نمایش مایکروسافت پاور پوینت
+Comment[fa]=میکروسافت پاورپوینت
 Comment[fi]=Microsoft PowerPoint -esitys
 Comment[fr]=Présentation Microsoft PowerPoint
 Comment[fy]=Microsoft PowerPoint Presintaasje
Index: mimetypes/application/x-kcsrc.desktop
===================================================================
--- mimetypes/application/x-kcsrc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-kcsrc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Tema de color de KDE
 Comment[et]=KDE värviteema
 Comment[eu]=KDE kolore-gaia
-Comment[fa]=طرح رنگی KDE
+Comment[fa]=چهرۀ رنگ KDE
 Comment[fi]=KDE:n väriteema
 Comment[fr]=Thème de couleurs pour KDE
 Comment[fy]=KDE Kleur tema
Index: mimetypes/application/vnd.ms-word.desktop
===================================================================
--- mimetypes/application/vnd.ms-word.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.ms-word.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Documento de Microsoft Word
 Comment[et]=Microsoft Wordi dokument
 Comment[eu]=Microsoft Word dokumentua
-Comment[fa]=سند مایکروسافت ورد
+Comment[fa]=سند میکروسافت ورد
 Comment[fi]=Microsoft Word -asiakirja
 Comment[fr]=Document Microsoft Word
 Comment[fy]=Microsoft Word-dokumint
Index: mimetypes/application/x-gzpostscript.desktop
===================================================================
--- mimetypes/application/x-gzpostscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-gzpostscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo PostScript comprimido con Gzip
 Comment[et]=GZIPiga pakitud PostScript fail
 Comment[eu]=Gzip PostScript fitxategia
-Comment[fa]=پرونده‌ی PostScript Gzip شده
+Comment[fa]=پروندۀ پست اسکریپت Gzipped
 Comment[fi]=Gzip-pakattu PostScript-tiedosto
 Comment[fr]=Fichier PostScript compacté par Gzip
 Comment[fy]=Mei Gzip komprimearre PostScript-triem
Index: mimetypes/application/vnd.stardivision.impress.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.impress.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.impress.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Presentación Impress de StarOffice
 Comment[et]=StarOffice Impress'i esitlus
 Comment[eu]=StarOffice aurkezpena
-Comment[fa]=نمایش StarOffice Impress
+Comment[fa]=ارائه StarOffice Impress
 Comment[fi]=StarOffice Impress -esitys
 Comment[fr]=Présentation StarOffice Impress
 Comment[fy]=StarOffice Impress Presintaasje
Index: mimetypes/application/x-java.desktop
===================================================================
--- mimetypes/application/x-java.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-java.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Clase Java
 Comment[et]=Java klass
 Comment[eu]=Java klasea
-Comment[fa]=طبقه‌ي Java
+Comment[fa]=ردۀ جاوا
 Comment[fi]=Java-luokka
 Comment[fr]=Classe Java
 Comment[fy]=Java-klasse
Index: mimetypes/application/x-dvi.desktop
===================================================================
--- mimetypes/application/x-dvi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-dvi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo TeX independiente del dispositivo
 Comment[et]=TeX seadmest sõltumatu fail
 Comment[eu]=Gailuengandik independientea den TeX fitxategia
-Comment[fa]=پرونده‌ی مستقل دستگاه TeX
+Comment[fa]=پروندۀ نابستگی دستگاه TeX
 Comment[fi]=TeX DVI -tiedosto
 Comment[fr]=Document DVI de TeX
 Comment[fy]=TeX Device Independent-triem
Index: mimetypes/application/xhtml+xml.desktop
===================================================================
--- mimetypes/application/xhtml+xml.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/xhtml+xml.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Documento familiar de XHTML
 Comment[et]=XHTML-dokument
 Comment[eu]=XHTML familiako dokumentua
-Comment[fa]=سند خانواده‌ی XHTML
+Comment[fa]=سند خانوادۀ XHTML
 Comment[fi]=XHTML-perheen asiakirja
 Comment[fr]=Document de type XHTML
 Comment[fy]=XHTML Family Dokumint
Index: mimetypes/application/vnd.sun.xml.calc.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.calc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.calc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Hoja de cálculo de OpenOffice.org
 Comment[et]=OpenOffice.org-i arvutustabel
 Comment[eu]=OpenOffice.org kalkulu-orria
-Comment[fa]=صفحه‌گسترده‌ی OpenOffice.org
+Comment[fa]=صفحه گسترده OpenOffice.org
 Comment[fi]=OpenOffice.org-taulukko
 Comment[fr]=Feuille de calcul OpenOffice.org
 Comment[fy]=OpenOffice.org Rekkenboerd
Index: mimetypes/application/x-applixword.desktop
===================================================================
--- mimetypes/application/x-applixword.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-applixword.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento de texto de Applix
 Comment[et]=Applixi tekstidokument
 Comment[eu]=Applix testu-dokumentua
-Comment[fa]=سند Applix Words
+Comment[fa]=سند واژه‌هایAApplix
 Comment[fi]=Applix Words -asiakirja
 Comment[fr]=Document Applix Words
 Comment[fy]=Applix Words-dokumint
Index: mimetypes/application/pkcs10.desktop
===================================================================
--- mimetypes/application/pkcs10.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pkcs10.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Solicitud de certificación S/MIME
 Comment[et]=S/MIME sertifitseerimise päring
 Comment[eu]=S/MIME ziurtagiri eskaera
-Comment[fa]=درخواست گواهینامه‌ی S/MIME
+Comment[fa]=درخواست گواهینامه S/MIME 
 Comment[fi]=S/MIME-sertifikaattipyyntö
 Comment[fr]=Requête de certification S/MIME
 Comment[fy]=S/MIME sertifikaat-oanfraach
Index: mimetypes/application/vnd.stardivision.chart.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.chart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.chart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Hoja de cálculo de StarOffice
 Comment[et]=StarOffice'i diagramm
 Comment[eu]=StarOffice diagrama
+Comment[fa]=نمودار StarOffice
 Comment[fi]=StarOffice-kaavio
 Comment[fr]=Diagramme StarOffice
 Comment[ga]=Cairt StarOffice
Index: mimetypes/application/vnd.stardivision.calc.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.calc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.calc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Hoja de cálculo de StarOffice
 Comment[et]=StarOffice Calc'i arvutustabel
 Comment[eu]=StarOffice kalkulu-orria
-Comment[fa]=صفحه گسترده‌ی StarOffice Calc
+Comment[fa]=صفحه گسترده StarOffice Calc
 Comment[fi]=StarOffice Calc -taulukko
 Comment[fr]=Feuille de calcul StarOffice Calc
 Comment[fy]=StarOffice Calc Rekkenboerd
Index: mimetypes/application/mspowerpoint.desktop
===================================================================
--- mimetypes/application/mspowerpoint.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/mspowerpoint.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Presentación de Microsoft PowerPoint
 Comment[et]=Microsoft PowerPointi esitlus
 Comment[eu]=Microsoft PowerPoint aurkezpena
-Comment[fa]=نمایش مایکروسافت پاور پوینت
+Comment[fa]=میکروسافت پاورپوینت
 Comment[fi]=Microsoft PowerPoint -esitys
 Comment[fr]=Présentation Microsoft PowerPoint
 Comment[fy]=Microsoft PowerPoint Presintaasje
Index: mimetypes/application/x-object.desktop
===================================================================
--- mimetypes/application/x-object.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-object.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Código objeto
 Comment[et]=Objektkood
 Comment[eu]=Objektu-kodea
-Comment[fa]=کد موضوعی
+Comment[fa]=برنامۀ مقصود
 Comment[fi]=Objektikoodi
 Comment[fr]=Code objet
 Comment[fy]=Objektkoade
Index: mimetypes/application/vnd.ms-asf.desktop
===================================================================
--- mimetypes/application/vnd.ms-asf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.ms-asf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Medios ASF
 Comment[et]=ASF meediafail
 Comment[eu]=ASF media
-Comment[fa]=رسانه‌ی ASF
+Comment[fa]=رسانۀ ASF
 Comment[fi]=ASF-mediatiedosto
 Comment[fr]=Support ASF
 Comment[fy]=ASF-media
Index: mimetypes/application/x-desktop.desktop
===================================================================
--- mimetypes/application/x-desktop.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-desktop.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de configuración del escritorio
 Comment[et]=Töölaua seadistuste fail
 Comment[eu]=Mahaigainaren konfigurazio-fitxategia
-Comment[fa]=پرونده‌ی تنظیم میزکار
+Comment[fa]=پروندۀ پیکربندی رومیزی
 Comment[fi]=Työpöydän asetustiedosto
 Comment[fr]=Fichier de configuration du bureau
 Comment[fy]=Konfiguraasjetriem foar it buroblêd
@@ -40,7 +40,7 @@
 Comment[mn]=Ажилын талбарын тохиргоо
 Comment[ms]=Fail Config Ruang Kerja
 Comment[mt]=Fajl konfigurazzjoni desktop
-Comment[nb]=Konfigurasjonsfil til skrivebord
+Comment[nb]=Oppsettsfil til skrivebord
 Comment[nds]=Instellen-Datei
 Comment[nl]=Configuratiegegevens
 Comment[nn]=Skrivebordsoppsett-fil
Index: mimetypes/application/x-debian-package.desktop
===================================================================
--- mimetypes/application/x-debian-package.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-debian-package.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Paquete Debian
 Comment[et]=Debiani pakett
 Comment[eu]=Debian paketea
-Comment[fa]=بسته‌ی دبیان
+Comment[fa]=بستۀ دبیان
 Comment[fi]=Debian-paketti
 Comment[fr]=Paquetage Debian
 Comment[fy]=Debian Pakket
Index: mimetypes/application/x-x509-ca-cert.desktop
===================================================================
--- mimetypes/application/x-x509-ca-cert.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-x509-ca-cert.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,6 +21,7 @@
 Comment[es]=Certificado DER, PEM, o Netscape codificado según  X.509
 Comment[et]=DER, PEM või Netscape'i kodeeritud X.509 sertifikaat
 Comment[eu]=DER, PEM, edo Netscape X.509 ziurtagiri kodetua
+Comment[fa]=DER, PEM,یا گواهینامه X.509 نت اسکیپ کدبندی‌شده 
 Comment[fi]=DER-, PEM- tai Netscape-enkoodattu X.509-sertifikaatti
 Comment[fr]=Certificat X.509 encodé avec Netscape, DER ou PEM
 Comment[fy]=DER-, PEM-, of Netscape-fersifere X.509-sertifikaat
Index: mimetypes/application/x-sqlite2.desktop
===================================================================
--- mimetypes/application/x-sqlite2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-sqlite2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[es]=Archivo de la base de datos SQLite2
 Comment[et]=SQLite2 andmebaasi fail
 Comment[eu]=SQLite2 datu-basearen fitxategia
+Comment[fa]=پروندۀ دادگان SQLite2
 Comment[fi]=SQLite2-tietokantatiedosto
 Comment[fr]=Fichier de base de données SQLite2
 Comment[fy]=SQLite2 databanktriem
Index: mimetypes/application/x-sqlite3.desktop
===================================================================
--- mimetypes/application/x-sqlite3.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-sqlite3.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[es]=Archivo de la base de datos SQLite3
 Comment[et]=SQLite3 andmebaasi fail
 Comment[eu]=SQLite3 datu-basearen fitxategia
+Comment[fa]=پروندۀ دادگان SQLite3
 Comment[fi]=SQLite3-tietokantatiedosto
 Comment[fr]=Fichier de base de données SQLite3
 Comment[fy]=SQLite3 databanktriem
Index: mimetypes/application/x-perl-module.desktop
===================================================================
--- mimetypes/application/x-perl-module.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-perl-module.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Módulo Perl
 Comment[et]=Perli moodul
 Comment[eu]=Perl modulua
+Comment[fa]=پیمانۀ پرل
 Comment[fi]=PERL-moduuli
 Comment[fr]=Module Perl
 Comment[fy]=Perl-module
Index: mimetypes/application/x-bzip2.desktop
===================================================================
--- mimetypes/application/x-bzip2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-bzip2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo comprimido Bzip2
 Comment[et]=Bzip2-arhiiv
 Comment[eu]=Bzip2 fitxategia
-Comment[fa]=پرونده‌ی Bzip2
+Comment[fa]=پروندۀ Bzip2
 Comment[fi]=Bzip2-tiedosto
 Comment[fr]=Fichier compacté par Bzip2
 Comment[fy]=Bzip2-Triem
Index: mimetypes/application/xsd.desktop
===================================================================
--- mimetypes/application/xsd.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/xsd.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Comment[el]=Σχήμα W3C XML
 Comment[es]=Schema XML de W3C
 Comment[eu]=W3C XML eskema
+Comment[fa]=طرح‌واره W3C XML
 Comment[fi]=W3C XML skema
 Comment[fr]=Schéma XML du W3C
 Comment[fy]=W3C XML-skema
Index: mimetypes/application/x-mswrite.desktop
===================================================================
--- mimetypes/application/x-mswrite.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-mswrite.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento de Microsoft Write
 Comment[et]=Microsoft Write'i dokument
 Comment[eu]=Microsoft testu-dokumentua
-Comment[fa]=سند مایکروسافت رایت
+Comment[fa]=سند نوشتن مایکروسافت
 Comment[fi]=Microsoft Write -asiakirja
 Comment[fr]=Document Microsoft Write
 Comment[fy]=Microsoft Write-dokumint
Index: mimetypes/application/fits.desktop
===================================================================
--- mimetypes/application/fits.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/fits.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Comment[es]=Datos FITS
 Comment[et]=FITS-andmed
 Comment[eu]=FITS datuak
+Comment[fa]=دادۀ FITS
 Comment[fi]=FITS-tiedot
 Comment[fr]=Données FITS
 Comment[fy]=FITS-data
Index: mimetypes/application/x-afm.desktop
===================================================================
--- mimetypes/application/x-afm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-afm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Métrica de fuentes Postscript.
 Comment[et]=PostScript fondimeetrika (PFM)
 Comment[eu]=PostScript letra-tipoen metrika
-Comment[fa]=متریک قلم PostScript
+Comment[fa]=اندازۀ قلم پست اسکریپت
 Comment[fi]=Postscript kirjasinmetriikka
 Comment[fr]=Police de caractères PostScript Métriques
 Comment[fy]=PostScript Lettertype Metryk
Index: mimetypes/application/vnd.oasis.opendocument.spreadsheet.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.spreadsheet.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.spreadsheet.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Hoja de cálculo de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument arvutustabel
 Comment[eu]=OASIS OpenDocument kalkulu-orria
+Comment[fa]=صفحه گسترده سندباز OASIS
 Comment[fi]=OASIS OpenDocument -taulukko
 Comment[fr]=Feuille de calcul OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument rekkenboerd
Index: mimetypes/application/x-lha.desktop
===================================================================
--- mimetypes/application/x-lha.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-lha.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Archivo LHA
 Comment[et]=Lha arhiiv
 Comment[eu]=Lha artxiboa
-Comment[fa]=آرشیو Lha
+Comment[fa]=بایگانی Lha
 Comment[fi]=Lha-paketti
 Comment[fr]=Archive LHA
 Comment[fy]=Lha-argyf
Index: mimetypes/application/x-tgz.desktop
===================================================================
--- mimetypes/application/x-tgz.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tgz.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo Tar comprimido en Gzip
 Comment[et]=Gzipitud TAR-arhiiv
 Comment[eu]=Tar+GZIP artxiboa
-Comment[fa]=آرشیو Gzip شده‌ی Tar
+Comment[fa]=بایگانی‌بان Gzipped 
 Comment[fi]=Gzip-pakattu Tar-paketti
 Comment[fr]=Archive Tar compactée par Gzip
 Comment[fy]=Mei Gzip komprimearre Tar-argyf
Index: mimetypes/application/x-javascript.desktop
===================================================================
--- mimetypes/application/x-javascript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-javascript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Archivo JavaScipt
 Comment[et]=JavaScripti fail
 Comment[eu]=JavaScript fitxategia
+Comment[fa]=پروندۀ جاوااسکریپت
 Comment[fi]=JavaScript-tiedosto
 Comment[fr]=Fichier JavaScript
 Comment[fy]=JavaSkript Triem
Index: mimetypes/application/vnd.sun.xml.impress.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.impress.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.impress.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Presentación de OpenOffice.org
 Comment[et]=OpenOffice.org-i esitlus
 Comment[eu]=OpenOffice.org aurkezpena
-Comment[fa]=نمایش OpenOffice.org
+Comment[fa]=ارائه OpenOffice.org
 Comment[fi]=OpenOffice.org-esitys
 Comment[fr]=Présentation OpenOffice.org
 Comment[fy]=OpenOffice.org Presentaasje
Index: mimetypes/application/x-vnd.kde.kugar.mixed.desktop
===================================================================
--- mimetypes/application/x-vnd.kde.kugar.mixed.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-vnd.kde.kugar.mixed.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo de archivos Kugar
 Comment[et]=Kugari arhiivifail
 Comment[eu]=Kugar fitxategi artxiboa
-Comment[fa]=پرونده‌ی آرشیو Kugar
+Comment[fa]=پروندۀ بایگانی Kugar
 Comment[fi]=Kugar-paketti
 Comment[fr]=Archive Kugar
 Comment[fy]=Kugar Argyf Triem
Index: mimetypes/application/x-gnumeric.desktop
===================================================================
--- mimetypes/application/x-gnumeric.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-gnumeric.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Hoja de cálculo de GNUmeric
 Comment[et]=GNUmerici arvutustabel
 Comment[eu]=Gnumeric kalkulu-orria
-Comment[fa]=صفحه‌گسترده‌ی GNUmeric
+Comment[fa]=صفحه گسترده GNUmeric
 Comment[fi]=GNUmeric-taulukko
 Comment[fr]=Feuille de calcul GNUmeric
 Comment[fy]=GNUmeric Rekkenboerd
Index: mimetypes/application/wordperfect.desktop
===================================================================
--- mimetypes/application/wordperfect.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/wordperfect.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento de WordPerfect
 Comment[et]=WordPerfecti dokument
 Comment[eu]=WordPerfect dokumentua
-Comment[fa]= سند WordPerfect
+Comment[fa]=سندWordPerfect
 Comment[fi]=WordPerfect-asiakirja
 Comment[fr]=Document WordPerfect
 Comment[fy]=WordPerfect-Dokumint
Index: mimetypes/application/x-executable.desktop
===================================================================
--- mimetypes/application/x-executable.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-executable.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo ejecutable
 Comment[et]=Käivitatav fail
 Comment[eu]=Fitxategi exekutagarria
-Comment[fa]=پرونده‌ی اجرایی
+Comment[fa]=پروندۀ جرایی
 Comment[fi]=Ohjelma
 Comment[fr]=Fichier exécutable
 Comment[fy]=Utfierber triem
Index: mimetypes/application/x-executable-script.desktop
===================================================================
--- mimetypes/application/x-executable-script.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-executable-script.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Procedimiento (probablemente ejecutable)
 Comment[et]=Käivitatav skript
 Comment[eu]=Script (exekutagarria litekeena)
+Comment[fa]=دست‌نوشته (احتمالا قابل اجرا)
 Comment[fi]=Skripti (mahdollisesti suoritettava)
 Comment[fr]=Script (peut-être exécutable)
 Comment[fy]=Skript (Wierskynlik útfierber)
Index: mimetypes/application/x-lzop.desktop
===================================================================
--- mimetypes/application/x-lzop.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-lzop.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo comprimido Lzop
 Comment[et]=LZOP arhiiv
 Comment[eu]=Lzop fitxategia
-Comment[fa]=پرونده‌ی Lzopped
+Comment[fa]=پروندۀ Lzopped
 Comment[fi]=Lzop-tiedosto
 Comment[fr]=Fichier compacté par Lzop
 Comment[fy]=Lzop-triem
Index: mimetypes/application/x-shockwave-flash.desktop
===================================================================
--- mimetypes/application/x-shockwave-flash.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-shockwave-flash.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Archivo Shockwave Flash
 Comment[et]=Shockwave Flash meedia
 Comment[eu]=Shockwave Flash media
+Comment[fa]=رسانۀ فلش Shockwave
 Comment[fi]=Shockwave Flash -media
 Comment[fr]=Média Shockwave Flash
 Comment[he]=מדיית Flash של Shockwave
Index: mimetypes/application/x-pw.desktop
===================================================================
--- mimetypes/application/x-pw.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-pw.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Documento de Pathetic Writer
 Comment[et]=Pathetic Writeri dokument
 Comment[eu]=Pathetic testu-dokumentua
-Comment[fa]=سند Pathetic ٌWriter
+Comment[fa]=سند نویسندۀ Pathetic
 Comment[fi]=Pathetic Writer -asiakirja
 Comment[fr]=Document Pathetic Writer
 Comment[fy]=Pathetic Writer Dokumint
Index: mimetypes/application/x-rar-compressed.desktop
===================================================================
--- mimetypes/application/x-rar-compressed.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-rar-compressed.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo RAR
 Comment[et]=Rar arhiiv
 Comment[eu]=Rar artxiboa
-Comment[fa]=آرشیو Rar
+Comment[fa]=بایگانی Rar
 Comment[fi]=Rar-paketti
 Comment[fr]=Archive Rar
 Comment[fy]=Rar-argyf
Index: mimetypes/application/x-kpovmodeler.desktop
===================================================================
--- mimetypes/application/x-kpovmodeler.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-kpovmodeler.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de KPovModeler
 Comment[et]=KPovModeleri fail
 Comment[eu]=KPovModeler fitxategia
-Comment[fa]=پرونده‌ی KPovModeler
+Comment[fa]=پروندۀ KPovModeler 
 Comment[fi]=KPovModeler-tiedosto
 Comment[fr]=Fichier KPovModeler
 Comment[fy]=KPovModeler-triem
Index: mimetypes/application/x-php.desktop
===================================================================
--- mimetypes/application/x-php.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-php.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Script de PHP
 Comment[et]=PHP skript
 Comment[eu]=PHP script-a
-Comment[fa]=نویسه‌ی PHP
+Comment[fa]=دست‌نوشته PHP
 Comment[fi]=PHP-skripti
 Comment[fr]=Script PHP
 Comment[fy]=PHP Skript
Index: mimetypes/application/x-troff-man.desktop
===================================================================
--- mimetypes/application/x-troff-man.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-troff-man.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Documento Troff con macros de páginas de Man
 Comment[et]=Manpage makrodega troff-dokument
 Comment[eu]=Troff dokumentua man eskuliburuko makroekin
-Comment[fa]=سند Troff با ماکروهای صفحات دستور
+Comment[fa]=سند Troff با کلان دستورهای صفحه راهنما
 Comment[fi]=Troff-asiakirja manpage-makroilla
 Comment[fr]=Document Troff avec macros de page de manuel
 Comment[fy]=Troff-dokumint mei manpage-makro's
Index: mimetypes/application/x-shellscript.desktop
===================================================================
--- mimetypes/application/x-shellscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-shellscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Script para intérprete de comandos
 Comment[et]=Shelli skript
 Comment[eu]=Shell script-a
-Comment[fa]=نویسه‌ی پوسته
+Comment[fa]=دست‌نوشتۀ پوسته
 Comment[fi]=Komentotulkkiskripti
 Comment[fr]=Script shell
 Comment[fy]=Shell-skript
@@ -42,7 +42,7 @@
 Comment[ms]=Skrip Cengkerang
 Comment[mt]=Skritt shell
 Comment[nb]=Skallskript
-Comment[nds]=Shellskript
+Comment[nds]=Konsoolskript
 Comment[nl]=Shell-script
 Comment[nn]=Skalskript
 Comment[nso]=Tshwaelo ya Shell
@@ -53,7 +53,7 @@
 Comment[ro]=Script de interpretor
 Comment[ru]=Скрипт shell
 Comment[rw]=Shell Iyandika
-Comment[se]=Skál3/43/4u skripta
+Comment[se]=Skálžu-skripta
 Comment[sk]=Shellovský skript
 Comment[sl]=Lupinski skript
 Comment[sq]=Skript Guacor
Index: mimetypes/application/vnd.oasis.opendocument.graphics.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.graphics.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.graphics.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Gráfico de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument joonistus
 Comment[eu]=OASIS OpenDocument grafikoak
+Comment[fa]=نگارۀ  سندباز OASIS
 Comment[fi]=OASIS OpenDocument -piirros
 Comment[fr]=Graphiques OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument grafyske foarstellings
Index: mimetypes/application/x-font-bdf.desktop
===================================================================
--- mimetypes/application/x-font-bdf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-bdf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Fuente bitmap BDF
 Comment[et]=BDF bittrasterfont
 Comment[eu]=BDF bitmap letra-tipoa
-Comment[fa]=قلم نقس‌بیت BDF
+Comment[fa]=قلم نگاشت بیت BDF
 Comment[fi]=BDF-bittikarttakirjasin
 Comment[fr]=Police de caractères bitmap BDF
 Comment[fy]=BDF Bitmap-lettertype
Index: mimetypes/application/x-kudesigner.desktop
===================================================================
--- mimetypes/application/x-kudesigner.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-kudesigner.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Plantilla de informe de Kugar
 Comment[et]=Kugari rapordimall
 Comment[eu]=Kugar txosten-txantiloia
-Comment[fa]=پرونده‌ی الگو‌ی Kugar
+Comment[fa]=قالب گزارش Kugar 
 Comment[fi]=Kugar-raporttipohja
 Comment[fr]=Modèle de rapport Kugar
 Comment[fy]=Kugar Rapport Sjabloan
Index: mimetypes/application/vnd.oasis.opendocument.formula.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.formula.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.formula.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Fórmula de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument valem
 Comment[eu]=OASIS OpenDocument formula
+Comment[fa]=فرمول سندباز OASIS
 Comment[fi]=OASIS OpenDocument -kaava
 Comment[fr]=Formule OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument Formule
Index: mimetypes/application/x-font-type1.desktop
===================================================================
--- mimetypes/application/x-font-type1.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-font-type1.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Fuente Postscript Tipo1
 Comment[et]=PostScript Type1 font
 Comment[eu]=PostScript Type1 letra-tipoa
-Comment[fa]=قلم PostScript نوع ۱
+Comment[fa]=قلم نوع ۱ پست اسکریپت
 Comment[fi]=Postscript Tyyppi 1 -kirjasin
 Comment[fr]=Police de caractères PostScript Type 1
 Comment[fy]=PostScript Type1-lettertype
Index: mimetypes/application/msword.desktop
===================================================================
--- mimetypes/application/msword.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/msword.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -25,7 +25,7 @@
 Comment[es]=Documento de Microsoft Word
 Comment[et]=Microsoft Wordi dokument
 Comment[eu]=Microsoft Word dokumentua
-Comment[fa]=سند مایکروسافت ورد
+Comment[fa]=سند میکروسافت ورد
 Comment[fi]=Microsoft Word -asiakirja
 Comment[fr]=Document Microsoft Word
 Comment[fy]=Microsoft Word-dokumint
Index: mimetypes/application/ogg.desktop
===================================================================
--- mimetypes/application/ogg.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/ogg.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Multimedia Ogg
 Comment[et]=Ogg multimeedia
 Comment[eu]=Ogg multimedia
-Comment[fa]=Ogg چندرسانه‌ای
+Comment[fa]=چند رسانه‌ایOgg 
 Comment[fi]=Ogg-multimediatiedosto
 Comment[fr]=Multimédia Ogg
 Comment[fy]=Ogg Multymedia
Index: mimetypes/application/vnd.stardivision.writer-global.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.writer-global.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.writer-global.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Comment[es]=Documentos maestros de escritura de StarOffice
 Comment[et]=StarOffice Writer'i peadokument
 Comment[eu]=StarOffice dokumentu maisua
+Comment[fa]=سند اصلی StarOffice Writer
 Comment[fi]=StarOffice Writer -pääasiakirja
 Comment[fr]=Document-maître StarOffice Writer
 Comment[fy]=StarOffice Writer Haad Dokumint
Index: mimetypes/application/x-krita.desktop
===================================================================
--- mimetypes/application/x-krita.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-krita.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Comment[es]=Documento de Krita
 Comment[et]=Krita dokument
 Comment[eu]=Krita dokumentua
-Comment[fa]=سند Krita
+Comment[fa]=سندKrita
 Comment[fi]=Krita-asiakirja
 Comment[fr]=Document Krita
 Comment[fy]=Krita-dokumint
Index: mimetypes/application/x-pak.desktop
===================================================================
--- mimetypes/application/x-pak.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-pak.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Archivo de ficheros PAK
 Comment[et]=PAK arhiiv
 Comment[eu]=PAK fitxategien artxiboa
+Comment[fa]=بایگانی پروندۀ  PAK
 Comment[fi]=PAK-paketti
 Comment[fr]=Fichier archive PAK
 Comment[fy]=PAK Triem Argyf
Index: mimetypes/application/x-applixgraphics.desktop
===================================================================
--- mimetypes/application/x-applixgraphics.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-applixgraphics.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento gráfico de Applix
 Comment[et]=Applixi graafikadokument
 Comment[eu]=Applix Graphics dokumentua
-Comment[fa]=سند Applix Graphics
+Comment[fa]=سند نگاره‌ای Applix
 Comment[fi]=Applix grafiikka-asiakirja
 Comment[fr]=Document Applix Graphics
 Comment[fy]=Applix Grafiek Dokumint
Index: mimetypes/application/illustrator.desktop
===================================================================
--- mimetypes/application/illustrator.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/illustrator.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Documento de ilustración de Adobe
 Comment[et]=Adobe Illustratori dokument
 Comment[eu]=Adobe Illustrator dokumentua
-Comment[fa]=سند ادوبی ایلاستریتر
+Comment[fa]=سند Adobe Illustrator
 Comment[fi]=Adobe Illustrator -asiakirja
 Comment[fr]=Document Adobe Illustrator
 Comment[fy]=Adobe Illustrator-dokumint
Index: mimetypes/application/pgp-signature.desktop
===================================================================
--- mimetypes/application/pgp-signature.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/pgp-signature.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Firma suelta OpenPGP
 Comment[et]=Eraldiseisev OpenPGP signatuur
 Comment[eu]=Uztartu gabeko OpenPGP sinadura
-Comment[fa]=امضای غیر متصل OpenPGP
+Comment[fa]=امضاء جداشدۀ  OpenPGP
 Comment[fi]=Irroitettu OpenPGP-allekirjoitus
 Comment[fr]=Signature OpenPGP détachée
 Comment[fy]=Loskeppele OpenPGP-sinjatuer
Index: mimetypes/application/x-tarz.desktop
===================================================================
--- mimetypes/application/x-tarz.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tarz.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo Tar comprimido
 Comment[et]=Pakitud tar-arhiiv
 Comment[eu]=Tar artxibo konprimitua
-Comment[fa]=آرشیو فشرده شده‌ی Tar
+Comment[fa]=بایگانی‌بان فشرده‌شده
 Comment[fi]=Pakattu Tar-paketti
 Comment[fr]=Archive Tar compactée
 Comment[fy]=Komprimearre tar-argyf
Index: mimetypes/application/x-python.desktop
===================================================================
--- mimetypes/application/x-python.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-python.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Programa en Python
 Comment[et]=Pythoni rakendus
 Comment[eu]=Python programa
-Comment[fa]=برنامه‌ی Python
+Comment[fa]=برنامۀ Python
 Comment[fi]=Python-ohjelma
 Comment[fr]=Programme Python
 Comment[fy]=Python-programma
Index: mimetypes/application/x-awk.desktop
===================================================================
--- mimetypes/application/x-awk.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-awk.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Script de AWK
 Comment[et]=AWK skript
 Comment[eu]=AWK script-a
-Comment[fa]=نویسه‌ی AWK
+Comment[fa]=دست‌نوشته AWK
 Comment[fi]=AWK-skripti
 Comment[fr]=Script AWK
 Comment[fy]=AWK-Skript
Index: mimetypes/application/x-vnd.kde.kplato.desktop
===================================================================
--- mimetypes/application/x-vnd.kde.kplato.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-vnd.kde.kplato.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Documento de gestión de proyectos KPlato
 Comment[et]=KPlato projektihalduse dokument
 Comment[eu]=KPlato proiektu kudeaketako dokumentua
+Comment[fa]=سند مدیریت پروژه KPlato
 Comment[fi]=KPlaton projektinhallinta-asiakirja
 Comment[fr]=Document de gestion de projet KPlato
 Comment[fy]=KPlato Projekt Management Dokumint
Index: mimetypes/application/x-gzdvi.desktop
===================================================================
--- mimetypes/application/x-gzdvi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-gzdvi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Archivo DVI comprimido con Gzip
 Comment[et]=Gzip tihendusega DVI-fail
 Comment[eu]=Gzip-ek konprimitutako DVI fitxategia
+Comment[fa]=پروندۀ DVI فشرده‌شدۀ 
 Comment[fi]=Gzip-pakattu DVI-tiedosto
 Comment[fr]=Fichier DVI compacté avec Gzip
 Comment[fy]=Gzip komprimearre DVI Triem
Index: mimetypes/application/x-tar.desktop
===================================================================
--- mimetypes/application/x-tar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-tar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo Tar
 Comment[et]=Tar-arhiiv
 Comment[eu]=Tar artxiboa
-Comment[fa]=آرشیو Tar
+Comment[fa]=بایگانی‌بان
 Comment[fi]=Tar-paketti
 Comment[fr]=Archive Tar
 Comment[fy]=Tar-argyf
Index: mimetypes/application/x-cda.desktop
===================================================================
--- mimetypes/application/x-cda.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-cda.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=CD de audio
 Comment[et]=CD audio
 Comment[eu]=CD audioa
-Comment[fa]=لوح فشرده‌ی صوتی
+Comment[fa]=دیسک فشردۀ صوتی
 Comment[fi]=CD-ääni
 Comment[fr]=CD audio
 Comment[fy]=CD-audio
Index: mimetypes/application/x-core.desktop
===================================================================
--- mimetypes/application/x-core.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/x-core.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Datos sobre el fallo de un programa
 Comment[et]=Programmi krahhi andmed
 Comment[eu]=Programen kraskadurari buruzko datuak
-Comment[fa]=داده‌ی تصادف برنامه
+Comment[fa]=دادۀ فروپاشی برنامه
 Comment[fi]=Ohjelman kaatumistiedot
 Comment[fr]=Données d'arrêt anormal de programme
 Comment[fy]=Ynformaasje oer crashte programma's
Index: mimetypes/application/vnd.stardivision.draw.desktop
===================================================================
--- mimetypes/application/vnd.stardivision.draw.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.stardivision.draw.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,6 +21,7 @@
 Comment[es]=Dibujo de StarOffice
 Comment[et]=StarOffice joonis
 Comment[eu]=StarOffice marrazkia
+Comment[fa]=ترسیم StarOffice
 Comment[fi]=StarOffice-piirros
 Comment[fr]=Dessin StarOffice
 Comment[ga]=Líníocht StarOffice
Index: mimetypes/application/vnd.sun.xml.draw.template.desktop
===================================================================
--- mimetypes/application/vnd.sun.xml.draw.template.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.sun.xml.draw.template.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Comment[es]=Plantilla de dibujo de OpenOffice.org
 Comment[et]=OpenOffice.org-i joonistusemall
 Comment[eu]=OpenOffice.org marrazkien txantiloia
+Comment[fa]=قالب ترسیم OpenOffice.org
 Comment[fi]=OpenOffice.org-piirrospohja
 Comment[fr]=Modèle de dessin OpenOffice.org
 Comment[fy]=OpenOffice.org Drawing sjabloan
Index: mimetypes/application/vnd.oasis.opendocument.chart.desktop
===================================================================
--- mimetypes/application/vnd.oasis.opendocument.chart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/vnd.oasis.opendocument.chart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Carta de OpenDocument OASIS
 Comment[et]=OASIS-e OpenDocument diagramm
 Comment[eu]=OASIS OpenDocument diagrama
+Comment[fa]=نمودار سندباز OASIS
 Comment[fi]=OASIS OpenDocument -taulukko
 Comment[fr]=Diagramme OASIS OpenDocument
 Comment[fy]=OASIS OpenDocument Grafyk
Index: mimetypes/application/mbox.desktop
===================================================================
--- mimetypes/application/mbox.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/application/mbox.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Carpeta de correo MBOX
 Comment[et]=MBOX e-posti kaust
 Comment[eu]=MBOX posta karpeta
+Comment[fa]=پوشۀ نامۀ MBOX
 Comment[fi]=MBOX-sähköpostikansio
 Comment[fr]=Dossier de boîte aux lettres MBox
 Comment[fy]=MBOX-eamelmap
@@ -31,11 +32,13 @@
 Comment[nb]=Mbox e-postmappe
 Comment[nds]=Mbox-Nettpostorner
 Comment[nl]=MBOX-postvakmap
+Comment[nn]=MBOX-e-postmappe
 Comment[pl]=Folder poczty w formacie MBOX
 Comment[pt]=Pasta de Correio MBOX
 Comment[pt_BR]=Pasta de Correio MBOX
 Comment[ro]=Folder de mail MBOX
 Comment[ru]=Почтовая папка MBOX
+Comment[se]=MBOX-boastamáhppa
 Comment[sk]=MBOX poštový priečinok
 Comment[sl]=Mapa za pošto MBOX
 Comment[sr]=MBOX фасцикла поште
Index: mimetypes/message/news.desktop
===================================================================
--- mimetypes/message/news.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/message/news.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Mensaje de noticias de Usenet
 Comment[et]=Uudistegrupi artikkel
 Comment[eu]=Usenet berri mezua
-Comment[fa]=پیام خبر یوزنت
+Comment[fa]=پیام خبری Usenet
 Comment[fi]=Usenet-viesti
 Comment[fr]=Message de forum de discussion
 Comment[fy]=Usenet-nijsberjocht
Index: mimetypes/message/rfc822.desktop
===================================================================
--- mimetypes/message/rfc822.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/message/rfc822.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Mensaje de correo electrónico
 Comment[et]=E-kiri
 Comment[eu]=E-Posta mezua
-Comment[fa]=پیام پست الکتریکی
+Comment[fa]=پیام رایانامه
 Comment[fi]=Sähköpostiviesti
 Comment[fr]=Message électronique
 Comment[fy]=E-postberjocht
Index: mimetypes/text/rss.desktop
===================================================================
--- mimetypes/text/rss.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/rss.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Comment[es]=Resumen RDF del sitio
 Comment[et]=RDF-saidi kokkuvõte
 Comment[eu]=Lekuaren RDF laburpena
-Comment[fa]=گزارش پایگاه RDF
+Comment[fa]=خلاصه پایگاه RDF
 Comment[fi]=RDF-yhteenveto
 Comment[fr]=Résumé de site RDF
 Comment[fy]=Gearfetting fan de RDF-side
Index: mimetypes/text/calendar.desktop
===================================================================
--- mimetypes/text/calendar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/calendar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo de iCalendar
 Comment[et]=iCalendari fail
 Comment[eu]=iCalendar fitxategia
-Comment[fa]=پرونده‌ی iCalendar
+Comment[fa]=پروندۀ iCalendar
 Comment[fi]=iCalendar-tiedosto
 Comment[fr]=Agenda iCalendar
 Comment[fy]=iCalender-triem
Index: mimetypes/text/rdf.desktop
===================================================================
--- mimetypes/text/rdf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/rdf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de entorno descripción de recursos (RDF)
 Comment[et]=Resource Description Framework (RDF) fail
 Comment[eu]=Resource Description Framework fitxategia
-Comment[fa]=پرونده‌ی قالب‌گار توضیح منابع
+Comment[fa]=پروندۀ چارچوب توصیف منبع
 Comment[fi]=Resurssin Framework-kuvaustiedosto
 Comment[fr]=Fichier de cadre de description de ressources
 Comment[fy]=Helpboarne Beskriuwing Framework Triem
Index: mimetypes/text/x-diff.desktop
===================================================================
--- mimetypes/text/x-diff.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-diff.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Diferencias entre archivos
 Comment[et]=Failidevaheline erinevus
 Comment[eu]=Fitxategien arteko desberdintasunak
-Comment[fa]=اختلاف‌های میان پرونده‌ها
+Comment[fa]=تفاوتهای بین پروند‌ه‌ها
 Comment[fi]=Tiedostojen väliset erot
 Comment[fr]=Différences entre fichiers
 Comment[fy]=Ferskil tusken triemmen
Index: mimetypes/text/x-objchdr.desktop
===================================================================
--- mimetypes/text/x-objchdr.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-objchdr.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Comment[es]=Archivo de cabecera de Objective-C
 Comment[et]=Objective-C päisefail
 Comment[eu]=Objective-C goiburuko fitxategia
+Comment[fa]=پروندۀ سرآیند C شئ گرا
 Comment[fi]=Objective-C -otsikko
 Comment[fr]=Fichier en-tête Objective-C
 Comment[fy]=Objektive-C koptekst-bestand
Index: mimetypes/text/x-bibtex.desktop
===================================================================
--- mimetypes/text/x-bibtex.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-bibtex.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Datos bibliográficos (Bibtex)
 Comment[et]=Bibliograafilised andmed (bibtex)
 Comment[eu]=Datu bibliografikoak (Bibtex)
-Comment[fa]=داده‌ی Bibliographic (Bibtex)
+Comment[fa]=داده کتابشناسی (‌Bibtex)
 Comment[fi]=Kirjadata (Bibtex)
 Comment[fr]=Données bibliographiques (BibTeX)
 Comment[fy]=Bibliografyske data (bibtex)
Index: mimetypes/text/x-java.desktop
===================================================================
--- mimetypes/text/x-java.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-java.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo con código Java
 Comment[et]=Java lähtetekst
 Comment[eu]=Java iturburu fitxategia
-Comment[fa]=پرونده‌ی کد Java
+Comment[fa]=پروندۀ منبع جاوا
 Comment[fi]=Java-lähdekoodi
 Comment[fr]=Fichier source Java
 Comment[fy]=Java-boarnetriem
Index: mimetypes/text/x-objcsrc.desktop
===================================================================
--- mimetypes/text/x-objcsrc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-objcsrc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo con código Objective-C
 Comment[et]=Objective-C lähtetekst
 Comment[eu]=Objective-C iturburu fitxategia
-Comment[fa]=پرونده‌ی کد Objective-C
+Comment[fa]=پروندۀ منبع C شئ گرا
 Comment[fi]=Objective-C -lähdekoodi
 Comment[fr]=Fichier source Objective-C
 Comment[fy]=Objektive-C-boarnetriem
Index: mimetypes/text/rtf.desktop
===================================================================
--- mimetypes/text/rtf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/rtf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Documento RTF
 Comment[et]=RTF-dokument
 Comment[eu]=RTF dokumentua
-Comment[fa]=سند RTF
+Comment[fa]=سند RT
 Comment[fi]=RTF-asiakirja
 Comment[fr]=Document RTF
 Comment[fy]=RTF Dokumint
Index: mimetypes/text/x-xslfo.desktop
===================================================================
--- mimetypes/text/x-xslfo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-xslfo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Comment[es]=Archivo de objeto de formato XSL
 Comment[et]=XSL vormindamise objektfail
 Comment[eu]=XSL formatuko objektu-fitxategia
-Comment[fa]=پرونده‌ی موضوع قالبی XSL
+Comment[fa]=پروندۀ شئ قالب‌دار XSL
 Comment[fi]=XSL-muotoinen objektitiedosto
 Comment[fr]=Fichier de formatage d'objet XSL
 Comment[fy]=XSL-yndielingsobjekt
Index: mimetypes/text/x-adasrc.desktop
===================================================================
--- mimetypes/text/x-adasrc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-adasrc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de fuentes Ada
 Comment[et]=Ada lähtetekst
 Comment[eu]=Ada iturburu fitxategia
-Comment[fa]=پرونده‌ی کد Ada
+Comment[fa]=پروندۀ منبع Ada
 Comment[fi]=Ada-lähdekoodi
 Comment[fr]=Fichier source Ada
 Comment[fy]=Ada-boarnetriem
Index: mimetypes/text/html.desktop
===================================================================
--- mimetypes/text/html.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/html.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Documento HTML
 Comment[et]=HTML-dokument
 Comment[eu]=HTML dokumentua
-Comment[fa]=سند HTML
+Comment[fa]=سند زنگام
 Comment[fi]=HTML-asiakirja
 Comment[fr]=Document HTML
 Comment[fy]=HTML Dokumint
Index: mimetypes/text/javascript.desktop
===================================================================
--- mimetypes/text/javascript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/javascript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[es]=Archivo JavaScipt
 Comment[et]=JavaScripti fail
 Comment[eu]=JavaScript fitxategia
+Comment[fa]=پروندۀ جاوااسکریپت
 Comment[fi]=JavaScript-tiedosto
 Comment[fr]=Fichier JavaScript
 Comment[fy]=JavaSkript Triem
Index: mimetypes/text/x-pascal.desktop
===================================================================
--- mimetypes/text/x-pascal.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-pascal.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo con código Pascal
 Comment[et]=Pascali lähtetekst
 Comment[eu]=Pascal ituruburu fitxategia
-Comment[fa]=پرونده‌ی کد پاسکال
+Comment[fa]=پروندۀ منبع پاسکال
 Comment[fi]=Pascal-lähdekoodi
 Comment[fr]=Fichier source Pascal
 Comment[fy]=Pascal-boarnetriem
Index: mimetypes/text/x-c++hdr.desktop
===================================================================
--- mimetypes/text/x-c++hdr.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-c++hdr.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de cabecera C++
 Comment[et]=C++ päis
 Comment[eu]=C++ goiburuko fitxategia
-Comment[fa]=سربرگ پرونده‌ی C++
+Comment[fa]=پروندۀ سرآیند ++C
 Comment[fi]=C++-otsikkotiedosto
 Comment[fr]=Fichier d'en-tête C++
 Comment[fy]=C++-koptekst triem
Index: mimetypes/text/vnd.abc.desktop
===================================================================
--- mimetypes/text/vnd.abc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/vnd.abc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Comment[es]=Archivo de música ABC
 Comment[et]=ABC muusikafail
 Comment[eu]=ABC musika fitxategia
+Comment[fa]=پروندۀ موسیقی ABC
 Comment[fi]=ABC-musiikkitiedosto
 Comment[fr]=Fichier musique ABC
 Comment[fy]=ABC-Muzyktriem
Index: mimetypes/text/enriched.desktop
===================================================================
--- mimetypes/text/enriched.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/enriched.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Comment[es]=Documento de texto ligeramente enriquecido
 Comment[et]=Vormindatud tekstidokument
 Comment[eu]=Arinki hobetutako testu dokumentua
-Comment[fa]=سند متنی، که سبک غنی‌شده
+Comment[fa]=سند متن غنی شده سبک
 Comment[fi]=Kevyesti rikastettu tekstiasiakirja
 Comment[fr]=Document en texte légèrement enrichi
 Comment[fy]=Licht opmakke tekst Dokumint
Index: mimetypes/text/x-latex.desktop
===================================================================
--- mimetypes/text/x-latex.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-latex.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Documento de LaTeX
 Comment[et]=LaTeX-dokument
 Comment[eu]=LaTeX dokumentua
-Comment[fa]=سند LaTex
+Comment[fa]=سند LaTeX
 Comment[fi]=LaTeX-asiakirja
 Comment[fr]=Document LaTeX
 Comment[fy]=LaTeX Dokumint
Index: mimetypes/text/x-moc.desktop
===================================================================
--- mimetypes/text/x-moc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-moc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo metaobjeto de Qt
 Comment[et]=Qt metaobjektfail
 Comment[eu]=Qt meta-objektu fitxategia
-Comment[fa]=پرونده‌ی فوق موضوعی Qt
+Comment[fa]=پروندۀ فراشي Qt
 Comment[fi]=Qt Meta -objektitiedosto
 Comment[fr]=Fichier Méta-objet pour Qt
 Comment[fy]=Qt-Meta-Objekt-triem
Index: mimetypes/text/x-ldif.desktop
===================================================================
--- mimetypes/text/x-ldif.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-ldif.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Libreta de direcciones LDAP
 Comment[et]=LDAP aadressiraamat
 Comment[eu]=LDAP helbide liburuxka
-Comment[fa]=دفتر‌نشانی LDAP
+Comment[fa]=کتاب نشانی LDAP
 Comment[fi]=LDAP-osoitekirja
 Comment[fr]=Carnet d'adresses LDAP
 Comment[fy]=LDAP adresboek
Index: mimetypes/text/x-katefilelist.desktop
===================================================================
--- mimetypes/text/x-katefilelist.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-katefilelist.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[es]=Lista de archivos (para el módulo cargador de lista de arhivos de Kate)
 Comment[et]=Failide nimekiri (Kate failide nimekirja plugina jaoks)
 Comment[eu]= Fitxategi zerrenda (Kate File List Loader pluginerako)
-Comment[fa]=سیاهه‌ی پرونده (برای متصل‌کننده‌ی بارکننده‌ی سیاهه‌ی پرونده‌ی Kate)
+Comment[fa]=فهرست پرونده )برای وصلۀ بارکنندۀ فهرست پروندۀ Kate(
 Comment[fi]=Tiedostolista (Kate-tiedostolistalisäosalle)
 Comment[fr]=Liste de fichiers (pour le chargeur de listes de fichiers de Kate)
 Comment[fy]=Triemmenlist (foar de Kate-triemmenplugin)
Index: mimetypes/text/x-chdr.desktop
===================================================================
--- mimetypes/text/x-chdr.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-chdr.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de cabecera C
 Comment[et]=C päis
 Comment[eu]=C goiburuko fitxategia
-Comment[fa]=سربرگ پرونده‌ی C
+Comment[fa]=پروندۀ سرآیند C
 Comment[fi]=C-otsikkotiedosto
 Comment[fr]=Fichier d'en-tête C
 Comment[fy]=C-koptekst triem
Index: mimetypes/text/x-c++src.desktop
===================================================================
--- mimetypes/text/x-c++src.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-c++src.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de código C++
 Comment[et]=C++ lähtetekst
 Comment[eu]=C++ iturburu fitxategia
-Comment[fa]=پرونده‌ی کد C++
+Comment[fa]=پروندۀ منبع ++C
 Comment[fi]=C++-lähdekoodi
 Comment[fr]=Fichier source C++
 Comment[fy]=C++-boarnetriem
Index: mimetypes/text/x-log.desktop
===================================================================
--- mimetypes/text/x-log.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-log.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de registro de aplicación
 Comment[et]=Rakenduse logifail
 Comment[eu]=Aplikazioen egunkari-fitxategia
-Comment[fa]=پرونده‌ی گذارشات برنامه
+Comment[fa]=پروندۀ ثبت کاربرد
 Comment[fi]=Sovelluksen lokitiedosto
 Comment[fr]=Fichier journal d'application
 Comment[fy]=Programmalogtriem
Index: mimetypes/text/x-tcl.desktop
===================================================================
--- mimetypes/text/x-tcl.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-tcl.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo TCL
 Comment[et]=Tcl-fail
 Comment[eu]=Tcl fitxategia
-Comment[fa]=پرونده‌ی Tcl
+Comment[fa]=پروندۀ Tcl
 Comment[fi]=Tcl-ohjelma
 Comment[fr]=Fichier TCL
 Comment[fy]=Tcl-triem
Index: mimetypes/text/css.desktop
===================================================================
--- mimetypes/text/css.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/css.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,7 +14,7 @@
 Comment[eo]=CSS - Stildifino
 Comment[es]=Hoja de estilo en cascada
 Comment[et]=CSS-dokument
-Comment[fa]=سبک صفحه‌ی آبشاری
+Comment[fa]=صفحه سبک آبشاری
 Comment[fi]=CSS-tyylisivu
 Comment[fr]=Feuille de style en cascade
 Comment[fy]=Cascading Style Sheet (stylblêd)
Index: mimetypes/text/x-hex.desktop
===================================================================
--- mimetypes/text/x-hex.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-hex.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Comment[es]=Formato de archivo Intel® Hexadecimal Object
 Comment[et]=Intel® 16nd-objektfaili vorming
 Comment[eu]=Intel® objektu hamaiseitarreko fitxategi formatua
+Comment[fa]=قالب پروندۀ شي شانزده شانزدهی  Intel® 
 Comment[fi]=Intel® Heksadesimaaliolion tiedostomuoto
 Comment[fr]=Format de fichier objet hexadécimal Intel®
 Comment[fy]=Intel® Hexadecimal Objekt Triem yndieling
Index: mimetypes/text/x-csrc.desktop
===================================================================
--- mimetypes/text/x-csrc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-csrc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de código C
 Comment[et]=C lähtetekst
 Comment[eu]=C iturburu fitxategia
-Comment[fa]=پرونده‌ی کد C
+Comment[fa]=پروندۀ منبع C
 Comment[fi]=C-lähdekoodi
 Comment[fr]=Fichier source C
 Comment[fy]=C-boarnetriem
Index: mimetypes/text/x-xslt.desktop
===================================================================
--- mimetypes/text/x-xslt.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-xslt.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de hoja de estilo XSLT
 Comment[et]=XSLT laaditabeli fail
 Comment[eu]=XSLT estilo-orriko fitxategia
-Comment[fa]=پرونده‌ی صفحه‌گسترده‌ی XSLT
+Comment[fa]=پروندۀ برگه‌شیوۀ XSLT
 Comment[fi]=XSLT-tyylitiedosto
 Comment[fr]=Feuille de style XSLT
 Comment[fy]=XSLT-stylblêdtriem
Index: mimetypes/text/x-csv.desktop
===================================================================
--- mimetypes/text/x-csv.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-csv.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Archivo de texto con valores separados por comas
 Comment[et]=Komaga eraldatud väärtuste tekstifail
 Comment[eu]=Komaz bereiztutako balioen testu-fitxategia
-Comment[fa]=پرونده‌ی متن با مقادیر جدا شده توسط ویرگول
+Comment[fa]=مقادیرجداشدۀ پروندۀ متن، توسط کاما
 Comment[fi]=Pilkuilla erotettu tekstitiedosto
 Comment[fr]=Fichier texte avec des valeurs séparées par une virgule
 Comment[fy]=Teksttriem mei troch komma's skieden wearden
Index: mimetypes/text/x-vcalendar.desktop
===================================================================
--- mimetypes/text/x-vcalendar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-vcalendar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo de intercambio de vCalendar
 Comment[et]=vCalendari transpordifail
 Comment[eu]=vCalendar elkartrukaketako fitxategia
-Comment[fa]=پرونده‌ی تبدیل vCalendar
+Comment[fa]=پروندۀ تبادل‌پذیرvCalendar
 Comment[fi]=vCalendar-siirtotiedosto
 Comment[fr]=Fichier d'échange vCalendar
 Comment[fy]=vCalendar utwisseling triem
Index: mimetypes/text/x-vcard.desktop
===================================================================
--- mimetypes/text/x-vcard.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-vcard.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Tarjeta de comercio electrónico
 Comment[et]=Elektrooniline visiitkaart
 Comment[eu]=Merkatal txartel elektronikoa
-Comment[fa]=کارت الکترونیکی تجارتی
+Comment[fa]=کارت تجارت الکترونیک
 Comment[fi]=Sähköinen käyntikortti
 Comment[fr]=Carte de commerce électronique
 Comment[fy]=Elektroanysk nammekaartsje
Index: mimetypes/text/x-tex.desktop
===================================================================
--- mimetypes/text/x-tex.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/text/x-tex.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Archivo TeX
 Comment[et]=TeX-fail
 Comment[eu]=TeX fitxategia
-Comment[fa]=پرونده‌ی TeX
+Comment[fa]=پروندۀ TeX
 Comment[fi]=TeX-tiedosto
 Comment[fr]=Fichier TeX
 Comment[fy]=TeX-triem
Index: mimetypes/video/x-ogm.desktop
===================================================================
--- mimetypes/video/x-ogm.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-ogm.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Vídeo de Ogg/Ogm
 Comment[et]=Ogg/Ogm videofail
 Comment[eu]=Ogg/Ogm bideoa
-Comment[fa]=تصویری Ogg/Ogm
+Comment[fa]=ویدئو Ogg/Ogm
 Comment[fi]=Ogg/Ogm-video
 Comment[fr]=Vidéo Ogg / Ogm
 Comment[fy]=Ogg/Ogm Fideo
Index: mimetypes/video/x-theora.desktop
===================================================================
--- mimetypes/video/x-theora.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-theora.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Vídeo de Theora
 Comment[et]=Theora videofail
 Comment[eu]=Theora bideoa
-Comment[fa]=تصویری Theora
+Comment[fa]=ویدئو Theora
 Comment[fi]=Theora-video
 Comment[fr]=Vidéo Theora
 Comment[fy]=Theora Fideo
Index: mimetypes/video/mpeg.desktop
===================================================================
--- mimetypes/video/mpeg.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/mpeg.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Vídeo MPEG
 Comment[et]=MPEG videofail
 Comment[eu]=MPEG bideoa
-Comment[fa]=پخش MPEG
+Comment[fa]=ویدئو MPEG
 Comment[fi]=MPEG-video
 Comment[fr]=Vidéo MPEG
 Comment[fy]=MPEG-fideo
Index: mimetypes/video/quicktime.desktop
===================================================================
--- mimetypes/video/quicktime.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/quicktime.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Vídeo QuickTime
 Comment[et]=Quicktime videofail
 Comment[eu]=Quicktime bideoa
-Comment[fa]=پخش Quicktime
+Comment[fa]=ویدئو Quicktime
 Comment[fi]=Quicktime-video
 Comment[fr]=Vidéo QuickTime
 Comment[fy]=Quicktime-fideo
Index: mimetypes/video/x-ms-asf.desktop
===================================================================
--- mimetypes/video/x-ms-asf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-ms-asf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Medios ASF
 Comment[et]=ASF meediafail
 Comment[eu]=ASF media
-Comment[fa]=رسانه‌ی ASF
+Comment[fa]=رسانۀ ASF
 Comment[fi]=ASF-mediatiedosto
 Comment[fr]=Support ASF
 Comment[fy]=ASF-media
Index: mimetypes/video/x-ms-wmv.desktop
===================================================================
--- mimetypes/video/x-ms-wmv.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-ms-wmv.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Video de media de Windows
 Comment[et]=Windows Media videofail
 Comment[eu]=Windows Media bideoa
-Comment[fa]=ویدیوی ویندوز مدیا
+Comment[fa]=ویدئو رسانۀ ویندوز
 Comment[fi]=Windows mediatiedosto
 Comment[fr]=Vidéo Windows Media
 Comment[fy]=Windows Media Fideo
Index: mimetypes/video/x-msvideo.desktop
===================================================================
--- mimetypes/video/x-msvideo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-msvideo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -22,7 +22,7 @@
 Comment[es]=Vídeo AVI de Microsoft
 Comment[et]=Microsoft AVI videofail
 Comment[eu]=Microsoft AVI bideoa
-Comment[fa]=پخش مایکروسافت AVI
+Comment[fa]=ویدئو AVI میکروسافت 
 Comment[fi]=Microsoft AVI -video
 Comment[fr]=Vidéo Microsoft AVI
 Comment[fy]=Microsoft AVI-Fideo
Index: mimetypes/video/vnd.rn-realvideo.desktop
===================================================================
--- mimetypes/video/vnd.rn-realvideo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/vnd.rn-realvideo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo de RealVideo
 Comment[et]=RealVideo fail
 Comment[eu]=RealVideo fitxategia
-Comment[fa]=پرونده‌ی RealVideo
+Comment[fa]=پروندۀ RealVideo
 Comment[fi]=RealVideo-tiedosto
 Comment[fr]=Fichier RealVideo
 Comment[fy]=RealFideo triem
Index: mimetypes/video/avi.desktop
===================================================================
--- mimetypes/video/avi.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/avi.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Vídeo AVI de Microsoft
 Comment[et]=Microsoft AVI videofail
 Comment[eu]=Microsoft AVI bideoa
-Comment[fa]=پخش مایکروسافت AVI
+Comment[fa]=ویدئو AVI میکروسافت 
 Comment[fi]=Microsoft AVI -video
 Comment[fr]=Vidéo Microsoft AVI
 Comment[fy]=Microsoft AVI-Fideo
Index: mimetypes/video/mp4.desktop
===================================================================
--- mimetypes/video/mp4.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/mp4.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Vídeo de MPEG-4
 Comment[et]=MPEG-4 videofail
 Comment[eu]=MPEG-4 bideoa
-Comment[fa]=تصویری MPEG-4
+Comment[fa]=ویدئو MPEG-4 
 Comment[fi]=MPEG-4 -video
 Comment[fr]=Vidéo MPEG-4
 Comment[fy]=MPEG-4 Fideo
Index: mimetypes/video/x-flic.desktop
===================================================================
--- mimetypes/video/x-flic.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-flic.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=Archivo FLIC de Autodesk
 Comment[et]=Autodeski FLIC-fail
 Comment[eu]=Autodesk FLIC fitxategia
-Comment[fa]=پرونده‌ی Autodesk FLIC
+Comment[fa]=پروندۀ Autodesk's FLIC
 Comment[fi]=Autodesk FLIC-tiedosto
 Comment[fr]=Fichier FLIC d'Autodesk
 Comment[fy]=Autodesk's FLIC-triem
Index: mimetypes/video/x-matroska.desktop
===================================================================
--- mimetypes/video/x-matroska.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/video/x-matroska.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Vídeo de Matroska
 Comment[et]=Matroska videofail
 Comment[eu]=Matroska bideoa
-Comment[fa]=تصویری Matroska
+Comment[fa]=ویدئو Matroska
 Comment[fi]=Matroska-video
 Comment[fr]=Vidéo Matroska
 Comment[fy]=Matroska Fideo
Index: mimetypes/inode/block.desktop
===================================================================
--- mimetypes/inode/block.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/inode/block.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Dispositivo de bloques
 Comment[et]=Plokkseade
 Comment[eu]=Bloke gailua
-Comment[fa]=‌دستگاه سد کردن
+Comment[fa]=دستگاه بلوک
 Comment[fi]=Lohkolaite
 Comment[fr]=Périphérique bloc
 Comment[fy]=Blokapparaat
Index: mimetypes/inode/chardevice.desktop
===================================================================
--- mimetypes/inode/chardevice.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/inode/chardevice.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Dispositivo de caracteres
 Comment[et]=Sümbolseade
 Comment[eu]=Karaktere gailua
-Comment[fa]=دستگاه حرف
+Comment[fa]=دستگاه نویسه
 Comment[fi]=Tekstilaite
 Comment[fr]=Périphérique caractère
 Comment[fy]=Apparaat foar tekstynfier of -útfier
Index: mimetypes/inode/directory-locked.desktop
===================================================================
--- mimetypes/inode/directory-locked.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ mimetypes/inode/directory-locked.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Archivo bloqueado
 Comment[et]=Lukustatud kataloog
 Comment[eu]=Karpeta blokeatua
-Comment[fa]=پوشه‌ی قفل شده
+Comment[fa]=پوشۀ قفل‌شده
 Comment[fi]=Lukittu kansio
 Comment[fr]=Dossier verrouillé
 Comment[fy]=Map Sletten
Index: kioslave/http/kcookiejar/kcookiejar.desktop
===================================================================
--- kioslave/http/kcookiejar/kcookiejar.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kioslave/http/kcookiejar/kcookiejar.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Name[es]=Módulo Jar de cookies de KDED
 Name[et]=KDED Cookie Jar moodul
 Name[eu]=KDED Cookie Jar modulua
-Name[fa]=بخش Jar کلوچه‌ی KDED
+Name[fa]=پیمانۀ ظرف کوکی KDED
 Name[fi]=KDED-evästemoduuli
 Name[fr]=Module Jar de cookie KDED 
 Name[fy]=KDED-module foar it bewarjen fan Koekjes
@@ -84,6 +84,7 @@
 Comment[es]=Mantiene registro todas las cookies en el sistema
 Comment[et]=Hoiab silma peal kõigil süsteemi küpsistel
 Comment[eu]=Sistemaren cookie guztien jarraipena egiten du
+Comment[fa]=رد همه کوکیها را در سیستم نگه می‌دارد
 Comment[fi]=Seuraa järjestelmän evästeitä
 Comment[fr]=Conserve une trace de tous les cookies dans le système
 Comment[fy]=Hâld by wer alle koekjes binne
Index: kioslave/http/http_cache_cleaner.desktop
===================================================================
--- kioslave/http/http_cache_cleaner.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kioslave/http/http_cache_cleaner.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Limpiador del caché de HTTP
 Name[et]=HTTP vahemälu puhastaja
 Name[eu]=HTTP cache-garbitzailea
-Name[fa]=پاک‌کننده‌ی کاشه HTTP
+Name[fa]=پاک‌کننده نهانگاه قام
 Name[fi]=HTTP-välimuistin tyhjentäjä
 Name[fr]=Nettoyage du cache HTTP
 Name[fy]=HTTP Cache oprommer
@@ -95,7 +95,7 @@
 Comment[es]=Elimina entradas antiguas del caché de HTTP
 Comment[et]=Puhastab HTTP vahemälu vanadest kirjetest
 Comment[eu]=HTTP cachearen sarrera zaharrak garbitzen ditu
-Comment[fa]=مدخل‌های قدیمی را از کاشه HTTP پاک می‌کند
+Comment[fa]=مدخلهای قدیمی را از نهانگاه قام پاک می‌کند
 Comment[fi]=Puhdistaa vanhat tiedot HTTP-välimuistista
 Comment[fr]=Efface les anciennes entrées du cache HTTP
 Comment[fy]=Ferwidert âlde items út de HTTP-cache
Index: kioslave/http/http.cc
===================================================================
--- kioslave/http/http.cc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kioslave/http/http.cc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -164,7 +164,7 @@
 static QString sanitizeCustomHTTPHeader(const QString& _header)
 {
   QString sanitizedHeaders;
-  QStringList headers = QStringList::split("\r\n", _header);
+  QStringList headers = QStringList::split(QRegExp("[\r\n]"), _header);
 
   for(QStringList::Iterator it = headers.begin(); it != headers.end(); ++it)
   {
Index: kioslave/bzip2/kbzip2filter.desktop
===================================================================
--- kioslave/bzip2/kbzip2filter.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kioslave/bzip2/kbzip2filter.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Filtro BZip2
 Name[et]=BZip2 filter
 Name[eu]=BZip2 iragazkia
-Name[fa]=صافی BZip2
+Name[fa]=پالایۀ BZip2 
 Name[fi]=BZip2-suodin
 Name[fr]=Filtre Bzip2
 Name[fy]=BZip2-filter
Index: kioslave/gzip/kgzipfilter.desktop
===================================================================
--- kioslave/gzip/kgzipfilter.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kioslave/gzip/kgzipfilter.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Filtro GZip
 Name[et]=GZip filter
 Name[eu]=GZip iragazkia
-Name[fa]=صافی GZip
+Name[fa]=پالایۀ GZip
 Name[fi]=GZip-suodin
 Name[fr]=Filtre Gzip
 Name[fy]=GZip-filter
Index: kinit/start_kdeinit.c
===================================================================
--- kinit/start_kdeinit.c	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ kinit/start_kdeinit.c	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,127 @@
+/*
+ * This file is part of the KDE libraries
+ * Copyright (c) 2006 Lubos Lunak <l.lunak@kde.org>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License version 2 as published by the Free Software Foundation.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public License
+ * along with this library; see the file COPYING.LIB.  If not, write to
+ * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ * Boston, MA 02110-1301, USA.
+ */
+
+#include <config.h>
+
+#include <errno.h>
+#include <fcntl.h>
+#include <signal.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <unistd.h>
+
+#ifdef KDEINIT_OOM_PROTECT
+
+/*
+ Prevent getting killed by bad heuristic in Linux OOM-killer.
+ This wrapper decreases the chance OOM killer kills it (or its children,
+ namely kdeinit), opens a pipe and forks. Child drops privileges
+ and launches kdeinit. Since processes started by kdeinit should
+ not have this protection, kdeinit will after forking send the new
+ PID using the pipe and wait for a signal. This parent will reset the protection
+ and SIGUSR1 the process to continue.
+*/
+
+static void set_protection( pid_t pid, int enable )
+{
+   char buf[ 1024 ];
+   sprintf( buf, "/proc/%d/oom_adj", pid );
+   int procfile = open( buf, O_WRONLY );
+   if( procfile >= 0 ) {
+      if( enable )
+         write( procfile, "-5", sizeof( "-5" ));
+      else
+         write( procfile, "0", sizeof( "0" ));
+      close( procfile );
+   }
+}
+
+int main(int argc, char **argv)
+{
+   int pipes[ 2 ];
+   int new_argc;
+   const char** new_argv;
+   char helper_num[ 1024 ];
+   int i;
+   if( pipe( pipes ) < 0 ) {
+      perror( "pipe()" );
+      return 1;
+   }
+   set_protection( getpid(), 1 );
+   switch( fork()) {
+      case -1:
+         perror( "fork()" );
+         return 1;
+      default: /* parent, drop privileges and exec */
+#if defined (HAVE_SETEUID) && !defined (HAVE_SETEUID_FAKE) 
+         seteuid(getuid());
+#else
+         setreuid(-1, getuid());
+#endif
+         if (geteuid() != getuid()) {
+            perror("setuid()");
+            return 1;
+         }
+         close( pipes[ 0 ] );
+         if(argc == 0)
+            return 1;
+         new_argc = argc + 2;
+         new_argv = malloc( sizeof( char* ) * ( new_argc + 1 ));
+         if( new_argv == NULL )
+            return 1;
+         new_argv[ 0 ] = EXECUTE;
+         new_argv[ 1 ] = "--oom-pipe";
+         sprintf( helper_num, "%d", pipes[ 1 ] );
+         new_argv[ 2 ] = helper_num;
+         for( i = 1;
+              i <= argc;
+              ++i )
+             new_argv[ i + 2 ] = argv[ i ];
+         execv(EXECUTE, (char**)new_argv);
+         perror(EXECUTE);
+         return 1;
+      case 0: /* child, keep privileges and do the privileged work */
+         close( pipes[ 1 ] );
+         for(;;) {
+            pid_t pid = 0;
+            int ret = read( pipes[ 0 ], &pid, sizeof( pid_t ));
+            if( ret < 0 && errno == EINTR )
+               continue;
+            if( ret <= 0 ) /* pipe closed or error, exit */
+               return 0;
+            if( pid != 0 ) {
+                set_protection( pid, 0 );
+                kill( pid, SIGUSR1 );
+            }
+         }
+   }
+}
+
+#else /* not Linux, the simple non-setuid case */
+
+int main(int argc, char **argv)
+{
+   if(argc == 0)
+      return 1;
+   argv[0] = (char*)EXECUTE;
+   execv(EXECUTE,argv);
+   perror(EXECUTE);
+   return 1;
+}
+#endif
Index: kinit/configure.in.in
===================================================================
--- kinit/configure.in.in	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kinit/configure.in.in	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -43,3 +43,16 @@
     AC_DEFINE(KDEINIT_USE_FONTCONFIG,1,[Use FontConfig in kdeinit])
 fi
 AC_SUBST(KDEINIT_XFT_INCLUDES)
+
+AC_MSG_CHECKING(whether to make kdeinit setuid root in order to protect it from bad Linux OOM-killer)
+kdeinit_setuid=
+case $target_os in
+    linux*)
+        AC_MSG_RESULT(yes)
+        kdeinit_setuid=1
+        AC_DEFINE(KDEINIT_OOM_PROTECT,1,[Enable prevention against poor Linux OOM-killer])
+        ;;
+    *)  AC_MSG_RESULT(no)
+        ;;
+esac
+AM_CONDITIONAL(KDEINIT_SETUID, test -n "$kdeinit_setuid" )
Index: kinit/kinit.cpp
===================================================================
--- kinit/kinit.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kinit/kinit.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -41,6 +41,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+#include <ctype.h>
 #include <unistd.h>
 #include <locale.h>
 
@@ -385,6 +386,38 @@
      return execpath;
 }
 
+#ifdef KDEINIT_OOM_PROTECT
+static int oom_pipe = -1;
+
+static void oom_protect_sighandler( int ) {
+}
+
+static void reset_oom_protect() {
+   if( oom_pipe <= 0 )
+      return;
+   struct sigaction act, oldact;
+   act.sa_handler = oom_protect_sighandler;
+   act.sa_flags = 0;
+   sigemptyset( &act.sa_mask );
+   sigaction( SIGUSR1, &act, &oldact );
+   sigset_t sigs, oldsigs;
+   sigemptyset( &sigs );
+   sigaddset( &sigs, SIGUSR1 );
+   sigprocmask( SIG_BLOCK, &sigs, &oldsigs );
+   pid_t pid = getpid();
+   if( write( oom_pipe, &pid, sizeof( pid_t )) > 0 ) {
+      sigsuspend( &oldsigs ); // wait for the signal to come
+    }
+   sigprocmask( SIG_SETMASK, &oldsigs, NULL );
+   sigaction( SIGUSR1, &oldact, NULL );
+   close( oom_pipe );
+   oom_pipe = -1;
+}
+#else
+static void reset_oom_protect() {
+}
+#endif
+
 static pid_t launch(int argc, const char *_name, const char *args,
                     const char *cwd=0, int envc=0, const char *envs=0,
                     bool reset_env = false,
@@ -484,6 +517,7 @@
         }
         close( d.launcher[0] );
      }
+     reset_oom_protect();
 
      if (cwd && *cwd)
         chdir(cwd);
@@ -1374,6 +1408,7 @@
             if (fork() == 0)
             {
                 close_fds();
+                reset_oom_protect();
                 handle_launcher_request(sock);
                 exit(255); /* Terminate process. */
             }
@@ -1394,6 +1429,7 @@
             if (fork() == 0)
             {
                 close_fds();
+                reset_oom_protect();
                 handle_launcher_request(sock);
                 exit(255); /* Terminate process. */
             }
@@ -1672,6 +1708,10 @@
          keep_running = 0;
       if (strcmp(safe_argv[i], "--new-startup") == 0)
          new_startup = 1;
+#ifdef KDEINIT_OOM_PROTECT
+      if (strcmp(safe_argv[i], "--oom-pipe") == 0 && i+1<argc)
+         oom_pipe = atol(argv[i+1]);
+#endif
       if (strcmp(safe_argv[i], "--help") == 0)
       {
         printf("Usage: kdeinit [options]\n");
@@ -1830,7 +1870,11 @@
 #endif
          handle_requests(pid);
       }
-      else if (safe_argv[i][0] == '-')
+      else if (safe_argv[i][0] == '-'
+#ifdef KDEINIT_OOM_PROTECT
+          || isdigit(safe_argv[i][0])
+#endif
+          )
       {
          // Ignore
       }
Index: kinit/Makefile.am
===================================================================
--- kinit/Makefile.am	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kinit/Makefile.am	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 SUBDIRS = . tests
 
 bin_PROGRAMS = kdeinit kdeinit_wrapper kshell kdeinit_shutdown lnusertemp kwrapper kioslave \
-               kstartupconfig kdostartupconfig
+               kstartupconfig kdostartupconfig start_kdeinit
 
 lib_LTLIBRARIES = 
 kdeinit_LTLIBRARIES = klauncher.la
@@ -66,6 +66,11 @@
                            $(KDE_RPATH)
 kdostartupconfig_LDADD  = $(LIB_KDECORE)
 
+start_kdeinit_SOURCES = start_kdeinit.c
+kdeinitpath = $(bindir)/kdeinit
+start_kdeinit_CFLAGS = $(KDE_USE_FPIE) -DEXECUTE=\"$(kdeinitpath)\"
+start_kdeinit_LDFLAGS = $(KDE_USE_PIE)
+
 METASOURCES = AUTO
 
 noinst_HEADERS = klauncher.h autostart.h klauncher_cmds.h setproctitle.h
@@ -77,6 +82,14 @@
 dummy.cpp:
 	echo > dummy.cpp
 
+if KDEINIT_SETUID
+# start_kdeinit needs to be installed setuid root on Linux
+install-exec-hook:
+	@(chown 0 $(DESTDIR)$(bindir)/start_kdeinit && chmod 4755 $(DESTDIR)$(bindir)/start_kdeinit) || echo "Please make start_kdeinit setuid root" >&2
+	@echo ""
+	@echo "start_kdeinit is by default installed on Linux with a set SETUID root bit!"
+	@echo "This is needed to prevent kdeinit from being killed by a bad heuristic in the OOM-killer when running out of memory."
+	@echo ""
+endif
 
 include $(top_srcdir)/admin/Doxyfile.am
-
Index: kimgio/xpm.kimgio
===================================================================
--- kimgio/xpm.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/xpm.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen mapa de pixels de X
 Name[et]=X pixmap pildifail
 Name[eu]=X PixMap irudia
-Name[fa]=تصویر عکس‌نقش X
+Name[fa]=تصویر نگاشت تصویر دانه ای X
 Name[fi]=X-kuvakartta
 Name[fr]=Image X Pixmap
 Name[fy]=X PixMap ôfbylding
Index: kimgio/g3.kimgio
===================================================================
--- kimgio/g3.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/g3.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Name[es]=Fax CCITT G3
 Name[et]=CCITT g3 fax
 Name[eu]=CCITT G3 faxa
-Name[fa]=دورنگار CCITT G3
+Name[fa]=دورنگارCCITT G3 
 Name[fi]=CCITT G3 -faksi
 Name[fr]=Fax CCITT G3
 Name[fy]=CCITT G3 Faks
Index: kimgio/ico.kimgio
===================================================================
--- kimgio/ico.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/ico.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Icono de Windows
 Name[et]=Windowsi ikoon
 Name[eu]=Windows ikonoa
-Name[fa]=شمایل ویندوز
+Name[fa]=شمایل پنجره ها
 Name[fi]=Windows-kuvake
 Name[fr]=Icône Windows
 Name[fy]=Windows Ikoan
Index: kimgio/rgb.kimgio
===================================================================
--- kimgio/rgb.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/rgb.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,6 +18,7 @@
 Name[es]=Imagen SGI (RGB)
 Name[et]=SGI pildifail (RGB)
 Name[eu]=SGI irudia (RGB)
+Name[fa]=تصویر) SGI (ًRGB
 Name[fi]=SGI-kuva (RGB)
 Name[fr]=Image SGI (RVB)
 Name[fy]=SGI ôfbylding (RBG)
Index: kimgio/hdr.kimgio
===================================================================
--- kimgio/hdr.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/hdr.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Name[es]=Imagen de gran rango dinámico
 Name[et]=High Dynamic Range pildifail
 Name[eu]=Dinamika Altuko Barruti irudia
+Name[fa]=گستره پویایی بالای تصویر
 Name[fi]=Korkeatasoinen muuttuvien arvoalueiden kuva
 Name[fr]=Image à définition dynamique haute
 Name[fy]=High Dynamic Range-ôfbylding
Index: kimgio/xcf.kimgio
===================================================================
--- kimgio/xcf.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/xcf.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Name[es]=Imagen GIMP
 Name[et]=GIMP-i pildifail
 Name[eu]=GIMP irudia
+Name[fa]=تصویرGIMP
 Name[fi]=GIMP-kuva
 Name[fr]=Image GIMP
 Name[fy]=GIMP-ôfbylding
Index: kimgio/mng.kimgio
===================================================================
--- kimgio/mng.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/mng.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Name[es]=Imagen MNG
 Name[et]=MNG pildifail
 Name[eu]=MNG irudia
+Name[fa]=تصویر MNG 
 Name[fi]=MNG-kuva
 Name[fr]=Image MNG
 Name[fy]=MNG-ôfbylding
Index: kimgio/psd.kimgio
===================================================================
--- kimgio/psd.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/psd.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,7 @@
 Name[es]=Imagen Photoshop de Adobe
 Name[et]=Adobe Photoshop pildifail
 Name[eu]=Adobe Photoshop irudia
+Name[fa]=تصویرAdobe Photoshop
 Name[fi]=Adobe Photoshop -kuva
 Name[fr]=Image Adobe Photoshop
 Name[fy]=Adobe Photoshop-ôfbylding
@@ -39,6 +40,7 @@
 Name[pt_BR]=Imagem do Adobe Photoshop
 Name[ro]=Imagine Adobe Photoshop
 Name[ru]=Рисунок Adobe Photoshop
+Name[se]=Adobe Photoshop-govva
 Name[sk]=Adobe Photoshop obrázok
 Name[sl]=Slika Adobe Photoshop
 Name[sr]=Слика Adobe-овог Photoshop-а
Index: kimgio/eps.kimgio
===================================================================
--- kimgio/eps.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/eps.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen PostScript encapsulada
 Name[et]=Kapseldatud PostScript pildifail
 Name[eu]=Kapsulatutako PostScript irudia
-Name[fa]=تصویر PostScript کپسوله شده
+Name[fa]=تصویر پست اسکریپت کپسوله شده
 Name[fi]=Encapsulated PostScript (EPS) -kuva
 Name[fr]=Image PostScript encapsulée
 Name[fy]=Ynsletten PostSkript ôfbylding
Index: kimgio/pcx.kimgio
===================================================================
--- kimgio/pcx.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/pcx.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen PCX
 Name[et]=PCX pildifail
 Name[eu]=PCX irudia
-Name[fa]=تصویر PCX
+Name[fa]=تصویرPCX
 Name[fi]=PCX-kuva
 Name[fr]=Image PCX
 Name[fy]=PCX ôfbylding
Index: kimgio/jp2.kimgio
===================================================================
--- kimgio/jp2.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/jp2.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen JPEG 2000
 Name[et]=JPEG 2000 pildifail
 Name[eu]=JPEG 2000 irudia
-Name[fa]=تصویر JPEG 2000
+Name[fa]=تصویر JPEG2000
 Name[fi]=JPEG 2000 -kuva
 Name[fr]=Image JPEG 2000
 Name[fy]=JPEG 2000 ôfbylding
Index: kimgio/gif.kimgio
===================================================================
--- kimgio/gif.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/gif.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen GIF
 Name[et]=GIF pildifail
 Name[eu]=GIF irudia
-Name[fa]=تصویر GIF
+Name[fa]=تصویرGIF
 Name[fi]=GIF-kuva
 Name[fr]=Image GIF
 Name[fy]=GIF ôfbylding
Index: kimgio/dds.kimgio
===================================================================
--- kimgio/dds.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/dds.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,6 +12,7 @@
 Name[de]=Oberfläche für Direct Draw
 Name[eo]=Rekta desegnosurfaco
 Name[eu]=Zuzeneko marrazketarako gainazala
+Name[fa]=سطح ترسیم مستقیم
 Name[fi]=Suora piirtotaso
 Name[fr]=Surface Direct Draw
 Name[gl]=Debuxar Superfície Directamente
Index: kimgio/tga.kimgio
===================================================================
--- kimgio/tga.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/tga.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen de visión verdadera Targa
 Name[et]=Truevision Targa pildifail
 Name[eu]=Truevision Targa irudia
-Name[fa]=تصویر Truevision Targa
+Name[fa]=تصویر پندارصحیح Targa
 Name[fi]=Truevision Targa -kuva
 Name[fr]=Image Targa Truevision
 Name[fy]=Truevision Targa ôfbylding
Index: kimgio/pbm.kimgio
===================================================================
--- kimgio/pbm.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/pbm.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Name[es]=Imagen Bitmap portable
 Name[et]=Portable bittraster-pildifail
 Name[eu]=Bitmap irudi eramangarria
-Name[fa]=تصویر نقش‌بیت قابل حمل
+Name[fa]=تصویر نگاشت بیت حمل پذیر
 Name[fi]=Portable Bitmap -kuva
 Name[fr]=Image Bitmap Portable
 Name[fy]=Portable Bitmap ôfbylding
Index: kimgio/pgm.kimgio
===================================================================
--- kimgio/pgm.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/pgm.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Imagen portable Graymap
 Name[et]=Portable Graymap pildifail
 Name[eu]=Graymap irudi eramangarria
-Name[fa]=تصویر نقش‌خاکستری قابل حمل
+Name[fa]=تصویر نگاشت خاکستری حمل پذیر
 Name[fi]=Portable Graymap -kuva
 Name[fr]=Image Graymap Portable
 Name[fy]=Portable Graymap ôfbylding
Index: kimgio/xbm.kimgio
===================================================================
--- kimgio/xbm.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/xbm.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Imagen mapa de bits de X
 Name[et]=X bitmap pildifail
 Name[eu]=X BitMap irudia
-Name[fa]=تصویر X BitMap
+Name[fa]=تصویر نگاشت بیتی X
 Name[fi]=X-bittikarttakuva
 Name[fr]=Image X Bitmap
 Name[fy]=X BitMap ôfbylding
Index: kimgio/ppm.kimgio
===================================================================
--- kimgio/ppm.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/ppm.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Imagen portable Pixmap
 Name[et]=Portable pikselrster-pildifail
 Name[eu]=Pixmap irudi eramangarria
-Name[fa]=تصویر عکس‌نقش قابل حمل
+Name[fa]=تصویرنگاشت تصویر دانه ای حمل پذیر
 Name[fi]=Portable Pixmap -kuva
 Name[fr]=Image Pixmap Portable
 Name[fy]=Portable Pixmap ôfbylding
Index: kimgio/xv.kimgio
===================================================================
--- kimgio/xv.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kimgio/xv.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Name[es]=Imagen XView
 Name[et]=XView pildifail
 Name[eu]=XView irudia
-Name[fa]=تصویر XView
+Name[fa]=تصویر نمایX
 Name[fi]=XView-kuva
 Name[fr]=Image XView
 Name[fy]=XView ôfbylding
Index: kio/kfileplugin.desktop
===================================================================
--- kio/kfileplugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kfileplugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Plugin de meta datos KFile
 Name[et]=KFile'i metaandmete plugin
 Name[eu]=KFile metadatuen plugin-a
-Name[fa]=متصل‌کننده‌ی فوق داده‌ی KFile
+Name[fa]=وصلۀ فرادادۀ KFile
 Name[fi]=KFile-metatietolisäosa
 Name[fr]=Module externe de métadonnées KFile
 Name[ga]=Breiseán meiteashonraí do KFile
Index: kio/kio/ktar.cpp
===================================================================
--- kio/kio/ktar.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/ktar.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -439,8 +439,8 @@
                     // Let's hack around hard links. Our classes don't support that, so make them symlinks
                     if ( typeflag == '1' )
                     {
-                        size = nm.length(); // in any case, we don't want to skip the real size, hence this resetting of size
-                        kdDebug(7041) << "HARD LINK, setting size to " << size << endl;
+                        kdDebug(7041) << "HARD LINK, setting size to 0 instead of " << size << endl;
+                        size = 0; // no contents
                     }
 
                     //kdDebug(7041) << "KTar::openArchive file " << nm << " size=" << size << endl;
@@ -801,7 +801,7 @@
 
     QCString permstr;
     permstr.sprintf("%o",perm);
-    permstr.rightJustify(6, ' ');
+    permstr = permstr.rightJustify(6, ' ');
     fillBuffer(buffer, permstr, size, mtime, 0x30, uname, gname);
 
     // Write header
@@ -860,7 +860,7 @@
 
     QCString permstr;
     permstr.sprintf("%o",perm);
-    permstr.rightJustify(6, ' ');
+    permstr = permstr.rightJustify(6, ' ');
     fillBuffer( buffer, permstr, 0, mtime, 0x35, uname, gname);
 
     // Write header
@@ -924,7 +924,7 @@
 
     QCString permstr;
     permstr.sprintf("%o",perm);
-    permstr.rightJustify(6, ' ');
+    permstr = permstr.rightJustify(6, ' ');
     fillBuffer(buffer, permstr, 0, mtime, 0x32, uname, gname);
 
     // Write header
Index: kio/kio/krun.cpp
===================================================================
--- kio/kio/krun.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/krun.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -296,7 +296,7 @@
 {
    switch( option ) {
    case 'u':
-      ret << (url.isLocalFile() ? url.path() : url.url());
+      ret << url.pathOrURL();
       break;
    case 'd':
       ret << url.directory();
Index: kio/kio/kservicegroup.cpp
===================================================================
--- kio/kio/kservicegroup.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/kservicegroup.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -48,6 +48,7 @@
 {
   d = new KServiceGroup::Private;
   m_bDeleted = false;
+  m_bDeep = false;
 }
 
 KServiceGroup::KServiceGroup( const QString &configFile, const QString & _relpath )
@@ -55,6 +56,7 @@
 {
   d = new KServiceGroup::Private;
   m_bDeleted = false;
+  m_bDeep = false;
 
   QString cfg = configFile;
   if (cfg.isEmpty())
Index: kio/kio/job.cpp
===================================================================
--- kio/kio/job.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/job.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2082,7 +2082,7 @@
         KMimeType::Ptr ptr = KMimeType::findByURL( m_url, 0, true, true );
         if ( ptr ) {
             QString proto = ptr->property("X-KDE-LocalProtocol").toString();
-            if ( !proto.isEmpty() ) {
+            if ( !proto.isEmpty() && KProtocolInfo::isKnownProtocol(proto) ) {
                 m_redirectionURL = m_url;
                 m_redirectionURL.setProtocol( proto );
                 m_error = 0;
Index: kio/kio/kservice.h
===================================================================
--- kio/kio/kservice.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/kservice.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -278,12 +278,16 @@
    *        otherwise false.
    */
   bool hasServiceType( const QString& _service ) const;
+
   /**
-   * Checks whether a service is used as a default setting, for
-   *         example as plugin in a file manager. Usually that is the
-   *         case, but some services may only be started when the user
-   *         selected them. This kind of services returns false here.
-   * @return true if the service may be used as a default setting
+   * Set to true if it is allowed to use this service as the default (main)
+   * action for the files it supports (e.g. Left Click in a file manager, or KRun in general).
+   *
+   * If not, then this service is only available in RMB popups, so it must
+   * be selected explicitely by the user in order to be used.
+   * Note that servicemenus supersede this functionality though, at least in konqueror.
+   *
+   * @return true if the service may be used as the default (main) handler
    */
   bool allowAsDefault() const { return m_bAllowAsDefault; }
 
Index: kio/kio/netaccess.cpp
===================================================================
--- kio/kio/netaccess.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kio/netaccess.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -435,7 +435,7 @@
   }
   else
   {
-    resultData = QString( "ERROR: Unknown protocol '%1'" ).arg( url.protocol() );
+    resultData = i18n( "ERROR: Unknown protocol '%1'" ).arg( url.protocol() );
   }
   return resultData;
 }
Index: kio/renamedlgplugin.desktop
===================================================================
--- kio/renamedlgplugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/renamedlgplugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Plugin para el diálogo de renombrado
 Comment[et]=Ümbernimetamise dialoogi plugin
 Comment[eu]=Berrizendatze elkarrizketa-koadroen plugin-a
-Comment[fa]=متصل‌کننده برای محاوره‌ی تغییر نام
+Comment[fa]=وصله برای محاورۀ تغییر نام
 Comment[fi]=Lisäosa uudelleennimeämisikkunalle
 Comment[fr]=Module externe pour la boîte de dialogue de renommage
 Comment[fy]=Plugin foar it 'Omneame'-dialooch
Index: kio/kioexec/main.cpp
===================================================================
--- kio/kioexec/main.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kioexec/main.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -82,6 +82,9 @@
     for ( int i = 1; i < args->count(); i++ )
     {
         KURL url = args->url(i);
+        // we need to map system:/ etc to make sure we get this right
+        url = KIO::NetAccess::mostLocalURL( url, 0 );
+
         //kdDebug() << "url=" << url.url() << " filename=" << url.fileName() << endl;
         // A local file, not an URL ?
         // => It is not encoded and not shell escaped, too.
Index: kio/kfile/kicondialog.h
===================================================================
--- kio/kfile/kicondialog.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kfile/kicondialog.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -71,7 +71,7 @@
 private:
     QStringList mFiles;
     QTimer *mpTimer;
-    KIconLoader *mpLoader;
+    KIconLoader *mpLoader; // unused
 
 protected:
     virtual void virtual_hook( int id, void* data );
@@ -222,6 +222,7 @@
 private:
     void init();
     void showIcons();
+    void setContext( KIcon::Context context );
 
     int mGroupOrSize;
     KIcon::Context mContext;
@@ -234,6 +235,8 @@
     KProgress *mpProgress;
     KIconLoader *mpLoader;
     KIconCanvas *mpCanvas;
+    int mNumContext;
+    KIcon::Context mContextMap[ 12 ]; // must match KIcon::Context size, code has assert
 
 protected:
     virtual void virtual_hook( int id, void* data );
Index: kio/kfile/kpropsdlgplugin.desktop
===================================================================
--- kio/kfile/kpropsdlgplugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kfile/kpropsdlgplugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Plugin para el diálogo de propiedades
 Comment[et]=Omaduste dialoogi plugin
 Comment[eu]=Propietateen elkarrizketa-koadroaren plugin-a
-Comment[fa]=متصل‌کننده برای محاوره‌ی امکانات
+Comment[fa]=وصله برای محاورۀ ویژگیها
 Comment[fi]=Lisäosa asetusikkunalle
 Comment[fr]=Module externe pour la boîte de dialogue des propriétés
 Comment[fy]=Plugin foar de 'Eigenskippen'-dialooch
Index: kio/kfile/kicondialog.cpp
===================================================================
--- kio/kfile/kicondialog.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kfile/kicondialog.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,6 +15,8 @@
 
 #include <config.h>
 
+#include <assert.h>
+
 #include <kiconviewsearchline.h>
 
 #include <kapplication.h>
@@ -90,7 +92,6 @@
     : KIconView(parent, name)
 {
     d = new KIconCanvasPrivate;
-    mpLoader = KGlobal::iconLoader();
     mpTimer = new QTimer(this);
     connect(mpTimer, SIGNAL(timeout()), SLOT(slotLoadFiles()));
     connect(this, SIGNAL(currentChanged(QIconViewItem *)),
@@ -325,13 +326,49 @@
     // When pressing Ok or Cancel, stop loading icons
     connect(this, SIGNAL(hidden()), mpCanvas, SLOT(stopLoading()));
 
-    // The order must match the context definitions in KIcon.
-    mpCombo->insertItem(i18n("Actions"));
-    mpCombo->insertItem(i18n("Applications"));
-    mpCombo->insertItem(i18n("Devices"));
-    mpCombo->insertItem(i18n("Filesystems"));
-    mpCombo->insertItem(i18n("Mimetypes"));
+    static const char* const context_text[] = {
+        I18N_NOOP( "Actions" ),
+        I18N_NOOP( "Animations" ),
+        I18N_NOOP( "Applications" ),
+        I18N_NOOP( "Categories" ),
+        I18N_NOOP( "Devices" ),
+        I18N_NOOP( "Emblems" ),
+        I18N_NOOP( "Emotes" ),
+        I18N_NOOP( "Filesystems" ),
+        I18N_NOOP( "International" ),
+        I18N_NOOP( "Mimetypes" ),
+        I18N_NOOP( "Places" ),
+        I18N_NOOP( "Status" ) };
+    static const KIcon::Context context_id[] = {
+        KIcon::Action,
+        KIcon::Animation,
+        KIcon::Application,
+        KIcon::Category,
+        KIcon::Device,
+        KIcon::Emblem,
+        KIcon::Emote,
+        KIcon::FileSystem,
+        KIcon::International,
+        KIcon::MimeType,
+        KIcon::Place,
+        KIcon::StatusIcon };
+    mNumContext = 0;
+    int cnt = sizeof( context_text ) / sizeof( context_text[ 0 ] );
+    // check all 3 arrays have same sizes
+    assert( cnt == sizeof( context_id ) / sizeof( context_id[ 0 ] )
+            && cnt == sizeof( mContextMap ) / sizeof( mContextMap[ 0 ] ));
+    for( int i = 0;
+         i < cnt;
+         ++i )
+    {
+        if( mpLoader->hasContext( context_id[ i ] ))
+        {
+            mpCombo->insertItem(i18n( context_text[ i ] ));
+            mContextMap[ mNumContext++ ] = context_id[ i ];
+        }
+    }
     mpCombo->setFixedSize(mpCombo->sizeHint());
+
     mpBrowseBut->setFixedWidth(mpCombo->width());
 
     // Make the dialog a little taller
@@ -423,8 +460,7 @@
     mpRb2->setChecked(user);
     mpCombo->setEnabled(!user);
     mpBrowseBut->setEnabled(user);
-    mContext = context;
-    mpCombo->setCurrentItem(mContext-1);
+    setContext( context );
 }
 
 void KIconDialog::setup(KIcon::Group group, KIcon::Context context,
@@ -442,8 +478,20 @@
     mpRb2->setEnabled( !lockUser || user );
     mpCombo->setEnabled(!user);
     mpBrowseBut->setEnabled( user && !lockCustomDir );
+    setContext( context );
+}
+
+void KIconDialog::setContext( KIcon::Context context )
+{
     mContext = context;
-    mpCombo->setCurrentItem(mContext-1);
+    for( int i = 0;
+         i < mNumContext;
+         ++i )
+        if( mContextMap[ i ] == context )
+        {
+            mpCombo->setCurrentItem( i );
+            return;
+        }
 }
 
 void KIconDialog::setCustomLocation( const QString& location )
@@ -563,7 +611,7 @@
 
 void KIconDialog::slotContext(int id)
 {
-    mContext = static_cast<KIcon::Context>(id+1);
+    mContext = static_cast<KIcon::Context>( mContextMap[ id ] );
     showIcons();
 }
 
Index: kio/kfile/kfiledialog.cpp
===================================================================
--- kio/kfile/kfiledialog.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kfile/kfiledialog.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1225,7 +1225,10 @@
         return;
     }
 
-//     #warning FIXME: http URLs, e.g. from KURLCombo
+    if (!KProtocolInfo::supportsListing(u)) {
+        locationEdit->lineEdit()->setEdited( true );
+        return;
+    }
 
     /* we strip the first / from the path to avoid file://usr which means
      *  / on host usr
Index: kio/kdatatool.desktop
===================================================================
--- kio/kdatatool.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kdatatool.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Herramienta KDE de datos
 Comment[et]=KDE andmete rakendus
 Comment[eu]=KDEren datuen tresna
-Comment[fa]=ابزار داده‌ی KDE
+Comment[fa]=ابزار داده KDE
 Comment[fi]=KDE:n datatyökalu
 Comment[fr]=Outil de données KDE
 Comment[fy]=KDE data-helpprogramma
Index: kio/misc/kssld/kssld.desktop
===================================================================
--- kio/misc/kssld/kssld.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kssld/kssld.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Name[es]=Módulo de demonio KSSL
 Name[et]=KSSL deemoni moodul
 Name[eu]=KSSL daemon modulua
-Name[fa]=بخش برنامه‌ی KSSL
+Name[fa]=پیمانۀ شبح  KSSL
 Name[fi]=KSSL-palvelinmoduuli
 Name[fr]=Module démon KSSL
 Name[ga]=Modúl Deamhain KSSL
@@ -92,6 +92,7 @@
 Comment[es]=Módulo de demonio KSSL para KDED
 Comment[et]=KDED KSSL deemoni moodul
 Comment[eu]=KSSL daemon modulua KDEDrako
+Comment[fa]=پیمانۀ شبح KSSL برای  KDED
 Comment[fi]=KSSL-palvelinmoduuli KDED:lle
 Comment[fr]=Module démon KSSL pour KDED
 Comment[fy]=KSSL daemon module foar KDED
Index: kio/misc/mms.protocol
===================================================================
--- kio/misc/mms.protocol	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/mms.protocol	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,7 @@
 Description[es]=Protocolo Microsoft Media Server
 Description[et]=Microsoft Media Server protokoll
 Description[eu]=Microsoft Media Server protokoloa
+Description[fa]=قرارداد کارساز رسانۀ میکروسافت
 Description[fi]=Microsoft Media -palvelinprotokolla
 Description[fr]=Protocole Microsoft Media Server
 Description[gl]=Protocolo Microsoft Media Server
Index: kio/misc/kwalletd/kwalletd.desktop
===================================================================
--- kio/misc/kwalletd/kwalletd.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kwalletd/kwalletd.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,7 +24,7 @@
 Name[es]=Módulo de demonio KWallet
 Name[et]=KWalleti deemoni moodul
 Name[eu]=KWallet daemon modulua
-Name[fa]=بخش برنامه‌ی KWallet
+Name[fa]=پیمانه شبح KWallet
 Name[fi]=KWallet-palvelinmoduuli
 Name[fr]=Module démon KWallet
 Name[gl]=Módulo do Demo KWallet
@@ -85,6 +85,7 @@
 Comment[es]=Módulo de demonio KWallet para KDED
 Comment[et]=KDED KWalleti deemoni moodul
 Comment[eu]=KWallet daemon modulua KDEDrako
+Comment[fa]=پیمانۀ شبح KWallet برای KDE
 Comment[fi]=KWallet palvelinmoduuli KDED:lle
 Comment[fr]=Module démon KWallet pour KDED
 Comment[fy]=KWallet daemon module foar KDED
Index: kio/misc/kwalletd/kwalletd.cpp
===================================================================
--- kio/misc/kwalletd/kwalletd.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kwalletd/kwalletd.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -50,10 +50,6 @@
 
 #include <assert.h>
 
-#ifdef Q_WS_X11
-#include <X11/Xlib.h>
-#endif
-
 extern "C" {
    KDE_EXPORT KDEDModule *create_kwalletd(const QCString &name) {
 	   return new KWalletD(name);
@@ -67,6 +63,7 @@
 			tType = Unknown;
 			transaction = 0L;
 			client = 0L;
+			modal = false;
 		}
 
 		~KWalletTransaction() {
@@ -83,6 +80,7 @@
 		QCString appid;
 		uint wId;
 		QString wallet;
+		bool modal;
 };
 
 
@@ -149,7 +147,7 @@
 
 		switch (xact->tType) {
 			case KWalletTransaction::Open:
-				res = doTransactionOpen(xact->appid, xact->wallet, xact->wId);
+				res = doTransactionOpen(xact->appid, xact->wallet, xact->wId, xact->modal);
 				replyType = "int";
 				if (!xact->returnObject.isEmpty()) {
 					DCOPRef(xact->rawappid, xact->returnObject).send("walletOpenResult", res);
@@ -232,6 +230,7 @@
 	DCOPRef(appid, returnObject).send("walletOpenResult", 0);
 
 	QTimer::singleShot(0, this, SLOT(processTransactions()));
+	checkActiveDialog();
 }
 
 
@@ -260,41 +259,59 @@
 	KWalletTransaction *xact = new KWalletTransaction;
 	_transactions.append(xact);
 
-	if (_transactions.count() > 1) {
-		xact->appid = appid;
-		xact->client = callingDcopClient();
-		xact->transaction = xact->client->beginTransaction();
-		xact->wallet = wallet;
-		xact->wId = wId;
-		xact->tType = KWalletTransaction::Open;
-		return 0; // process later
-	}
+	xact->appid = appid;
+	xact->client = callingDcopClient();
+	xact->transaction = xact->client->beginTransaction();
+	xact->wallet = wallet;
+	xact->wId = wId;
+	xact->tType = KWalletTransaction::Open;
+	xact->modal = true; // mark dialogs as modal, the app has blocking wait
+	QTimer::singleShot(0, this, SLOT(processTransactions()));
+	checkActiveDialog();
+	return 0; // process later
+}
 
-	int rc = doTransactionOpen(appid, wallet, wId);
 
-	_transactions.remove(xact);
-
-	if (rc < 0) {
-		// multiple requests from the same client should not produce multiple password dialogs on a failure
-		for (KWalletTransaction *x = _transactions.first(); x; x = _transactions.next()) {
-			if (appid == x->appid && x->tType == KWalletTransaction::Open && x->wallet == wallet && x->wId == wId)
-				x->tType = KWalletTransaction::OpenFail;
-		}
+// Sets up a dialog that will be shown by kwallet.
+void KWalletD::setupDialog( QWidget* dialog, WId wId, const QCString& appid, bool modal ) {
+	if( wId != 0 ) 
+		KWin::setMainWindow( dialog, wId ); // correct, set dialog parent
+	else {
+		if( appid.isEmpty())
+			kdWarning() << "Using kwallet without parent window!" << endl;
+		else
+			kdWarning() << "Application '" << appid << "' using kwallet without parent window!" << endl;
+		// allow dialog activation even if it interrupts, better than trying hacks
+		// with keeping the dialog on top or on all desktops
+		kapp->updateUserTimestamp();
 	}
+	if( modal )
+		KWin::setState( dialog->winId(), NET::Modal );
+	else
+		KWin::clearState( dialog->winId(), NET::Modal );
+	activeDialog = dialog;
+}
 
-	processTransactions();
-
-	return rc;
+// If there's a dialog already open and another application tries some operation that'd lead to
+// opening a dialog, that application will be blocked by this dialog. A proper solution would
+// be to set the second application's window also as a parent for the active dialog, so that
+// KWin properly handles focus changes and so on, but there's currently no support for multiple
+// dialog parents. Hopefully to be done in KDE4, for now just use all kinds of bad hacks to make
+//  sure the user doesn't overlook the active dialog.
+void KWalletD::checkActiveDialog() {
+	if( !activeDialog || !activeDialog->isShown())
+		return;
+	kapp->updateUserTimestamp();
+	KWin::setState( activeDialog->winId(), NET::KeepAbove );
+	KWin::setOnAllDesktops( activeDialog->winId(), true );
+	KWin::forceActiveWindow( activeDialog->winId());
 }
 
-
-int KWalletD::doTransactionOpen(const QCString& appid, const QString& wallet, uint wId) {
+int KWalletD::doTransactionOpen(const QCString& appid, const QString& wallet, uint wId, bool modal) {
 	if (_firstUse && !wallets().contains(KWallet::Wallet::LocalWallet())) {
 		// First use wizard
 		KWalletWizard *wiz = new KWalletWizard(0);
-#ifdef Q_WS_X11
-		XSetTransientForHint(qt_xdisplay(), wiz->winId(), wId);
-#endif
+		setupDialog( wiz, wId, appid, modal );
 		int rc = wiz->exec();
 		if (rc == QDialog::Accepted) {
 			KConfig cfg("kwalletrc");
@@ -334,12 +351,12 @@
 		cfg.sync();
 	}
 
-	int rc = internalOpen(appid, wallet, false, wId);
+	int rc = internalOpen(appid, wallet, false, wId, modal);
 	return rc;
 }
 
 
-int KWalletD::internalOpen(const QCString& appid, const QString& wallet, bool isPath, WId w) {
+int KWalletD::internalOpen(const QCString& appid, const QString& wallet, bool isPath, WId w, bool modal) {
 	int rc = -1;
 	bool brandNew = false;
 
@@ -419,11 +436,7 @@
 		const char *p = 0L;
 		while (!b->isOpen()) {
 			assert(kpd); // kpd can't be null if isOpen() is false
-#ifdef Q_WS_X11
-			XSetTransientForHint(qt_xdisplay(), kpd->winId(), w);
-#endif
-			KWin::setState( kpd->winId(), NET::KeepAbove );
-			KWin::setOnAllDesktops(kpd->winId(), true);
+			setupDialog( kpd, w, appid, modal );
 			if (kpd->exec() == KDialog::Accepted) {
 				p = kpd->password();
 				int rc = b->open(QByteArray().duplicate(p, strlen(p)));
@@ -506,12 +519,7 @@
 		} else {
 			dialog->setLabel(i18n("<qt>The application '<b>%1</b>' has requested access to the open wallet '<b>%2</b>'.").arg(QStyleSheet::escape(QString(appid))).arg(QStyleSheet::escape(wallet)));
 		}
-#ifdef Q_WS_X11
-		XSetTransientForHint(qt_xdisplay(), dialog->winId(), w);
-#endif
-		KWin::setState(dialog->winId(), NET::KeepAbove);
-		KWin::setOnAllDesktops(dialog->winId(), true);
-
+		setupDialog( dialog, w, appid, false );
 		response = dialog->exec();
 		delete dialog;
 	}
@@ -577,6 +585,7 @@
 	_transactions.append(xact);
 
 	QTimer::singleShot(0, this, SLOT(processTransactions()));
+	checkActiveDialog();
 }
 
 
@@ -593,7 +602,7 @@
 	}
 
 	if (!it.current()) {
-		handle = doTransactionOpen(appid, wallet, wId);
+		handle = doTransactionOpen(appid, wallet, wId,false);
 		if (-1 == handle) {
 			KMessageBox::sorryWId(wId, i18n("Unable to open wallet. The wallet must be opened in order to change the password."), i18n("KDE Wallet Service"));
 			return;
@@ -613,9 +622,7 @@
 	kpd->setPrompt(i18n("<qt>Please choose a new password for the wallet '<b>%1</b>'.").arg(QStyleSheet::escape(wallet)));
 	kpd->setCaption(i18n("KDE Wallet Service"));
 	kpd->setAllowEmptyPasswords(true);
-#ifdef Q_WS_X11
-	XSetTransientForHint(qt_xdisplay(), kpd->winId(), wId);
-#endif
+	setupDialog( kpd, wId, appid, false );
 	if (kpd->exec() == KDialog::Accepted) {
 		const char *p = kpd->password();
 		if (p) {
Index: kio/misc/kwalletd/kwalletd.h
===================================================================
--- kio/misc/kwalletd/kwalletd.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kwalletd/kwalletd.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,6 +26,7 @@
 #include <qintdict.h>
 #include <qstring.h>
 #include <qwidget.h>
+#include <qguardedptr.h>
 #include "kwalletbackend.h"
 
 #include <time.h>
@@ -150,7 +151,7 @@
 		void processTransactions();
 
 	private:
-		int internalOpen(const QCString& appid, const QString& wallet, bool isPath = false, WId w = 0);
+		int internalOpen(const QCString& appid, const QString& wallet, bool isPath = false, WId w = 0, bool modal = false);
 		bool isAuthorizedApp(const QCString& appid, const QString& wallet, WId w);
 		// This also validates the handle.  May return NULL.
 		KWallet::Backend* getWallet(const QCString& appid, int handle);
@@ -169,8 +170,11 @@
 		QCString friendlyDCOPPeerName();
 
 		void doTransactionChangePassword(const QCString& appid, const QString& wallet, uint wId);
-		int doTransactionOpen(const QCString& appid, const QString& wallet, uint wId);
+		int doTransactionOpen(const QCString& appid, const QString& wallet, uint wId, bool modal);
 
+		void setupDialog( QWidget* dialog, WId wId, const QCString& appid, bool modal );
+		void checkActiveDialog();
+
 		QIntDict<KWallet::Backend> _wallets;
 		QMap<QCString,QValueList<int> > _handles;
 		QMap<QString,QCString> _passwords;
@@ -184,6 +188,7 @@
 		KTimeout *_timeouts;
 
 		QPtrList<KWalletTransaction> _transactions;
+		QGuardedPtr< QWidget > activeDialog;
 };
 
 
Index: kio/misc/kpac/eventsrc
===================================================================
--- kio/misc/kpac/eventsrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kpac/eventsrc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Configuración automática del Proxy
 Comment[et]=Automaatne proxy konfigureerimine
 Comment[eu]=Proxy-aren konfigurazio automatikoa
-Comment[fa]=تنظیم خودکار پراکسی
+Comment[fa]=پیکربندی خودکار پیشکار
 Comment[fi]=Automaattiset proxy-asetukset
 Comment[fr]=Configuration automatique du proxy
 Comment[fy]=Automatyske proxy ynstelling
@@ -88,7 +88,7 @@
 Name[es]=Procedimiento inválido del proxy
 Name[et]=Vigane proxy skript
 Name[eu]=Proxy-aren script baliogabea
-Name[fa]=نوشتک پراکسی بی‌اعتبار
+Name[fa]=دست‌نوشتۀ پیشکار نامعتبر
 Name[fi]=Virheellinen proxy-skripti
 Name[fr]=Script de proxy non valable
 Name[fy]=Unjildich proxy skript
@@ -154,7 +154,6 @@
 Comment[es]=El procedimiento descargado para la configuración del proxy es inválido
 Comment[et]=Allalaaditud proxy seadistuse skript on vigane
 Comment[eu]=Deskargatutako proxy-aren konfigurazioko script-a baliogabea da
-Comment[fa]=نوشتک تنظیم پراکسی بارگیری شده بی‌اعتبار می‌باشد
 Comment[fi]=Ladattu proxy-asetusskripti on virheellinen
 Comment[fr]=Le script téléchargé de configuration du proxy n'est pas valable
 Comment[fy]=It ynladen proxy ynstellings skript is ûnjildich
@@ -185,7 +184,7 @@
 Comment[ru]=Загруженный скрипт настройки прокси содержит ошибки
 Comment[rw]=inyandikoporogaramu y'iboneza rya Nyabubasha yakuruwe ntiyemewe
 Comment[se]=Viežžojuvvon gaskabálváskripta lea gustomeahttun
-Comment[sk]=Stiahnutý konfiguračný skript proxy nieje správny
+Comment[sk]=Stiahnutý konfiguračný skript proxy nie je správny
 Comment[sl]=Naložen nastavitveni skript posrednika je neveljaven
 Comment[sq]=Skripta për Konfigurimin e Proxy-t ishte e gabuar
 Comment[sr]=Преузета скрипта за подешавање проксија је неисправна
@@ -222,7 +221,7 @@
 Name[es]=Error de descarga del procedimiento
 Name[et]=Viga skripti allalaadimisel
 Name[eu]=Errorea script-a deskargatzean
-Name[fa]=خطای بارگیری نوشتک
+Name[fa]=خطای بارگیری دست‌نوشته
 Name[fi]=Skriptin latausvirhe
 Name[fr]=Erreur de téléchargement du script
 Name[fy]=Skript ynlaad flater
@@ -290,7 +289,6 @@
 Comment[es]=El procedimiento de configuración del proxy no se pudo descargar
 Comment[et]=Proxy seadistuse skripti ei õnnestu alla laadida
 Comment[eu]=Proxy-aren konfigurazioko script-a ezin izan da deskargatu
-Comment[fa]=بارگیری نوشتک تنظیم پراکسی امکان‌پذیر نبود
 Comment[fi]=Proxyn asetusskriptiä ei voitu ladata
 Comment[fr]=Le script de configuration du proxy n'a pas pu être téléchargé
 Comment[fy]=It ynladen fan de proxy ynstellings skript is net slagge
@@ -358,7 +356,7 @@
 Name[es]=Error de evaluación del procedimiento
 Name[et]=Viga skripti käivitamisel
 Name[eu]=Script-aren ebaluazioko errorea
-Name[fa]=خطای ارزیابی نوشتک
+Name[fa]=خطای ارزیابی دست‌نوشته
 Name[fi]=Skriptin määritysvirhe
 Name[fr]=Erreur d'évaluation du script
 Name[fy]=Beoardiele skript flater
@@ -389,6 +387,7 @@
 Name[ro]=Eroare de analiză a scriptului
 Name[ru]=Ошибка разбора скрипта
 Name[rw]=Ikosa ry'isuzuma ry'inyandikoporogaramu
+Name[se]=Meattáhus dulkodettiin skripta
 Name[sk]=Chyba kontroly skriptu
 Name[sl]=Napaka pri ocenjevanju skripta
 Name[sq]=Gabim i vlerësimit të skriptës
@@ -423,7 +422,7 @@
 Comment[es]=Se produjo un error al ejecutarse el procedimiento de configuración del proxy
 Comment[et]=Ilmnes tõsine viga proxy seadistuse skripti käivitamisel
 Comment[eu]=Errorea gertatu da proxy-a konfiguratzeko script-ean
-Comment[fa]=هنگام اجرای نوشتک تنظیم پراکسی خطایی رخ داد
+Comment[fa]=هنگام اجرای دست‌نوشتۀ پیکربندی پیشکار، خطایی وجود داشت
 Comment[fi]=Proxy-skriptin suorittamisessa tapahtui virhe
 Comment[fr]=Une erreur s'est produite lors de l'exécution du script de configuration du proxy
 Comment[fy]=Der wie in flater by it útfoeren fan de proxy ynstellings skript
Index: kio/misc/kpac/proxyscout.desktop
===================================================================
--- kio/misc/kpac/proxyscout.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kpac/proxyscout.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -12,7 +12,7 @@
 Name[el]=Διαμεσολαβητής Scout
 Name[eo]=Prokurilo
 Name[es]=Explorador del proxy
-Name[fa]=پراکسی Scout
+Name[fa]=پیشکار Scout
 Name[fi]=Proxy-tiedustelija
 Name[fy]=Proxy ferkenner
 Name[gl]=Proxy Explorador
@@ -62,6 +62,7 @@
 Comment[es]=Configuración automática del Proxy
 Comment[et]=Automaatne proxy konfigureerimine
 Comment[eu]=Proxy-aren konfigurazio automatikoa
+Comment[fa]=پیکربندی خودکار پیشکار
 Comment[fi]=Automaattiset proxy-asetukset
 Comment[fr]=Configuration automatique du proxy
 Comment[fy]=Automatyske proxy ynstelling
Index: kio/misc/kio_uiserver.desktop
===================================================================
--- kio/misc/kio_uiserver.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/kio_uiserver.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -31,7 +31,7 @@
 Comment[es]=Servidor UI de información de progreso de KDE
 Comment[et]=KDE edenemise info UI server
 Comment[eu]=KDEren aurrerapen-informazioen UI zerbitzaria
-Comment[fa]=کارگزار واسطه‌ی کاریر اطلاعات پیشرفت KDE
+Comment[fa]=اطلاعات پیشرفت کارساز  UI KDE
 Comment[fi]=KDE:n edistymispalkin käyttöliittymäpalvelin
 Comment[fr]=Serveur graphique d'infos de progression de KDE
 Comment[fy]=KDE's tsjinner foar ynformaasje oer de fuortgong
Index: kio/misc/fileshareset
===================================================================
--- kio/misc/fileshareset	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/misc/fileshareset	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -118,7 +118,7 @@
     local ($_) = @_;
     my $ok = 1;
     $ok &&= m|^/|;
-    $ok &&= !m|/../|;
+    $ok &&= !m|/\.\./|;
     $ok &&= !m|[\0\n\r]|;
     $ok &&= -d $_;
     $ok &&= own($_);
Index: kio/tests/ktartest.cpp
===================================================================
--- kio/tests/ktartest.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/tests/ktartest.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -30,7 +30,9 @@
   for( ; it != l.end(); ++it )
   {
     const KTarEntry* entry = dir->entry( (*it) );
-    printf("mode=%07o %s %s %s%s isdir=%d\n", entry->permissions(), entry->user().latin1(), entry->group().latin1(), path.latin1(), (*it).latin1(), entry->isDirectory());
+    printf("mode=%07o %s %s %s%s %d isdir=%d\n", entry->permissions(), entry->user().latin1(), entry->group().latin1(), path.latin1(), (*it).latin1(),
+           entry->isFile() ? static_cast<const KArchiveFile *>(entry)->size() : 0,
+           entry->isDirectory());
     if (entry->isDirectory())
       recursive_print( (KTarDirectory *)entry, path+(*it)+"/" );
   }
Index: kio/tests/dummymeta.desktop
===================================================================
--- kio/tests/dummymeta.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/tests/dummymeta.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -11,7 +11,7 @@
 Name[el]=Εικονικό Meta
 Name[eo]=Stulta Meto
 Name[et]=Dummy meta
-Name[fa]=فوق احمق
+Name[fa]=فرا ساختگی
 Name[fi]=Tyhjä meta
 Name[fr]=Données factices
 Name[ga]=Meitea Caoch
Index: kio/kurifilterplugin.desktop
===================================================================
--- kio/kurifilterplugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kurifilterplugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Plugin de Navegación Mejorada
 Name[et]=Täiustatud brausimise plugin
 Name[eu]=Arakatze plugin hobetua
-Name[fa]=متصل‌کننده‌ی مرور مترقی
+Name[fa]=وصلۀ مرور افزوده
 Name[fi]=Laajennettu selauslisäosa
 Name[fr]=Module externe de navigation avancée
 Name[fy]=Plugin foar effisjinter browsen
Index: kio/kcomprfilter.desktop
===================================================================
--- kio/kcomprfilter.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kcomprfilter.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Name[es]=Filtro de compresión de KDE
 Name[et]=KDE pakkimise filter
 Name[eu]=KDEren konpresio-iragazkia
-Name[fa]=صافی فشرده سازی KDE
+Name[fa]=پالایه فشرده سازی KDE
 Name[fi]=KDE:n pakkaussuodin
 Name[fr]=Filtre de compression de KDE
 Name[fy]=KDE kompresjefilter
Index: kio/data.protocol
===================================================================
--- kio/data.protocol	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/data.protocol	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,6 +17,7 @@
 Description[es]=Un kioslave para datos URIs (rfc2397)
 Description[et]=Andme-URI-de I/O-moodul (rfc2397)
 Description[eu]=Datuen URLen (rfc2397) kioslave-a
+Description[fa]=یک kioslave برای URIهای داده)rfc2397(
 Description[fi]=kioslave data URI:lle (rfc2397)
 Description[fr]=Un module d'entrée / sortie pour les URI de données (rfc2397)
 Description[fy]=In kioslave foar data-URI-adresse (rfc2397)
Index: kio/kcmodule.desktop
===================================================================
--- kio/kcmodule.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kcmodule.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Name[es]=Módulo de control de KDE
 Name[et]=KDE juhtimismoodul
 Name[eu]=KDEren kontrol-modulua
-Name[fa]=بخش کنترل KDE
+Name[fa]=پیمانه کنترل KDE
 Name[fi]=KDE:n ohjausmoduuli
 Name[fr]=Module de configuration de KDE
 Name[fy]=KDE konfiguraasjemodule
Index: kio/application.desktop
===================================================================
--- kio/application.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/application.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Name[es]=Aplicación
 Name[et]=Rakendus
 Name[eu]=Aplikazioa
-Name[fa]=برنامه‌ی کاربردی
+Name[fa]=کاربرد
 Name[fi]=Sovellus
 Name[fy]=Applikaasje
 Name[ga]=Feidhmchlár
Index: kio/kpasswdserver.desktop
===================================================================
--- kio/kpasswdserver.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kpasswdserver.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Módulo de contraseña de KDED
 Name[et]=KDED parooli moodul
 Name[eu]=KDEDren pasahitz-modulua
-Name[fa]=بخش واژه‌ی رمز KDED
+Name[fa]=پیمانۀ اسم رمز KDED
 Name[fi]=KDED-salasanamoduuli
 Name[fr]=Module de mot de passe KDED
 Name[fy]=KDED-wachtwurdmodule
@@ -89,6 +89,7 @@
 Comment[es]=Soporte de caché de contraseñas
 Comment[et]=Parooli meelespidamise toetus
 Comment[eu]=Pasahitzen cachearen euskarria
+Comment[fa]=پشتیبانی از مخفی کردن اسم رمز
 Comment[fi]=Salasanojen välimuistituki
 Comment[fr]=Gestion du cache des mots de passe
 Comment[fy]=Wachtwurd caching stype
Index: kio/kssl/kssl.cc
===================================================================
--- kio/kssl/kssl.cc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kssl/kssl.cc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -129,7 +129,7 @@
 		return false;
 
 	if (m_bAutoReconfig)
-	m_cfg->load();
+		m_cfg->load();
 
 	if (!m_cfg->tlsv1())
 		return false;
@@ -138,6 +138,8 @@
 	d->m_meth = d->kossl->TLSv1_client_method();
 	d->lastInitTLS = true;
 
+	m_pi.reset();
+
 	d->m_ctx = d->kossl->SSL_CTX_new(d->m_meth);
 	if (d->m_ctx == 0L) {
 		return false;
@@ -172,9 +174,11 @@
 
 	m_pi.reset();
 
-	if (m_cfg->sslv2() && !m_cfg->sslv3())
+	if (!m_cfg->tlsv1() && !m_cfg->sslv3() && m_cfg->sslv2())
 		d->m_meth = d->kossl->SSLv2_client_method();
-	else if (m_cfg->sslv3() && !m_cfg->sslv2())
+        else if (m_cfg->tlsv1() && !m_cfg->sslv3() && !m_cfg->sslv2())
+		d->m_meth = d->kossl->TLSv1_client_method();
+	else if (!m_cfg->tlsv1() && m_cfg->sslv3() && !m_cfg->sslv2())
 		d->m_meth = d->kossl->SSLv3_client_method();
 	else d->m_meth = d->kossl->SSLv23_client_method();
 
@@ -304,10 +308,15 @@
 	}
 */
 
-	if (!d->lastInitTLS)
-		d->kossl->SSL_set_options(d->m_ssl, SSL_OP_NO_TLSv1);
+	int off = SSL_OP_ALL;
+	if (!d->lastInitTLS && !m_cfg->tlsv1())
+		off |= SSL_OP_NO_TLSv1;
+	if (!m_cfg->sslv3())
+		off |= SSL_OP_NO_SSLv3;
+	if (!m_cfg->sslv2())
+		off |= SSL_OP_NO_SSLv2;
 
-	d->kossl->SSL_set_options(d->m_ssl, SSL_OP_ALL);
+	d->kossl->SSL_set_options(d->m_ssl, off);
 
 	rc = d->kossl->SSL_set_fd(d->m_ssl, sock);
 	if (rc == 0) {
@@ -390,10 +399,15 @@
 	}
 */
 
-	if (!d->lastInitTLS)
-		d->kossl->SSL_set_options(d->m_ssl, SSL_OP_NO_TLSv1);
+	int off = SSL_OP_ALL;
+	if (!d->lastInitTLS && !m_cfg->tlsv1())
+		off |= SSL_OP_NO_TLSv1;
+	if (!m_cfg->sslv3())
+		off |= SSL_OP_NO_SSLv3;
+	if (!m_cfg->sslv2())
+		off |= SSL_OP_NO_SSLv2;
 
-	d->kossl->SSL_set_options(d->m_ssl, SSL_OP_ALL);
+	d->kossl->SSL_set_options(d->m_ssl, off);
 
 	rc = d->kossl->SSL_set_fd(d->m_ssl, sock);
 	if (rc == 0) {
@@ -499,6 +513,7 @@
 		if (err != SSL_ERROR_NONE &&
 		    err != SSL_ERROR_ZERO_RETURN && err != SSL_ERROR_SYSCALL) {
 			rc = -1;      // OpenSSL returns 0 on error too
+			d->kossl->ERR_print_errors_fp(stderr);
 		}
 
 //		else if (err == SSL_ERROR_ZERO_RETURN)
Index: kio/kssl/kssl/caroot/ca-bundle.crt
===================================================================
--- kio/kssl/kssl/caroot/ca-bundle.crt	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kssl/kssl/caroot/ca-bundle.crt	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2591,3 +2591,38 @@
 00UOpO6wNnQt8M2YI3s3S9r+UZjEHjQ8iP2ZO1CnwYszx8JSFhKVU2Ui77qLzmLb
 cCOxgN8aIDjnfg==
 -----END CERTIFICATE-----
+
+-----BEGIN CERTIFICATE-----
+MIIF0DCCBLigAwIBAgIEOrZQizANBgkqhkiG9w0BAQUFADB/MQswCQYDVQQGEwJC
+TTEZMBcGA1UEChMQUXVvVmFkaXMgTGltaXRlZDElMCMGA1UECxMcUm9vdCBDZXJ0
+aWZpY2F0aW9uIEF1dGhvcml0eTEuMCwGA1UEAxMlUXVvVmFkaXMgUm9vdCBDZXJ0
+aWZpY2F0aW9uIEF1dGhvcml0eTAeFw0wMTAzMTkxODMzMzNaFw0yMTAzMTcxODMz
+MzNaMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1pdGVkMSUw
+IwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYDVQQDEyVR
+dW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MIIBIjANBgkqhkiG
+9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv2G1lVO6V/z68mcLOhrfEYBklbTRvM16z/Yp
+li4kVEAkOPcahdxYTMukJ0KX0J+DisPkBgNbAKVRHnAEdOLB1Dqr1607BxgFjv2D
+rOpm2RgbaIr1VxqYuvXtdj182d6UajtLF8HVj71lODqV0D1VNk7feVcxKh7YWWVJ
+WCCYfqtffp/p1k3sg3Spx2zY7ilKhSoGFPlU5tPaZQeLYzcS19Dsw3sgQUSj7cug
+F+FxZc4dZjH3dgEZyH0DWLaVSR2mEiboxgx24ONmy+pdpibu5cxfvWenAScOospU
+xbF6lR1xHkopigPcakXBpBlebzbNw6Kwt/5cOOJSvPhEQ+aQuwIDAQABo4ICUjCC
+Ak4wPQYIKwYBBQUHAQEEMTAvMC0GCCsGAQUFBzABhiFodHRwczovL29jc3AucXVv
+dmFkaXNvZmZzaG9yZS5jb20wDwYDVR0TAQH/BAUwAwEB/zCCARoGA1UdIASCAREw
+ggENMIIBCQYJKwYBBAG+WAABMIH7MIHUBggrBgEFBQcCAjCBxxqBxFJlbGlhbmNl
+IG9uIHRoZSBRdW9WYWRpcyBSb290IENlcnRpZmljYXRlIGJ5IGFueSBwYXJ0eSBh
+c3N1bWVzIGFjY2VwdGFuY2Ugb2YgdGhlIHRoZW4gYXBwbGljYWJsZSBzdGFuZGFy
+ZCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBvZiB1c2UsIGNlcnRpZmljYXRpb24gcHJh
+Y3RpY2VzLCBhbmQgdGhlIFF1b1ZhZGlzIENlcnRpZmljYXRlIFBvbGljeS4wIgYI
+KwYBBQUHAgEWFmh0dHA6Ly93d3cucXVvdmFkaXMuYm0wHQYDVR0OBBYEFItLbe3T
+KbkGGew5Oanwl4Rqy+/fMIGuBgNVHSMEgaYwgaOAFItLbe3TKbkGGew5Oanwl4Rq
+y+/foYGEpIGBMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1p
+dGVkMSUwIwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYD
+VQQDEyVRdW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5ggQ6tlCL
+MA4GA1UdDwEB/wQEAwIBBjANBgkqhkiG9w0BAQUFAAOCAQEAitQUtf70mpKnGdSk
+fnIYj9lofFIk3WdvOXrEql494liwTXCYhGHoG+NpGA7O+0dQoE7/8CQfvbLO9Sf8
+7C9TqnN7Az10buYWnuulLsS/VidQK2K6vkscPFVcQR0kvoIgR13VRH56FmjffU1R
+cHhXHTMe/QKZnAzNCgVPx7uOpHX6Sm2xgI4JVrmcGmD+XcHXetwReNDWXcG31a0y
+mQM6isxUJTkxgXsTIlG6Rmyhu576BGxJJnSP0nPrzDCi5upZIof4l/UO/erMkqQW
+xFIY6iHOsfHmhIHluqmGKPJDWl0Snawe2ajlCmqnf6CHKc/yiU3U7MXi5nrQNiOK
+SnQ2+Q==
+-----END CERTIFICATE-----
Index: kio/kssl/kssl/localcerts
===================================================================
--- kio/kssl/kssl/localcerts	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kssl/kssl/localcerts	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -32,3 +32,5 @@
 geotrust-global-2.pem
 GeoTrust_Universal_CA.pem
 GeoTrust_Universal_CA2.pem
+quovadis.pem
+startcom.pem
Index: kio/kssl/kssl/quovadis.pem
===================================================================
--- kio/kssl/kssl/quovadis.pem	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ kio/kssl/kssl/quovadis.pem	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,34 @@
+-----BEGIN CERTIFICATE-----
+MIIF0DCCBLigAwIBAgIEOrZQizANBgkqhkiG9w0BAQUFADB/MQswCQYDVQQGEwJC
+TTEZMBcGA1UEChMQUXVvVmFkaXMgTGltaXRlZDElMCMGA1UECxMcUm9vdCBDZXJ0
+aWZpY2F0aW9uIEF1dGhvcml0eTEuMCwGA1UEAxMlUXVvVmFkaXMgUm9vdCBDZXJ0
+aWZpY2F0aW9uIEF1dGhvcml0eTAeFw0wMTAzMTkxODMzMzNaFw0yMTAzMTcxODMz
+MzNaMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1pdGVkMSUw
+IwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYDVQQDEyVR
+dW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MIIBIjANBgkqhkiG
+9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv2G1lVO6V/z68mcLOhrfEYBklbTRvM16z/Yp
+li4kVEAkOPcahdxYTMukJ0KX0J+DisPkBgNbAKVRHnAEdOLB1Dqr1607BxgFjv2D
+rOpm2RgbaIr1VxqYuvXtdj182d6UajtLF8HVj71lODqV0D1VNk7feVcxKh7YWWVJ
+WCCYfqtffp/p1k3sg3Spx2zY7ilKhSoGFPlU5tPaZQeLYzcS19Dsw3sgQUSj7cug
+F+FxZc4dZjH3dgEZyH0DWLaVSR2mEiboxgx24ONmy+pdpibu5cxfvWenAScOospU
+xbF6lR1xHkopigPcakXBpBlebzbNw6Kwt/5cOOJSvPhEQ+aQuwIDAQABo4ICUjCC
+Ak4wPQYIKwYBBQUHAQEEMTAvMC0GCCsGAQUFBzABhiFodHRwczovL29jc3AucXVv
+dmFkaXNvZmZzaG9yZS5jb20wDwYDVR0TAQH/BAUwAwEB/zCCARoGA1UdIASCAREw
+ggENMIIBCQYJKwYBBAG+WAABMIH7MIHUBggrBgEFBQcCAjCBxxqBxFJlbGlhbmNl
+IG9uIHRoZSBRdW9WYWRpcyBSb290IENlcnRpZmljYXRlIGJ5IGFueSBwYXJ0eSBh
+c3N1bWVzIGFjY2VwdGFuY2Ugb2YgdGhlIHRoZW4gYXBwbGljYWJsZSBzdGFuZGFy
+ZCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBvZiB1c2UsIGNlcnRpZmljYXRpb24gcHJh
+Y3RpY2VzLCBhbmQgdGhlIFF1b1ZhZGlzIENlcnRpZmljYXRlIFBvbGljeS4wIgYI
+KwYBBQUHAgEWFmh0dHA6Ly93d3cucXVvdmFkaXMuYm0wHQYDVR0OBBYEFItLbe3T
+KbkGGew5Oanwl4Rqy+/fMIGuBgNVHSMEgaYwgaOAFItLbe3TKbkGGew5Oanwl4Rq
+y+/foYGEpIGBMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1p
+dGVkMSUwIwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYD
+VQQDEyVRdW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5ggQ6tlCL
+MA4GA1UdDwEB/wQEAwIBBjANBgkqhkiG9w0BAQUFAAOCAQEAitQUtf70mpKnGdSk
+fnIYj9lofFIk3WdvOXrEql494liwTXCYhGHoG+NpGA7O+0dQoE7/8CQfvbLO9Sf8
+7C9TqnN7Az10buYWnuulLsS/VidQK2K6vkscPFVcQR0kvoIgR13VRH56FmjffU1R
+cHhXHTMe/QKZnAzNCgVPx7uOpHX6Sm2xgI4JVrmcGmD+XcHXetwReNDWXcG31a0y
+mQM6isxUJTkxgXsTIlG6Rmyhu576BGxJJnSP0nPrzDCi5upZIof4l/UO/erMkqQW
+xFIY6iHOsfHmhIHluqmGKPJDWl0Snawe2ajlCmqnf6CHKc/yiU3U7MXi5nrQNiOK
+SnQ2+Q==
+-----END CERTIFICATE-----
Index: kio/kssl/kssl/ksslcalist
===================================================================
--- kio/kssl/kssl/ksslcalist	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kio/kssl/kssl/ksslcalist	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -713,3 +713,9 @@
 site=true
 email=true
 code=false
+
+[/C=BM/O=QuoVadis Limited/OU=Root Certification Authority/CN=QuoVadis Root Certification Authority]
+x509=MIIF0DCCBLigAwIBAgIEOrZQizANBgkqhkiG9w0BAQUFADB/MQswCQYDVQQGEwJCTTEZMBcGA1UEChMQUXVvVmFkaXMgTGltaXRlZDElMCMGA1UECxMcUm9vdCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEuMCwGA1UEAxMlUXVvVmFkaXMgUm9vdCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTAeFw0wMTAzMTkxODMzMzNaFw0yMTAzMTcxODMzMzNaMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1pdGVkMSUwIwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYDVQQDEyVRdW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv2G1lVO6V/z68mcLOhrfEYBklbTRvM16z/Ypli4kVEAkOPcahdxYTMukJ0KX0J+DisPkBgNbAKVRHnAEdOLB1Dqr1607BxgFjv2DrOpm2RgbaIr1VxqYuvXtdj182d6UajtLF8HVj71lODqV0D1VNk7feVcxKh7YWWVJWCCYfqtffp/p1k3sg3Spx2zY7ilKhSoGFPlU5tPaZQeLYzcS19Dsw3sgQUSj7cugF+FxZc4dZjH3dgEZyH0DWLaVSR2mEiboxgx24ONmy+pdpibu5cxfvWenAScOospUxbF6lR1xHkopigPcakXBpBlebzbNw6Kwt/5cOOJSvPhEQ+aQuwIDAQABo4ICUjCCAk4wPQYIKwYBBQUHAQEEMTAvMC0GCCsGAQUFBzABhiFodHRwczovL29jc3AucXVvdmFkaXNvZmZzaG9yZS5jb20wDwYDVR0TAQH/BAUwAwEB/zCCARoGA1UdIASCAREwggENMIIBCQYJKwYBBAG+WAABMIH7MIHUBggrBgEFBQcCAjCBxxqBxFJlbGlhbmNlIG9uIHRoZSBRdW9WYWRpcyBSb290IENlcnRpZmljYXRlIGJ5IGFueSBwYXJ0eSBhc3N1bWVzIGFjY2VwdGFuY2Ugb2YgdGhlIHRoZW4gYXBwbGljYWJsZSBzdGFuZGFyZCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBvZiB1c2UsIGNlcnRpZmljYXRpb24gcHJhY3RpY2VzLCBhbmQgdGhlIFF1b1ZhZGlzIENlcnRpZmljYXRlIFBvbGljeS4wIgYIKwYBBQUHAgEWFmh0dHA6Ly93d3cucXVvdmFkaXMuYm0wHQYDVR0OBBYEFItLbe3TKbkGGew5Oanwl4Rqy+/fMIGuBgNVHSMEgaYwgaOAFItLbe3TKbkGGew5Oanwl4Rqy+/foYGEpIGBMH8xCzAJBgNVBAYTAkJNMRkwFwYDVQQKExBRdW9WYWRpcyBMaW1pdGVkMSUwIwYDVQQLExxSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MS4wLAYDVQQDEyVRdW9WYWRpcyBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5ggQ6tlCLMA4GA1UdDwEB/wQEAwIBBjANBgkqhkiG9w0BAQUFAAOCAQEAitQUtf70mpKnGdSkfnIYj9lofFIk3WdvOXrEql494liwTXCYhGHoG+NpGA7O+0dQoE7/8CQfvbLO9Sf87C9TqnN7Az10buYWnuulLsS/VidQK2K6vkscPFVcQR0kvoIgR13VRH56FmjffU1RcHhXHTMe/QKZnAzNCgVPx7uOpHX6Sm2xgI4JVrmcGmD+XcHXetwReNDWXcG31a0ymQM6isxUJTkxgXsTIlG6Rmyhu576BGxJJnSP0nPrzDCi5upZIof4l/UO/erMkqQWxFIY6iHOsfHmhIHluqmGKPJDWl0Snawe2ajlCmqnf6CHKc/yiU3U7MXi5nrQNiOKSnQ2+Q==
+site=true
+email=true
+code=false
Index: kstyles/riscos/riscos.themerc
===================================================================
--- kstyles/riscos/riscos.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/riscos/riscos.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -234,7 +234,7 @@
 Name[de]=RISC-OS
 Name[eo]=Risc-OS
 Name[eu]=RISC SE
-Name[fa]=RISC سیستم‌عامل
+Name[fa]=سیستم عامل RISC
 Name[hi]=रिस्क ओएस(RISC OS)
 Name[ko]=리스크 OS
 Name[mn]=RISC-OS
@@ -264,7 +264,7 @@
 Comment[es]=Tema tipo RISC OS
 Comment[et]=RISC OS-laadne teema
 Comment[eu]=RISC SEen antzeko gaia
-Comment[fa]=طرح شبیه سیستم عامل RISC
+Comment[fa]=چهرۀ شبیه RISC سیستم عامل
 Comment[fi]=RISC OS:n kaltainen tyyli
 Comment[fr]=Thème similaire à RISC OS
 Comment[fy]=RISC OS-eftich tema
Index: kstyles/themes/light-v2.themerc
===================================================================
--- kstyles/themes/light-v2.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/light-v2.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Name[es]=Estilo ligero, 2nda revisión
 Name[et]=Light Style, 2. versioon
 Name[eu]=Argi-estiloa, 2. berrikuspena
-Name[fa]=سبک نور، نسخه‌ی دوم
+Name[fa]=سبک نور، دومین بازبینی
 Name[fi]=Light Style, toinen versio
 Name[fr]=Style lumière, 2ème version
 Name[fy]=Light Style, 2e revyzje
@@ -87,7 +87,7 @@
 Comment[es]=Segunda revisión del elegante estilo de widgets 'Ligero'.
 Comment[et]=Lihtsa ja elegantse 'Light' stiili teine versioon
 Comment[eu]='Argi' trepetaren estilo sinple eta dotorearen 2. berrikuspena.
-Comment[fa]=انتشار دوم سبک تکه‌ی ساده و زیبای 'نور'.
+Comment[fa]=دومین بازبینی سبک عنصر ساده و زیبای نور
 Comment[fi]=Toinen versio yksinkertaisesta ja elegantista Light-tyylistä
 Comment[fr]=Deuxième version du style graphique « Lumière », simple et élégant.
 Comment[fy]=Twadde revyzje fan de ienfâldige en elegante widgetstyl 'Light'
Index: kstyles/themes/light-v3.themerc
===================================================================
--- kstyles/themes/light-v3.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/light-v3.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Name[es]=Estilo Ligero, 3era revisión
 Name[et]=Light Style, 3. versioon
 Name[eu]=Argi-estiloa, 3. berrikuspena
-Name[fa]=سبک نور، نسخه‌ی سوم
+Name[fa]=سبک نور، سومین بازبینی
 Name[fi]=Light-tyyli, kolmas versio
 Name[fr]=Style lumière, 3ème version
 Name[fy]=Light Style, 3e revyzje
@@ -87,7 +87,7 @@
 Comment[es]=Tercera revisión del elegante estilo de widgets 'Ligero'.
 Comment[et]=Lihtsa ja elegantse 'Light' stiili kolmas versioon
 Comment[eu]='Argi' trepetaren estilo sinple eta dotorearen 3. berrikuspena.
-Comment[fa]=انتشار سوم سبک تکه‌ی ساده و زیبای 'نور'.
+Comment[fa]=سومین بازبینی سبک عنصر ساده و زیبای نور
 Comment[fi]=Kolmas versio yksinkertaisesta ja elegantista Light-tyylistä
 Comment[fr]=Troisième version du style graphique « Lumière », simple et élégant.
 Comment[fy]=Tredde revyzje fan de ienfâldige en elegante widgetstyl 'Light'
Index: kstyles/themes/qtplatinum.themerc
===================================================================
--- kstyles/themes/qtplatinum.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/qtplatinum.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -4,7 +4,7 @@
 Name[bn]=প্ল্যাটিনাম
 Name[cy]=Platinwm
 Name[eo]=Plateno
-Name[fa]=پلاتینوم
+Name[fa]=پلاتین
 Name[hi]=प्लेटिनम
 Name[is]=Platínum
 Name[it]=Platino
@@ -40,7 +40,7 @@
 Comment[es]=Estilo incorporado Platinum sin tema
 Comment[et]=Qt Platinum teemata stiil
 Comment[eu]=Gairik gabeko Platinum estiloa
-Comment[fa]=سبک پلاتینم بدون طرح توکار
+Comment[fa]=سبک پلاتین بدون چهره توکار
 Comment[fi]=Sisäänrakennettu teemoittamaton Platinium-tyyli
 Comment[fr]=Style Platinum d'origine sans thème
 Comment[fy]=Ynboude, temaleaze Platinum-styl
Index: kstyles/themes/qtwindows.themerc
===================================================================
--- kstyles/themes/qtwindows.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/qtwindows.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2,7 +2,6 @@
 Name=MS Windows 9x
 Name[bn]=এম-এস উইন্ডোস ৯x
 Name[eo]=Vindozo 9x
-Name[fa]=مایکروسافت ویندوز 9x
 Name[gl]=MS Windows 8x
 Name[hi]=एमएस विंडोज़ 9x
 Name[ko]=MS 윈도우즈 9x
@@ -29,7 +28,7 @@
 Comment[es]=Estilo incorporado Windows 9x sin tema
 Comment[et]=Qt Windows9x-laadne teemata stiil
 Comment[eu]=Gairik gabeko Windows 9x estiloa
-Comment[fa]=سبک ویندوز ۹x بدون طرح توکار
+Comment[fa]=سبک ویندوز 9x بدون چهره توکار 
 Comment[fi]=Sisäänrakennettu teemoittamaton Windows 9x-tyyli
 Comment[fr]=Style Windows 9x d'origine sans thème
 Comment[fy]=Ynboude, temaleaze Windows 9x-styl
Index: kstyles/themes/qtcde.themerc
===================================================================
--- kstyles/themes/qtcde.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/qtcde.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Estilo incorporado CDE sin tema
 Comment[et]=Qt CDE-laadne teemata stiil
 Comment[eu]=Gairik gabeko CDE estiloa
-Comment[fa]=سبک CDE بدون طرح توکار
+Comment[fa]=سبک CDE بدون چهرۀ توکار
 Comment[fi]=Sisäänrakennettu teemoittamaton CDE-tyyli
 Comment[fr]=Style CDE d'origine sans thème
 Comment[fy]=Ynboude, temaleaze CDE-styl
Index: kstyles/themes/b3.themerc
===================================================================
--- kstyles/themes/b3.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/b3.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -23,7 +23,7 @@
 Comment[es]=B3/Modificación de B2
 Comment[et]=B3 - muudatustega B2
 Comment[eu]=B3/ B2 eraldatua
-Comment[fa]=B3/تغییرات B2
+Comment[fa]=B3/اصلاح B2
 Comment[fi]=B3/Muokattu B2
 Comment[fr]=B3 / Modification de B2
 Comment[fy]=B3/modifikaasje fan B2
Index: kstyles/themes/mega.themerc
===================================================================
--- kstyles/themes/mega.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/mega.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -13,7 +13,7 @@
 Name[es]=Estilo MegaDegradado de alta profundidad
 Name[et]=MegaGradient paljuvärviline stiil
 Name[eu]=MegaGradient kolore askodun estiloa
-Name[fa]=سبک رنگ‌بالا‌ی کلان‌شیب
+Name[fa]=سبک رنگ  بالای مگا گرادینت
 Name[fi]=MegaGradient-monivärityyli
 Name[fr]=Style MégaGradient très coloré
 Name[fy]=MegaGradiënt hege-kleurenstyl
Index: kstyles/themes/highcolor.themerc
===================================================================
--- kstyles/themes/highcolor.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/highcolor.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Name[es]=Alta profundidad de color clásico
 Name[et]=Paljuvärviline vaikestiil
 Name[eu]=Kolore askodun klasikoa
-Name[fa]=رنگ‌بالا‌ی کلاسیک
+Name[fa]=رنگ بالای کلاسیک
 Name[fi]=Monivärinen klassikkotyyli
 Name[fr]=Style très coloré classique
 Name[fy]=Klassyke Hege Kleuren
@@ -82,7 +82,7 @@
 Comment[es]=Versión de alta profundidad de color del estilo clásico
 Comment[et]=Vaikestiili paljuvärviline versioon
 Comment[eu]=Estilo klasikoaren kolore askodun bertsioa
-Comment[fa]=نسخه‌ی رنگ‌بالای سبک کلاسیک
+Comment[fa]=نسخۀ رنگ بالای سبک کلاسیک
 Comment[fi]=Monivärinen versio klassikkotyylistä
 Comment[fr]=Version très colorée du style classique
 Comment[fy]=Hege kleuren ferzje fan de klassyke styl
Index: kstyles/themes/qtmotif.themerc
===================================================================
--- kstyles/themes/qtmotif.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/qtmotif.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,7 +26,7 @@
 Comment[es]=Estilo incorporado Motif sin tema
 Comment[et]=Qt Motif'i-laadne teemata stiil
 Comment[eu]=Gairik gabeko Motif estiloa
-Comment[fa]=سبک موتیف بدون طرح توکار
+Comment[fa]=سبک موتیف بدون چهرۀ توکار
 Comment[fi]=Sisäänrakennettu teemoittamaton Motif-tyyli
 Comment[fr]=Style Motif d'origine sans thème
 Comment[fy]=Ynboude, temaleaze Motif-styl
Index: kstyles/themes/keramik.themerc
===================================================================
--- kstyles/themes/keramik.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/keramik.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -37,6 +37,7 @@
 Comment[es]=Un estilo que utiliza mezcla alfa
 Comment[et]=Alfablendingut kasutav stiil
 Comment[eu]=Alfa kanala darabilen estilo lehenetsia
+Comment[fa]=یک سبک با استفاده از alphablending
 Comment[fi]=Alphasekoitusta käyttävä tyyli
 Comment[fr]=Un style utilisant l'alpha-blending
 Comment[fy]=In styl dy brûk makket fan alfaminging
Index: kstyles/themes/kstep.themerc
===================================================================
--- kstyles/themes/kstep.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/kstep.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -5,7 +5,7 @@
 Name[bn]=কে.ডি.ই. স্টেপ
 Name[de]=KDE-Step
 Name[eo]=KDE-Step
-Name[fa]=مرحله‌ی KDE
+Name[fa]=گام KDE
 Name[hi]=केडीई स्टेप
 Name[is]=KDE-step
 Name[ko]=KDE 스텝
@@ -41,7 +41,7 @@
 Comment[es]=Estilo tipo NeXT sin tema
 Comment[et]=NeXT'i-laadne teemata stiil
 Comment[eu]=Gairik gabeko Next estiloa
-Comment[fa]=سبک شبیه Next بدون طرح
+Comment[fa]=سبک مشابه بعدی بدون چهره
 Comment[fi]=Teemoittamaton Next:n kaltainen tyyli
 Comment[fr]=Style sans thème similaire à NeXT
 Comment[fy]=Temaleaze Next-styl
Index: kstyles/themes/qtmotifplus.themerc
===================================================================
--- kstyles/themes/qtmotifplus.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/qtmotifplus.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -33,7 +33,7 @@
 Comment[es]=Estilo incorporado Motif mejorado
 Comment[et]=Qt täiustatud Motif'i-laadne stiil
 Comment[eu]=Gairik gabeko Motif estilo hobetua
-Comment[fa]=سبک موتیف مترقی توکار
+Comment[fa]=سبک موتیف افزوده  توکار
 Comment[fi]=Sisäänrakennettu paranneltu Motif-tyyli
 Comment[fr]=Style Motif amélioré d'origine
 Comment[fy]=Ynboude, ferbettere Motif-styl
Index: kstyles/themes/beos.themerc
===================================================================
--- kstyles/themes/beos.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/themes/beos.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Estilo tipo BeOS sin tema
 Comment[et]=BeOS'i-laadne teemata stiil
 Comment[eu]=Gairik gabeko BeOS estiloa
-Comment[fa]=سبک شبیه Beos بدون طرح
+Comment[fa]=سبک شبیه BeOS بدون چهره
 Comment[fi]=Teemoittamaton BeOS:n kaltainen tyyli
 Comment[fr]=Style sans thème similaire à BeOS
 Comment[fy]=Temaleaze BeOs eftich slyl 
Index: kstyles/plastik/plastik.cpp
===================================================================
--- kstyles/plastik/plastik.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/plastik/plastik.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -159,8 +159,6 @@
     hoverWidget = 0;
     hoverTab = 0;
 
-    horizontalDots = 0;
-    verticalDots = 0;
 
     horizontalLine = 0;
     verticalLine = 0;
@@ -225,8 +223,6 @@
 PlastikStyle::~PlastikStyle()
 {
     delete pixmapCache;
-    delete horizontalDots;
-    delete verticalDots;
     delete horizontalLine;
     delete verticalLine;
 }
Index: kstyles/plastik/plastik.h
===================================================================
--- kstyles/plastik/plastik.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/plastik/plastik.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -351,10 +351,6 @@
     };
     QIntCache<CacheEntry> *pixmapCache;
     
-    // For renderFocusRect
-    mutable QBitmap *verticalDots;
-    mutable QBitmap *horizontalDots;
-
     // For KPE_ListViewBranch
     mutable QBitmap *verticalLine;
     mutable QBitmap *horizontalLine;
Index: kstyles/plastik/plastik.themerc
===================================================================
--- kstyles/plastik/plastik.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/plastik/plastik.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2,6 +2,7 @@
 Name=Plastik
 Name[af]=Plastiek
 Name[bn]=প্লাস্টিক
+Name[fa]=پلاستیک
 Name[he]=פלסטיק
 Name[hi]=प्लास्टिक
 Name[is]=Plast
@@ -35,6 +36,7 @@
 Comment[es]=Un estilo sencillo y terso
 Comment[et]=Lihtne ja klaar stiil
 Comment[eu]=Estilo xehe eta gardena
+Comment[fa]=یک سبک ساده و تمیز
 Comment[fi]=Yksinkertainen ja siisti tyyli
 Comment[fr]=Un style simple et propre
 Comment[fy]=In ienfâldich en skjinne styl
Index: kstyles/highcontrast/highcontrast.themerc
===================================================================
--- kstyles/highcontrast/highcontrast.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/highcontrast/highcontrast.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -11,6 +11,7 @@
 Name[es]=ContrasteAlto
 Name[et]=Tugev kontrast
 Name[eu]=Kontraste handia
+Name[fa]=سایه‌روشن بالا
 Name[fi]=KorkeaKontrasti
 Name[fr]=Contraste fort
 Name[fy]=Heechkontrast
@@ -63,6 +64,7 @@
 Comment[es]=Un estilo que funciona con esquemas de color de contraste alto
 Comment[et]=Stiil, mis sobib hästi tugeva kontrastiga värviskeemidele
 Comment[eu]=Kontraste handiko gaiekin ongi moldatzen den estiloa
+Comment[fa]=سبکی که به خوبی با طرحهای رنگ، با سایه‌روشن بالا کار می‌کند 
 Comment[fi]=Tyyli joka toimii hyvin korkeakontrastisien väriteemojen kanssa
 Comment[fr]=Un style se combinant bien avec les modèles de couleurs à fort contraste
 Comment[fy]=In styl dy goed wurket mei hege kontrast kleureskema’s
Index: kstyles/web/web.themerc
===================================================================
--- kstyles/web/web.themerc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kstyles/web/web.themerc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -90,7 +90,7 @@
 Comment[es]=Estilo objeto visual Web
 Comment[et]=Veebi elementide sarnane stiil
 Comment[eu]=Web trepetaren estiloa
-Comment[fa]=سبک تکه وب
+Comment[fa]=سبک عنصر وب
 Comment[fi]=Web-tyyli
 Comment[fr]=Style web
 Comment[fy]=Web-widgetstyl
Index: COPYING-DOCS
===================================================================
--- COPYING-DOCS	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ COPYING-DOCS	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,397 @@
+		GNU Free Documentation License
+		  Version 1.2, November 2002
+
+
+ Copyright (C) 2000,2001,2002  Free Software Foundation, Inc.
+     51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+
+0. PREAMBLE
+
+The purpose of this License is to make a manual, textbook, or other
+functional and useful document "free" in the sense of freedom: to
+assure everyone the effective freedom to copy and redistribute it,
+with or without modifying it, either commercially or noncommercially.
+Secondarily, this License preserves for the author and publisher a way
+to get credit for their work, while not being considered responsible
+for modifications made by others.
+
+This License is a kind of "copyleft", which means that derivative
+works of the document must themselves be free in the same sense.  It
+complements the GNU General Public License, which is a copyleft
+license designed for free software.
+
+We have designed this License in order to use it for manuals for free
+software, because free software needs free documentation: a free
+program should come with manuals providing the same freedoms that the
+software does.  But this License is not limited to software manuals;
+it can be used for any textual work, regardless of subject matter or
+whether it is published as a printed book.  We recommend this License
+principally for works whose purpose is instruction or reference.
+
+
+1. APPLICABILITY AND DEFINITIONS
+
+This License applies to any manual or other work, in any medium, that
+contains a notice placed by the copyright holder saying it can be
+distributed under the terms of this License.  Such a notice grants a
+world-wide, royalty-free license, unlimited in duration, to use that
+work under the conditions stated herein.  The "Document", below,
+refers to any such manual or work.  Any member of the public is a
+licensee, and is addressed as "you".  You accept the license if you
+copy, modify or distribute the work in a way requiring permission
+under copyright law.
+
+A "Modified Version" of the Document means any work containing the
+Document or a portion of it, either copied verbatim, or with
+modifications and/or translated into another language.
+
+A "Secondary Section" is a named appendix or a front-matter section of
+the Document that deals exclusively with the relationship of the
+publishers or authors of the Document to the Document's overall subject
+(or to related matters) and contains nothing that could fall directly
+within that overall subject.  (Thus, if the Document is in part a
+textbook of mathematics, a Secondary Section may not explain any
+mathematics.)  The relationship could be a matter of historical
+connection with the subject or with related matters, or of legal,
+commercial, philosophical, ethical or political position regarding
+them.
+
+The "Invariant Sections" are certain Secondary Sections whose titles
+are designated, as being those of Invariant Sections, in the notice
+that says that the Document is released under this License.  If a
+section does not fit the above definition of Secondary then it is not
+allowed to be designated as Invariant.  The Document may contain zero
+Invariant Sections.  If the Document does not identify any Invariant
+Sections then there are none.
+
+The "Cover Texts" are certain short passages of text that are listed,
+as Front-Cover Texts or Back-Cover Texts, in the notice that says that
+the Document is released under this License.  A Front-Cover Text may
+be at most 5 words, and a Back-Cover Text may be at most 25 words.
+
+A "Transparent" copy of the Document means a machine-readable copy,
+represented in a format whose specification is available to the
+general public, that is suitable for revising the document
+straightforwardly with generic text editors or (for images composed of
+pixels) generic paint programs or (for drawings) some widely available
+drawing editor, and that is suitable for input to text formatters or
+for automatic translation to a variety of formats suitable for input
+to text formatters.  A copy made in an otherwise Transparent file
+format whose markup, or absence of markup, has been arranged to thwart
+or discourage subsequent modification by readers is not Transparent.
+An image format is not Transparent if used for any substantial amount
+of text.  A copy that is not "Transparent" is called "Opaque".
+
+Examples of suitable formats for Transparent copies include plain
+ASCII without markup, Texinfo input format, LaTeX input format, SGML
+or XML using a publicly available DTD, and standard-conforming simple
+HTML, PostScript or PDF designed for human modification.  Examples of
+transparent image formats include PNG, XCF and JPG.  Opaque formats
+include proprietary formats that can be read and edited only by
+proprietary word processors, SGML or XML for which the DTD and/or
+processing tools are not generally available, and the
+machine-generated HTML, PostScript or PDF produced by some word
+processors for output purposes only.
+
+The "Title Page" means, for a printed book, the title page itself,
+plus such following pages as are needed to hold, legibly, the material
+this License requires to appear in the title page.  For works in
+formats which do not have any title page as such, "Title Page" means
+the text near the most prominent appearance of the work's title,
+preceding the beginning of the body of the text.
+
+A section "Entitled XYZ" means a named subunit of the Document whose
+title either is precisely XYZ or contains XYZ in parentheses following
+text that translates XYZ in another language.  (Here XYZ stands for a
+specific section name mentioned below, such as "Acknowledgements",
+"Dedications", "Endorsements", or "History".)  To "Preserve the Title"
+of such a section when you modify the Document means that it remains a
+section "Entitled XYZ" according to this definition.
+
+The Document may include Warranty Disclaimers next to the notice which
+states that this License applies to the Document.  These Warranty
+Disclaimers are considered to be included by reference in this
+License, but only as regards disclaiming warranties: any other
+implication that these Warranty Disclaimers may have is void and has
+no effect on the meaning of this License.
+
+
+2. VERBATIM COPYING
+
+You may copy and distribute the Document in any medium, either
+commercially or noncommercially, provided that this License, the
+copyright notices, and the license notice saying this License applies
+to the Document are reproduced in all copies, and that you add no other
+conditions whatsoever to those of this License.  You may not use
+technical measures to obstruct or control the reading or further
+copying of the copies you make or distribute.  However, you may accept
+compensation in exchange for copies.  If you distribute a large enough
+number of copies you must also follow the conditions in section 3.
+
+You may also lend copies, under the same conditions stated above, and
+you may publicly display copies.
+
+
+3. COPYING IN QUANTITY
+
+If you publish printed copies (or copies in media that commonly have
+printed covers) of the Document, numbering more than 100, and the
+Document's license notice requires Cover Texts, you must enclose the
+copies in covers that carry, clearly and legibly, all these Cover
+Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
+the back cover.  Both covers must also clearly and legibly identify
+you as the publisher of these copies.  The front cover must present
+the full title with all words of the title equally prominent and
+visible.  You may add other material on the covers in addition.
+Copying with changes limited to the covers, as long as they preserve
+the title of the Document and satisfy these conditions, can be treated
+as verbatim copying in other respects.
+
+If the required texts for either cover are too voluminous to fit
+legibly, you should put the first ones listed (as many as fit
+reasonably) on the actual cover, and continue the rest onto adjacent
+pages.
+
+If you publish or distribute Opaque copies of the Document numbering
+more than 100, you must either include a machine-readable Transparent
+copy along with each Opaque copy, or state in or with each Opaque copy
+a computer-network location from which the general network-using
+public has access to download using public-standard network protocols
+a complete Transparent copy of the Document, free of added material.
+If you use the latter option, you must take reasonably prudent steps,
+when you begin distribution of Opaque copies in quantity, to ensure
+that this Transparent copy will remain thus accessible at the stated
+location until at least one year after the last time you distribute an
+Opaque copy (directly or through your agents or retailers) of that
+edition to the public.
+
+It is requested, but not required, that you contact the authors of the
+Document well before redistributing any large number of copies, to give
+them a chance to provide you with an updated version of the Document.
+
+
+4. MODIFICATIONS
+
+You may copy and distribute a Modified Version of the Document under
+the conditions of sections 2 and 3 above, provided that you release
+the Modified Version under precisely this License, with the Modified
+Version filling the role of the Document, thus licensing distribution
+and modification of the Modified Version to whoever possesses a copy
+of it.  In addition, you must do these things in the Modified Version:
+
+A. Use in the Title Page (and on the covers, if any) a title distinct
+   from that of the Document, and from those of previous versions
+   (which should, if there were any, be listed in the History section
+   of the Document).  You may use the same title as a previous version
+   if the original publisher of that version gives permission.
+B. List on the Title Page, as authors, one or more persons or entities
+   responsible for authorship of the modifications in the Modified
+   Version, together with at least five of the principal authors of the
+   Document (all of its principal authors, if it has fewer than five),
+   unless they release you from this requirement.
+C. State on the Title page the name of the publisher of the
+   Modified Version, as the publisher.
+D. Preserve all the copyright notices of the Document.
+E. Add an appropriate copyright notice for your modifications
+   adjacent to the other copyright notices.
+F. Include, immediately after the copyright notices, a license notice
+   giving the public permission to use the Modified Version under the
+   terms of this License, in the form shown in the Addendum below.
+G. Preserve in that license notice the full lists of Invariant Sections
+   and required Cover Texts given in the Document's license notice.
+H. Include an unaltered copy of this License.
+I. Preserve the section Entitled "History", Preserve its Title, and add
+   to it an item stating at least the title, year, new authors, and
+   publisher of the Modified Version as given on the Title Page.  If
+   there is no section Entitled "History" in the Document, create one
+   stating the title, year, authors, and publisher of the Document as
+   given on its Title Page, then add an item describing the Modified
+   Version as stated in the previous sentence.
+J. Preserve the network location, if any, given in the Document for
+   public access to a Transparent copy of the Document, and likewise
+   the network locations given in the Document for previous versions
+   it was based on.  These may be placed in the "History" section.
+   You may omit a network location for a work that was published at
+   least four years before the Document itself, or if the original
+   publisher of the version it refers to gives permission.
+K. For any section Entitled "Acknowledgements" or "Dedications",
+   Preserve the Title of the section, and preserve in the section all
+   the substance and tone of each of the contributor acknowledgements
+   and/or dedications given therein.
+L. Preserve all the Invariant Sections of the Document,
+   unaltered in their text and in their titles.  Section numbers
+   or the equivalent are not considered part of the section titles.
+M. Delete any section Entitled "Endorsements".  Such a section
+   may not be included in the Modified Version.
+N. Do not retitle any existing section to be Entitled "Endorsements"
+   or to conflict in title with any Invariant Section.
+O. Preserve any Warranty Disclaimers.
+
+If the Modified Version includes new front-matter sections or
+appendices that qualify as Secondary Sections and contain no material
+copied from the Document, you may at your option designate some or all
+of these sections as invariant.  To do this, add their titles to the
+list of Invariant Sections in the Modified Version's license notice.
+These titles must be distinct from any other section titles.
+
+You may add a section Entitled "Endorsements", provided it contains
+nothing but endorsements of your Modified Version by various
+parties--for example, statements of peer review or that the text has
+been approved by an organization as the authoritative definition of a
+standard.
+
+You may add a passage of up to five words as a Front-Cover Text, and a
+passage of up to 25 words as a Back-Cover Text, to the end of the list
+of Cover Texts in the Modified Version.  Only one passage of
+Front-Cover Text and one of Back-Cover Text may be added by (or
+through arrangements made by) any one entity.  If the Document already
+includes a cover text for the same cover, previously added by you or
+by arrangement made by the same entity you are acting on behalf of,
+you may not add another; but you may replace the old one, on explicit
+permission from the previous publisher that added the old one.
+
+The author(s) and publisher(s) of the Document do not by this License
+give permission to use their names for publicity for or to assert or
+imply endorsement of any Modified Version.
+
+
+5. COMBINING DOCUMENTS
+
+You may combine the Document with other documents released under this
+License, under the terms defined in section 4 above for modified
+versions, provided that you include in the combination all of the
+Invariant Sections of all of the original documents, unmodified, and
+list them all as Invariant Sections of your combined work in its
+license notice, and that you preserve all their Warranty Disclaimers.
+
+The combined work need only contain one copy of this License, and
+multiple identical Invariant Sections may be replaced with a single
+copy.  If there are multiple Invariant Sections with the same name but
+different contents, make the title of each such section unique by
+adding at the end of it, in parentheses, the name of the original
+author or publisher of that section if known, or else a unique number.
+Make the same adjustment to the section titles in the list of
+Invariant Sections in the license notice of the combined work.
+
+In the combination, you must combine any sections Entitled "History"
+in the various original documents, forming one section Entitled
+"History"; likewise combine any sections Entitled "Acknowledgements",
+and any sections Entitled "Dedications".  You must delete all sections
+Entitled "Endorsements".
+
+
+6. COLLECTIONS OF DOCUMENTS
+
+You may make a collection consisting of the Document and other documents
+released under this License, and replace the individual copies of this
+License in the various documents with a single copy that is included in
+the collection, provided that you follow the rules of this License for
+verbatim copying of each of the documents in all other respects.
+
+You may extract a single document from such a collection, and distribute
+it individually under this License, provided you insert a copy of this
+License into the extracted document, and follow this License in all
+other respects regarding verbatim copying of that document.
+
+
+7. AGGREGATION WITH INDEPENDENT WORKS
+
+A compilation of the Document or its derivatives with other separate
+and independent documents or works, in or on a volume of a storage or
+distribution medium, is called an "aggregate" if the copyright
+resulting from the compilation is not used to limit the legal rights
+of the compilation's users beyond what the individual works permit.
+When the Document is included in an aggregate, this License does not
+apply to the other works in the aggregate which are not themselves
+derivative works of the Document.
+
+If the Cover Text requirement of section 3 is applicable to these
+copies of the Document, then if the Document is less than one half of
+the entire aggregate, the Document's Cover Texts may be placed on
+covers that bracket the Document within the aggregate, or the
+electronic equivalent of covers if the Document is in electronic form.
+Otherwise they must appear on printed covers that bracket the whole
+aggregate.
+
+
+8. TRANSLATION
+
+Translation is considered a kind of modification, so you may
+distribute translations of the Document under the terms of section 4.
+Replacing Invariant Sections with translations requires special
+permission from their copyright holders, but you may include
+translations of some or all Invariant Sections in addition to the
+original versions of these Invariant Sections.  You may include a
+translation of this License, and all the license notices in the
+Document, and any Warranty Disclaimers, provided that you also include
+the original English version of this License and the original versions
+of those notices and disclaimers.  In case of a disagreement between
+the translation and the original version of this License or a notice
+or disclaimer, the original version will prevail.
+
+If a section in the Document is Entitled "Acknowledgements",
+"Dedications", or "History", the requirement (section 4) to Preserve
+its Title (section 1) will typically require changing the actual
+title.
+
+
+9. TERMINATION
+
+You may not copy, modify, sublicense, or distribute the Document except
+as expressly provided for under this License.  Any other attempt to
+copy, modify, sublicense or distribute the Document is void, and will
+automatically terminate your rights under this License.  However,
+parties who have received copies, or rights, from you under this
+License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+
+10. FUTURE REVISIONS OF THIS LICENSE
+
+The Free Software Foundation may publish new, revised versions
+of the GNU Free Documentation License from time to time.  Such new
+versions will be similar in spirit to the present version, but may
+differ in detail to address new problems or concerns.  See
+http://www.gnu.org/copyleft/.
+
+Each version of the License is given a distinguishing version number.
+If the Document specifies that a particular numbered version of this
+License "or any later version" applies to it, you have the option of
+following the terms and conditions either of that specified version or
+of any later version that has been published (not as a draft) by the
+Free Software Foundation.  If the Document does not specify a version
+number of this License, you may choose any version ever published (not
+as a draft) by the Free Software Foundation.
+
+
+ADDENDUM: How to use this License for your documents
+
+To use this License in a document you have written, include a copy of
+the License in the document and put the following copyright and
+license notices just after the title page:
+
+    Copyright (c)  YEAR  YOUR NAME.
+    Permission is granted to copy, distribute and/or modify this document
+    under the terms of the GNU Free Documentation License, Version 1.2
+    or any later version published by the Free Software Foundation;
+    with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
+    A copy of the license is included in the section entitled "GNU
+    Free Documentation License".
+
+If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
+replace the "with...Texts." line with this:
+
+    with the Invariant Sections being LIST THEIR TITLES, with the
+    Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.
+
+If you have Invariant Sections without Cover Texts, or some other
+combination of the three, merge those two alternatives to suit the
+situation.
+
+If your document contains nontrivial examples of program code, we
+recommend releasing these examples in parallel under your choice of
+free software license, such as the GNU General Public License,
+to permit their use in free software.
Index: kabc/plugins/evolution/evolution.desktop
===================================================================
--- kabc/plugins/evolution/evolution.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/plugins/evolution/evolution.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -4,6 +4,7 @@
 Name[be]=Эвалюцыя
 Name[bn]=ইভোলিউশন
 Name[eo]=Evoluo
+Name[fa]=اوولوشن
 Name[hi]=एवॉल्यूशन
 Name[ko]=에볼루션
 Name[mn]=Хөгжил
Index: kabc/plugins/dir/dir.desktop
===================================================================
--- kabc/plugins/dir/dir.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/plugins/dir/dir.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Name[es]=Directorio
 Name[et]=Kataloog
 Name[eu]=Direktorioa
-Name[fa]=شاخه
+Name[fa]=فهرست راهنما
 Name[fi]=Hakemisto
 Name[fo]=Fíluskrá
 Name[fr]=Dossier
Index: kabc/kabc_manager.desktop
===================================================================
--- kabc/kabc_manager.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/kabc_manager.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Name[es]=Contactos
 Name[et]=Kontaktid
 Name[eu]=Kontaktuak
+Name[fa]=تماسها
 Name[fi]=Yhteystiedot
 Name[fy]=Kontakten
 Name[ga]=Teagmhálacha
Index: kabc/kab2kabc.desktop
===================================================================
--- kabc/kab2kabc.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/kab2kabc.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -34,7 +34,7 @@
 Comment[es]=Conversor libkab a libkabc.
 Comment[et]=libkab -> libkabc teisendamine
 Comment[eu]=libkab-etik libkabc-era bihurtzeko tresna.
-Comment[fa]=وسیله‌ی تبدیل libkab به libkabc
+Comment[fa]=ابزار تبدیل libkab به libcabc.
 Comment[fi]=libkab-libkabc -muunnin
 Comment[fr]=Outil de conversion de libkab vers libkabc.
 Comment[fy]=Konversjeprogramma fan libkab nei libkabc.
Index: kabc/lock.cpp
===================================================================
--- kabc/lock.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/lock.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -57,7 +57,8 @@
   if ( !file.open( IO_ReadOnly ) ) return false;
 
   QTextStream t( &file );
-  t >> pid >> endl >> app;
+  pid = t.readLine().toInt();
+  app = t.readLine();
 
   return true;
 }
Index: kabc/formats/binary.desktop
===================================================================
--- kabc/formats/binary.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kabc/formats/binary.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Name[es]=Binario
 Name[et]=Binaar
 Name[eu]=Bitarra
-Name[fa]=اجرایی
+Name[fa]=دوگانی
 Name[fi]=Binääri
 Name[fr]=Binaire
 Name[fy]=Binêr
Index: kcert/kcertpart.desktop
===================================================================
--- kcert/kcertpart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kcert/kcertpart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Administrador empotrable de certificados personales
 Comment[et]=Põimitav personaalsete sertifikaatide haldur
 Comment[eu]=Ziurtagiri pertsonalen kudeatzaile kapsulagarria
-Comment[fa]=مپیر گواهی‌نامه‌ی شخصی نهفته
+Comment[fa]=مدیر گواهی نامه شخصی نهفته
 Comment[fi]=Upotettava henkilökohtaisten sertifikaattien hallintatyökalu
 Comment[fr]=Gestionnaire de certificats personnels intégrable
 Comment[fy]=Yn te sluten Persoanlik-sertifikaatbehearder
Index: kutils/kplugininfo.desktop
===================================================================
--- kutils/kplugininfo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kutils/kplugininfo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Name[es]=Información de los plugin de KDE
 Name[et]=KDE plugina info
 Name[eu]=KDEren plugin-en informazioa
-Name[fa]=اطلاعات متصل‌کننده‌ی KDE
+Name[fa]=اطلاعات وصلۀ  KDE
 Name[fi]=KDE:n lisäosatiedot
 Name[fr]=Information sur le module KDE
 Name[fy]=KDE Plugin ynformaasje
@@ -42,7 +42,7 @@
 Name[mk]=KDE Информација за приклучок
 Name[mn]=КДЭ плугин мэдээлэл
 Name[ms]=Maklumat Plugmasuk KDE
-Name[nb]=KDEs informasjon om tilleggsprogram
+Name[nb]=KDEs informasjon om programtillegg
 Name[nds]=Plugin-Informatschoon
 Name[nl]=KDE-plugininformatie
 Name[nn]=Informasjon om KDE-programtillegg
Index: kdesu/configure.in.in
===================================================================
--- kdesu/configure.in.in	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdesu/configure.in.in	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -6,6 +6,14 @@
     AC_DEFINE_UNQUOTED(__PATH_SU, "$path_su", [path to su])
 fi
 
+dnl Check for sudo
+AC_PATH_PROG(path_sudo, "sudo", "no")
+if test "$path_sudo" = "no"; then
+    AC_MSG_WARN(sudo was not found)
+else
+    AC_DEFINE_UNQUOTED(__PATH_SUDO, "$path_sudo", [path to sudo])
+fi
+
 dnl Check for POSIX.1b scheduling
 AC_MSG_CHECKING([POSIX.1b scheduling])
 AC_TRY_LINK([
Index: kdesu/process.cpp
===================================================================
--- kdesu/process.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdesu/process.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -48,6 +48,7 @@
 #include <qcstring.h>
 #include <qfile.h>
 
+#include <kconfig.h>
 #include <kdebug.h>
 #include <kstandarddirs.h>
 
@@ -73,7 +74,15 @@
 */
 bool PtyProcess::checkPid(pid_t pid)
 {
+	KConfig* config = KGlobal::config();
+	config->setGroup("super-user-command");
+	QString superUserCommand = config->readEntry("super-user-command", "su");
+	//sudo does not accept signals from user so we except it
+	if (superUserCommand == "sudo") {
+		return true;
+	} else {
 	return kill(pid,0) == 0;
+	}
 }
 
 /*
Index: kdesu/su.cpp
===================================================================
--- kdesu/su.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdesu/su.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -5,6 +5,9 @@
 * This file is part of the KDE project, module kdesu.
 * Copyright (C) 1999,2000 Geert Jansen <jansen@kde.org>
 * 
+* Sudo support added by Jonathan Riddell <jriddell@ ubuntu.com>
+* Copyright (C) 2005 Canonical Ltd
+*
 * This is free software; you can use this library under the GNU Library 
 * General Public License, version 2. See the file "COPYING.LIB" for the 
 * exact licensing terms.
@@ -30,6 +33,7 @@
 #include <qcstring.h>
 #include <qfile.h>
 
+#include <kconfig.h>
 #include <kdebug.h>
 #include <klocale.h>
 #include <kstandarddirs.h>
@@ -42,11 +46,25 @@
 #define __PATH_SU "false"
 #endif
 
+#ifndef __PATH_SUDO
+#define __PATH_SUDO "false"
+#endif
 
+//change to sudo or su according to your preferences
+#define DEFAULT_SUPER_USER_COMMAND "su"
+
 SuProcess::SuProcess(const QCString &user, const QCString &command)
 {
     m_User = user;
     m_Command = command;
+
+    KConfig* config = KGlobal::config();
+    config->setGroup("super-user-command");
+    superUserCommand = config->readEntry("super-user-command", DEFAULT_SUPER_USER_COMMAND);
+    if ( superUserCommand != "sudo" && superUserCommand != "su" ) {
+	kdWarning() << "unknown super user command" << endl;
+	superUserCommand = "su";
+    }
 }
 
 
@@ -73,7 +91,16 @@
     if (check)
         setTerminal(true);
 
+    // since user may change after constructor (due to setUser())
+    // we need to override sudo with su for non-root here
+    if (m_User != "root") {
+        superUserCommand = "su";
+    }
+
     QCStringList args;
+    if (superUserCommand == "sudo") {
+        args += "-u";
+    }
 
 #ifdef Q_OS_DARWIN
     args += "-c";
@@ -85,16 +112,27 @@
     else
         args += m_User;
     
-    args += "-c";
+    if (superUserCommand == "su") {
+        args += "-c";
+    }
     args += QCString(__KDE_BINDIR) + "/kdesu_stub";
 #ifndef Q_OS_DARWIN
     args += "-";
 #endif
 
-    QCString command = __PATH_SU;
-    if (::access(__PATH_SU, X_OK) != 0)
+    ///    QCString command = __PATH_SU;
+    ///    if (::access(__PATH_SU, X_OK) != 0)
+    QCString command;
+    if (superUserCommand == "sudo") {
+        command = __PATH_SUDO;
+    } else {
+        command = __PATH_SU;
+    }
+ 
+    if (::access(command, X_OK) != 0)
     {
-        command = QFile::encodeName(KGlobal::dirs()->findExe("su"));
+      ///        command = QFile::encodeName(KGlobal::dirs()->findExe("su"));
+        command = QFile::encodeName( KGlobal::dirs()->findExe(superUserCommand.ascii()) );
         if (command.isEmpty())
             return check ? SuNotFound : -1;
     }
@@ -119,10 +157,20 @@
     {
         if (ret == killme)
         {
-            if (kill(m_Pid, SIGKILL) < 0)
-            {
-                ret=error;
-            }
+	  ///            if (kill(m_Pid, SIGKILL) < 0)
+	  ///            {
+	  ///                ret=error;
+	  ///            }
+            if ( superUserCommand == "sudo" ) {
+ 	        // sudo can not be killed, just return
+ 	        return ret;
+ 	    }
+ 	    if (kill(m_Pid, SIGKILL) < 0) {
+ 	        kdDebug() << k_funcinfo << "kill < 0" << endl;
+ 		//FIXME SIGKILL doesn't work for sudo,
+ 		//why is this different from su?
+ 		ret=error;
+ 	    }
             else
             {
                 int iret = waitForChild();
@@ -144,7 +192,9 @@
     if (ret == notauthorized)
     {
         kill(m_Pid, SIGKILL);
-        waitForChild();
+        if (superUserCommand != "sudo") {
+            waitForChild();
+        }
         return SuIncorrectPassword;
     }
 
@@ -277,6 +327,10 @@
                 {
                     unreadLine(line);
                     return ok;
+ 	        } else if (superUserCommand == "sudo") {
+ 	            // sudo gives a "sorry" line so reaches here
+ 	            // with the wrong password
+ 	            return notauthorized;
                 }
                 break;
             //////////////////////////////////////////////////////////////////////////
Index: kdesu/su.h
===================================================================
--- kdesu/su.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdesu/su.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -57,6 +57,7 @@
 private:
     class SuProcessPrivate;
     SuProcessPrivate *d;
+    QString superUserCommand;
 };
 
 #endif
Index: kspell2/kspellclient.desktop
===================================================================
--- kspell2/kspellclient.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kspell2/kspellclient.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,6 +19,7 @@
 Comment[es]=Cliente KSpell
 Comment[et]=KSpelli klient
 Comment[eu]=KSpell bezeroa
+Comment[fa]=کارخواه KSpell
 Comment[fi]=KSpell-asiakasohjelma
 Comment[fr]=Client KSpell
 Comment[fy]=KSpell Klant
Index: kdecore/netwm.h
===================================================================
--- kdecore/netwm.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/netwm.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1269,7 +1269,7 @@
     /**
        Returns an icon.  If width and height are passed, the icon returned will be
        the closest it can find (the next biggest).  If width and height are omitted,
-       then the first icon in the list is returned.
+       then the largest icon in the list is returned.
 
        @param width the preferred width for the icon, -1 to ignore
 
Index: kdecore/ktimezones.cpp
===================================================================
--- kdecore/ktimezones.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/ktimezones.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -237,12 +237,12 @@
     char *originalZone = ::getenv("TZ");
 
     // Convert the given localtime to UTC.
-    ::putenv(strdup(QString("TZ=:").append(m_name).utf8()));
+    ::setenv("TZ", m_name.utf8(), 1);
     tzset();
     unsigned utc = dateTime.toTime_t();
 
     // Set the timezone and convert UTC to localtime.
-    ::putenv(strdup(QString("TZ=:").append(newZone->name()).utf8()));
+    ::setenv("TZ", newZone->name().utf8(), 1);
     tzset();
     QDateTime remoteTime;
     remoteTime.setTime_t(utc, Qt::LocalTime);
@@ -254,7 +254,7 @@
     }
     else
     {
-        ::putenv(strdup(QString("TZ=").append(originalZone).utf8()));
+        ::setenv("TZ", originalZone, 1);
     }
     tzset();
     return remoteTime;
@@ -288,7 +288,7 @@
     QDateTime basisTime = QDateTime::currentDateTime(basisSpec);
 
     // Set the timezone and find out what time it is there compared to the basis.
-    ::putenv(strdup(QString("TZ=:").append(m_name).utf8()));
+    ::setenv("TZ", m_name.utf8(), 1);
     tzset();
     QDateTime remoteTime = QDateTime::currentDateTime(Qt::LocalTime);
     int offset = remoteTime.secsTo(basisTime);
@@ -300,7 +300,7 @@
     }
     else
     {
-        ::putenv(strdup(QString("TZ=").append(originalZone).utf8()));
+        ::setenv("TZ", originalZone, 1);
     }
     tzset();
     return offset;
Index: kdecore/kicontheme.h
===================================================================
--- kdecore/kicontheme.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kicontheme.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -51,7 +51,14 @@
       Application, ///< An icon that represents an application.
       Device, ///< An icon that represents a device.
       FileSystem, ///< An icon that represents a file system.
-      MimeType ///< An icon that represents a mime type (or file type).
+      MimeType, ///< An icon that represents a mime type (or file type).
+      Animation, ///< An icon that is animated.
+      Category, ///< An icon that represents a category.
+      Emblem, ///< An icon that adds information to an existing icon.
+      Emote, ///< An icon that expresses an emotion.
+      International, ///< An icon that represents a country's flag.
+      Place, ///< An icon that represents a location (e.g. 'home', 'trash').
+      StatusIcon ///< An icon that represents an event.
     };
 
     /**
@@ -313,6 +320,12 @@
      * @see KIcon::isValid will return true, and false otherwise.
      */
     KIcon iconPath(const QString& name, int size, KIcon::MatchType match) const;
+    
+    /**
+     * Returns true if the theme has any icons for the given context.
+     * @since 3.5.5
+     */
+    bool hasContext( KIcon::Context context ) const;
 
     /**
      * List all icon themes installed on the system, global and local.
Index: kdecore/kstandarddirs.cpp
===================================================================
--- kdecore/kstandarddirs.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kstandarddirs.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -100,6 +100,7 @@
 			      "wallpaper", "lib", "pixmap", "templates",
 			      "module", "qtplugins",
 			      "xdgdata-apps", "xdgdata-dirs", "xdgconf-menu",
+			      "xdgdata-icon",
 			      "kcfg", "emoticons", 0 };
 
 static int tokenize( QStringList& token, const QString& str,
@@ -1055,6 +1056,8 @@
         return "lib" KDELIBSUFF "/kde3/plugins";
     if (!strcmp(type, "xdgdata-apps"))
         return "applications/";
+    if (!strcmp(type, "xdgdata-icon"))
+        return "icons/";
     if (!strcmp(type, "xdgdata-dirs"))
         return "desktop-directories/";
     if (!strcmp(type, "xdgconf-menu"))
Index: kdecore/kaboutdata.h
===================================================================
--- kdecore/kaboutdata.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kaboutdata.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -359,6 +359,7 @@
      * @param programName The program name. This string should be
      *        marked for translation.
      *        Example: I18N_NOOP("Advanced Text Editor").
+     * @since 3.2
      */
     void setProgramName( const char* programName );
 
Index: kdecore/kaccelmanager.cpp
===================================================================
--- kdecore/kaccelmanager.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kaccelmanager.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -167,7 +167,7 @@
 {
     if (!widget)
     {
-        kdDebug(125) << "null pointer given to manage" << endl;
+        kdDebug(131) << "null pointer given to manage" << endl;
         return;
     }
 
@@ -239,8 +239,6 @@
         if ( dynamic_cast<QLabel*>( it->m_widget ) && it->m_widget->inherits("KURLLabel") )
              continue;
 
-        kdDebug(125) << "write " << cnt << " " << it->m_widget->className() << " " <<contents[cnt].accelerated() << endl;
-
         int tprop = it->m_widget->metaObject()->findProperty("text", true);
         if (tprop != -1)  {
             if (checkChange(contents[cnt]))
@@ -256,7 +254,6 @@
     for (Item *it = item->m_children->first(); it != 0;
          it = item->m_children->next())
     {
-        kdDebug(125) << "children " << it->m_widget->className() << endl;
         if (it->m_widget && it->m_widget->isVisibleTo( item->m_widget ) )
             calculateAccelerators(it, used);
     }
@@ -456,7 +453,7 @@
 
 void KAcceleratorManager::manage(QWidget *widget, bool programmers_mode)
 {
-    kdDebug(125) << "KAcceleratorManager::manage\n";
+    kdDebug(131) << "KAcceleratorManager::manage\n";
     KAcceleratorManagerPrivate::changed_string = QString::null;
     KAcceleratorManagerPrivate::added_string = QString::null;
     KAcceleratorManagerPrivate::removed_string = QString::null;
@@ -496,7 +493,6 @@
 
     m_orig_accel = m_accel = stripAccelerator(m_pureText);
 
-    kdDebug(125) << input << " " << m_orig_accel << " " << m_accel << " " << m_pureText << endl;
     if (initialWeight == -1)
         initialWeight = KAccelManagerAlgorithm::DEFAULT_WEIGHT;
 
@@ -575,7 +571,7 @@
     // try to preserve the wanted accelarators
     if ((int)pos == accel()) {
         weight += KAccelManagerAlgorithm::WANTED_ACCEL_EXTRA_WEIGHT;
-        // kdDebug(125) << "wanted " << m_pureText << " " << KAcceleratorManagerPrivate::standardName(m_origText) << endl;
+        // kdDebug(131) << "wanted " << m_pureText << " " << KAcceleratorManagerPrivate::standardName(m_origText) << endl;
         if (KAcceleratorManagerPrivate::standardName(m_origText))  {
             weight += KAccelManagerAlgorithm::STANDARD_ACCEL;
         }
@@ -685,19 +681,17 @@
 
 void KAccelManagerAlgorithm::findAccelerators(KAccelStringList &result, QString &used)
 {
-    kdDebug(125) << "findAccelerators\n";
+    kdDebug(131) << "findAccelerators\n";
   KAccelStringList accel_strings = result;
 
   // initally remove all accelerators
   for (KAccelStringList::Iterator it = result.begin(); it != result.end(); ++it) {
-      kdDebug(125) << "reset " << ( *it ).pure() << endl;
     (*it).setAccel(-1);
   }
 
   // pick the highest bids
   for (uint cnt=0; cnt<accel_strings.count(); ++cnt)
   {
-      kdDebug(125) << "cnt " << accel_strings[cnt].pure() << endl;
     int max = 0, index = -1, accel = -1;
 
     // find maximum weight
@@ -862,7 +856,7 @@
 {
     if (!child)
     {
-        kdDebug(125) << "null pointer given to aboutToShow" << endl;
+        kdDebug(131) << "null pointer given to aboutToShow" << endl;
         return;
     }
 
Index: kdecore/kiconloader_p.h
===================================================================
--- kdecore/kiconloader_p.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 0)
+++ kdecore/kiconloader_p.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -0,0 +1,60 @@
+/* vi: ts=8 sts=4 sw=4
+ *
+ * This file is part of the KDE project, module kdecore.
+ * Copyright (C) 2000 Geert Jansen <jansen@kde.org>
+ *                    Antonio Larrosa <larrosa@kde.org>
+ *
+ * This is free software; it comes under the GNU Library General
+ * Public License, version 2. See the file "COPYING.LIB" for the
+ * exact licensing terms.
+ */
+
+#ifndef __KIconLoader_p_h_Included__
+#define __KIconLoader_p_h_Included__
+
+#include <qobject.h>
+#include <qstringlist.h>
+#include <kicontheme.h>
+#include <kiconloader.h>
+#include <kiconeffect.h>
+#include <qdict.h>
+
+class KIconThemeNode
+{
+public:
+    KIconThemeNode(KIconTheme *_theme);
+    ~KIconThemeNode();
+
+    void queryIcons(QStringList *lst, int size, KIcon::Context context) const;
+    void queryIconsByContext(QStringList *lst, int size, KIcon::Context context) const;
+    KIcon findIcon(const QString& name, int size, KIcon::MatchType match) const;
+    void printTree(QString& dbgString) const;
+
+    KIconTheme *theme;
+};
+
+class KIconLoaderPrivate : public QObject
+{
+    Q_OBJECT
+public:
+    QStringList mThemesInTree;
+    KIconGroup *mpGroups;
+    KIconThemeNode *mpThemeRoot;
+    KStandardDirs *mpDirs;
+    KIconLoader *q;
+    KIconEffect mpEffect;
+    QDict<QImage> imgDict;
+    QImage lastImage; // last loaded image without effect applied
+    QString lastImageKey; // key for icon without effect
+    QString appname;
+    int lastIconType; // see KIcon::type
+    int lastIconThreshold; // see KIcon::threshold
+    QPtrList<KIconThemeNode> links;
+    bool extraDesktopIconsLoaded;
+    bool delayedLoading;
+
+public slots:
+    void slotIconChanged();
+};
+
+#endif // __KIconLoader_p_h_Included__
Index: kdecore/kconfig.cpp
===================================================================
--- kdecore/kconfig.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kconfig.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -331,7 +331,7 @@
 static KStaticDeleter< QValueList<KSharedConfig*> > sd;
 QValueList<KSharedConfig*> *KSharedConfig::s_list = 0;
 
-KSharedConfig::Ptr KSharedConfig::openConfig(const QString& fileName, bool immutable, bool useKDEGlobals )
+KSharedConfig::Ptr KSharedConfig::openConfig(const QString& fileName, bool readOnly, bool useKDEGlobals )
 {
   if (s_list)
   {
@@ -339,12 +339,12 @@
          it != s_list->end(); ++it)
      {
         if ((*it)->backEnd->fileName() == fileName &&
-                (*it)->backEnd->bFileImmutable == immutable &&
+                (*it)->bReadOnly == readOnly &&
                 (*it)->backEnd->useKDEGlobals == useKDEGlobals )
            return (*it);
      }
   }
-  return new KSharedConfig(fileName, immutable, useKDEGlobals);
+  return new KSharedConfig(fileName, readOnly, useKDEGlobals);
 }
 
 KSharedConfig::KSharedConfig( const QString& fileName, bool readonly, bool usekdeglobals)
Index: kdecore/Makefile.am
===================================================================
--- kdecore/Makefile.am	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/Makefile.am	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -81,7 +81,7 @@
 	kregpriv.h kshortcutmenu.h ksycocadict.h ksycocafactory.h netsupp.h \
 	kcheckaccelerators.h kcalendarsystemgregorian.h \
 	kcalendarsystemhijri.h kcalendarsystemhebrew.h kcalendarsystemjalali.h \
-	kprotocolinfofactory.h kqiodevicegzip_p.h
+	kprotocolinfofactory.h kqiodevicegzip_p.h kiconloader_p.h
 
 libkdecore_la_SOURCES = libintl.cpp kapplication.cpp \
 	kdebug.cpp netwm.cpp kconfigbase.cpp kconfig.cpp  ksimpleconfig.cpp \
Index: kdecore/kdebug.cpp
===================================================================
--- kdecore/kdebug.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kdebug.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -582,8 +582,10 @@
 
 void kdClearDebugConfig()
 {
-    delete kDebug_data->config;
-    kDebug_data->config = 0;
+    if (kDebug_data) {
+        delete kDebug_data->config;
+        kDebug_data->config = 0;
+    }
 }
 
 
Index: kdecore/kglobalaccel_x11.h
===================================================================
--- kdecore/kglobalaccel_x11.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kglobalaccel_x11.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -96,12 +96,14 @@
 	virtual bool isEnabledInternal() const;
 	static void blockShortcuts( bool block );
 	void disableBlocking( bool disable );
+        void suspend( bool s );
 
  protected slots:
 	void slotActivated( int iAction );
  private:
 	bool m_blocked;
 	bool m_blockingDisabled;
+        bool m_suspended;
 };
 
 #endif // _KGLOBALACCEL_X11_H
Index: kdecore/eventsrc
===================================================================
--- kdecore/eventsrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/eventsrc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Notificaciones del sistema de KDE
 Comment[et]=KDE süsteemi märguanded
 Comment[eu]=KDEren sistemako jakinarazpenak
-Comment[fa]=اعلامیه‌های سیستم KDE
+Comment[fa]=اخطارهای سیستم KDE
 Comment[fi]=KDE:n järjestelmähuomautukset
 Comment[fr]=Notifications du système KDE
 Comment[fy]=KDE Systeemberjochten
@@ -96,6 +96,7 @@
 Name[es]=Papelera: vaciada
 Name[et]=Prügikast: tühjendatud
 Name[eu]=Zakarrontzia: hustuta
+Name[fa]=زباله:خالی 
 Name[fi]=Roskakori: tyhjennetty
 Name[fr]=Corbeille : vidée
 Name[fy]=Jiskefet: leech makke
@@ -138,7 +139,7 @@
 Name[uz]=Чиқиндилар қутиси бўшатилди
 Name[vi]=Rác: đã đổ
 Name[zh_CN]=回收站：已清空
-Name[zh_TW]=垃圾桶已清空
+Name[zh_TW]=資源回收桶已清空
 Comment=The trash has been emptied
 Comment[af]=Die gemors is leeggemaak
 Comment[bg]=Съдържанието а кошчето е изтрито
@@ -154,6 +155,7 @@
 Comment[es]=La papelera se ha vaciado
 Comment[et]=Prügikast on tühjendatud
 Comment[eu]=Zakarrontzia hustu da
+Comment[fa]=زباله خالی شده
 Comment[fi]=Roskakori on tyhjennetty
 Comment[fr]=La corbeille a été vidée
 Comment[fy]=It jiskefet is leech makke
@@ -195,7 +197,7 @@
 Comment[uz]=Чиқиндилар қутиси бўшатилди
 Comment[vi]=Rác đã được đổ.
 Comment[zh_CN]=回收站已被清空
-Comment[zh_TW]=垃圾桶已清空。
+Comment[zh_TW]=資源回收桶已清空。
 default_presentation=1
 
 [Textcompletion: rotation]
@@ -217,7 +219,7 @@
 Name[es]=Completado de texto: rotación
 Name[et]=Teksti lõpetamine: pööramine
 Name[eu]=Testu-osaketa: biraketa
-Name[fa]=تکمیل متن: گردش
+Name[fa]=تکمیل متن:چرخش
 Name[fi]=Tekstintäydennys: pyöritys
 Name[fr]=Autocomplètement de texte : rotation
 Name[fy]=Tekstkompletearing: rotaasje
@@ -290,6 +292,7 @@
 Comment[es]=Se ha alcanzado el final de la lista de concordancias
 Comment[et]=Jõuti kokkulangevuste nimekirja lõppu
 Comment[eu]=Bat datozenen zerrendaren amaierara iritsi da
+Comment[fa]=به پایان فهرست تطبیق ها رسیده است
 Comment[fi]=Osumalistan loppu saavutettu
 Comment[fr]=La fin de la liste des correspondances a été atteinte
 Comment[fy]=It ein fan de oerienkomstenlist is berikt
@@ -355,7 +358,7 @@
 Name[es]=Completado de texto: no hay concordancias
 Name[et]=Teksti lõpetamine: kokkulangevus puudub
 Name[eu]=Testu-osaketa: ez dago bat datorrenik
-Name[fa]=تکمیل متن: بدون لنگه
+Name[fa]=تکمیل متن:بدون تطبیق
 Name[fi]=Tekstintäydennys: ei osumia
 Name[fr]=Autocomplètement de texte : aucune correspondance
 Name[fy]=Tekstkompletearing - gjin oerienkomst
@@ -428,6 +431,7 @@
 Comment[es]=No se encontró ningún completado concordante
 Comment[et]=Kokkulangevat lõppu ei leitud
 Comment[eu]=Ez da bat datorren osaketarik aurkitu
+Comment[fa]=تکمیل مطابق پیدا نشد
 Comment[fi]=Ei osumia täydennettäväksi
 Comment[fr]=Aucune possibilité d'auto-complètement trouvée
 Comment[fy]=gjin oerienkomstige kompletearings binne fun
@@ -494,7 +498,7 @@
 Name[es]=Completado de texto: concordancia parcial
 Name[et]=Teksti lõpetamine: osaline kokkulangevus
 Name[eu]=Testu-osaketa: bat datorren partziala
-Name[fa]=تکمیل متن: قسمتی نظیر
+Name[fa]=تکمیل متن:تطبیق جزیی
 Name[fi]=Tekstintäydennys: osittainen osuma
 Name[fr]=Autocomplètement de texte : correspondance partielle
 Name[fy]=Tekstkompletearing - foar in diel oerienkommend
@@ -567,6 +571,7 @@
 Comment[es]=Hay más de una posible concordancia
 Comment[et]=Võimalike variante on rohkem kui üks
 Comment[eu]=Bat datorrenak bat baino gehiago dira
+Comment[fa]=بیش از یک تطبیق ممکن وجود دارد
 Comment[fi]=Useampia mahdollisia osumia
 Comment[fr]=Au moins deux correspondances ont été trouvées
 Comment[fy]=Der is wierskynlik mear as ien oerienkomst
@@ -634,7 +639,7 @@
 Name[es]=No se puede abrir archivo
 Name[et]=Faili avamine ebaõnnestus
 Name[eu]=Ezin da fitxategia ireki
-Name[fa]=نتوانستم پرونده را بگشایم
+Name[fa]=نمی‌توانید پرونده را باز کنید
 Name[fi]=Ei voitu avata tiedostoa
 Name[fo]=Kann ikki opna fíla
 Name[fr]=Impossible d'ouvrir un fichier
@@ -714,7 +719,7 @@
 Comment[es]=El archivo seleccionado no se puede abrir para leer o escribir.
 Comment[et]=Valitud faili pole võimalik avada lugemiseks või kirjutamiseks.
 Comment[eu]=Hautatutako fitxategia ezin da irakurtzeko edo idazteko ireki
-Comment[fa]=پرونده‌ی انتخاب شده برای خواندن یا نوشتن قابل گشودن نمی‌باشد
+Comment[fa]=پروندۀ انتخاب شده نمی‌تواند برای خواندن یا نوشتن باز شود
 Comment[fi]=Valittua tiedostoa ei voida avata luettavaksi tai kirjoitettavaksi
 Comment[fr]=Le fichier sélectionné ne peut être ouvert ni en lecture ni en écriture
 Comment[fy]=It selektearre triem kin net iepene wurde om te lêzen of skriuwen
@@ -795,7 +800,7 @@
 Name[es]=Error fatal
 Name[et]=Fataalne viga
 Name[eu]=Errore larria
-Name[fa]=خطای اساسی
+Name[fa]=خطای مخرب
 Name[fi]=Peruuttamaton virhe
 Name[fr]=Problème critique
 Name[fy]=Fatale flater
@@ -869,6 +874,7 @@
 Comment[es]=Hubo un error serio que ha causado el cierre del programa
 Comment[et]=Ilmnes tõsine viga, mis sundis programmi tööd lõpetama
 Comment[eu]=Errore larria gertatu da eta programa itxiarazi du.
+Comment[fa]=یک خطای جدی باعث خروج برنامه شد
 Comment[fi]=Tapahtui vakava virhe, jonka takia ohjelma lopetettiin
 Comment[fr]=Un problème grave a provoqué l'arrêt du programme
 Comment[fy]=Der wie in serieuse flater wertroch it programma sluten is
@@ -937,7 +943,7 @@
 Name[es]=Notificación
 Name[et]=Märguanne
 Name[eu]=Jakinarazpena
-Name[fa]=اعلام
+Name[fa]=اخطار
 Name[fi]=Huomautus
 Name[fo]=Áminning
 Name[fy]=Notifikaasje
@@ -1011,6 +1017,7 @@
 Comment[es]=Ocurrió algo especial en el programa
 Comment[et]=Programmis juhtus midagi erilist
 Comment[eu]=Gertaera berezia gertatu da programan
+Comment[fa]=اتفاق خاصی در برنامه رخ داد
 Comment[fi]=Ohjelmassa tapahtui jotain erikoista
 Comment[fr]=Quelque chose de spécial s'est passé dans le programme
 Comment[fy]=Der barde wat spesjaals yn't programma
@@ -1156,6 +1163,7 @@
 Comment[es]=Hubo un error en el programa que puede causar problemas
 Comment[et]=Programmis ilmnes viga, mis võib tekitada probleeme
 Comment[eu]=Arazoak sor ditzakeen errorea gertatu da programan
+Comment[fa]=خطایی در برنامه وجود دارد که ممکن است باعث بروزمشکلاتی شود
 Comment[fi]=Ohjelmassa tapahtui virhe, joka voi aiheuttaa ongelmia
 Comment[fr]=Une erreur est survenu dans le programme, pouvant causer des dysfonctionnements.
 Comment[fy]=Der wie in flater yn it programma wat swierrichheid feroorsaakje kin
@@ -1224,7 +1232,7 @@
 Name[es]=Catástrofe
 Name[et]=Katastroof
 Name[eu]=Ondamendia
-Name[fa]=مصیبت
+Name[fa]=فاجعه
 Name[fi]=Katastrofi
 Name[fy]=Katastrofe
 Name[ga]=Tubaiste
@@ -1299,7 +1307,7 @@
 Comment[es]=Ocurrió un error muy serio, causando al menos el cierre del programa.
 Comment[et]=Ilmnes väga tõsine viga, mis sundis programmi tööd lõpetama.
 Comment[eu]=Errore oso larria gertatu da, programa itxiaraziz
-Comment[fa]=خطایی جدی رخ داد، که حداقل باعث خروج برنامه شد
+Comment[fa]=یک خطای بسیار جدی رخ داد ،حداقل باعث خروج برنامه شد.
 Comment[fi]=Tapahtui vakava virhe, jonka takia ohjelma ainakin lopetetaan.
 Comment[fr]=Une erreur très grave s'est produite, provoquant au moins l'arrêt du programme
 Comment[fy]=In serieuse flater had him foardyn wertroch it programma sluten is
@@ -1443,6 +1451,7 @@
 Comment[es]=KDE está arrancando
 Comment[et]=KDE käivitub
 Comment[eu]=KDE abiarazten ari da
+Comment[fa]=KDEدر حال راه اندازی است
 Comment[fi]=KDE:tä käynnistetään
 Comment[fr]=KDE est en cours de démarrage
 Comment[fy]=KDE Start op
@@ -1584,6 +1593,7 @@
 Comment[es]=KDE está terminando
 Comment[et]=KDE lõpetab töö
 Comment[eu]=KDE bukatzen ari da
+Comment[fa]=KDE در حال خروج است
 Comment[fi]=KDE:tä sammutetaan
 Comment[fr]=KDE est en cours d'arrêt
 Comment[fy]=KDE giet nei de útgong
@@ -1730,7 +1740,7 @@
 Comment[es]=Se ha producido un error de impresión.
 Comment[et]=Trükkimisel ilmnes viga
 Comment[eu]=Inprimatze-errorea gertatu da
-Comment[fa]=خطای چاپی رخ داد
+Comment[fa]=خطای چاپی رخ داده است
 Comment[fi]=Tapahtui tulostusvirhe
 Comment[fr]=Un problème d'impression est survenu
 Comment[fy]=In printflater had him foardyn
@@ -1876,7 +1886,7 @@
 Comment[es]=Se está mostrando un mensaje de información
 Comment[et]=Näidatakse informatiivset teadet
 Comment[eu]=Informazioren mezua erakusten ari da
-Comment[fa]=یک پیام اطلاعاتی نمایش داده می‌شود
+Comment[fa]=پیام اطلاعاتی نمایش داده می‌شود
 Comment[fi]=Näytetään tiedotusviesti
 Comment[fr]=Un message d'information est affiché actuellement
 Comment[fy]=In ynformaasje berjocht lit him sjen
@@ -1952,7 +1962,7 @@
 Name[es]=Mensaje de aviso
 Name[et]=Hoiatav teade
 Name[eu]=Abisuaren mezua
-Name[fa]=پیام اخطاری
+Name[fa]=پیام اخطار
 Name[fi]=Varoitusviesti
 Name[fr]=Message d'avertissement
 Name[fy]=Warskôgings berjocht
@@ -2022,7 +2032,7 @@
 Comment[es]=Se está mostrando un mensaje de aviso
 Comment[et]=Näidatakse hoiatavat teadet
 Comment[eu]=Abisuaren mezua erakusten ari da
-Comment[fa]=یک پیام اخطاری نمایش داده می‌شود
+Comment[fa]=پیام اخطار نمایش داده می‌شود
 Comment[fi]=Näytetään varoitusviesti
 Comment[fr]=Un message d'avertissement est affiché actuellement
 Comment[fy]=In warskôgings berjocht lit him sjen
@@ -2132,6 +2142,7 @@
 Name[ro]=Mesaj situaţie critică
 Name[ru]=Критическая ошибка
 Name[rw]=Ubutumwa bunenga
+Name[se]=Heahttediehtu
 Name[sk]=Kritická správa
 Name[sl]=Kritično sporočilo
 Name[sq]=Porosi Kritik
@@ -2167,7 +2178,7 @@
 Comment[es]=Se está mostrando un mensaje crítico
 Comment[et]=Näidatakse kriitilist teadet
 Comment[eu]=Mezu kritikoa erakusten ari da
-Comment[fa]=یک پیام بحرانی نمایش داده می‌شود
+Comment[fa]=پیام بحرانی نمایش داده می‌شود
 Comment[fi]=Näytetään kriittinen viesti
 Comment[fr]=Un message critique est affiché actuellement
 Comment[fy]=In krityk berjocht let him sjen
@@ -2201,6 +2212,7 @@
 Comment[ro]=A fost afişat un mesaj de situaţie critică
 Comment[ru]=Вывод критического сообщения
 Comment[rw]=Ubutumwa bunenga bwerekanwe
+Comment[se]=Heahttediehtu čájehuvvo
 Comment[sk]=Je zobrazená kritická správa
 Comment[sl]=Prikazano je kritično sporočilo
 Comment[sq]=Një porosi kritike është paraqitur
@@ -2314,7 +2326,7 @@
 Comment[es]=Se está haciendo una pregunta
 Comment[et]=Esitatakse küsimus
 Comment[eu]=Galdera egiten ari da
-Comment[fa]=سوالی مطرح می‌شود
+Comment[fa]=سوالی پرسیده می‌شود
 Comment[fi]=Kysytään kysymys
 Comment[fr]=Une question est posée actuellement
 Comment[fy]=In fraach is stelt
Index: kdecore/kconfig.h
===================================================================
--- kdecore/kconfig.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kconfig.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -280,14 +280,14 @@
   /**
    * Returns a ref-counted pointer to a shared read-write config object.
    * @param fileName the name of the file to use for the configuration
-   * @param immutable if true, force the config object to be read-only.
+   * @param readOnly set the config object's read-only status
    * @param bUseKDEGlobals Toggle reading the global KDE configuration file.
    */
-  static KSharedConfig::Ptr openConfig(const QString& fileName, bool immutable = false,
+  static KSharedConfig::Ptr openConfig(const QString& fileName, bool readOnly = false,
     bool bUseKDEGlobals = true);
 
 private:
-  KSharedConfig( const QString& fileName, bool immutable, bool useKDEGlobals );
+  KSharedConfig( const QString& fileName, bool readOnly, bool useKDEGlobals );
   ~KSharedConfig();
 
   static QValueList<KSharedConfig*> *s_list;
Index: kdecore/kicontheme.cpp
===================================================================
--- kdecore/kicontheme.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kicontheme.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -106,6 +106,8 @@
     // Find the theme description file. These are always global.
 
     icnlibs = KGlobal::dirs()->resourceDirs("icon");
+    icnlibs += KGlobal::dirs()->resourceDirs("xdgdata-icon");
+    icnlibs += "/usr/share/pixmaps";
     for (it=icnlibs.begin(); it!=icnlibs.end(); ++it)
     {
         cDir = *it + name + "/";
@@ -340,6 +342,20 @@
     return iconlistResult;
 }
 
+bool KIconTheme::hasContext(KIcon::Context context) const
+{
+    QPtrListIterator<KIconThemeDir> dirs(mDirs);
+    KIconThemeDir *dir;
+
+    for ( ; dirs.current(); ++dirs)
+    {
+        dir = dirs.current();
+        if ((context == KIcon::Any) || (context == dir->context()))
+            return true;
+    }
+    return false;
+}
+
 KIcon KIconTheme::iconPath(const QString& name, int size, KIcon::MatchType match) const
 {
     KIcon icon;
@@ -453,6 +469,8 @@
 
     _theme_list = new QStringList();
     QStringList icnlibs = KGlobal::dirs()->resourceDirs("icon");
+    icnlibs += (KGlobal::dirs()->resourceDirs("xdgdata-icon"));
+    icnlibs += "/usr/share/pixmaps";
     QStringList::ConstIterator it;
     for (it=icnlibs.begin(); it!=icnlibs.end(); ++it)
     {
@@ -517,6 +535,20 @@
         mContext = KIcon::Application;
     else if (tmp == "Actions")
         mContext = KIcon::Action;
+    else if (tmp == "Animations")
+        mContext = KIcon::Animation;
+    else if (tmp == "Categories")
+        mContext = KIcon::Category;
+    else if (tmp == "Emblems")
+        mContext = KIcon::Emblem;
+    else if (tmp == "Emotes")
+        mContext = KIcon::Emote;
+    else if (tmp == "International")
+        mContext = KIcon::International;
+    else if (tmp == "Places")
+        mContext = KIcon::Place;
+    else if (tmp == "Status")
+        mContext = KIcon::StatusIcon;
     else {
         kdDebug(264) << "Invalid Context= line for icon theme: " << mDir << "\n";
         return;
Index: kdecore/kiconloader.cpp
===================================================================
--- kdecore/kiconloader.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kiconloader.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,6 +26,8 @@
 #include <qmovie.h>
 #include <qbitmap.h>
 
+#include <kapplication.h>
+#include <kipc.h>
 #include <kdebug.h>
 #include <kstandarddirs.h>
 #include <kglobal.h>
@@ -49,23 +51,10 @@
 #include "svgicons/ksvgiconpainter.h"
 #endif
 
+#include "kiconloader_p.h"
+
 /*** KIconThemeNode: A node in the icon theme dependancy tree. ***/
 
-class KIconThemeNode
-{
-public:
-
-    KIconThemeNode(KIconTheme *_theme);
-    ~KIconThemeNode();
-
-    void queryIcons(QStringList *lst, int size, KIcon::Context context) const;
-    void queryIconsByContext(QStringList *lst, int size, KIcon::Context context) const;
-    KIcon findIcon(const QString& name, int size, KIcon::MatchType match) const;
-    void printTree(QString& dbgString) const;
-
-    KIconTheme *theme;
-};
-
 KIconThemeNode::KIconThemeNode(KIconTheme *_theme)
 {
     theme = _theme;
@@ -115,26 +104,6 @@
     bool alphaBlending;
 };
 
-
-/*** d pointer for KIconLoader. ***/
-
-struct KIconLoaderPrivate
-{
-    QStringList mThemesInTree;
-    KIconGroup *mpGroups;
-    KIconThemeNode *mpThemeRoot;
-    KStandardDirs *mpDirs;
-    KIconEffect mpEffect;
-    QDict<QImage> imgDict;
-    QImage lastImage; // last loaded image without effect applied
-    QString lastImageKey; // key for icon without effect
-    int lastIconType; // see KIcon::type
-    int lastIconThreshold; // see KIcon::threshold
-    QPtrList<KIconThemeNode> links;
-    bool extraDesktopIconsLoaded :1;
-    bool delayedLoading :1;
-};
-
 #define KICONLOADER_CHECKS
 #ifdef KICONLOADER_CHECKS
 // Keep a list of recently created and destroyed KIconLoader instances in order
@@ -174,41 +143,56 @@
         }
     kiconloaders->append( KIconLoaderDebug( this, _appname ));
 #endif
+    d = new KIconLoaderPrivate;
+    d->q = this;
+    d->mpGroups = 0L;
+    d->imgDict.setAutoDelete(true);
+    d->links.setAutoDelete(true);
+
+    if (kapp) {
+        kapp->addKipcEventMask(KIPC::IconChanged);
+        QObject::connect(kapp, SIGNAL(iconChanged(int)), d, SLOT(slotIconChanged()));
+    }
+
     init( _appname, _dirs );
 }
 
 void KIconLoader::reconfigure( const QString& _appname, KStandardDirs *_dirs )
 {
-    delete d;
+    d->links.clear();
+    d->imgDict.clear();
+    d->mThemesInTree.clear();
+    d->lastImage.reset();
+    d->lastImageKey = QString::null;
+    delete d->mpGroups;
+
     init( _appname, _dirs );
 }
 
 void KIconLoader::init( const QString& _appname, KStandardDirs *_dirs )
 {
-    d = new KIconLoaderPrivate;
-    d->imgDict.setAutoDelete( true );
-    d->links.setAutoDelete(true);
-    d->extraDesktopIconsLoaded=false;
-    d->delayedLoading=false;
+    // If this is unequal to 0, the iconloader is initialized
+    // successfully.
+    d->mpThemeRoot = 0L;
 
+    d->appname = _appname;
+    d->extraDesktopIconsLoaded = false;
+    d->delayedLoading = false;
+
     if (_dirs)
-	d->mpDirs = _dirs;
+        d->mpDirs = _dirs;
     else
-	d->mpDirs = KGlobal::dirs();
+        d->mpDirs = KGlobal::dirs();
 
-    // If this is unequal to 0, the iconloader is initialized
-    // successfully.
-    d->mpThemeRoot = 0L;
-
     QString appname = _appname;
     if (appname.isEmpty())
-	appname = KGlobal::instance()->instanceName();
+        appname = KGlobal::instance()->instanceName();
 
     // Add the default theme and its base themes to the theme tree
     KIconTheme *def = new KIconTheme(KIconTheme::current(), appname);
     if (!def->isValid())
     {
-	delete def;
+        delete def;
         // warn, as this is actually a small penalty hit
         kdDebug(264) << "Couldn't find current icon theme, falling back to default." << endl;
 	def = new KIconTheme(KIconTheme::defaultThemeName(), appname);
@@ -260,6 +244,8 @@
     QStringList dirs;
     dirs += d->mpDirs->resourceDirs("icon");
     dirs += d->mpDirs->resourceDirs("pixmap");
+    dirs += d->mpDirs->resourceDirs("xdgdata-icon");
+    dirs += "/usr/share/pixmaps";
     for (QStringList::ConstIterator it = dirs.begin(); it != dirs.end(); ++it)
 	d->mpDirs->addResourceDir("appicon", *it);
 
@@ -850,34 +836,35 @@
 	*img = d->mpEffect.apply(*img, group, state);
     }
 
-    pix.convertFromImage(*img);
-
-    delete img;
-
     if (favIconOverlay)
     {
-        QPixmap favIcon(name, "PNG");
-        int x = pix.width() - favIcon.width() - 1,
-            y = pix.height() - favIcon.height() - 1;
-        if (pix.mask())
+        QImage favIcon(name, "PNG");
+        int x = img->width() - favIcon.width() - 1,
+            y = img->height() - favIcon.height() - 1;
+        if( favIcon.depth() != 32 )
+            favIcon = favIcon.convertDepth( 32 );
+        if( img->depth() != 32 )
+            *img = img->convertDepth( 32 );
+        for( int line = 0;
+             line < favIcon.height();
+             ++line )
         {
-            QBitmap mask = *pix.mask();
-            QBitmap fmask;
-            if (favIcon.mask())
-		fmask = *favIcon.mask();
-	    else {
-		// expensive, but works
-		fmask = favIcon.createHeuristicMask();
-	    }
-
-            bitBlt(&mask, x, y, &fmask,
-                   0, 0, favIcon.width(), favIcon.height(),
-                   favIcon.mask() ? Qt::OrROP : Qt::SetROP);
-            pix.setMask(mask);
+            QRgb* fpos = reinterpret_cast< QRgb* >( favIcon.scanLine( line ));
+            QRgb* ipos = reinterpret_cast< QRgb* >( img->scanLine( line + y )) + x;
+            for( int i = 0;
+                 i < favIcon.width();
+                 ++i, ++fpos, ++ipos )
+                *ipos = qRgba( ( qRed( *ipos ) * ( 255 - qAlpha( *fpos )) + qRed( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qGreen( *ipos ) * ( 255 - qAlpha( *fpos )) + qGreen( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qBlue( *ipos ) * ( 255 - qAlpha( *fpos )) + qBlue( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qAlpha( *ipos ) * ( 255 - qAlpha( *fpos )) + qAlpha( *fpos ) * qAlpha( *fpos )) / 255 );
         }
-        bitBlt(&pix, x, y, &favIcon);
     }
 
+    pix.convertFromImage(*img);
+
+    delete img;
+
     QPixmapCache::insert(key, pix);
     return pix;
 }
@@ -1130,6 +1117,16 @@
     return res2;
 }
 
+// used by KIconDialog to find out which contexts to offer in a combobox
+bool KIconLoader::hasContext(KIcon::Context context) const
+{
+    for ( KIconThemeNode *themeNode = d->links.first() ; themeNode ;
+            themeNode = d->links.next() )
+       if( themeNode->theme->hasContext( context ))
+           return true;
+    return false;
+}
+
 KIconEffect * KIconLoader::iconEffect() const
 {
     return &d->mpEffect;
@@ -1416,3 +1413,8 @@
 
     return pix;
 }
+
+void KIconLoaderPrivate::slotIconChanged()
+{
+  q->reconfigure(appname, mpDirs);
+}
Index: kdecore/kglobalaccel_x11.cpp
===================================================================
--- kdecore/kglobalaccel_x11.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kglobalaccel_x11.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -82,6 +82,7 @@
 : KAccelBase( KAccelBase::NATIVE_KEYS )
 , m_blocked( false )
 , m_blockingDisabled( false )
+, m_suspended( false )
 {
         if( all_accels == NULL )
             all_accels = new QValueList< KGlobalAccelPrivate* >;
@@ -133,6 +134,13 @@
         return KAccelBase::isEnabled() && !m_blocked;
 }
 
+// see #117169 - the bug is hard to reproduce, probably somewhere in X, testcase would be probably
+// difficult to make, and so on - just don't release the grabs and only ignore the events instead
+void KGlobalAccelPrivate::suspend( bool s )
+{
+	m_suspended = s;
+}
+
 bool KGlobalAccelPrivate::emitSignal( Signal )
 {
 	return false;
@@ -267,7 +275,7 @@
                 XFlush( qt_xdisplay()); // avoid X(?) bug
         }
 
-	if( !isEnabledInternal())
+	if( !isEnabledInternal() || m_suspended )
 		return false;
 
 	CodeMod codemod;
@@ -317,6 +325,7 @@
 #endif
 		return false;
 	}
+        
 	KAccelAction* pAction = m_rgCodeModToAction[codemod];
 
 	if( !pAction ) {
Index: kdecore/kiconloader.h
===================================================================
--- kdecore/kiconloader.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kiconloader.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -262,6 +262,11 @@
 				    KIcon::Context context=KIcon::Any) const;
 
     /**
+     * @internal
+     */
+    bool hasContext( KIcon::Context context ) const;
+
+    /**
      * Returns a list of all icons (*.png or *.xpm extension) in the
      * given directory.
      * @param iconsDir the directory to search in
Index: kdecore/all_languages.desktop
===================================================================
--- kdecore/all_languages.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/all_languages.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -5,7 +5,7 @@
 Name[bn]=আফার
 Name[cy]=Afareg
 Name[eo]=Afara
-Name[fa]=آفر
+Name[fa]=افار
 Name[ga]=Afárais
 Name[he]=אפאר
 Name[hi]=अफ्र
@@ -56,7 +56,7 @@
 Name[de]=Abhasisch
 Name[eo]=Abĥaza
 Name[et]=Abhaasia
-Name[fa]=آبخازیان
+Name[fa]=ابخازیان
 Name[fi]=Abhaasi
 Name[fr]=Abkhaze
 Name[fy]=Abkhasysk
@@ -172,7 +172,7 @@
 Name[eo]=Afrikansa
 Name[et]=Afrikaani
 Name[eu]=Afrikaansa
-Name[fa]=آفریکانس
+Name[fa]=آفریقایی
 Name[fy]=Afrikaansk
 Name[ga]=Afracáinis
 Name[gl]=Africáner
@@ -433,7 +433,7 @@
 Name[de]=Aimara
 Name[eo]=Ajmara
 Name[et]=Aimaraa
-Name[fa]=آیمارا
+Name[fa]=آیمارایی
 Name[fi]=Aimara
 Name[ga]=Adhmarais
 Name[gl]=Aimará
@@ -558,7 +558,7 @@
 Name[de]=Baschkirisch
 Name[eo]=Baŝkira
 Name[et]=Baškiiri
-Name[fa]=بشکیر
+Name[fa]=بشکیری
 Name[fi]=Baškiiri
 Name[fr]=Bachkir
 Name[ga]=Baiscíris
@@ -764,7 +764,7 @@
 Name[ca]=Biharí
 Name[cy]=Bihareg
 Name[de]=Biharisch
-Name[fa]=بیحاری
+Name[fa]=بیهاری
 Name[fy]=Bihary
 Name[ga]=Bihairis
 Name[he]=ביהרי
@@ -910,7 +910,7 @@
 Name[es]=Tibetano
 Name[et]=Tiibeti
 Name[eu]=Tibetera
-Name[fa]=تبتی
+Name[fa]=تیبوتیایی
 Name[fi]=Tiibet
 Name[fr]=Tibétain
 Name[fy]=Tibetaansk
@@ -983,7 +983,7 @@
 Name[es]=Bretón
 Name[et]=Bretooni
 Name[eu]=Bretoiera
-Name[fa]=برتون
+Name[fa]=برتونیایی
 Name[fi]=Bretoni
 Name[fy]=Bretonsk
 Name[ga]=Briotáinis
@@ -1135,7 +1135,7 @@
 Name[es]=Catalán
 Name[et]=Katalaani
 Name[eu]=Katalaniera
-Name[fa]=کاتالان
+Name[fa]=کاتالانی
 Name[fi]=Katalaani
 Name[fy]=Katalaansk
 Name[ga]=Catalóinis
@@ -1205,7 +1205,7 @@
 Name[eo]=Ĉeĉena
 Name[es]=Checheno
 Name[et]=Tšetšeeni
-Name[fa]=چچن
+Name[fa]=چچنی
 Name[fi]=Tšetšeeni
 Name[fr]=Tchétchène
 Name[fy]=Tsjechysk
@@ -1267,7 +1267,7 @@
 Name[bs]=Kamoro
 Name[cy]=Chamorreg
 Name[eo]=Ĉamora
-Name[fa]=کامورو
+Name[fa]=کاماروئی
 Name[ga]=Seamóróis
 Name[he]=צ'מורו
 Name[hi]=केमोरो
@@ -1317,7 +1317,7 @@
 Name[es]=Corso
 Name[et]=Korsika
 Name[eu]=Korsiera
-Name[fa]=کرسیایی
+Name[fa]=کورسیکانی
 Name[fi]=Korsika
 Name[fr]=Corse
 Name[fy]=Korsikaansk
@@ -1462,7 +1462,7 @@
 Name[es]=Eslávo eclesiástico
 Name[et]=Kirikuslaavi
 Name[eu]=Church Eslaviera
-Name[fa]=اسلواک کلیسایی
+Name[fa]=یوگوسلاویایی
 Name[fi]=Kirkkoslaavi
 Name[fr]=Slavon d'égise
 Name[fy]=Tsjerk-slavysk
@@ -1528,7 +1528,7 @@
 Name[de]=Chuvaschisch
 Name[eo]=Ĉuvaŝa
 Name[et]=Tšuvaši
-Name[fa]=چووش
+Name[fa]=چواش
 Name[fi]=Tšuvassi
 Name[fr]=Tchouvache
 Name[ga]=Suvais
@@ -1811,7 +1811,7 @@
 Name[bg]=Джонкгха
 Name[bn]=জঙখা
 Name[cy]=Dzongkhaeg
-Name[fa]=زنگخا
+Name[fa]=زونگخا
 Name[gl]=Dzongca
 Name[he]=ג'ונקה
 Name[hi]=झोंखा
@@ -2018,6 +2018,7 @@
 Name[es]=Inglés británico
 Name[et]=Briti inglise
 Name[eu]=Ingelesa (britainiarra)
+Name[fa]=انگلیسی بریتانیایی
 Name[fi]=Brittienglanti
 Name[fr]=Anglais britannique
 Name[fy]=Britsk Ingelsk
@@ -2077,6 +2078,7 @@
 Name[es]=Inglés americano
 Name[et]=Ameerika inglise
 Name[eu]=Ingelesa (amerikarra)
+Name[fa]=انگلیسی امریکایی
 Name[fi]=Amerikanenglanti
 Name[fr]=Anglais américain
 Name[fy]=Amerikaansk Ingelsk
@@ -2129,7 +2131,7 @@
 Name[bn]=এস্পারান্তো
 Name[br]=Esperanteg
 Name[eu]=Esperantoa
-Name[fa]=اسپرانتو
+Name[fa]=اسپرانتور
 Name[fr]=Espéranto
 Name[he]=אספרנטו
 Name[hi]=एस्परेंतो
@@ -2335,7 +2337,7 @@
 Name[es]=Vasco
 Name[et]=Baski
 Name[eu]=Euskara
-Name[fa]=باسک
+Name[fa]=باسکی
 Name[fi]=Baski
 Name[fy]=Baskysk
 Name[ga]=Bascais
@@ -2623,7 +2625,7 @@
 Name[es]=Feroés
 Name[et]=Fääri
 Name[eu]=Faroera
-Name[fa]=فارویی
+Name[fa]=فاروسی
 Name[fi]=Fääri
 Name[fr]=Féroïen
 Name[fy]=Faeroersk
@@ -2770,7 +2772,7 @@
 Name[es]=Frisio
 Name[et]=Friisi
 Name[eu]=Frisiera
-Name[fa]=فریسیایی
+Name[fa]=فریسی
 Name[fi]=Friisi
 Name[fr]=Frison
 Name[fy]=Frysk
@@ -2835,6 +2837,7 @@
 Name[es]=Gaélico irlandés
 Name[et]=Iiri gaeli
 Name[eu]=Irlandar gaelikoa
+Name[fa]=اسکاتلندی ایرلندی
 Name[fi]=Irlannin gael
 Name[fr]=Gaélique irlandais
 Name[fy]=Iersk Gaelic
@@ -2891,7 +2894,7 @@
 Name[es]=Gaélico
 Name[et]=Gaeli
 Name[eu]=Gaelikoa
-Name[fa]=گالیی
+Name[fa]=اسکاتلندی
 Name[fi]=Gael
 Name[fr]=Gaélique
 Name[ga]=Gàidhlig
@@ -2953,6 +2956,7 @@
 Name[es]=Gallego
 Name[et]=Galeegi
 Name[eu]=Galiziera
+Name[fa]=اسکاتلندی
 Name[fi]=Gallicia
 Name[fr]=Gaélicien
 Name[fy]=Galiciaansk
@@ -3012,7 +3016,7 @@
 Name[es]=Guaraní
 Name[et]=Guaranii
 Name[eu]=Guaraniera
-Name[fa]=گورانی
+Name[fa]=گوارانی
 Name[ga]=Guaráinis
 Name[he]=גוארני
 Name[hi]=गौरानी
@@ -3055,7 +3059,7 @@
 Name[eo]= Guĝarata
 Name[et]=Gudžarati
 Name[eu]=Gujaratera
-Name[fa]=گوراجاتی
+Name[fa]=گجراتی
 Name[fi]=Gudžarati
 Name[ga]=Gúisearáitis
 Name[gl]=Guxarati
@@ -3103,7 +3107,7 @@
 Name[eo]=Manksa
 Name[et]=Mänksi
 Name[eu]=Manera
-Name[fa]=منکس
+Name[fa]=مانکسی
 Name[fr]=Mannois
 Name[ga]=Manainnis
 Name[he]=מנקס
@@ -3145,7 +3149,7 @@
 Name[br]=Haousa
 Name[de]=Haussa-Sprache
 Name[eo]=Haŭsa
-Name[fa]=هاوسایی
+Name[fa]=هوسا
 Name[fr]=Haoussa
 Name[ga]=Hásais
 Name[he]=האוסה
@@ -3361,7 +3365,7 @@
 Name[es]=Croata
 Name[et]=Horvaadi
 Name[eu]=Kroaziera
-Name[fa]=کروات
+Name[fa]=کروواسیایی
 Name[fi]=Kroatia
 Name[fr]=Croate
 Name[fy]=Kroatysk
@@ -3435,6 +3439,7 @@
 Name[es]=Serbio superior
 Name[et]=Ülemsorbi
 Name[eu]=Goi Serbiera
+Name[fa]=صربستان شمالی
 Name[fi]=Yläsorbi
 Name[fr]=Haut Sorabe
 Name[fy]=Heech Sorbysk
@@ -3638,7 +3643,7 @@
 Name[bn]=হেরেরো
 Name[cy]=Hausa
 Name[eo]=Herera
-Name[fa]=حراره‌ای
+Name[fa]=هررو
 Name[ga]=Heiréiróis
 Name[he]=הררו
 Name[hi]=हेरेरो
@@ -3676,7 +3681,7 @@
 Name[bg]=Интерлингва
 Name[bn]=ইন্টারলিঙ্গুয়া
 Name[eo]=Interlingvao
-Name[fa]=اینترلینگو
+Name[fa]=میان زبانی
 Name[ga]=Idirtheanga
 Name[he]=אינטרלינגואה
 Name[hi]=इंटरलिंगुआ
@@ -3790,10 +3795,9 @@
 Name[bg]=Оксидентал
 Name[bn]=ইন্টারলিং
 Name[br]=Interlingeg
-Name[de]=Interlingua
 Name[eo]=Interlingveo
 Name[es]=Interlinga
-Name[fa]=اینترلینگ
+Name[fa]=میان زبانی
 Name[fy]=Interlingua
 Name[ga]=Idirtheanga iartharach
 Name[gl]=Interlingua
@@ -3834,7 +3838,7 @@
 Name[br]=Inupiak
 Name[bs]=Inupiak
 Name[eo]=Inuita
-Name[fa]=اینپیاک
+Name[fa]=اینوپیاک
 Name[fi]=Inupiatun
 Name[he]=אינופיאק
 Name[hi]=इनुपिआक
@@ -4193,7 +4197,7 @@
 Name[es]=Javanés
 Name[et]=Jaava
 Name[eu]=Javera
-Name[fa]=جاوانی
+Name[fa]=جاوانیز
 Name[fi]=Jaava
 Name[fr]=Javanais
 Name[fy]=Javaansk
@@ -4266,7 +4270,7 @@
 Name[es]=Georgiano
 Name[et]=Gruusia
 Name[eu]=Georgiera
-Name[fa]=گرجستانی
+Name[fa]=گرجی
 Name[fi]=Georgia
 Name[fr]=Géorgien
 Name[fy]=Georgysk
@@ -4328,7 +4332,7 @@
 Name[bn]=কিকুয়ু
 Name[de]=Kikuyu-Sprache
 Name[et]=Kikuju
-Name[fa]=کیکویو
+Name[fa]=کیکویا
 Name[fi]=Kikuju
 Name[ga]=Ciocúis
 Name[he]=קיקויו
@@ -4475,7 +4479,7 @@
 Name[cs]=Kmérský
 Name[eo]=Kmera
 Name[et]=Khmeeri
-Name[fa]=خمر
+Name[fa]=خمری
 Name[ga]=Ciméiris
 Name[he]=חמר
 Name[hi]=ख्मेर
@@ -4521,7 +4525,7 @@
 Name[bg]=Каннада
 Name[bn]=কন্নাডা
 Name[br]=Kanada
-Name[fa]=کانادا
+Name[fa]=کانادایی
 Name[ga]=Cannadais
 Name[he]=קנאדה
 Name[hi]=कन्नड़
@@ -4819,7 +4823,7 @@
 Name[el]=Κορνουαλικά
 Name[eo]=Kornvala
 Name[et]=Korni
-Name[fa]=کرنیش
+Name[fa]=کرنیشی
 Name[fi]=Korni
 Name[fr]=Cornique
 Name[fy]=Cornysk
@@ -4882,7 +4886,7 @@
 Name[es]=Kirguiz
 Name[et]=Kirgiisi
 Name[eu]=Kirgiera
-Name[fa]=قرقیز
+Name[fa]=قرقیزی
 Name[fi]=Kirgiisi
 Name[fr]=Kirghize
 Name[fy]=Kirgizysk
@@ -5016,7 +5020,7 @@
 Name[es]=Luxemburgués
 Name[et]=Luksemburgi
 Name[eu]=Luxenburgera
-Name[fa]=لوگزامبورگی
+Name[fa]=لوکزامبورگ
 Name[fi]=Luxemburg
 Name[fr]=Luxembourgeois
 Name[fy]=Luksemboarchsk
@@ -5083,7 +5087,7 @@
 Name[eo]=Limburga
 Name[es]=Limburgano
 Name[et]=Limburgi
-Name[fa]=لیمبورگایی
+Name[fa]=لیمبرگان
 Name[fi]=Limburgi
 Name[fr]=Limbourgeois
 Name[fy]=Limburgsk
@@ -5177,7 +5181,7 @@
 Name[eo]=Laŭa
 Name[es]=Laosiano
 Name[eu]=Laosera
-Name[fa]=لایوسی
+Name[fa]=لائویی
 Name[ga]=Láóis
 Name[he]=לאו
 Name[hi]=लाओ
@@ -5234,7 +5238,7 @@
 Name[es]=Lituano
 Name[et]=Leedu
 Name[eu]=Lituaniera
-Name[fa]=لیتوانیایی
+Name[fa]=لیتوانی
 Name[fi]=Liettua
 Name[fr]=Lituanien
 Name[fy]=Litouwsk
@@ -5311,7 +5315,7 @@
 Name[es]=Latvio
 Name[et]=Läti
 Name[eu]=Letoniera
-Name[fa]=لاتویایی
+Name[fa]=لاتوینی
 Name[fi]=Latvia
 Name[fr]=Letton
 Name[fy]=Letsk
@@ -5382,7 +5386,7 @@
 Name[es]=Malagasio
 Name[et]=Malagassi
 Name[eu]=Madagaskarera
-Name[fa]=مالاگاسیایی
+Name[fa]=مالاگازی
 Name[fi]=Malagasi
 Name[fr]=Malgache
 Name[fy]=Malagasysk
@@ -5511,7 +5515,7 @@
 Name[es]=Maorí
 Name[et]=Maoori
 Name[eu]=Maoria
-Name[fa]=مایوری
+Name[fa]=مائوری
 Name[ga]=Maorais
 Name[he]=מאורית
 Name[hi]=माओरी
@@ -5572,7 +5576,7 @@
 Name[es]=Macedonio
 Name[et]=Makedoonia
 Name[eu]=Mazedoniera
-Name[fa]=مقدونیه‌ای
+Name[fa]=مقدونی
 Name[fi]=Makedonia
 Name[fr]=Macédonien
 Name[fy]=Masedoanysk
@@ -5640,7 +5644,7 @@
 Name[eo]=Malajalama
 Name[es]=Malayo
 Name[et]=Malajalami
-Name[fa]=مالایالامی
+Name[fa]=مالی
 Name[fi]=Malajalam
 Name[ga]=Mailéalaimis
 Name[gl]=Malaialam
@@ -5771,7 +5775,7 @@
 Name[es]=Moldavo
 Name[et]=Moldaavia
 Name[eu]=Moldabiera
-Name[fa]=مولداویایی
+Name[fa]=مولداوی
 Name[fi]=Moldavia
 Name[fr]=Moldave
 Name[fy]=Moldavysk
@@ -5836,7 +5840,7 @@
 Name[eo]=Marata
 Name[es]=Maratí
 Name[eu]=Marathera
-Name[fa]=مراتی
+Name[fa]=ماراتی
 Name[fr]=Marathe
 Name[ga]=Maraitis
 Name[gl]=Marata
@@ -5887,7 +5891,7 @@
 Name[es]=Malayo
 Name[et]=Malaisia
 Name[eu]=Malaysiera
-Name[fa]=مالایی
+Name[fa]=مالی
 Name[fi]=Malaiji
 Name[fr]=Malais
 Name[fy]=Maleisk
@@ -5957,7 +5961,7 @@
 Name[es]=Maltés
 Name[et]=Malta
 Name[eu]=Maltera
-Name[fa]=مالتی
+Name[fa]=مالتز
 Name[fi]=Malta
 Name[fr]=Maltais
 Name[fy]=Malteesk
@@ -6030,7 +6034,7 @@
 Name[es]=Burmés
 Name[et]=Birma
 Name[eu]=Birmaniera
-Name[fa]=برمه‌ای
+Name[fa]=برمس
 Name[fi]=Burma
 Name[fr]=Birman
 Name[fy]=Burmeesk
@@ -6093,7 +6097,7 @@
 Name[el]=Ναουρού
 Name[eo]=Naura
 Name[eu]=Nauruera
-Name[fa]=نایرویی
+Name[fa]=نائورو
 Name[fr]=Nauruan
 Name[fy]=Naurûaansk
 Name[ga]=Nárúis
@@ -6144,7 +6148,7 @@
 Name[es]=Noruego Bokmål
 Name[et]=Norra bokmål
 Name[eu]=Norvegiera (Bokmål)
-Name[fa]=نروژی بکمال
+Name[fa]=نروژی بوکمال
 Name[fi]=Norja (bokmål)
 Name[fr]=Norvégien Bokmaal
 Name[fy]=Noarsk, Bokmål
@@ -6213,7 +6217,7 @@
 Name[es]=Ndebele del norte
 Name[et]=Põhja-ndebele
 Name[eu]=Ndebelera (iparraldekoa)
-Name[fa]=ان‌دبله، شمال
+Name[fa]=اندبل شمالی
 Name[fi]=Ndebele, Pohjoinen
 Name[fr]=Ndébélé du Nord
 Name[fy]=Ndebele, Noard
@@ -6281,6 +6285,7 @@
 Name[es]=Sajón bajo
 Name[et]=Alamsaksi
 Name[eu]=Beheko Sajoniera
+Name[fa]=ساکسونی سفلی
 Name[fi]=Alasaksa
 Name[fr]=Bas saxon (ou francique, ou plattdeutsch)
 Name[fy]=Neder Saksysk
@@ -6392,7 +6397,7 @@
 Name[ar]=الندونغا
 Name[bg]=Ндонга
 Name[bn]=নডোঙ্গা
-Name[fa]=ان‌دونگایی
+Name[fa]=اندونگا
 Name[ga]=Ndongais
 Name[he]=נדונגה
 Name[hi]=नदोन्गा
@@ -6464,7 +6469,7 @@
 Name[ms]=Belanda
 Name[mt]=Olandiż
 Name[nb]=Nederlandsk
-Name[nds]=Nedderlandsch
+Name[nds]=Nedderlannsch
 Name[nl]=Nederlands
 Name[nn]=Nederlandsk
 Name[nso]=Se-Dutch
@@ -6518,7 +6523,7 @@
 Name[es]=Noruego Nynorsk
 Name[et]=Norra nynorsk
 Name[eu]=Norvegiera (Nynorsk)
-Name[fa]=نروژی نینورسک
+Name[fa]=نرس جدید نروژی
 Name[fi]=Norja (nynorsk)
 Name[fr]=Norvégien Nynorsk
 Name[fy]=Noarsk, Nynorsk
@@ -6590,7 +6595,7 @@
 Name[es]=Ndebele del sur
 Name[et]=Lõuna-ndebele
 Name[eu]=Ndebelera (hegoaldekoa)
-Name[fa]=ان‌دبله، جنوب
+Name[fa]=اندبل جنوبی
 Name[fi]=Ndebele, Etelä
 Name[fr]=Ndébélé du Sud
 Name[fy]=Ndebele, Súd
@@ -6716,7 +6721,7 @@
 Name[el]=Νάβαχο
 Name[eo]=Navaha
 Name[et]=Navaho
-Name[fa]=ناواجویی
+Name[fa]=ناواجو
 Name[fi]=Navaho
 Name[fr]=Navaho
 Name[ga]=Navachóis
@@ -6759,7 +6764,7 @@
 Name[bn]=চিচেওয়া
 Name[de]=Nyanja
 Name[eo]=Ĉiĉeva
-Name[fa]=چیچوایی
+Name[fa]=چیچوا
 Name[fi]=Njandža
 Name[ga]=Siseivis
 Name[he]=צ'יצ'ווה
@@ -6811,7 +6816,7 @@
 Name[es]=Occitano
 Name[et]=Oktsitaani
 Name[eu]=Okzitaniera
-Name[fa]=اکیتانی
+Name[fa]=اُکیتان
 Name[fi]=Oksitaani
 Name[fy]=Oksitaansk
 Name[ga]=Ocatáinis
@@ -6867,7 +6872,7 @@
 Name[bg]=Афан Оромо
 Name[bn]=ওরোমো
 Name[eo]=Oroma
-Name[fa]=اورومویی
+Name[fa]=اورومو
 Name[ga]=Oraimis
 Name[he]=אורומו
 Name[hi]=ओरोमो
@@ -6907,7 +6912,7 @@
 Name[de]=Orija
 Name[eo]=Orijo
 Name[et]=Orija
-Name[fa]=اوریایی
+Name[fa]=اوریا
 Name[fi]=Orija
 Name[ga]=Oirísis
 Name[gl]=Orisa
@@ -6957,7 +6962,7 @@
 Name[es]=Osetio
 Name[et]=Osseedi
 Name[eu]=Osetiera
-Name[fa]=استیایی
+Name[fa]=اوستی قفقاز
 Name[fi]=Osseetti
 Name[fr]=Ossète
 Name[fy]=Ossetysk
@@ -7193,7 +7198,7 @@
 Name[es]=Pastún
 Name[et]=Puštu
 Name[eu]=Paxtuera
-Name[fa]=پشتون
+Name[fa]=پشتو
 Name[fi]=Paštu
 Name[ga]=Paistis
 Name[he]=פשטו
@@ -7553,6 +7558,7 @@
 Name[es]=Rumaní
 Name[et]=Mustlaskeel
 Name[eu]=Errumaniera
+Name[fa]=رومانی
 Name[fi]=Romani
 Name[fr]=Rromani
 Name[hr]=Romanski
@@ -7566,11 +7572,13 @@
 Name[nb]=Romani
 Name[nds]=Roomsch
 Name[nl]=Roma
+Name[nn]=Romani
 Name[pl]=Romski
 Name[pt]=Romeno
 Name[pt_BR]=Romeno
 Name[ro]=Ţigănească
 Name[ru]=Цыганский
+Name[se]=Románigiella
 Name[sk]=Románsky
 Name[sl]=romsko
 Name[sr]=Ромски
@@ -7669,7 +7677,7 @@
 Name[bn]=কিন্যারওয়াণ্ডা
 Name[et]=Ruanda
 Name[eu]=Kinyaruanda
-Name[fa]=کینیارواندا
+Name[fa]=کینیارواندایی
 Name[fi]=Ruanda
 Name[ga]=Cinearuáindis
 Name[gl]=Quiñaruanda
@@ -7774,7 +7782,7 @@
 Name[es]=Sardo
 Name[et]=Sardiinia
 Name[eu]=Sardiera
-Name[fa]=ساردینیایی
+Name[fa]=ساردینی
 Name[fi]=Sardi
 Name[fr]=Sarde
 Name[fy]=Sardinysk
@@ -7945,7 +7953,7 @@
 Name[bg]=Сангро
 Name[bn]=সাংগো
 Name[eo]=Sangoa
-Name[fa]=سانگویی
+Name[fa]=سانگو
 Name[ga]=Sangóis
 Name[he]=סאנגו
 Name[hi]=सैन्गो
@@ -7992,7 +8000,7 @@
 Name[es]=Sinhalés
 Name[et]=Singaleesi
 Name[eu]=Sinhala
-Name[fa]=سینهالسیی
+Name[fa]=سینهالس
 Name[fi]=Sinhali
 Name[fr]=Singhalais
 Name[fy]=Singaleesk
@@ -8213,7 +8221,7 @@
 Name[es]=Samoano
 Name[et]=Samoa
 Name[eu]=Samoera
-Name[fa]=ساموایی
+Name[fa]=ساموان
 Name[fi]=Samoa
 Name[fy]=Samoaansk
 Name[ga]=Samóis
@@ -8270,7 +8278,7 @@
 Name[bg]=Шона
 Name[bn]=শোনা
 Name[eo]=Ŝona
-Name[fa]=شانوایی
+Name[fa]=شوها
 Name[fi]=šona
 Name[ga]=Seoinis
 Name[he]=שונה
@@ -8319,7 +8327,7 @@
 Name[es]=Somalí
 Name[et]=Somaali
 Name[eu]=Somaliera
-Name[fa]=سومالیایی
+Name[fa]=سومالی
 Name[fy]=Somalysk
 Name[ga]=Somáilis
 Name[he]=סומלית
@@ -8383,7 +8391,7 @@
 Name[es]=Albanés
 Name[et]=Albaania
 Name[eu]=Albaniera
-Name[fa]=آلبانیایی
+Name[fa]=آلبانی
 Name[fi]=Albania
 Name[fr]=Albanais
 Name[fy]=Albaansk
@@ -8457,7 +8465,7 @@
 Name[es]=Serbio
 Name[et]=Serbia
 Name[eu]=Serbiera
-Name[fa]=صربی
+Name[fa]=صربستانی
 Name[fi]=Serbia
 Name[fr]=Serbe
 Name[fy]=Servysk
@@ -8527,6 +8535,7 @@
 Name[es]=Latín Serbio
 Name[et]=Serbia (ladina)
 Name[eu]=Serbiera (Latina)
+Name[fa]=صربستانی
 Name[fi]=Serbian latina
 Name[fr]=Serbe Latin
 Name[fy]=Servysk Latijnsk
@@ -8544,11 +8553,13 @@
 Name[nb]=Serbisk (latinsk)
 Name[nds]=Serbsch (latiensch Schrift)
 Name[nl]=Servisch Latijn
+Name[nn]=Serbisk, latinsk
 Name[pl]=Serbski łaciński
 Name[pt]=Sérvio Latino
 Name[pt_BR]=Sérvio Latino
 Name[ro]=Sîrbă latină
 Name[ru]=Сербский латинницей
+Name[se]=Serbialaš latiidnagiella
 Name[sk]=Srbský Latinka
 Name[sl]=srbsko latinsko
 Name[sr]=Српски латинични
@@ -8621,7 +8632,7 @@
 Name[es]=Sotho del sur
 Name[et]=Lõuna-sotho
 Name[eu]=Sothoera (egoaldekoa)
-Name[fa]=سوتو، جنوبی
+Name[fa]=سوتوی جنوبی
 Name[fi]=Sotho
 Name[fr]=Sotho du Sud
 Name[fy]=Sotho, Súd
@@ -8691,7 +8702,7 @@
 Name[es]=Sudanés
 Name[et]=Sunda
 Name[eu]=Sundanera
-Name[fa]=سوندانزی
+Name[fa]=ساندانیز
 Name[fi]=Sunda
 Name[fr]=Soudanais
 Name[fy]=Soendaneesk
@@ -8762,7 +8773,7 @@
 Name[es]=Sueco
 Name[et]=Rootsi
 Name[eu]=Suediera
-Name[fa]=سویدی
+Name[fa]=سوئدی
 Name[fi]=Ruotsi
 Name[fr]=Suédois
 Name[fy]=Sweedsk
@@ -8833,7 +8844,7 @@
 Name[es]=Suahili
 Name[et]=Suahiili
 Name[eu]=Swahiliera
-Name[fa]=سواحیلی
+Name[fa]=سواهیلی
 Name[ga]=Svahaílis
 Name[he]=סוואהילי
 Name[hi]=स्वाहिली
@@ -8939,7 +8950,7 @@
 Name[bn]=তেলেগু
 Name[br]=Telegu
 Name[eo]=Telugua
-Name[fa]=تلوگویی
+Name[fa]=تلوگو
 Name[fr]=Télougou
 Name[fy]=Telûgû
 Name[ga]=Teileagúis
@@ -9114,7 +9125,7 @@
 Name[de]=Tigrinja-Sprache
 Name[eo]=Tigraja
 Name[et]=Tigrinja
-Name[fa]=تیگرینیایی
+Name[fa]=تیگرینیا
 Name[fi]=Tigrinja
 Name[fr]=Tigrigna
 Name[fy]=Tigrysk
@@ -9233,7 +9244,7 @@
 Name[eo]=Cvana
 Name[et]=Tsvana
 Name[eu]=Tswanera
-Name[fa]=سوانسایی
+Name[fa]=تی سوانا
 Name[fi]=Tšwana
 Name[fy]=Tswanaansk
 Name[ga]=Suáinis
@@ -9277,7 +9288,7 @@
 Name[br]=Inizi Tonga
 Name[el]=Τόνγκα
 Name[eu]=Tongera
-Name[fa]=تونگایی
+Name[fa]=تونگا
 Name[fy]=Tongaansk
 Name[ga]=Tongais
 Name[he]=טונגה
@@ -9394,7 +9405,7 @@
 Name[de]=Tsonga-Sprache
 Name[eo]=Conga
 Name[eu]=Tsongera
-Name[fa]=سونگایی
+Name[fa]=تی سوانگا
 Name[fy]=Tsongaansk
 Name[ga]=Songais
 Name[he]=צונגה
@@ -9492,7 +9503,7 @@
 Name[bn]=টুয়ি
 Name[de]=Akan-Sprache
 Name[et]=Tvii
-Name[fa]=وییی
+Name[fa]=توی
 Name[he]=צ'ווי
 Name[hi]=त्वी
 Name[hu]=Tvi
@@ -9538,7 +9549,7 @@
 Name[es]=Tahitiano
 Name[et]=Tahiti
 Name[eu]=Tahitiera
-Name[fa]=تاهیتیایی
+Name[fa]=تاهیتی
 Name[fi]=Tahiti
 Name[fr]=Tahitien
 Name[fy]=Tahitiaansk
@@ -9601,7 +9612,7 @@
 Name[de]=Uigurisch
 Name[eo]=Ujgura
 Name[et]=Uiguuri
-Name[fa]=یوقیری
+Name[fa]=یوگر
 Name[fi]=Uiguuri
 Name[ga]=Úígiúiris
 Name[he]=אויגור
@@ -9663,7 +9674,7 @@
 Name[es]=Ucranio
 Name[et]=Ukraina
 Name[eu]=Ukrainiera
-Name[fa]=اوکراینی
+Name[fa]=اکراینی
 Name[fi]=Ukraina
 Name[fr]=Ukrainien
 Name[fy]=Oekraïnsk
@@ -9779,7 +9790,7 @@
 Name[es]=Uzbeko
 Name[et]=Usbeki
 Name[eu]=Uzbekera
-Name[fa]=ازبک
+Name[fa]=ازبکی
 Name[fi]=Uzbekki
 Name[fy]=Oezbeeksk
 Name[ga]=Úisbéicis
@@ -9944,7 +9955,7 @@
 Name[cy]=Volapuk
 Name[da]=Volapyk
 Name[eo]=Volapuko
-Name[fa]=وولاپکی
+Name[fa]=ولاپوک
 Name[he]=וולפיק
 Name[hi]=वोलापक
 Name[ja]=ヴォラピューク語
@@ -9987,7 +9998,7 @@
 Name[eo]=Valona
 Name[et]=Vallooni
 Name[eu]=Waloiera
-Name[fa]=والوونی
+Name[fa]=والونی
 Name[fi]=Valloni
 Name[fr]=Wallon
 Name[fy]=Waalsk
@@ -10053,7 +10064,7 @@
 Name[eo]=Volofa
 Name[et]=Volofi
 Name[eu]=Wolofera
-Name[fa]=ولفی
+Name[fa]=ولوف
 Name[ga]=Volaifis
 Name[he]=וולוף
 Name[hi]=वालाफ़
@@ -10139,7 +10150,7 @@
 Name[eo]=Jida
 Name[et]=Jidiš
 Name[eu]=Jiddish
-Name[fa]=ییدی
+Name[fa]=عبری
 Name[fi]=Jiddiš
 Name[fy]=Jiddysk
 Name[ga]=Giúdais
@@ -10194,7 +10205,7 @@
 Name[eo]=Joruba
 Name[et]=Joruba
 Name[eu]=Jorubera
-Name[fa]=یروبایی
+Name[fa]=یوروبا
 Name[fi]=Joruba
 Name[ga]=Iarúibis
 Name[gl]=Yorùbá
@@ -10238,7 +10249,7 @@
 Name[bg]=Жуанг
 Name[bn]=ঝুয়াং
 Name[et]=Zhuangi
-Name[fa]=ژوانگ
+Name[fa]=هونگ
 Name[ga]=Siuáingis
 Name[gl]=Chuan
 Name[he]=ג'ואנג
@@ -10364,6 +10375,7 @@
 Name[es]=Chino simplificado
 Name[et]=Hiina (lihtsustatud)
 Name[eu]=Txinatar soildua
+Name[fa]=زبان چینی ساده شده
 Name[fi]=Yksinkertaistettu kiina
 Name[fr]=Chinois simplifié
 Name[fy]=Sjineesk (ynfaldich)
@@ -10420,6 +10432,7 @@
 Name[es]=Chino (Hong Kong)
 Name[et]=Hiina (Hong Kong)
 Name[eu]=Txinera (Hong Kong)
+Name[fa]=چینی)هنگ کنگ(
 Name[fi]=Kiina (Hong Kong)
 Name[fr]=Chinois (Hong Kong)
 Name[fy]=Sjineesk (Hong Kong)
@@ -10437,11 +10450,13 @@
 Name[nb]=Kinesisk (Hong kong)
 Name[nds]=Chineesch (Hong Kong)
 Name[nl]=Chinees (Hong Kong)
+Name[nn]=Kinesisk (Hong Kong)
 Name[pl]=Chiński (Hong Kong)
 Name[pt]=Chinês (Hong Kong)
 Name[pt_BR]=Chinês (Hong Kong)
 Name[ro]=Chineză (Hong Kong)
 Name[ru]=Китайский (Гонконг)
+Name[se]=Kiinnágiella (Hong Kong)
 Name[sk]=Čínsky (Hong Kong)
 Name[sl]=kitajsko (Hong Kong)
 Name[sr]=Кинески (Хонгконг)
@@ -10469,6 +10484,7 @@
 Name[es]=Chino tradicional
 Name[et]=Hiina (traditsiooniline)
 Name[eu]=Txinatar tradizionala
+Name[fa]=چینی سنتی
 Name[fi]=Perinteinen kiina
 Name[fr]=Chinois traditionnel
 Name[fy]=Sjineesk (tradisjoniel)
@@ -10525,7 +10541,7 @@
 Name[es]=Zulú
 Name[et]=Suulu
 Name[eu]=Zuluera
-Name[fa]=زولو
+Name[fa]=ناتالی
 Name[fr]=Zoulou
 Name[ga]=Súlúis
 Name[he]=זולו
Index: kdecore/kwin.h
===================================================================
--- kdecore/kwin.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kwin.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -179,7 +179,8 @@
      *    enum for details) - passing 0 means all properties. Unlisted properties
      *    cause related information to be invalid in the returned data, but
      *    make this function faster when not all data is needed.
-     * @param properties2 additional properties (see NET::Property2 enum)
+     * @param properties2 additional properties (see NET::Property2 enum). Note that
+     *    specifying 0 means no properties, not all.
      * @return the window information
      * @since 3.2
      */
@@ -260,12 +261,8 @@
     /**
      * Sets the type of window @p win to @p windowType.
      *
-     * Possible values are NET::Normal, NET::Desktop, NET::Dock,
-     * NET::Tool, NET::Menu, NET::Dialog, NET::Override (== no
-     * decoration frame), NET::TopMenu, NET::Utility or NET::Splash
-     *
      * @param win the id of the window
-     * @param windowType the type of the window
+     * @param windowType the type of the window (see NET::WindowType)
      */
     static void setType( WId win, NET::WindowType windowType );
 
Index: kdecore/kdebug.areas
===================================================================
--- kdecore/kdebug.areas	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kdebug.areas	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -11,6 +11,7 @@
 128        kdecore (KRegExp)
 129        kdecore (KAction)
 130        kio (KPasswdServer)
+131        kdecore (KAcceleratorManager)
 150        kdecore (KLibLoader)
 160        kdecore (KNotifyClient)
 170        kdecore (KNetwork socket)
Index: kdecore/kstartupinfo.cpp
===================================================================
--- kdecore/kstartupinfo.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kstartupinfo.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -84,7 +84,7 @@
     : public KStartupInfoData
     {
     public:
-        Data() {}; // just because it's in a QMap
+        Data() : KStartupInfoData(), age(0) {}; // just because it's in a QMap
         Data( const QString& txt_P )
             : KStartupInfoData( txt_P ), age( 0 ) {};
         unsigned int age;
@@ -262,7 +262,7 @@
 	    emit gotNewStartup( id_P, d->startups[ id_P ] );
 	    return;
 	    }
-        emit gotStartupChange( id_P, d->startups[ id_P ] );
+        emit gotStartupChange( id_P, d->silent_startups[ id_P ] );
         return;
         }
     if( d->uninited_startups.contains( id_P ))
@@ -858,7 +858,7 @@
             {
             const KStartupInfoId& key = it.key();
             ++it;
-            kdDebug( 172 ) << "entry timeout:" << key.id() << endl;
+            kdDebug( 172 ) << "startups entry timeout:" << key.id() << endl;
             remove_startup_info_internal( key );
             }
         else
@@ -877,7 +877,7 @@
             {
             const KStartupInfoId& key = it.key();
             ++it;
-            kdDebug( 172 ) << "entry timeout:" << key.id() << endl;
+            kdDebug( 172 ) << "silent entry timeout:" << key.id() << endl;
             remove_startup_info_internal( key );
             }
         else
@@ -896,7 +896,7 @@
             {
             const KStartupInfoId& key = it.key();
             ++it;
-            kdDebug( 172 ) << "entry timeout:" << key.id() << endl;
+            kdDebug( 172 ) << "uninited entry timeout:" << key.id() << endl;
             remove_startup_info_internal( key );
             }
         else
Index: kdecore/kglobalaccel.h
===================================================================
--- kdecore/kglobalaccel.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kglobalaccel.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -215,6 +215,12 @@
          * @internal
          */
         void disableBlocking( bool disable );
+        
+        /**
+         * @internal
+         */
+        // like setEnabled(), but doesn't ungrab (see in KGlobalAccelPrivate)
+        void suspend( bool s );
 
 private:
 
Index: kdecore/kglobalaccel.cpp
===================================================================
--- kdecore/kglobalaccel.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kglobalaccel.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -65,6 +65,9 @@
 void KGlobalAccel::setEnabled( bool bEnabled )
 	{ d->setEnabled( bEnabled ); }
 
+void KGlobalAccel::suspend( bool s )
+	{ d->suspend( s ); }
+
 void KGlobalAccel::blockShortcuts( bool block )
         { KGlobalAccelPrivate::blockShortcuts( block ); }
 
Index: kdecore/netwm_def.h
===================================================================
--- kdecore/netwm_def.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/netwm_def.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -270,10 +270,7 @@
        @li Dialog indicates that this is a dialog window. If _NET_WM_WINDOW_TYPE is
        not set, then windows with WM_TRANSIENT_FOR set must be taken as this type.
 
-       @li Override indicates that this window wants to have no Window Manager
-       decorations. This is for windows that would normally use either override_redirect
-       or Motif hints to give no decorations.  This is a KDE extension to the
-       _NET_WM_WINDOW_TYPE mechanism.
+       @li Override - deprecated, has unclear meaning and is KDE-only.
        
        @li TopMenu indicates a toplevel menu (AKA macmenu). This is a KDE extension to the
        _NET_WM_WINDOW_TYPE mechanism.
@@ -287,7 +284,7 @@
 	Toolbar  = 3,
        	Menu     = 4,
 	Dialog   = 5,
-	Override = 6, // NON STANDARD
+	Override = 6, ///< @deprecated
         TopMenu  = 7, // NON STANDARD
 	Tool     = Toolbar, // This will go away soon, COMPAT (How soon? :)
 	Utility  = 8,	///< @since 3.2
Index: kdecore/netwm.cpp
===================================================================
--- kdecore/netwm.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/netwm.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -3467,14 +3467,19 @@
 	return result;
     }
 
+    // find the largest icon
     result = icons[0];
+    for (int i = 1; i < icons.size(); i++) {
+	if( icons[i].size.width >= result.size.width &&
+	     icons[i].size.height >= result.size.height )
+	    result = icons[i];
+    }
 
+    // return the largest icon if w and h are -1
+    if (width == -1 && height == -1) return result;
+
     // find the icon that's closest in size to w x h...
-    // return the first icon if w and h are -1
-    if (width == height && height == -1) return result;
-
-    int i;
-    for (i = 0; i < icons.size(); i++) {
+    for (int i = 0; i < icons.size(); i++) {
 	if ((icons[i].size.width >= width &&
 	     icons[i].size.width < result.size.width) &&
 	    (icons[i].size.height >= height &&
Index: kdecore/kdebugrc
===================================================================
--- kdecore/kdebugrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdecore/kdebugrc	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -36,6 +36,10 @@
 [125]
 InfoOutput=4
 
+# KCheckAccel debug info off
+[131]
+InfoOutput=4
+
 # KAction debug info off
 [129]
 InfoOutput=4
Index: khtml/khtml_ext.cpp
===================================================================
--- khtml/khtml_ext.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/khtml_ext.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -38,6 +38,7 @@
 #include <qclipboard.h>
 #include <qfileinfo.h>
 #include <qpopupmenu.h>
+#include <qurl.h>
 #include <qmetaobject.h>
 #include <private/qucomextra_p.h>
 #include <qdragobject.h>
@@ -273,7 +274,9 @@
     if( !KURIFilter::self()->filterURI(data, list) )
     {
         KDesktopFile file("searchproviders/google.desktop", true, "services");
-        data.setData(file.readEntry("Query").replace("\\{@}", m_part->selectedText()));
+	QString encodedSearchTerm = m_part->selectedText();
+	QUrl::encode(encodedSearchTerm);
+	data.setData(file.readEntry("Query").replace("\\{@}", encodedSearchTerm));
     }
 
     KParts::URLArgs args;
@@ -441,6 +444,7 @@
 
       // search text
       QString selectedText = khtml->selectedText();
+      selectedText.replace("&", "&&");
       if ( selectedText.length()>18 ) {
         selectedText.truncate(15);
         selectedText+="...";
@@ -472,7 +476,8 @@
         name = "Google";
       }
 
-      new KAction( i18n( "Search '%1' at %2" ).arg( selectedText ).arg( name ), icon, 0, d->m_khtml->browserExtension(),
+      // using .arg(foo, bar) instead of .arg(foo).arg(bar), as foo can contain %x
+      new KAction( i18n( "Search for '%1' with %2" ).arg( selectedText, name ), icon, 0, d->m_khtml->browserExtension(),
                      SLOT( searchProvider() ), actionCollection(), "searchProvider" );
 
       // favorite search providers
@@ -481,7 +486,7 @@
       favoriteEngines = config.readListEntry("FavoriteSearchEngines", favoriteEngines);
 
       if ( !favoriteEngines.isEmpty()) {
-        KActionMenu* providerList = new KActionMenu( i18n( "Search '%1' At" ).arg( selectedText ), actionCollection(), "searchProviderList" );
+        KActionMenu* providerList = new KActionMenu( i18n( "Search for '%1' with" ).arg( selectedText ), actionCollection(), "searchProviderList" );
 
         QStringList::ConstIterator it = favoriteEngines.begin();
         for ( ; it != favoriteEngines.end(); ++it ) {
Index: khtml/khtml.desktop
===================================================================
--- khtml/khtml.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/khtml.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Componente incrustable para visualizar HTML
 Comment[et]=Põimitav HTML-i näitamise  komponent
 Comment[eu]=Kapsulatutako HTML ikustailea
-Comment[fa]=بخش نمایش HTML نهفته
+Comment[fa]=مولفۀ مشاهدۀ زنگام نهفته
 Comment[fi]=Upotettava HTML-katselukomponentti
 Comment[fr]=Composant d'affichage HTML intégrable
 Comment[fy]=Yn te sluten HTML-werjeftekomponint
Index: khtml/khtmlimage.desktop
===================================================================
--- khtml/khtmlimage.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/khtmlimage.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -19,7 +19,7 @@
 Comment[es]=Componente incrustable para visualizar imágenes
 Comment[et]=Põimitav pildifailide näitamise komponent
 Comment[eu]=Kapsulatutako irudi-ikustailea
-Comment[fa]=بخش نمایشگر تصویر نهفته
+Comment[fa]=مولفۀ مشاهده تصویر نهفته
 Comment[fi]=Upotettava kuviennäyttökomponentti
 Comment[fr]=Composant d'affichage d'images intégrable
 Comment[fy]=Yn te sluten komponint foar byldwerjefte
@@ -94,7 +94,7 @@
 Name[es]=Visor de imágenes incrustable
 Name[et]=Põimitav pildifailide näitaja
 Name[eu]=Kapsulatutako irudi-ikustailea
-Name[fa]=نمایشگر تصویر نهفته
+Name[fa]=مشاهده گر تصویر نهفته
 Name[fi]=Upotettava kuvannäyttäjä
 Name[fr]=Afficheur d'images intégrable
 Name[fy]=Yn te sluten byldwerjefte
Index: khtml/khtmlview.cpp
===================================================================
--- khtml/khtmlview.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/khtmlview.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -391,8 +391,8 @@
     QWidget* cursor_icon_widget;
 
     // scrolling activated by MMB
-    int m_mouseScroll_byX : 4;
-    int m_mouseScroll_byY : 4;
+    short m_mouseScroll_byX;
+    short m_mouseScroll_byY;
     QTimer *m_mouseScrollTimer;
     QWidget *m_mouseScrollIndicator;
 };
@@ -1101,21 +1101,12 @@
         (deltaX > 0) ? d->m_mouseScroll_byX = 1 : d->m_mouseScroll_byX = -1;
         (deltaY > 0) ? d->m_mouseScroll_byY = 1 : d->m_mouseScroll_byY = -1;
 
-        int adX = abs( deltaX );
-        int adY = abs( deltaY );
+        double adX = QABS(deltaX)/30.0;
+        double adY = QABS(deltaY)/30.0;
 
-        if (adX > 100) d->m_mouseScroll_byX *= 7;
-        else if (adX > 75) d->m_mouseScroll_byX *= 4;
-        else if (adX > 50) d->m_mouseScroll_byX *= 2;
-        else if (adX > 25) d->m_mouseScroll_byX *= 1;
-        else d->m_mouseScroll_byX = 0;
+        d->m_mouseScroll_byX = kMax(kMin(d->m_mouseScroll_byX * int(adX*adX), SHRT_MAX), SHRT_MIN);
+        d->m_mouseScroll_byY = kMax(kMin(d->m_mouseScroll_byY * int(adY*adY), SHRT_MAX), SHRT_MIN);
 
-        if (adY > 100) d->m_mouseScroll_byY *= 7;
-        else if (adY > 75) d->m_mouseScroll_byY *= 4;
-        else if (adY > 50) d->m_mouseScroll_byY *= 2;
-        else if (adY > 25) d->m_mouseScroll_byY *= 1;
-        else d->m_mouseScroll_byY = 0;
-
         if (d->m_mouseScroll_byX == 0 && d->m_mouseScroll_byY == 0) {
             d->m_mouseScrollTimer->stop();
         }
@@ -1481,13 +1472,9 @@
       switch(_ke->key())
         {
         case Key_Space:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                scrollBy( 0, -clipper()->height() + offs );
-                if(d->scrollSuspended)
-                    d->newScrollTimer(this, 0);
-            }
+            scrollBy( 0, -clipper()->height() + offs );
+            if(d->scrollSuspended)
+                d->newScrollTimer(this, 0);
             break;
 
         case Key_Down:
@@ -1515,69 +1502,45 @@
         {
         case Key_Down:
         case Key_J:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                if (!d->scrollTimerId || d->scrollSuspended)
-                    scrollBy( 0, 10 );
-                if (d->scrollTimerId)
-                    d->newScrollTimer(this, 0);
-            }
+            if (!d->scrollTimerId || d->scrollSuspended)
+                scrollBy( 0, 10 );
+            if (d->scrollTimerId)
+                d->newScrollTimer(this, 0);
             break;
 
         case Key_Space:
         case Key_Next:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                scrollBy( 0, clipper()->height() - offs );
-                if(d->scrollSuspended)
-                    d->newScrollTimer(this, 0);
-            }
+            scrollBy( 0, clipper()->height() - offs );
+            if(d->scrollSuspended)
+                d->newScrollTimer(this, 0);
             break;
 
         case Key_Up:
         case Key_K:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                if (!d->scrollTimerId || d->scrollSuspended)
-                    scrollBy( 0, -10 );
-                if (d->scrollTimerId)
-                    d->newScrollTimer(this, 0);
-            }
+            if (!d->scrollTimerId || d->scrollSuspended)
+                scrollBy( 0, -10 );
+            if (d->scrollTimerId)
+                d->newScrollTimer(this, 0);
             break;
 
         case Key_Prior:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                scrollBy( 0, -clipper()->height() + offs );
-                if(d->scrollSuspended)
-                    d->newScrollTimer(this, 0);
-            }
+            scrollBy( 0, -clipper()->height() + offs );
+            if(d->scrollSuspended)
+                d->newScrollTimer(this, 0);
             break;
         case Key_Right:
         case Key_L:
-            if ( d->hmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                if (!d->scrollTimerId || d->scrollSuspended)
-                    scrollBy( 10, 0 );
-                if (d->scrollTimerId)
-                    d->newScrollTimer(this, 0);
-            }
+            if (!d->scrollTimerId || d->scrollSuspended)
+                scrollBy( 10, 0 );
+            if (d->scrollTimerId)
+                d->newScrollTimer(this, 0);
             break;
         case Key_Left:
         case Key_H:
-            if ( d->hmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                if (!d->scrollTimerId || d->scrollSuspended)
-                    scrollBy( -10, 0 );
-                if (d->scrollTimerId)
-                    d->newScrollTimer(this, 0);
-            }
+            if (!d->scrollTimerId || d->scrollSuspended)
+                scrollBy( -10, 0 );
+            if (d->scrollTimerId)
+                d->newScrollTimer(this, 0);
             break;
         case Key_Enter:
         case Key_Return:
@@ -1590,22 +1553,14 @@
 	    }
             break;
         case Key_Home:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                setContentsPos( 0, 0 );
-                if(d->scrollSuspended)
-                    d->newScrollTimer(this, 0);
-            }
+            setContentsPos( 0, 0 );
+            if(d->scrollSuspended)
+                d->newScrollTimer(this, 0);
             break;
         case Key_End:
-            if ( d->vmode == QScrollView::AlwaysOff )
-                _ke->accept();
-            else {
-                setContentsPos( 0, contentsHeight() - visibleHeight() );
-                if(d->scrollSuspended)
-                    d->newScrollTimer(this, 0);
-            }
+            setContentsPos( 0, contentsHeight() - visibleHeight() );
+            if(d->scrollSuspended)
+                d->newScrollTimer(this, 0);
             break;
         case Key_Shift:
             // what are you doing here?
@@ -3248,11 +3203,6 @@
             m_part->parentPart()->view()->wheelEvent( e );
         e->ignore();
     }
-    else if ( (e->orientation() == Vertical && d->vmode == QScrollView::AlwaysOff) ||
-              (e->orientation() == Horizontal && d->hmode == QScrollView::AlwaysOff) )
-    {
-        e->accept();
-    }
     else
     {
         d->scrollBarMoved = true;
Index: khtml/kmultipart/kmultipart.desktop
===================================================================
--- khtml/kmultipart/kmultipart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/kmultipart/kmultipart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Name[es]=Componente empotrado para multiparte/mezcla
 Name[et]=Multipart/mixed põimitav komponent
 Name[eu]=Kapsulatutako zati-anitzen/nahastuen osagaia
+Name[fa]=مولفه نهفته برای چند بخش/مخلوط
 Name[fi]=Upotettava komponentti multipart/mixed-hallintaan
 Name[fr]=Composant intégrable pour le type multipart / mixed
 Name[fy]=Yn te sluten komponint foar mulipart/mixed
Index: khtml/html/htmltokenizer.cpp
===================================================================
--- khtml/html/htmltokenizer.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/htmltokenizer.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -904,8 +904,16 @@
                         unsigned int a;
                         cBuffer[cBufferPos] = '\0';
                         a = khtml::getAttrID(cBuffer, cBufferPos);
-                        if ( !a )
-                            attrName = QString::fromLatin1(QCString(cBuffer, cBufferPos+1).data());
+                        if ( !a ) {
+                            // did we just get /> or e.g checked/>
+                            if (curchar == '>' && cBufferPos >=1 && cBuffer[cBufferPos-1] == '/') {
+                                currToken.flat = true;
+                                if (cBufferPos>1)
+                                    a = khtml::getAttrID(cBuffer, cBufferPos-1);
+                            }
+                            if (!a)
+                                attrName = QString::fromLatin1(QCString(cBuffer, cBufferPos+1).data());
+                        }
 
                         dest = buffer;
                         *dest++ = a;
@@ -915,9 +923,6 @@
                         else
                             kdDebug( 6036 ) << "Known attribute: " << QCString(cBuffer, cBufferPos+1).data() << endl;
 #endif
-                        // did we just get />
-                        if (!a && cBufferPos == 1 && *cBuffer == '/' && curchar == '>')
-                            currToken.flat = true;
 
                         tag = SearchEqual;
                         break;
Index: khtml/html/html_formimpl.cpp
===================================================================
--- khtml/html/html_formimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_formimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1917,10 +1917,10 @@
 
 	if (act) {
 	    NodeImpl* const formNode=getFormElement();
-	    if (formNode) {
+	    if (formNode && evt->target() != formNode) {
 		getDocument()->setFocusNode(formNode);
 		if (formNode->id()==ID_INPUT)
-		    static_cast<DOM::HTMLInputElementImpl*>(formNode)->defaultEventHandler(evt);
+		    static_cast<DOM::HTMLInputElementImpl*>(formNode)->click();
 		evt->setDefaultHandled();
 	    }
 	}
@@ -2211,20 +2211,18 @@
     return result;
 }
 
-NodeImpl *HTMLSelectElementImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
+void HTMLSelectElementImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
 {
-    NodeImpl* const result = HTMLGenericFormElementImpl::replaceChild(newChild,oldChild, exceptioncode);
+    HTMLGenericFormElementImpl::replaceChild(newChild,oldChild, exceptioncode);
     if( !exceptioncode )
         setRecalcListItems();
-    return result;
 }
 
-NodeImpl *HTMLSelectElementImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
+void HTMLSelectElementImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
 {
-    NodeImpl* const result = HTMLGenericFormElementImpl::removeChild(oldChild, exceptioncode);
+    HTMLGenericFormElementImpl::removeChild(oldChild, exceptioncode);
     if( !exceptioncode )
         setRecalcListItems();
-    return result;
 }
 
 NodeImpl *HTMLSelectElementImpl::appendChild ( NodeImpl *newChild, int &exceptioncode )
@@ -2428,8 +2426,8 @@
                 anySelected = true;
         }
     }
-    // If there is no default selection, jump to first option.
-    if ( !anySelected ) {
+    // If this is a single-row SELECT and there is no default selection, jump to first option.
+    if ( !anySelected && m_size <= 1 ) {
         for (i = 0; i < itemsSize; ++i) {
             if (items[i]->id() == ID_OPTION) {
                 static_cast<HTMLOptionElementImpl*>(items[i])->setSelected(true);
Index: khtml/html/html_baseimpl.cpp
===================================================================
--- khtml/html/html_baseimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_baseimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -624,6 +624,9 @@
         else
             removeCSSProperty(CSS_PROP_HEIGHT);
         break;
+    case ATTR_ALIGN:
+        addHTMLAlignment( attr->value() );
+        break;
     case ATTR_SRC:
         needWidgetUpdate = true; // ### do this for scrolling, margins etc?
         HTMLFrameElementImpl::parseAttribute( attr );
Index: khtml/html/html_elementimpl.cpp
===================================================================
--- khtml/html/html_elementimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_elementimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -530,28 +530,26 @@
     // we need to pop <html> and <body> elements and remove <head> to
     // accomadate folks passing complete HTML documents to make the
     // child of an element.
-    Node n;
-
     for ( NodeImpl* node = fragment->firstChild(); node; ) {
         if (node->id() == ID_HTML || node->id() == ID_BODY) {
             NodeImpl* firstChild = node->firstChild();
             NodeImpl* child = firstChild;
             while ( child ) {
                 NodeImpl *nextChild = child->nextSibling();
-                n = fragment->insertBefore(child, node, ignoredExceptionCode);
+                fragment->insertBefore(child, node, ignoredExceptionCode);
                 child = nextChild;
             }
             if ( !firstChild ) {
                 NodeImpl *nextNode = node->nextSibling();
-                n = fragment->removeChild(node, ignoredExceptionCode);
+                fragment->removeChild(node, ignoredExceptionCode);
                 node = nextNode;
             } else {
-                n = fragment->removeChild(node, ignoredExceptionCode);
+                fragment->removeChild(node, ignoredExceptionCode);
                 node = firstChild;
             }
         } else if (node->id() == ID_HEAD) {
             NodeImpl *nextNode = node->nextSibling();
-            n = fragment->removeChild(node, ignoredExceptionCode);
+            fragment->removeChild(node, ignoredExceptionCode);
             node = nextNode;
         } else {
             node = node->nextSibling();
Index: khtml/html/html_tableimpl.h
===================================================================
--- khtml/html/html_tableimpl.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_tableimpl.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -277,8 +277,8 @@
     // overrides
     virtual NodeImpl *addChild(NodeImpl *child);
     virtual NodeImpl *insertBefore ( NodeImpl *newChild, NodeImpl *refChild, int &exceptioncode );
-    virtual NodeImpl *replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
-    virtual NodeImpl *removeChild ( NodeImpl *oldChild, int &exceptioncode );
+    virtual void      replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
+    virtual void      removeChild ( NodeImpl *oldChild, int &exceptioncode );
     virtual NodeImpl *appendChild ( NodeImpl *newChild, int &exceptioncode );
     
     virtual void parseAttribute(AttributeImpl *attr);
Index: khtml/html/html_formimpl.h
===================================================================
--- khtml/html/html_formimpl.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_formimpl.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -413,8 +413,8 @@
     virtual void restoreState(const QString &);
 
     virtual NodeImpl *insertBefore ( NodeImpl *newChild, NodeImpl *refChild, int &exceptioncode );
-    virtual NodeImpl *replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
-    virtual NodeImpl *removeChild ( NodeImpl *oldChild, int &exceptioncode );
+    virtual void      replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
+    virtual void      removeChild ( NodeImpl *oldChild, int &exceptioncode );
     virtual NodeImpl *appendChild ( NodeImpl *newChild, int &exceptioncode );
     virtual NodeImpl *addChild( NodeImpl* newChild );
 
Index: khtml/html/htmlparser.cpp
===================================================================
--- khtml/html/htmlparser.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/htmlparser.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1408,6 +1408,7 @@
     // The end result will be: <b>...</b><p><b>Foo</b>Goo</p>
     //
     // Step 1: Remove |blockElem| from its parent, doing a batch detach of all the kids.
+    SharedPtr<NodeImpl> guard(blockElem);
     blockElem->parentNode()->removeChild(blockElem, exceptionCode);
 
     // Step 2: Clone |residualElem|.
@@ -1419,6 +1420,7 @@
     NodeImpl* currNode = blockElem->firstChild();
     while (currNode) {
         NodeImpl* nextNode = currNode->nextSibling();
+        SharedPtr<NodeImpl> guard(currNode); //Protect from deletion while moving
         blockElem->removeChild(currNode, exceptionCode);
         newNode->appendChild(currNode, exceptionCode);
         currNode = nextNode;
Index: khtml/html/html_inlineimpl.cpp
===================================================================
--- khtml/html/html_inlineimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_inlineimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -175,8 +175,13 @@
     switch(attr->id())
     {
     case ATTR_HREF:
+    {
+        bool hadAnchor = m_hasAnchor;
         m_hasAnchor = attr->val() != 0;
         getDocument()->incDOMTreeVersion();
+        if (hadAnchor != m_hasAnchor)
+            setChanged();
+    }
         break;
     case ATTR_TARGET:
         m_hasTarget = attr->val() != 0;
Index: khtml/html/html_tableimpl.cpp
===================================================================
--- khtml/html/html_tableimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/html/html_tableimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -389,21 +389,18 @@
     return retval;
 }
 
-NodeImpl *HTMLTableElementImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
+void HTMLTableElementImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
 {
     handleChildRemove( oldChild ); //Always safe.
-
-    NodeImpl* retval = HTMLElementImpl::replaceChild( newChild, oldChild, exceptioncode );
-    if (retval)
+    HTMLElementImpl::replaceChild( newChild, oldChild, exceptioncode );
+    if ( !exceptioncode )
         handleChildAdd( newChild );
-
-    return retval;
 }
 
-NodeImpl *HTMLTableElementImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
+void HTMLTableElementImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
 {
     handleChildRemove( oldChild );
-    return HTMLElementImpl::removeChild( oldChild, exceptioncode);
+    HTMLElementImpl::removeChild( oldChild, exceptioncode);
 }
 
 void HTMLTableElementImpl::parseAttribute(AttributeImpl *attr)
@@ -937,7 +934,7 @@
     : HTMLTablePartElementImpl(doc)
 {
     _id = i;
-    _span = (_id == ID_COLGROUP ? 0 : 1);
+    _span = 1;
 }
 
 NodeImpl::Id HTMLTableColElementImpl::id() const
@@ -952,6 +949,7 @@
     {
     case ATTR_SPAN:
         _span = attr->val() ? attr->val()->toInt() : 1;
+        if (_span < 1) _span = 1;
         break;
     case ATTR_WIDTH:
         if (!attr->value().isEmpty())
Index: khtml/ecma/kjs_dom.cpp
===================================================================
--- khtml/ecma/kjs_dom.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/ecma/kjs_dom.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1198,9 +1198,9 @@
     case DOMElement::GetAttributeNode:
       return getDOMNode(exec,element.getAttributeNode(args[0].toString(exec).string()));
     case DOMElement::SetAttributeNode:
-      return getDOMNode(exec,element.setAttributeNode((new DOMNode(exec,KJS::toNode(args[0])))->toNode()));
+      return getDOMNode(exec,element.setAttributeNode(KJS::toNode(args[0])));
     case DOMElement::RemoveAttributeNode:
-      return getDOMNode(exec,element.removeAttributeNode((new DOMNode(exec,KJS::toNode(args[0])))->toNode()));
+      return getDOMNode(exec,element.removeAttributeNode(KJS::toNode(args[0])));
     case DOMElement::GetElementsByTagName:
       return getDOMNodeList(exec,element.getElementsByTagName(args[0].toString(exec).string()));
     case DOMElement::HasAttribute: // DOM2
@@ -1216,7 +1216,7 @@
     case DOMElement::GetAttributeNodeNS: // DOM2
       return getDOMNode(exec,element.getAttributeNodeNS(args[0].toString(exec).string(),args[1].toString(exec).string()));
     case DOMElement::SetAttributeNodeNS: // DOM2
-      return getDOMNode(exec,element.setAttributeNodeNS((new DOMNode(exec,KJS::toNode(args[0])))->toNode()));
+      return getDOMNode(exec,element.setAttributeNodeNS(KJS::toNode(args[0])));
     case DOMElement::GetElementsByTagNameNS: // DOM2
       return getDOMNodeList(exec,element.getElementsByTagNameNS(args[0].toString(exec).string(),args[1].toString(exec).string()));
     case DOMElement::HasAttributeNS: // DOM2
@@ -1393,7 +1393,7 @@
     case DOMNamedNodeMap::GetNamedItem:
       return getDOMNode(exec, map.getNamedItem(args[0].toString(exec).string()));
     case DOMNamedNodeMap::SetNamedItem:
-      return getDOMNode(exec, map.setNamedItem((new DOMNode(exec,KJS::toNode(args[0])))->toNode()));
+      return getDOMNode(exec, map.setNamedItem(KJS::toNode(args[0])));
     case DOMNamedNodeMap::RemoveNamedItem:
       return getDOMNode(exec, map.removeNamedItem(args[0].toString(exec).string()));
     case DOMNamedNodeMap::Item:
Index: khtml/ecma/xmlhttprequest.cpp
===================================================================
--- khtml/ecma/xmlhttprequest.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/ecma/xmlhttprequest.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -335,7 +335,8 @@
     // FIXME: determine post encoding correctly by looking in headers
     // for charset.
     QByteArray buf;
-    buf.duplicate(_body.utf8().data(), _body.length());
+    QCString str = _body.utf8();
+    buf.duplicate(str.data(), str.size() - 1);
 
     job = KIO::http_post( url, buf, false );
     if(contentType.isNull())
Index: khtml/rendering/render_flow.cpp
===================================================================
--- khtml/rendering/render_flow.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_flow.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -4,7 +4,7 @@
  * Copyright (C) 1999-2003 Lars Knoll (knoll@kde.org)
  *           (C) 1999-2003 Antti Koivisto (koivisto@kde.org)
  *           (C) 2002-2003 Dirk Mueller (mueller@kde.org)
- *           (C) 2003 Apple Computer, Inc.
+ *           (C) 2003-2006 Apple Computer, Inc.
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -189,63 +189,80 @@
     return flowBox;
 }
 
-void RenderFlow::paintLineBoxBackgroundBorder(PaintInfo& pI, int _tx, int _ty)
+void RenderFlow::paintLines(PaintInfo& i, int _tx, int _ty)
 {
+    // Only paint during the foreground/selection phases.
+    if (i.phase != PaintActionForeground && i.phase != PaintActionSelection && i.phase != PaintActionOutline)
+        return;
+
     if (!firstLineBox())
         return;
 
-    if (style()->visibility() == VISIBLE && pI.phase == PaintActionForeground) {
-        // We can check the first box and last box and avoid painting if we don't
-        // intersect.
-        int yPos = _ty + firstLineBox()->yPos();
-        int h = lastLineBox()->yPos() + lastLineBox()->height() - firstLineBox()->yPos();
-        if( (yPos > pI.r.bottom()) || (yPos + h <= pI.r.y()))
-            return;
+    // We can check the first box and last box and avoid painting if we don't
+    // intersect.  This is a quick short-circuit that we can take to avoid walking any lines.
+    // FIXME: This check is flawed in two extremely obscure ways.
+    // (1) If some line in the middle has a huge overflow, it might actually extend below the last line.
+    // (2) The overflow from an inline block on a line is not reported to the line.
+    int maxOutlineSize = maximalOutlineSize(i.phase);
+    int yPos = firstLineBox()->root()->topOverflow() - maxOutlineSize;
+    int h = maxOutlineSize + lastLineBox()->root()->bottomOverflow() - yPos;
+    yPos += _ty;
+    if ((yPos >= i.r.y() + i.r.height()) || (yPos + h <= i.r.y()))
+        return;
+    for (InlineFlowBox* curr = firstLineBox(); curr; curr = curr->nextFlowBox()) {
+        yPos = curr->root()->topOverflow() - maxOutlineSize;
+        h = curr->root()->bottomOverflow() + maxOutlineSize - yPos;
+        yPos += _ty;
+        if ((yPos < i.r.y() + i.r.height()) && (yPos + h > i.r.y()))
+            curr->paint(i, _tx, _ty);
+    }
 
-        // See if our boxes intersect with the dirty rect.  If so, then we paint
-        // them.  Note that boxes can easily overlap, so we can't make any assumptions
-        // based off positions of our first line box or our last line box.
-        int xOffsetWithinLineBoxes = 0;
-        for (InlineRunBox* curr = firstLineBox(); curr; curr = curr->nextLineBox()) {
-            yPos = _ty + curr->yPos();
-            h = curr->height();
-            if ((yPos <= pI.r.bottom()) && (yPos + h > pI.r.y()))
-                curr->paintBackgroundAndBorder(pI, _tx, _ty, xOffsetWithinLineBoxes);
-            xOffsetWithinLineBoxes += curr->width();
-        }
+    if (i.phase == PaintActionOutline && i.outlineObjects) {
+          QValueList<RenderFlow *>::iterator it;;
+          for( it = (*i.outlineObjects).begin(); it != (*i.outlineObjects).end(); ++it )
+              if ((*it)->isRenderInline())
+                  static_cast<RenderInline*>(*it)->paintOutlines(i.p, _tx, _ty);
+          i.outlineObjects->clear();
     }
 }
 
-void RenderFlow::paintLineBoxDecorations(PaintInfo& pI, int _tx, int _ty)
+
+bool RenderFlow::hitTestLines(NodeInfo& i, int x, int y, int tx, int ty, HitTestAction hitTestAction)
 {
+   (void) hitTestAction;
+   /*
+    if (hitTestAction != HitTestForeground) // ### port hitTest
+        return false;
+   */
+
     if (!firstLineBox())
-        return;
+        return false;
 
-    if (style()->visibility() == VISIBLE && pI.phase == PaintActionForeground) {
-        // We only paint line box decorations in strict or almost strict mode.
-        // Otherwise we let the TextRuns paint their own decorations.
-        if (style()->htmlHacks())
-            return;
+    // We can check the first box and last box and avoid hit testing if we don't
+    // contain the point.  This is a quick short-circuit that we can take to avoid walking any lines.
+    // FIXME: This check is flawed in two extremely obscure ways.
+    // (1) If some line in the middle has a huge overflow, it might actually extend below the last line.
+    // (2) The overflow from an inline block on a line is not reported to the line.
+    if ((y >= ty + lastLineBox()->root()->bottomOverflow()) || (y < ty + firstLineBox()->root()->topOverflow()))
+        return false;
 
-        // We can check the first box and last box and avoid painting if we don't
-        // intersect.
-        int yPos = _ty + firstLineBox()->yPos();;
-        int h = lastLineBox()->yPos() + lastLineBox()->height() - firstLineBox()->yPos();
-        if( (yPos > pI.r.bottom()) || (yPos + h <= pI.r.y()))
-            return;
-
-        // See if our boxes intersect with the dirty rect.  If so, then we paint
-        // them.  Note that boxes can easily overlap, so we can't make any assumptions
-        // based off positions of our first line box or our last line box.
-        for (InlineRunBox* curr = firstLineBox(); curr; curr = curr->nextLineBox()) {
-            yPos = _ty + curr->yPos();
-            h = curr->height();
-            if ((yPos <= pI.r.bottom()) && (yPos + h > pI.r.y()))
-                curr->paintDecorations(pI, _tx, _ty);
+    // See if our root lines contain the point.  If so, then we hit test
+    // them further.  Note that boxes can easily overlap, so we can't make any assumptions
+    // based off positions of our first line box or our last line box.
+    for (InlineFlowBox* curr = lastLineBox(); curr; curr = curr->prevFlowBox()) {
+        if (y >= ty + curr->root()->topOverflow() && y < ty + curr->root()->bottomOverflow()) {
+            bool inside = curr->nodeAtPoint(i, x, y, tx, ty);
+            if (inside) {
+                setInnerNode(i);
+                return true;
+            }
         }
     }
+    
+    return false;
 }
 
+
 void RenderFlow::repaint(bool immediate)
 {
     if (isInlineFlow()) {
@@ -260,7 +277,7 @@
                 left = curr->xPos();
 
         // Now invalidate a rectangle.
-        int ow = style() ? style()->outlineWidth() : 0;
+        int ow = style() ? style()->outlineSize() : 0;
 
         // We need to add in the relative position offsets of any inlines (including us) up to our
         // containing block.
@@ -281,7 +298,7 @@
     }
     else {
         if (firstLineBox() && firstLineBox()->topOverflow() < 0) {
-            int ow = style() ? style()->outlineWidth() : 0;
+            int ow = style() ? style()->outlineSize() : 0;
             repaintRectangle(-ow, -ow+firstLineBox()->topOverflow(),
                              effectiveWidth()+ow*2, effectiveHeight()+ow*2, immediate);
         }
Index: khtml/rendering/render_object.h
===================================================================
--- khtml/rendering/render_object.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_object.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -361,10 +361,12 @@
      */
     struct PaintInfo {
        PaintInfo(QPainter* _p, const QRect& _r, PaintAction _phase)
-           : p(_p), r(_r), phase(_phase) {}
+           : p(_p), r(_r), phase(_phase), outlineObjects(0) {}
+       ~PaintInfo() { delete outlineObjects; }
        QPainter* p;
        QRect     r;
        PaintAction phase;
+       QValueList<RenderFlow *>* outlineObjects; // used to list which outlines should be painted by a block with inline children
     };
     virtual void paint( PaintInfo& i, int tx, int ty);
 
@@ -405,6 +407,12 @@
     virtual void calcWidth() {}
 
     /*
+     * Calculates the actual width of the object (only for non inline
+     * objects)
+     */
+    virtual void calcHeight() {}
+
+    /*
      * This function should cause the Element to calculate its
      * width and height and the layout of its content
      *
@@ -519,6 +527,7 @@
                                                      DOM::NodeImpl*&, int & offset,
 						     SelPointState & );
     virtual bool nodeAtPoint(NodeInfo& info, int x, int y, int tx, int ty, HitTestAction, bool inside = false);
+    void setInnerNode(NodeInfo& info);
 
     // set the style of the object.
     virtual void setStyle(RenderStyle *style);
Index: khtml/rendering/render_inline.cpp
===================================================================
--- khtml/rendering/render_inline.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_inline.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -248,33 +248,9 @@
     block->setNeedsLayoutAndMinMaxRecalc();
 }
 
-void RenderInline::paint(PaintInfo& i,
-                      int _tx, int _ty)
+void RenderInline::paint(PaintInfo& i, int _tx, int _ty)
 {
-#ifdef DEBUG_LAYOUT
-    //    kdDebug( 6040 ) << renderName() << "(RenderInline) " << this << " ::paintObject() w/h = (" << width() << "/" << height() << ")" << endl;
-#endif
-
-    if ( i.phase == PaintActionElementBackground )
-        return;
-
-    // let the children their backgrounds
-    PaintAction oldphase = i.phase;
-    if ( i.phase == PaintActionChildBackgrounds )
-        i.phase = PaintActionChildBackground;
-
-    paintLineBoxBackgroundBorder(i, _tx, _ty);
-
-    for( RenderObject *child = firstChild(); child; child = child->nextSibling())
-        if(!child->layer() && !child->isFloating())
-            child->paint(i, _tx, _ty);
-
-    paintLineBoxDecorations(i, _tx, _ty);
-
-    i.phase = oldphase;
-    if (style()->visibility() == VISIBLE && i.phase == PaintActionOutline) {
-        paintOutlines(i.p, _tx, _ty);
-    }
+    paintLines(i, _tx, _ty);
 }
 
 /**
@@ -436,25 +412,30 @@
  */
 static void collectHorizontalBoxCoordinates(InlineBox *box,
                                             QValueVector<QPoint> &pointArray,
-                                            bool bottom, int limit = -500000)
+                                            bool bottom, int offset, int limit = -500000)
 {
 //   kdDebug(6000) << "collectHorizontalBoxCoordinates: " << endl;
-    int y = box->yPos() + bottom*box->height();
+    offset = bottom ? offset:-offset;
+    int y = box->yPos() + bottom*box->height() + offset;
     if (limit != -500000 && (bottom ? y < limit : y > limit))
         y = limit;
-    int x = box->xPos() + bottom*box->width();
+    int x = box->xPos() + bottom*box->width() + offset;
     QPoint newPnt(x, y);
     // Add intersection point if point-array not empty.
     if (!pointArray.isEmpty()) {
         QPoint lastPnt = pointArray.back();
         QPoint insPnt(newPnt.x(), lastPnt.y());
+        if (offset && ((bottom && lastPnt.y() > y) || (!bottom && lastPnt.y() < y))) {
+            insPnt.rx() = lastPnt.x();
+            insPnt.ry() = y;
+        }
 //         kdDebug(6040) << "left: " << lastPnt << " == " << insPnt << ": " << (insPnt == lastPnt) << endl;
         appendPoint(pointArray, insPnt);
     }
     // Insert starting point of box
     appendPoint(pointArray, newPnt);
 
-    newPnt.rx() += bottom ? -box->width() : box->width();
+    newPnt.rx() += (bottom ? -box->width() : box->width()) - 2*offset;
 
     if (box->isInlineFlowBox()) {
         InlineFlowBox *flowBox = static_cast<InlineFlowBox *>(box);
@@ -467,7 +448,7 @@
               l2 = y;
             else
               l2 = limit;
-            collectHorizontalBoxCoordinates(b, pointArray, bottom, l2);
+            collectHorizontalBoxCoordinates(b, pointArray, bottom, kAbs(offset), l2);
         }
 
         // Add intersection point if flow box contained any children
@@ -493,11 +474,11 @@
  *	succeeding
  * @return \c true if this and the next box are disjoint
  */
-inline static bool lineBoxesDisjoint(InlineRunBox *line, bool toBegin)
+inline static bool lineBoxesDisjoint(InlineRunBox *line, int offset, bool toBegin)
 {
   InlineRunBox *next = toBegin ? line->prevLineBox() : line->nextLineBox();
-  return !next || next->xPos() + next->width() < line->xPos()
-               || next->xPos() > line->xPos() + line->width();
+  return !next || next->xPos() + next->width() + 2*offset < line->xPos()
+               || next->xPos() > line->xPos() + line->width() + 2*offset;
 }
 
 /**
@@ -511,25 +492,26 @@
  */
 static void collectVerticalBoxCoordinates(InlineRunBox *line,
                                           QValueVector<QPoint> &pointArray,
-                                          bool left, InlineRunBox **lastline = 0)
+                                          bool left, int offset, InlineRunBox **lastline = 0)
 {
     InlineRunBox *last = 0;
+    offset = left ? -offset:offset;
     for (InlineRunBox* curr = line; curr && !last; curr = left ? curr->prevLineBox() : curr->nextLineBox()) {
         InlineBox *root = curr;
 
-        bool isLast = lineBoxesDisjoint(curr, left);
+        bool isLast = lineBoxesDisjoint(curr, kAbs(offset), left);
         if (isLast) last = curr;
 
         if (root != line && !isLast)
             while (root->parent()) root = root->parent();
-        QPoint newPnt(curr->xPos() + !left*curr->width(),
-                      left ? root->topOverflow() : root->bottomOverflow());
+        QPoint newPnt(curr->xPos() + !left*curr->width() + offset,
+                      (left ? root->topOverflow() : root->bottomOverflow()) + offset);
         if (!pointArray.isEmpty()) {
             QPoint lastPnt = pointArray.back();
             if (newPnt.x()>lastPnt.x() && !left)
-                pointArray.back().setY( kMin(lastPnt.y(), root->topOverflow()) );
+                pointArray.back().setY( kMin(lastPnt.y(), root->topOverflow()-offset) );
             else if (newPnt.x()<lastPnt.x() && left)
-                pointArray.back().setY( kMax(lastPnt.y(), root->bottomOverflow()) );
+                pointArray.back().setY( kMax(lastPnt.y(), root->bottomOverflow()+offset) );
             QPoint insPnt(newPnt.x(), pointArray.back().y());
 //         kdDebug(6040) << "left: " << lastPnt << " == " << insPnt << ": " << (insPnt == lastPnt) << endl;
             appendPoint(pointArray, insPnt);
@@ -584,6 +566,7 @@
 {
     if (style()->outlineWidth() == 0 || style()->outlineStyle() <= BHIDDEN)
         return;
+    int offset = style()->outlineOffset();
 
     // We may have to draw more than one outline path as they may be
     // disjoint.
@@ -591,13 +574,13 @@
         QValueVector<QPoint> path;
 
         // collect topmost outline
-        collectHorizontalBoxCoordinates(curr, path, false);
+        collectHorizontalBoxCoordinates(curr, path, false, offset);
         // collect right outline
-        collectVerticalBoxCoordinates(curr, path, false, &curr);
+        collectVerticalBoxCoordinates(curr, path, false, offset, &curr);
         // collect bottommost outline
-        collectHorizontalBoxCoordinates(curr, path, true);
+        collectHorizontalBoxCoordinates(curr, path, true, offset);
         // collect left outline
-        collectVerticalBoxCoordinates(curr, path, true);
+        collectVerticalBoxCoordinates(curr, path, true, offset);
 
         const QPoint *begin = linkEndToBegin(path);
 
@@ -678,13 +661,11 @@
     int ow = o->style()->outlineWidth();
     EBorderStyle os = o->style()->outlineStyle();
     QColor oc = o->style()->outlineColor();
-    // ### outline-offset is not this simple to merge anymore
-    int offset = 0; // o->style()->outlineOffset();
 
-    int x1 = tx + p1.x() - offset;
-    int y1 = ty + p1.y() - offset;
-    int x2 = tx + p2.x() + offset;
-    int y2 = ty + p2.y() + offset;
+    int x1 = tx + p1.x();
+    int y1 = ty + p1.y();
+    int x2 = tx + p2.x();
+    int y2 = ty + p2.y();
     if (x1 > x2) {
         kSwap(x1, x2);
         if (bsOrientation(curBS) == BSHorizontal) kSwap(prevBS, nextBS);
@@ -840,23 +821,17 @@
 
 bool RenderInline::nodeAtPoint(NodeInfo& info, int _x, int _y, int _tx, int _ty, HitTestAction hitTestAction, bool inside)
 {
+/*
     if ( hitTestAction != HitTestSelfOnly ) {
         for (RenderObject* child = lastChild(); child; child = child->previousSibling())
             if (!child->layer() && !child->isFloating() && child->nodeAtPoint(info, _x, _y, _tx, _ty, HitTestAll))
                 inside = true;
     }
-
-
+*/
     // Check our line boxes if we're still not inside.
-    if (hitTestAction != HitTestChildrenOnly && !inside && style()->visibility() != HIDDEN) {
+    if (/*hitTestAction != HitTestChildrenOnly &&*/ !inside && style()->visibility() != HIDDEN) {
         // See if we're inside one of our line boxes.
-        for (InlineRunBox* curr = firstLineBox(); curr; curr = curr->nextLineBox()) {
-            if((_y >=_ty + curr->m_y) && (_y < _ty + curr->m_y + curr->m_height) &&
-               (_x >= _tx + curr->m_x) && (_x <_tx + curr->m_x + curr->m_width) ) {
-                inside = true;
-                break;
-            }
-        }
+        inside = hitTestLines(info, _x, _y, _tx, _ty, hitTestAction);
     }
 
     if (inside && element()) {
Index: khtml/rendering/render_layer.h
===================================================================
--- khtml/rendering/render_layer.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_layer.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -153,6 +153,8 @@
     Marquee* marquee() const { return m_marquee; }
     void suspendMarquees();
 
+    bool isOverflowOnly() const { return m_isOverflowOnly; }
+
 #ifdef APPLE_CHANGES
     bool isTransparent();
     RenderLayer* transparentAncestor();
@@ -217,6 +219,10 @@
     QPtrVector<RenderLayer>* posZOrderList() const { return m_posZOrderList; }
     QPtrVector<RenderLayer>* negZOrderList() const { return m_negZOrderList; }
 
+    void dirtyOverflowList();
+    void updateOverflowList();
+    QValueList<RenderLayer*>* overflowList() const { return m_overflowList; }
+
     void setHasOverlaidWidgets(bool b=true) { m_hasOverlaidWidgets = b; }
     bool hasOverlaidWidgets() const { return m_hasOverlaidWidgets; }
     QRegion getMask() const { return m_region; }
@@ -281,6 +287,7 @@
     KDE_EXPORT void paintLayer(RenderLayer* rootLayer, QPainter *p, const QRect& paintDirtyRect, bool selectionOnly=false);
     RenderLayer* nodeAtPointForLayer(RenderLayer* rootLayer, RenderObject::NodeInfo& info,
                                      int x, int y, const QRect& hitTestRect);
+    bool shouldBeOverflowOnly() const;
 
 protected:
     RenderObject* m_object;
@@ -315,13 +322,18 @@
     // z-indices.
     QPtrVector<RenderLayer>* m_posZOrderList;
     QPtrVector<RenderLayer>* m_negZOrderList;
-    bool m_zOrderListsDirty;
     
-    bool m_markedForRepaint;
+    // This list contains our overflow child layers.
+    QValueList<RenderLayer*>* m_overflowList;
+   
+    bool m_zOrderListsDirty: 1;
+    bool m_overflowListDirty: 1;
+    bool m_isOverflowOnly: 1;
+    bool m_markedForRepaint: 1;
+    bool m_hasOverlaidWidgets: 1; 
 
     QRect m_visibleRect;
 
-    bool m_hasOverlaidWidgets; 
     QRegion m_region; // used by overlaid (non z-order aware) widgets
 
     Marquee* m_marquee; // Used by layers with overflow:marquee
Index: khtml/rendering/render_line.cpp
===================================================================
--- khtml/rendering/render_line.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_line.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,7 +1,8 @@
 /**
 * This file is part of the html renderer for KDE.
  *
- * Copyright (C) 2003 Apple Computer, Inc.
+ * Copyright (C) 2003-2006 Apple Computer, Inc.
+ *           (C) 2006 Germain Garand (germain@ebooksfrance.org)
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -66,7 +67,6 @@
     return renderArena->allocate(sz);
 }
 
-
 void InlineBox::operator delete(void* ptr, size_t sz)
 {
     assert(inInlineBoxDetach);
@@ -75,6 +75,53 @@
     *(size_t *)ptr = sz;
 }
 
+static bool needsOutlinePhaseRepaint(RenderObject* o, RenderObject::PaintInfo& i, int tx, int ty) {
+    if (o->style()->outlineWidth() <= 0)
+        return false;
+    QRect r(tx+o->xPos(),ty+o->yPos(),o->width(),o->height());
+    if (r.intersects(i.r))
+        return false;
+    r.addCoords(-o->style()->outlineSize(),
+                -o->style()->outlineSize(),
+                 o->style()->outlineSize(),
+                 o->style()->outlineSize());
+    if (!r.intersects(i.r))
+        return false;
+    return true;
+}
+
+void InlineBox::paint(RenderObject::PaintInfo& i, int tx, int ty)
+{
+    if ( i.phase == PaintActionOutline && !needsOutlinePhaseRepaint(object(), i, tx, ty) )
+        return;
+
+    // Paint all phases of replaced elements atomically, as though the replaced element established its
+    // own stacking context.  (See Appendix E.2, section 6.4 on inline block/table elements in the CSS2.1
+    // specification.)
+    bool paintSelectionOnly = i.phase == PaintActionSelection;
+    RenderObject::PaintInfo info(i.p, i.r, paintSelectionOnly ? i.phase : PaintActionElementBackground);
+    object()->paint(info, tx, ty);
+    if (!paintSelectionOnly) {
+        info.phase = PaintActionChildBackgrounds;
+        object()->paint(info, tx, ty);
+        info.phase = PaintActionFloat;
+        object()->paint(info, tx, ty);
+        info.phase = PaintActionForeground;
+        object()->paint(info, tx, ty);
+        info.phase = PaintActionOutline;
+        object()->paint(info, tx, ty);
+    }
+}
+
+bool InlineBox::nodeAtPoint(RenderObject::NodeInfo& i, int x, int y, int tx, int ty)
+{
+    // Hit test all phases of replaced elements atomically, as though the replaced element established its
+    // own stacking context.  (See Appendix E.2, section 6.4 on inline block/table elements in the CSS2.1
+    // specification.)
+    bool inside = false;
+    return object()->nodeAtPoint(i, x, y, tx, ty, HitTestAll, inside); // ### port hitTest
+}
+
 RootInlineBox* InlineBox::root()
 {
     if (m_parent)
@@ -441,13 +488,15 @@
         else if (curr->yPos() == PositionBottom)
             curr->setYPos(y + maxHeight - curr->height());
         else {
-            if (!curr->hasTextChildren() && !strictMode)
+            if (!strictMode && !curr->hasTextDescendant())
                 childAffectsTopBottomPos = false;
             curr->setYPos(curr->yPos() + y + maxAscent - curr->baseline());
         }
         int newY = curr->yPos();
         int newHeight = curr->height();
         int newBaseline = curr->baseline();
+        int overflowTop = 0;
+        int overflowBottom = 0;
         if (curr->isInlineTextBox() || curr->isInlineFlowBox()) {
             const QFontMetrics &fm = curr->object()->fontMetrics( m_firstLine );
 #ifdef APPLE_CHANGES
@@ -463,6 +512,10 @@
                 newHeight = fm.lineSpacing();
             }
 #endif
+            for (ShadowData* shadow = curr->object()->style()->textShadow(); shadow; shadow = shadow->next) {
+                overflowTop = kMin(overflowTop, shadow->y - shadow->blur);
+                overflowBottom = kMax(overflowBottom, shadow->y + shadow->blur);
+            }
             if (curr->isInlineFlowBox()) {
                 newHeight += curr->object()->borderTop() + curr->object()->paddingTop() +
                             curr->object()->borderBottom() + curr->object()->paddingBottom();
@@ -472,16 +525,16 @@
         } else {
             newY += curr->object()->marginTop();
             newHeight = curr->height() - (curr->object()->marginTop() + curr->object()->marginBottom());
-        }
+            overflowTop = curr->object()->overflowTop();
+            overflowBottom = curr->object()->overflowHeight() - newHeight;
+       }
         curr->setYPos(newY);
         curr->setHeight(newHeight);
         curr->setBaseline(newBaseline);
 
         if (childAffectsTopBottomPos) {
-            if (newY < topPosition)
-                topPosition = newY;
-            if (newY + newHeight > bottomPosition)
-                bottomPosition = newY + newHeight;
+            topPosition = kMin(topPosition, newY + overflowTop);
+            bottomPosition = kMax(bottomPosition, newY + newHeight + overflowBottom);
         }
     }
 
@@ -499,7 +552,7 @@
             setBaseline(ascent);
         }
 #endif
-        if (hasTextChildren() || strictMode) {
+        if (hasTextDescendant() || strictMode) {
             if (yPos() < topPosition)
                 topPosition = yPos();
             if (yPos() + height() > bottomPosition)
@@ -520,7 +573,7 @@
     }
 
     // See if we have text children. If not, then we need to shrink ourselves to fit on the line.
-    if (!hasTextChildren()) {
+    if (!hasTextDescendant()) {
         if (yPos() < topPos)
             setYPos(topPos);
         if (yPos() + height() > bottomPos)
@@ -529,17 +582,79 @@
             setBaseline(height());
     }
 }
+
+bool InlineFlowBox::nodeAtPoint(RenderObject::NodeInfo& i, int x, int y, int tx, int ty)
+{
+    // Check children first.
+    for (InlineBox* curr = lastChild(); curr; curr = curr->prevOnLine()) {
+        if (!curr->object()->layer() && curr->nodeAtPoint(i, x, y, tx, ty)) {
+            object()->setInnerNode(i);
+            return true;
+        }
+    }
+
+    // Now check ourselves.
+    QRect rect(tx + m_x, ty + m_y, m_width, m_height);
+    if (object()->style()->visibility() == VISIBLE && rect.contains(x, y)) {
+        object()->setInnerNode(i);
+        return true;
+    }
+
+    return false;
+}
+
+
+void InlineFlowBox::paint(RenderObject::PaintInfo& i, int tx, int ty)
+{
+    bool intersectsDamageRect = true;
+    int xPos = tx + m_x - object()->maximalOutlineSize(i.phase);
+    int w = width() + 2 * object()->maximalOutlineSize(i.phase);
+    if ((xPos >= i.r.x() + i.r.width()) || (xPos + w <= i.r.x()))
+        intersectsDamageRect = false;
+
+    if (intersectsDamageRect) {
+        if (i.phase == PaintActionOutline) {
+            // Add ourselves to the paint info struct's list of inlines that need to paint their
+            // outlines.
+            if (object()->style()->visibility() == VISIBLE && object()->style()->outlineWidth() > 0 &&
+                !object()->isInlineContinuation() && !isRootInlineBox()) {
+                if (!i.outlineObjects)
+                    i.outlineObjects = new QValueList<RenderFlow*>;
+                i.outlineObjects->append(static_cast<RenderFlow*>(object()));
+            }
+        }
+        else {
+            // 1. Paint our background and border.
+            paintBackgroundAndBorder(i, tx, ty);
+
+            // 2. Paint our underline and overline.
+            paintDecorations(i, tx, ty, false);
+        }
+    }
+
+    // 3. Paint our children.
+    for (InlineBox* curr = firstChild(); curr; curr = curr->nextOnLine()) {
+        if (!curr->object()->layer())
+            curr->paint(i, tx, ty);
+    }
+
+    // 4. Paint our strike-through
+    if (intersectsDamageRect && i.phase != PaintActionOutline)
+        paintDecorations(i, tx, ty, true);
+}
+
+
 void InlineFlowBox::paintBackgrounds(QPainter* p, const QColor& c, const BackgroundLayer* bgLayer,
-                                     int my, int mh, int _tx, int _ty, int w, int h, int xoff)
+                                     int my, int mh, int _tx, int _ty, int w, int h)
 {
     if (!bgLayer)
         return;
-    paintBackgrounds(p, c, bgLayer->next(), my, mh, _tx, _ty, w, h, xoff);
-    paintBackground(p, c, bgLayer, my, mh, _tx, _ty, w, h, xoff);
+    paintBackgrounds(p, c, bgLayer->next(), my, mh, _tx, _ty, w, h);
+    paintBackground(p, c, bgLayer, my, mh, _tx, _ty, w, h);
 }
 
 void InlineFlowBox::paintBackground(QPainter* p, const QColor& c, const BackgroundLayer* bgLayer,
-                                    int my, int mh, int _tx, int _ty, int w, int h, int xOffsetOnLine)
+                                    int my, int mh, int _tx, int _ty, int w, int h)
 {
     CachedImage* bg = bgLayer->backgroundImage();
     bool hasBackgroundImage = bg && (bg->pixmap_size() == bg->valid_rect().size()) &&
@@ -570,8 +685,10 @@
     }
 }
 
-void InlineFlowBox::paintBackgroundAndBorder(RenderObject::PaintInfo& pI, int _tx, int _ty, int xOffsetOnLine)
+void InlineFlowBox::paintBackgroundAndBorder(RenderObject::PaintInfo& pI, int _tx, int _ty)
 {
+    if (object()->style()->visibility() != VISIBLE || pI.phase != PaintActionForeground)
+        return;
 
     // Move x/y to our coordinates.
     _tx += m_x;
@@ -593,7 +710,7 @@
     if ((!parent() && m_firstLine && styleToUse != object()->style()) ||
         (parent() && object()->shouldPaintBackgroundOrBorder())) {
         QColor c = styleToUse->backgroundColor();
-        paintBackgrounds(pI.p, c, styleToUse->backgroundLayers(), my, mh, _tx, _ty, w, h, xOffsetOnLine);
+        paintBackgrounds(pI.p, c, styleToUse->backgroundLayers(), my, mh, _tx, _ty, w, h);
 
         // :first-line cannot be used to put borders on a line. Always paint borders with our
         // non-first-line style.
@@ -620,20 +737,23 @@
     return shouldDraw;
 }
 
-void InlineFlowBox::paintDecorations(RenderObject::PaintInfo& pI, int _tx, int _ty)
+void InlineFlowBox::paintDecorations(RenderObject::PaintInfo& pI, int _tx, int _ty, bool paintedChildren)
 {
     // Now paint our text decorations. We only do this if we aren't in quirks mode (i.e., in
     // almost-strict mode or strict mode).
+    if (object()->style()->htmlHacks() || object()->style()->visibility() != VISIBLE)
+        return;
 
     _tx += m_x;
     _ty += m_y;
     RenderStyle* styleToUse = object()->style(m_firstLine);
     int deco = parent() ? styleToUse->textDecoration() : styleToUse->textDecorationsInEffect();
-    if (deco != TDNONE && shouldDrawDecoration(object())) {
+    if (deco != TDNONE &&
+        ((!paintedChildren && ((deco & UNDERLINE) || (deco & OVERLINE))) || (paintedChildren && (deco & LINE_THROUGH))) &&
+        shouldDrawDecoration(object())) {
         // We must have child boxes and have decorations defined.
         _tx += borderLeft() + paddingLeft();
         int w = m_width - (borderLeft() + paddingLeft() + borderRight() + paddingRight());
-//    kdDebug() << k_funcinfo << "w: " << w << " deco: " << deco << endl;
         if ( !w )
             return;
         const QFontMetrics &fm = object()->fontMetrics( m_firstLine );
@@ -643,16 +763,20 @@
         underline = overline = linethrough = styleToUse->color();
         if (!parent())
             object()->getTextDecorationColors(deco, underline, overline, linethrough);
-        if (deco & UNDERLINE) {
+
+        if (styleToUse->font() != pI.p->font())
+            pI.p->setFont(styleToUse->font());
+
+        if (deco & UNDERLINE && !paintedChildren) {
             int underlineOffset = ( fm.height() + m_baseline ) / 2;
             if (underlineOffset <= m_baseline) underlineOffset = m_baseline+1;
 
             pI.p->fillRect(_tx, _ty + underlineOffset, w, thickness, underline );
         }
-        if (deco & OVERLINE) {
+        if (deco & OVERLINE && !paintedChildren) {
             pI.p->fillRect(_tx, _ty, w, thickness, overline );
         }
-        if (deco & LINE_THROUGH) {
+        if (deco & LINE_THROUGH && paintedChildren) {
             pI.p->fillRect(_tx, _ty + 2*m_baseline/3, w, thickness, linethrough );
         }
     }
Index: khtml/rendering/render_text.h
===================================================================
--- khtml/rendering/render_text.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_text.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -73,9 +73,13 @@
 
     virtual bool isInlineTextBox() const { return true; }
 
+    void paint(RenderObject::PaintInfo& i, int tx, int ty);
     void paintDecoration(QPainter *pt, const Font *f, int _tx, int _ty, int decoration);
     void paintShadow(QPainter *pt, const Font* f, int _tx, int _ty, const ShadowData *shadow );
     void paintSelection(const Font *f, RenderText *text, QPainter *p, RenderStyle* style, int tx, int ty, int startPos, int endPos, int deco);
+    
+    void selectionStartEnd(int& sPos, int& ePos);
+    RenderObject::SelectionState selectionState();
 
     // Return before, after (offset set to max), or inside the text, at @p offset
     FindSelectionResult checkSelectionPoint(int _x, int _y, int _tx, int _ty, const Font *f, RenderText *text, int & offset, short lineheight);
Index: khtml/rendering/render_table.h
===================================================================
--- khtml/rendering/render_table.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_table.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -306,6 +306,8 @@
 
     virtual void layout();
 
+    virtual RenderObject* removeChildNode(RenderObject* child);
+
     // The only time rows get a layer is when they have transparency.
     virtual bool requiresLayer() const { return /* style()->opacity() < 1.0f; */ false ; }
     virtual void paint(PaintInfo& i, int tx, int ty);
Index: khtml/rendering/render_style.h
===================================================================
--- khtml/rendering/render_style.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_style.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -332,6 +332,9 @@
     bool operator!=(const StyleSurroundData& o) const {
         return !(*this == o);
     }
+    bool hasSamePBMData(const StyleSurroundData& o) const {
+        return (margin == o.margin) && (padding == o.padding) && (border == o.border);
+    }
 
     LengthBox offset;
     LengthBox margin;
Index: khtml/rendering/render_object.cpp
===================================================================
--- khtml/rendering/render_object.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_object.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1057,8 +1057,7 @@
 
     const QColor& oc = style->outlineColor();
     EBorderStyle os = style->outlineStyle();
-    // ### outline-offset should be implemented in renderInline before reactivated here
-    int offset = 0; // style->outlineOffset();
+    int offset = style->outlineOffset();
 
 #ifdef APPLE_CHANGES
     if (style->outlineStyleIsAuto()) {
@@ -1732,37 +1731,32 @@
                 inside = true;
     }
 
-    if (inside) {
-        if (!info.innerNode() && !isInline() && continuation()) {
-            // We are in the margins of block elements that are part of a continuation.  In
-            // this case we're actually still inside the enclosing inline element that was
-            // split.  Go ahead and set our inner node accordingly.
-            info.setInnerNode(continuation()->element());
-            if (!info.innerNonSharedNode())
-                info.setInnerNonSharedNode(continuation()->element());
-        }
+    if (inside)
+        setInnerNode(info);
 
-        if (info.innerNode() && info.innerNode()->renderer() &&
-            !info.innerNode()->renderer()->isInline() && element() && isInline()) {
-            // Within the same layer, inlines are ALWAYS fully above blocks.  Change inner node.
-            info.setInnerNode(element());
+    return inside;
+}
 
-            // Clear everything else.
-            info.setInnerNonSharedNode(0);
-            info.setURLElement(0);
-        }
 
-        if (!info.innerNode() && element())
-            info.setInnerNode(element());
-
-        if(!info.innerNonSharedNode() && element())
-            info.setInnerNonSharedNode(element());
-
+void RenderObject::setInnerNode(NodeInfo& info)
+{
+    if (!info.innerNode() && !isInline() && continuation()) {
+        // We are in the margins of block elements that are part of a continuation.  In
+        // this case we're actually still inside the enclosing inline element that was
+        // split.  Go ahead and set our inner node accordingly.
+        info.setInnerNode(continuation()->element());
+        if (!info.innerNonSharedNode())
+            info.setInnerNonSharedNode(continuation()->element());
     }
 
-    return inside;
+    if (!info.innerNode() && element())
+        info.setInnerNode(element());
+            
+    if(!info.innerNonSharedNode() && element())
+        info.setInnerNonSharedNode(element());
 }
 
+
 short RenderObject::verticalPositionHint( bool firstLine ) const
 {
     short vpos = m_verticalPosition;
Index: khtml/rendering/render_flow.h
===================================================================
--- khtml/rendering/render_flow.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_flow.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -66,8 +66,8 @@
 
     virtual InlineBox* createInlineBox(bool makePlaceHolderBox, bool isRootLineBox);
 
-    void paintLineBoxBackgroundBorder(PaintInfo& pI, int _tx, int _ty);
-    void paintLineBoxDecorations(PaintInfo& p, int _tx, int _ty);
+    void paintLines(PaintInfo& i, int _tx, int _ty);
+    bool hitTestLines(NodeInfo& i, int x, int y, int tx, int ty, HitTestAction hitTestAction);
 
     virtual void repaint(bool immediate = false);
 
Index: khtml/rendering/render_layer.cpp
===================================================================
--- khtml/rendering/render_layer.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_layer.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -97,7 +97,10 @@
 m_scrollMediator( 0 ),
 m_posZOrderList( 0 ),
 m_negZOrderList( 0 ),
+m_overflowList(0),
 m_zOrderListsDirty( true ),
+m_overflowListDirty(true),
+m_isOverflowOnly( shouldBeOverflowOnly() ),
 m_markedForRepaint( false ),
 m_hasOverlaidWidgets( false ),
 m_marquee( 0 )
@@ -113,6 +116,7 @@
     delete m_scrollMediator;
     delete m_posZOrderList;
     delete m_negZOrderList;
+    delete m_overflowList;
     delete m_marquee;
 }
 
@@ -372,12 +376,16 @@
 
     child->setParent(this);
 
-    // Dirty the z-order list in which we are contained.  The stackingContext() can be null in the
-    // case where we're building up generated content layers.  This is ok, since the lists will start
-    // off dirty in that case anyway.
-    RenderLayer* stackingContext = child->stackingContext();
-    if (stackingContext)
-        stackingContext->dirtyZOrderLists();
+    if (child->isOverflowOnly())
+        dirtyOverflowList();
+    else {
+        // Dirty the z-order list in which we are contained.  The stackingContext() can be null in the
+        // case where we're building up generated content layers.  This is ok, since the lists will start
+        // off dirty in that case anyway.
+        RenderLayer* stackingContext = child->stackingContext();
+        if (stackingContext)
+            stackingContext->dirtyZOrderLists();
+    }
 }
 
 RenderLayer* RenderLayer::removeChild(RenderLayer* oldChild)
@@ -393,12 +401,16 @@
     if (m_last == oldChild)
         m_last = oldChild->previousSibling();
 
-    // Dirty the z-order list in which we are contained.  When called via the
-    // reattachment process in removeOnlyThisLayer, the layer may already be disconnected
-    // from the main layer tree, so we need to null-check the |stackingContext| value.
-    RenderLayer* stackingContext = oldChild->stackingContext();
-    if (stackingContext)
-        oldChild->stackingContext()->dirtyZOrderLists();
+    if (oldChild->isOverflowOnly())
+        dirtyOverflowList();
+    else {
+        // Dirty the z-order list in which we are contained.  When called via the
+        // reattachment process in removeOnlyThisLayer, the layer may already be disconnected
+        // from the main layer tree, so we need to null-check the |stackingContext| value.
+        RenderLayer* stackingContext = oldChild->stackingContext();
+        if (stackingContext)
+            stackingContext->dirtyZOrderLists();
+    }
 
     oldChild->setPreviousSibling(0);
     oldChild->setNextSibling(0);
@@ -839,8 +851,9 @@
     int x = layerBounds.x();
     int y = layerBounds.y();
 
-    // Ensure our z-order lists are up-to-date.
+    // Ensure our lists are up-to-date.
     updateZOrderLists();
+    updateOverflowList();
 
 #ifdef APPLE_CHANGES
     // Set our transparency if we need to.
@@ -902,9 +915,11 @@
             renderer()->paint(paintInfo, tx, ty);
             paintInfo.phase = PaintActionForeground;
             renderer()->paint(paintInfo, tx, ty);
-            paintInfo.phase = PaintActionOutline;
-            renderer()->paint(paintInfo, tx, ty);
             RenderCanvas *rc = static_cast<RenderCanvas*>(renderer()->document()->renderer());
+            if (rc->maximalOutlineSize()) {
+                paintInfo.phase = PaintActionOutline;
+                renderer()->paint(paintInfo, tx, ty);
+            }
             if (rc->selectionStart() && rc->selectionEnd()) {
                 paintInfo.phase = PaintActionSelection;
                 renderer()->paint(paintInfo, tx, ty);
@@ -915,6 +930,11 @@
         restoreClip(p, paintDirtyRect, clipRectToApply);
     }
 
+    // Paint any child layers that have overflow.
+    if (m_overflowList)
+        for (QValueList<RenderLayer*>::iterator it = m_overflowList->begin(); it != m_overflowList->end(); ++it)
+            (*it)->paintLayer(rootLayer, p, paintDirtyRect, selectionOnly);
+
     // Now walk the sorted list of children with positive z-indices.
     if (m_posZOrderList) {
         uint count = m_posZOrderList->count();
@@ -986,8 +1006,9 @@
     QRect layerBounds, bgRect, fgRect;
     calculateRects(rootLayer, hitTestRect, layerBounds, bgRect, fgRect);
 
-    // Ensure our z-order lists are up-to-date.
+    // Ensure our lists are up-to-date.
     updateZOrderLists();
+    updateOverflowList();
 
     // This variable tracks which layer the mouse ends up being inside.  The minute we find an insideLayer,
     // we are done and can return it.
@@ -1005,8 +1026,17 @@
         }
     }
 
+    // Now check our overflow objects.
+    if (m_overflowList) {
+        QValueList<RenderLayer*>::iterator it = m_overflowList->end();
+        for (--it; it != m_overflowList->end(); --it) {
+            insideLayer = (*it)->nodeAtPointForLayer(rootLayer, info,  xMousePos, yMousePos, hitTestRect);
+            if (insideLayer)
+                return insideLayer;
+        }
+    }
+
     // Next we want to see if the mouse pos is inside the child RenderObjects of the layer.
-
     if (containsPoint(xMousePos, yMousePos, fgRect) &&
         renderer()->nodeAtPoint(info, xMousePos, yMousePos,
                             layerBounds.x() - renderer()->xPos() + m_object->borderLeft(), 
@@ -1290,6 +1320,13 @@
     m_zOrderListsDirty = true;
 }
 
+void RenderLayer::dirtyOverflowList()
+{
+    if (m_overflowList)
+        m_overflowList->clear();
+    m_overflowListDirty = true;
+}
+
 void RenderLayer::updateZOrderLists()
 {
     if (!isStackingContext() || !m_zOrderListsDirty)
@@ -1311,6 +1348,22 @@
     m_zOrderListsDirty = false;
 }
 
+void RenderLayer::updateOverflowList()
+{
+    if (!m_overflowListDirty)
+        return;
+        
+    for (RenderLayer* child = firstChild(); child; child = child->nextSibling()) {
+        if (child->isOverflowOnly()) {
+            if (!m_overflowList)
+                m_overflowList = new QValueList<RenderLayer*>;
+            m_overflowList->append(child);
+        }
+    }
+
+    m_overflowListDirty = false;
+}
+
 void RenderLayer::collectLayers(QPtrVector<RenderLayer>*& posBuffer, QPtrVector<RenderLayer>*& negBuffer)
 {
     // FIXME: A child render object or layer could override visibility.  Don't remove this
@@ -1319,20 +1372,24 @@
     if (renderer()->style()->visibility() != VISIBLE)
         return;
 
-    // Determine which buffer the child should be in.
-    QPtrVector<RenderLayer>*& buffer = (zIndex() >= 0) ? posBuffer : negBuffer;
+    // Overflow layers are just painted by their enclosing layers, so they don't get put in zorder lists.
+    if (!isOverflowOnly()) {
 
-    // Create the buffer if it doesn't exist yet.
-    if (!buffer)
-        buffer = new QPtrVector<RenderLayer>();
+        // Determine which buffer the child should be in.
+        QPtrVector<RenderLayer>*& buffer = (zIndex() >= 0) ? posBuffer : negBuffer;
 
-    // Resize by a power of 2 when our buffer fills up.
-    if (buffer->count() == buffer->size())
-        buffer->resize(2*(buffer->size()+1));
+        // Create the buffer if it doesn't exist yet.
+        if (!buffer)
+            buffer = new QPtrVector<RenderLayer>();
 
-    // Append ourselves at the end of the appropriate buffer.
-    buffer->insert(buffer->count(), this);
+        // Resize by a power of 2 when our buffer fills up.
+        if (buffer->count() == buffer->size())
+            buffer->resize(2*(buffer->size()+1));
 
+        // Append ourselves at the end of the appropriate buffer.
+        buffer->insert(buffer->count(), this);
+    }
+
     // Recur into our children to collect more layers, but only if we don't establish
     // a stacking context.
     if (!isStackingContext()) {
@@ -1429,8 +1486,26 @@
 
 #endif
 
+bool RenderLayer::shouldBeOverflowOnly() const
+{
+    return renderer()->style() && renderer()->hasOverflowClip() && 
+           !renderer()->isPositioned() &&  !renderer()->isRelPositioned(); 
+           /* && !isTransparent(); */
+}
+
 void RenderLayer::styleChanged()
 {
+    bool isOverflowOnly = shouldBeOverflowOnly();
+    if (isOverflowOnly != m_isOverflowOnly) {
+        m_isOverflowOnly = isOverflowOnly;
+        RenderLayer* p = parent();
+        RenderLayer* sc = stackingContext();
+        if (p)
+            p->dirtyOverflowList();
+        if (sc)
+            sc->dirtyZOrderLists();
+    }
+
     if (m_object->style()->overflow() == OMARQUEE && m_object->style()->marqueeBehavior() != MNONE) {
         if (!m_marquee)
             m_marquee = new Marquee(this);
Index: khtml/rendering/render_inline.h
===================================================================
--- khtml/rendering/render_inline.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_inline.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -77,11 +77,11 @@
     virtual int offsetTop() const;
 
     virtual void caretPos(int offset, int flags, int &_x, int &_y, int &width, int &height);
+    void paintOutlines(QPainter *p, int tx, int ty);    
 
 protected:
     static RenderInline* cloneInline(RenderFlow* src);
     void paintOutlinePath(QPainter *p, int tx, int ty, const QPoint *begin, const QPoint *end, BorderSide startingBS, int initialDirection, BorderSide endingBS);
-    void paintOutlines(QPainter *p, int tx, int ty);
 
 private:
     bool m_isContinuation : 1; // Whether or not we're a continuation of an inline.
Index: khtml/rendering/render_text.cpp
===================================================================
--- khtml/rendering/render_text.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_text.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -92,6 +92,99 @@
     *(size_t *)ptr = sz;
 }
 
+void InlineTextBox::selectionStartEnd(int& sPos, int& ePos)
+{
+    int startPos, endPos;
+    if (object()->selectionState() == RenderObject::SelectionInside) {
+        startPos = 0;
+        endPos = renderText()->string()->l;
+    } else {
+        renderText()->selectionStartEnd(startPos, endPos);
+        if (object()->selectionState() == RenderObject::SelectionStart)
+            endPos = renderText()->string()->l;
+        else if (object()->selectionState() == RenderObject::SelectionEnd)
+            startPos = 0;
+    }
+
+    sPos = kMax(startPos - m_start, 0);
+    ePos = kMin(endPos - m_start, (int)m_len);
+}
+
+RenderObject::SelectionState InlineTextBox::selectionState()
+{
+    RenderObject::SelectionState state = object()->selectionState();
+    if (state == RenderObject::SelectionStart || state == RenderObject::SelectionEnd ||
+        state == RenderObject::SelectionBoth) {
+        int startPos, endPos;
+        renderText()->selectionStartEnd(startPos, endPos);
+        
+        bool start = (state != RenderObject::SelectionEnd && startPos >= m_start && startPos < m_start + m_len);
+        bool end = (state != RenderObject::SelectionStart && endPos > m_start && endPos <= m_start + m_len);
+        if (start && end)
+            state = RenderObject::SelectionBoth;
+        else if (start)
+            state = RenderObject::SelectionStart;
+        else if (end)
+            state = RenderObject::SelectionEnd;
+        else if ((state == RenderObject::SelectionEnd || startPos < m_start) &&
+                 (state == RenderObject::SelectionStart || endPos > m_start + m_len))
+            state = RenderObject::SelectionInside;
+    }
+    return state;
+}
+
+void InlineTextBox::paint(RenderObject::PaintInfo& i, int tx, int ty)
+{
+    if (object()->isBR() || object()->style()->visibility() != VISIBLE || i.phase == PaintActionOutline)
+        return;
+
+    if (i.phase == PaintActionSelection && object()->selectionState() == RenderObject::SelectionNone)
+        // When only painting the selection, don't bother to paint if there is none.
+        return;
+
+    int xPos = tx + m_x;
+    int w = width();
+    if ((xPos >= i.r.x() + i.r.width()) || (xPos + w <= i.r.x()))
+        return;
+
+    // Set our font.
+    RenderStyle* styleToUse = object()->style(m_firstLine);
+    int d = styleToUse->textDecorationsInEffect();
+    if (styleToUse->font() != i.p->font())
+        i.p->setFont(styleToUse->font());
+    const Font *font = &styleToUse->htmlFont();
+    bool haveSelection = selectionState() != RenderObject::SelectionNone;
+    
+    // Now calculate startPos and endPos, for painting selection.
+    // We paint selection while endPos > 0
+    int ePos = 0, sPos = 0;
+    if (haveSelection && !object()->canvas()->staticMode()) {
+        selectionStartEnd(sPos, ePos);
+    }
+    if (styleToUse->color() != i.p->pen().color())
+        i.p->setPen(styleToUse->color());
+
+    if (m_len > 0 && i.phase != PaintActionSelection) {
+        if (styleToUse->textShadow())
+            paintShadow(i.p, font, tx, ty, styleToUse->textShadow());
+        if (!haveSelection || sPos != 0 || ePos != m_len) {
+            font->drawText(i.p, m_x + tx, m_y + ty + m_baseline, renderText()->string()->s, renderText()->string()->l, m_start, m_len,
+                           m_toAdd, m_reversed ? QPainter::RTL : QPainter::LTR);
+        }
+    }
+
+    if (d != TDNONE && i.phase != PaintActionSelection && styleToUse->htmlHacks()) {
+        i.p->setPen(styleToUse->color());
+        paintDecoration(i.p, font, tx, ty, d);
+    }
+
+    if (haveSelection && i.phase == PaintActionSelection) {
+        //kdDebug(6040) << this << " paintSelection with startPos=" << sPos << " endPos=" << ePos << endl;
+        if ( sPos < ePos )
+	    paintSelection(font, renderText(), i.p, styleToUse, tx, ty, sPos, ePos, d);
+    }
+}
+
 /** returns the proper ::selection pseudo style for the given element
  * @return the style or 0 if no ::selection pseudo applies.
  */
@@ -130,11 +223,10 @@
 	// ### should be at most retrieved once per render text
 	QColor bg = khtml::retrieveBackgroundColor(text);
 	// It may happen that the contrast is -- well -- virtually non existent.
-	// In this case, simply invert the colors
-	if (!khtml::hasSufficientContrast(hbg, bg)) {
-	    hc = QColor(0xff-hc.red(),0xff-hc.green(),0xff-hc.blue());
-	    hbg = QColor(0xff-hbg.red(),0xff-hbg.green(),0xff-hbg.blue());
-	}/*end if*/
+	// In this case, simply swap the colors, thus in compliance with
+	// NN4 (win32 only), IE, and Mozilla.
+	if (!khtml::hasSufficientContrast(hbg, bg))
+	    qSwap(hc, hbg);
     }
 
     p->setPen(hc);
@@ -861,128 +953,9 @@
     return false;
 }
 
-void RenderText::paint( PaintInfo& pI, int tx, int ty)
+void RenderText::paint( PaintInfo& /*pI*/, int /*tx*/, int /*ty*/)
 {
-    if (pI.phase == PaintActionSelection && selectionState() == SelectionNone)
-        // When only painting the selection, don't bother to paint if there is none.
-        return;
-    if (pI.phase != PaintActionForeground && pI.phase != PaintActionSelection
-        || style()->visibility() != VISIBLE)
-        return;
-
-    int s = m_lines.count() - 1;
-    if ( s < 0 ) return;
-
-    if ( ty + m_lines[0]->m_y > pI.r.bottom() ) return;
-    if ( ty + m_lines[s]->m_y + m_lines[s]->height() < pI.r.top() ) return;
-
-    int ow = style()->outlineWidth();
-    RenderStyle* pseudoStyle = hasFirstLine() ? style()->getPseudoStyle(RenderStyle::FIRST_LINE) : 0;
-    InlineTextBox f(0, pI.r.top()-ty);
-    int si = m_lines.findFirstMatching(&f);
-    // something matching found, find the first one to paint
-    bool isStatic = canvas()->staticMode();
-    if (isStatic && pI.phase == PaintActionSelection) return;
-
-    if(si >= 0)
-    {
-        // Move up until out of area to be painted
-        while(si > 0 && m_lines[si-1]->checkVerticalPoint(pI.r.y(), ty, pI.r.height(), m_lineHeight))
-            si--;
-
-        // Now calculate startPos and endPos, for painting selection.
-        // We paint selection while endPos > 0
-        int endPos = 0, startPos = 0;
-        if (!isStatic && (selectionState() != SelectionNone)) {
-            if (selectionState() == SelectionInside) {
-                //kdDebug(6040) << this << " SelectionInside -> 0 to end" << endl;
-                startPos = 0;
-                endPos = str->l;
-            } else {
-                selectionStartEnd(startPos, endPos);
-                if(selectionState() == SelectionStart)
-                    endPos = str->l;
-                else if(selectionState() == SelectionEnd)
-                    startPos = 0;
-            }
-            //kdDebug(6040) << this << " Selection from " << startPos << " to " << endPos << endl;
-        }
-
-        InlineTextBox* s;
-	const Font *font = &style()->htmlFont();
-
-        bool haveSelection = !isStatic && selectionState() != SelectionNone && startPos != endPos;
-        if (!haveSelection && pI.phase == PaintActionSelection)
-            // When only painting the selection, don't bother to paint if there
-            return;
-
-        // run until we find one that is outside the range, then we
-        // know we can stop
-        do {
-            s = m_lines[si];
-
-            RenderStyle* _style = pseudoStyle && s->m_firstLine ? pseudoStyle : style();
-            int d = _style->textDecorationsInEffect();
-
-            if(_style->font() != pI.p->font())
-                pI.p->setFont(_style->font());
-
-	    //has to be outside the above if because of small caps.
-	    font = &_style->htmlFont();
-
-            if(_style->color() != pI.p->pen().color())
-                pI.p->setPen(_style->color());
-
-#ifdef APPLE_CHANGES
-            // Set a text shadow if we have one.
-            bool setShadow = false;
-            if (_style->textShadow()) {
-                p->setShadow(_style->textShadow()->x, _style->textShadow()->y,
-                             _style->textShadow()->blur, _style->textShadow()->color);
-                setShadow = true;
-            }
-#endif
-
-            const int offset = s->m_start;
-            const int sPos = kMax( startPos - offset, 0 );
-            const int ePos = kMin( endPos - offset, int( s->m_len ) );
-            if (s->m_len > 0 && pI.phase != PaintActionSelection) {
-                //kdDebug( 6040 ) << "RenderObject::paintObject(" << QConstString(str->s + s->m_start, s->m_len).string() << ") at(" << s->m_x+tx << "/" << s->m_y+ty << ")" << endl;
-                if (_style->textShadow())
-                    s->paintShadow(pI.p, font, tx, ty, _style->textShadow());
-// kdDebug(6040) << QConstString(str->s + s->m_start, s->m_len).string().left(40) << endl;
-                if (!haveSelection || sPos != 0 || ePos != s->m_len) {
-                    font->drawText(pI.p, s->m_x + tx, s->m_y + ty + s->m_baseline, str->s, str->l, s->m_start, s->m_len,
-                                   s->m_toAdd, s->m_reversed ? QPainter::RTL : QPainter::LTR);
-                }
-	    }
-
-            if (d != TDNONE && pI.phase == PaintActionForeground
-                && style()->htmlHacks()) {
-                pI.p->setPen(_style->color());
-                s->paintDecoration(pI.p, font, tx, ty, d);
-            }
-
-            if (haveSelection && pI.phase == PaintActionSelection) {
-                //kdDebug(6040) << this << " paintSelection with startPos=" << sPos << " endPos=" << ePos << endl;
-		if ( sPos < ePos )
-		    s->paintSelection(font, this, pI.p, _style, tx, ty, sPos, ePos, d);
-
-            }
-#ifdef BIDI_DEBUG
-            {
-                int h = lineHeight( false ) + paddingTop() + paddingBottom() + borderTop() + borderBottom();
-                QColor c2 = QColor("#0000ff");
-                drawBorder(pI.p, tx + s->m_x, ty + s->m_y, tx + s->m_x + 1, ty + s->m_y + h,
-                              RenderObject::BSLeft, c2, c2, SOLID, 1, 1);
-                drawBorder(pI.p, tx + s->m_x + s->m_width, ty + s->m_y, tx + s->m_x + s->m_width + 1, ty + s->m_y + h,
-                              RenderObject::BSRight, c2, c2, SOLID, 1, 1);
-            }
-#endif
-
-        } while (++si < (int)m_lines.count() && m_lines[si]->checkVerticalPoint(pI.r.y()-ow, ty, pI.r.height(), m_lineHeight));
-
-    }
+    KHTMLAssert( false );
 }
 
 void RenderText::calcMinMaxWidth()
@@ -1145,25 +1118,41 @@
         switch(style()->textTransform()) {
         case CAPITALIZE:
         {
-            // find previous text renderer if one exists
-            RenderObject* o;
+            RenderObject *o;
             bool runOnString = false;
-            for (o = previousRenderer(); o && o->isInlineFlow(); o = o->previousRenderer())
-                ;
-            if (o && o->isText()) {
-                DOMStringImpl* prevStr = static_cast<RenderText*>(o)->string();
-                QChar c = (*prevStr)[prevStr->length() - 1];
-                if (!c.isSpace())
-                    runOnString = true;
+
+            // find previous non-empty text renderer if one exists
+            for (o = previousRenderer(); o; o = o->previousRenderer()) {
+                if (!o->isInlineFlow()) {
+                    if (!o->isText())
+                        break;
+
+                    DOMStringImpl *prevStr = static_cast<RenderText*>(o)->string();
+                    // !prevStr can happen with css like "content:open-quote;"
+                    if (!prevStr)
+                        break;
+
+                    if (prevStr->length() == 0)
+                        continue;
+                    QChar c = (*prevStr)[prevStr->length() - 1];
+                    if (!c.isSpace())
+                        runOnString = true;
+
+                    break;
+                }
             }
+
             str = str->capitalize(runOnString);
         }
         break;
-	case UPPERCASE:   str = str->upper();       break;
-	case LOWERCASE:  str = str->lower();       break;
-	case NONE:
-	default:;
-	}
+
+		
+		
+        case UPPERCASE: str = str->upper();       break;
+        case LOWERCASE: str = str->lower();       break;
+        case NONE:
+        default:;
+    }
         str->ref();
         oldstr->deref();
     }
Index: khtml/rendering/render_table.cpp
===================================================================
--- khtml/rendering/render_table.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_table.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -283,9 +283,12 @@
     m_height = 0;
     initMaxMarginValues();
 
-    //int oldWidth = m_width;
+    int oldWidth = m_width;
     calcWidth();
     m_overflowWidth = m_width;
+    
+    if (tCaption && (oldWidth != m_width || tCaption->style()->height().isPercent()))
+        tCaption->setChildNeedsLayout(true);
 
     // the optimization below doesn't work since the internal table
     // layout could have changed.  we need to add a flag to the table
@@ -1984,6 +1987,15 @@
     setInline(false);   // our object is not Inline
 }
 
+RenderObject* RenderTableRow::removeChildNode(RenderObject* child)
+{
+    RenderTableSection *s = section();
+    if (s)
+        s->setNeedCellRecalc();
+
+    return RenderContainer::removeChildNode( child );
+}
+
 void RenderTableRow::detach()
 {
     RenderTableSection *s = section();
@@ -2235,6 +2247,9 @@
     kdDebug( 6040 ) << renderName() << "(TableCell)::calcMinMaxWidth() known=" << minMaxKnown() << endl;
 #endif
 
+    if (section()->needCellRecalc)
+        section()->recalcCells();
+
     RenderBlock::calcMinMaxWidth();
     if (element() && style()->whiteSpace() == NORMAL) {
         // See if nowrap was set.
Index: khtml/rendering/render_box.cpp
===================================================================
--- khtml/rendering/render_box.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_box.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -171,9 +171,8 @@
     if (m_layer)
         m_layer->styleChanged();
 
-    // ### outlineSize() and outlineOffset() not merged yet
-    if (style()->outlineWidth() > 0 && style()->outlineWidth() > maximalOutlineSize(PaintActionOutline))
-        static_cast<RenderCanvas*>(document()->renderer())->setMaximalOutlineSize(style()->outlineWidth());
+    if (style()->outlineWidth() > 0 && style()->outlineSize() > maximalOutlineSize(PaintActionOutline))
+        static_cast<RenderCanvas*>(document()->renderer())->setMaximalOutlineSize(style()->outlineSize());
     if (affectsParent)
         restructureParentFlow();
 }
@@ -737,7 +736,7 @@
         }
 
         if(!isInline() || isReplaced()) {
-            _xPos += xPos(), 
+            _xPos += xPos(),
             _yPos += yPos();
         }
 
@@ -779,7 +778,7 @@
 
 void RenderBox::repaint(bool immediate)
 {
-    int ow = style() ? style()->outlineWidth() /* style()->outlineSize() */ : 0;
+    int ow = style() ? style()->outlineSize() : 0;
     if( isInline() && !isReplaced() )
     {
         RenderObject* p = parent();
@@ -1106,6 +1105,7 @@
     if (cb->isTableCell() && style()->htmlHacks()) {
         result = static_cast<RenderTableCell*>(cb)->cellPercentageHeight();
     }
+
     // Otherwise we only use our percentage height if our containing block had a specified
     // height.
     else if (cb->style()->height().isFixed())
@@ -1133,6 +1133,12 @@
                               p->borderTop() + p->borderBottom() +
                               p->paddingTop() + p->paddingBottom());
     }
+    else if (cb->isRoot() && style()->htmlHacks() && cb->style()->height().isVariable()) {
+        int visHeight = canvas()->viewportHeight();
+        result = visHeight - (marginTop() + marginBottom() +
+                              borderTop() + borderBottom() +
+                              paddingTop() + paddingBottom());
+    }
     else if (cb->isAnonymousBlock() || treatAsReplaced && style()->htmlHacks()) {
         // IE quirk.
         result = cb->calcPercentageHeight(cb->style()->height(), treatAsReplaced);
Index: khtml/rendering/render_block.cpp
===================================================================
--- khtml/rendering/render_block.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_block.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1597,7 +1597,7 @@
 
         yPos += overflowTop();
 
-        int os = 2*maximalOutlineSize(pI.phase);
+        int os = maximalOutlineSize(pI.phase);
         if( (yPos > pI.r.bottom() + os) || (_ty + h <= pI.r.y() - os))
             return;
     }
@@ -1625,21 +1625,20 @@
     if ( pI.phase == PaintActionChildBackgrounds )
         pI.phase = PaintActionChildBackground;
 
-    paintLineBoxBackgroundBorder(pI, _tx, _ty);
-
     // 2. paint contents
     int scrolledX = _tx;
     int scrolledY = _ty;
     if (style()->hidesOverflow() && m_layer)
         m_layer->subtractScrollOffset(scrolledX, scrolledY);
 
-    for(RenderObject *child = firstChild(); child; child = child->nextSibling()) {
-        if(!child->layer() && !child->isFloating())
-            child->paint(pI, scrolledX, scrolledY);
+    if (childrenInline())
+        paintLines(pI, scrolledX, scrolledY);
+    else {            
+        for(RenderObject *child = firstChild(); child; child = child->nextSibling())
+            if(!child->layer() && !child->isFloating())
+                child->paint(pI, scrolledX, scrolledY);
     }
 
-    paintLineBoxDecorations(pI, scrolledX, scrolledY);
-
     // 3. paint floats.
     if (!inlineFlow && (pI.phase == PaintActionFloat || pI.phase == PaintActionSelection))
         paintFloats(pI, scrolledX, scrolledY, pI.phase == PaintActionSelection);
@@ -2413,6 +2412,9 @@
 
 int RenderBlock::getClearDelta(RenderObject *child)
 {
+    if (!hasFloats())
+        return 0;
+
     //kdDebug( 6040 ) << "getClearDelta on child " << child << " oldheight=" << m_height << endl;
     bool clearSet = child->style()->clear() != CNONE;
     int bottom = 0;
Index: khtml/rendering/render_line.h
===================================================================
--- khtml/rendering/render_line.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/rendering/render_line.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -45,6 +45,9 @@
 
     void detach(RenderArena* renderArena);
 
+    virtual void paint(RenderObject::PaintInfo& i, int _tx, int _ty);
+    virtual bool nodeAtPoint(RenderObject::NodeInfo& i, int x, int y, int tx, int ty);
+
     // Overloaded new operator.
     void* operator new(size_t sz, RenderArena* renderArena) throw();
 
@@ -96,6 +99,7 @@
     int baseline() const { return m_baseline; }
 
     virtual bool hasTextChildren() const { return true; }
+    virtual bool hasTextDescendant() const { return true; }
 
     virtual int topOverflow() const { return yPos(); }
     virtual int bottomOverflow() const { return yPos()+height(); }
@@ -137,8 +141,8 @@
     void setNextLineBox(InlineRunBox* n) { m_nextLine = n; }
     void setPreviousLineBox(InlineRunBox* p) { m_prevLine = p; }
 
-    virtual void paintBackgroundAndBorder(RenderObject::PaintInfo&, int /*_tx*/, int /*_ty*/, int /*xOffsetOnLine*/) {}
-    virtual void paintDecorations(RenderObject::PaintInfo&, int /*_tx*/, int /*_ty*/) {}
+    virtual void paintBackgroundAndBorder(RenderObject::PaintInfo&, int /*_tx*/, int /*_ty*/) {}
+    virtual void paintDecorations(RenderObject::PaintInfo&, int /*_tx*/, int /*_ty*/, bool /*paintedChildren*/ = false) {}
 
 protected:
     InlineRunBox* m_prevLine;  // The previous box that also uses our RenderObject
@@ -155,6 +159,7 @@
         m_lastChild = 0;
         m_includeLeftEdge = m_includeRightEdge = false;
         m_hasTextChildren = false;
+        m_hasTextDescendant = false;
         m_afterPageBreak = false;
     }
 
@@ -162,6 +167,9 @@
 
     virtual bool isInlineFlowBox() const { return true; }
 
+    InlineFlowBox* prevFlowBox() const { return static_cast<InlineFlowBox*>(m_prevLine); }
+    InlineFlowBox* nextFlowBox() const { return static_cast<InlineFlowBox*>(m_nextLine); }
+
     InlineBox* firstChild() const  { return m_firstChild; }
     InlineBox* lastChild() const { return m_lastChild; }
 
@@ -180,16 +188,21 @@
         }
         child->setFirstLineStyleBit(m_firstLine);
         child->setParent(this);
-        if (child->isInlineTextBox())
-            m_hasTextChildren = true;
+        if (!m_hasTextChildren && child->isInlineTextBox()) {
+            m_hasTextDescendant = m_hasTextChildren = true;
+            for (InlineFlowBox* p = m_parent; p && !p->hasTextDescendant(); p = p->parent())
+                p->m_hasTextDescendant = true;
+        }
     }
     void removeFromLine(InlineBox* child);
-    virtual void paintBackgroundAndBorder(RenderObject::PaintInfo&, int _tx, int _ty, int xOffsetOnLine);
+    virtual void paintBackgroundAndBorder(RenderObject::PaintInfo&, int _tx, int _ty);
     void paintBackgrounds(QPainter* p, const QColor& c, const BackgroundLayer* bgLayer,
-                          int my, int mh, int _tx, int _ty, int w, int h, int xoff);
+                          int my, int mh, int _tx, int _ty, int w, int h);
     void paintBackground(QPainter* p, const QColor& c, const BackgroundLayer* bgLayer,
-                         int my, int mh, int _tx, int _ty, int w, int h, int xoff);
-    virtual void paintDecorations(RenderObject::PaintInfo&, int _tx, int _ty);
+                         int my, int mh, int _tx, int _ty, int w, int h);
+    virtual void paint(RenderObject::PaintInfo& i, int _tx, int _ty);
+    virtual void paintDecorations(RenderObject::PaintInfo&, int _tx, int _ty, bool paintedChildren = false);
+    virtual bool nodeAtPoint(RenderObject::NodeInfo& i, int x, int y, int tx, int ty);
 
     int marginBorderPaddingLeft() const;
     int marginBorderPaddingRight() const;
@@ -207,6 +220,7 @@
         m_includeRightEdge = includeRight;
     }
     virtual bool hasTextChildren() const { return m_hasTextChildren; }
+    bool hasTextDescendant() const { return m_hasTextDescendant; }
 
     // Helper functions used during line construction and placement.
     void determineSpacingForFlowBoxes(bool lastLine, RenderObject* endObject);
@@ -235,6 +249,7 @@
     bool m_includeLeftEdge : 1;
     bool m_includeRightEdge : 1;
     bool m_hasTextChildren : 1;
+    bool m_hasTextDescendant : 1;
     bool m_afterPageBreak : 1;
 };
 
Index: khtml/dom/dom_node.cpp
===================================================================
--- khtml/dom/dom_node.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/dom/dom_node.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -270,21 +270,23 @@
 {
     if (!impl) throw DOMException(DOMException::NOT_FOUND_ERR);
     int exceptioncode = 0;
-    NodeImpl *r = impl->replaceChild( newChild.impl, oldChild.impl, exceptioncode );
+    impl->replaceChild( newChild.impl, oldChild.impl, exceptioncode );
     if (exceptioncode)
 	throw DOMException(exceptioncode);
     if (newChild.impl && !newChild.impl->closed()) newChild.impl->close();
-    return r;
+    
+    return oldChild;
 }
 
 Node Node::removeChild( const Node &oldChild )
 {
     if (!impl) throw DOMException(DOMException::NOT_FOUND_ERR);
     int exceptioncode = 0;
-    NodeImpl *r = impl->removeChild( oldChild.impl, exceptioncode );
+    impl->removeChild( oldChild.impl, exceptioncode );
     if (exceptioncode)
 	throw DOMException(exceptioncode);
-    return r;
+	
+    return oldChild;
 }
 
 Node Node::appendChild( const Node &newChild )
Index: khtml/java/kjavaappletviewer.desktop
===================================================================
--- khtml/java/kjavaappletviewer.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/java/kjavaappletviewer.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Name[es]=Visor de applets de Java empotrables
 Name[et]=Põimitav Java apleti näitaja
 Name[eu]=Kapsulatutako Javaren applet-ikustailea
-Name[fa]=نمایشگر نهفته‌ی برنامک‌های Java
+Name[fa]=مشاهده گر برنامک جاوای نهفته
 Name[fi]=Upotettava Java-sovelmien näyttäjä
 Name[fr]=Afficheur d'applets Java intégré
 Name[fy]=yn sluten Java Applet Werjefte
Index: khtml/css/html4.css
===================================================================
--- khtml/css/html4.css	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/html4.css	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -170,7 +170,6 @@
 table {
 	display: table;
 	border-collapse: separate;
-	text-align: -khtml-auto;
 	border-spacing: 2px;
         -khtml-flow-mode: -khtml-around-floats;
         box-sizing: border-box;
Index: khtml/css/cssparser.cpp
===================================================================
--- khtml/css/cssparser.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/cssparser.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1948,6 +1948,70 @@
     return list;
 }
 
+ 
+bool CSSParser::parseColorParameters(Value* value, int* colorArray, bool parseAlpha)
+{
+    ValueList* args = value->function->args;
+    Value* v = args->current();
+    // Get the first value
+    if (!validUnit(v, FInteger | FPercent, true))
+        return false;
+    colorArray[0] = static_cast<int>(v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256.0 / 100.0 : 1.0));
+    for (int i = 1; i < 3; i++) {
+        v = args->next();
+        if (v->unit != Value::Operator && v->iValue != ',')
+            return false;
+        v = args->next();
+        if (!validUnit(v, FInteger | FPercent, true))
+            return false;
+        colorArray[i] = static_cast<int>(v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256.0 / 100.0 : 1.0));
+    }
+    if (parseAlpha) {
+        v = args->next();
+        if (v->unit != Value::Operator && v->iValue != ',')
+            return false;
+        v = args->next();
+        if (!validUnit(v, FNumber, true))
+            return false;
+        colorArray[3] = static_cast<int>(kMax(0.0, kMin(1.0, v->fValue)) * 255);
+    }
+    return true;
+}
+ 
+// CSS3 specification defines the format of a HSL color as
+// hsl(<number>, <percent>, <percent>)
+// and with alpha, the format is
+// hsla(<number>, <percent>, <percent>, <number>)
+// The first value, HUE, is in an angle with a value between 0 and 360
+bool CSSParser::parseHSLParameters(Value* value, double* colorArray, bool parseAlpha)
+{
+    ValueList* args = value->function->args;
+    Value* v = args->current();
+    // Get the first value
+    if (!validUnit(v, FInteger, true))
+        return false;
+    // normalize the Hue value and change it to be between 0 and 1.0
+    colorArray[0] = (((static_cast<int>(v->fValue) % 360) + 360) % 360) / 360.0;
+    for (int i = 1; i < 3; i++) {
+        v = args->next();
+        if (v->unit != Value::Operator && v->iValue != ',')
+            return false;
+        v = args->next();
+        if (!validUnit(v, FPercent, true))
+            return false;
+        colorArray[i] = kMax(0.0, kMin(100.0, v->fValue)) / 100.0; // needs to be value between 0 and 1.0
+    }
+    if (parseAlpha) {
+        v = args->next();
+        if (v->unit != Value::Operator && v->iValue != ',')
+            return false;
+        v = args->next();
+        if (!validUnit(v, FNumber, true))
+            return false;
+        colorArray[3] = kMax(0.0, kMin(1.0, v->fValue));
+    }
+    return true;
+}
 
 static bool parseColor(int unit, const QString &name, QRgb& rgb)
 {
@@ -2015,65 +2079,41 @@
 		value->function->args != 0 &&
                 value->function->args->size() == 5 /* rgb + two commas */ &&
                 qString( value->function->name ).lower() == "rgb(" ) {
-        ValueList *args = value->function->args;
-        Value *v = args->current();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
+        int colorValues[3];
+        if (!parseColorParameters(value, colorValues, false))
             return 0;
-        int r = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        v = args->next();
-        if ( v->unit != Value::Operator && v->iValue != ',' )
+        colorValues[0] = kMax( 0, kMin( 255, colorValues[0] ) );
+        colorValues[1] = kMax( 0, kMin( 255, colorValues[1] ) );
+        colorValues[2] = kMax( 0, kMin( 255, colorValues[2] ) );
+        c = qRgb(colorValues[0], colorValues[1], colorValues[2]);
+    } else if (value->unit == Value::Function &&
+                value->function->args != 0 &&
+                value->function->args->size() == 7 /* rgba + three commas */ &&
+                domString(value->function->name).lower() == "rgba(") {
+        int colorValues[4];
+        if (!parseColorParameters(value, colorValues, true))
             return 0;
-        v = args->next();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
+        colorValues[0] = kMax( 0, kMin( 255, colorValues[0] ) );
+        colorValues[1] = kMax( 0, kMin( 255, colorValues[1] ) );
+        colorValues[2] = kMax( 0, kMin( 255, colorValues[2] ) );
+        c = qRgba(colorValues[0], colorValues[1], colorValues[2], colorValues[3]);
+    } else if (value->unit == Value::Function &&
+                value->function->args != 0 &&
+                value->function->args->size() == 5 /* hsl + two commas */ &&
+                domString(value->function->name).lower() == "hsl(") {
+        double colorValues[3];
+        if (!parseHSLParameters(value, colorValues, false))
             return 0;
-        int g = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        v = args->next();
-        if ( v->unit != Value::Operator && v->iValue != ',' )
+        c = khtml::qRgbaFromHsla(colorValues[0], colorValues[1], colorValues[2], 1.0);
+    } else if (value->unit == Value::Function &&
+                value->function->args != 0 &&
+                value->function->args->size() == 7 /* hsla + three commas */ &&
+                domString(value->function->name).lower() == "hsla(") {
+        double colorValues[4];
+        if (!parseHSLParameters(value, colorValues, true))
             return 0;
-        v = args->next();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
-            return 0;
-        int b = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        r = kMax( 0, kMin( 255, r ) );
-        g = kMax( 0, kMin( 255, g ) );
-        b = kMax( 0, kMin( 255, b ) );
-        c = qRgb( r, g, b );
+        c = khtml::qRgbaFromHsla(colorValues[0], colorValues[1], colorValues[2], colorValues[3]);
     }
-    else if ( value->unit == Value::Function &&
-              value->function->args != 0 &&
-              value->function->args->size() == 7 /* rgba + three commas */ &&
-              qString( value->function->name ).lower() == "rgba(" ) {
-        ValueList *args = value->function->args;
-        Value *v = args->current();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
-            return 0;
-        int r = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        v = args->next();
-        if ( v->unit != Value::Operator && v->iValue != ',' )
-            return 0;
-        v = args->next();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
-            return 0;
-        int g = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        v = args->next();
-        if ( v->unit != Value::Operator && v->iValue != ',' )
-            return 0;
-        v = args->next();
-        if ( !validUnit( v, FInteger|FPercent, true ) )
-            return 0;
-        int b = (int) ( v->fValue * (v->unit == CSSPrimitiveValue::CSS_PERCENTAGE ? 256./100. : 1.) );
-        v = args->next();
-        if ( v->unit != Value::Operator && v->iValue != ',' )
-            return 0;
-        v = args->next();
-        if ( !validUnit( v, FNumber, true ) )
-            return 0;
-        r = QMAX( 0, QMIN( 255, r ) );
-        g = QMAX( 0, QMIN( 255, g ) );
-        b = QMAX( 0, QMIN( 255, b ) );
-        int a = (int)(QMAX( 0, QMIN( 1.0f, v->fValue ) ) * 255);
-        c = qRgba( r, g, b, a );
-    }
     else
         return 0;
 
Index: khtml/css/cssstyleselector.h
===================================================================
--- khtml/css/cssstyleselector.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/cssstyleselector.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -28,6 +28,7 @@
 
 #include "rendering/render_style.h"
 #include "dom/dom_string.h"
+#include "xml/dom_restyler.h"
 
 class KHTMLSettings;
 class KHTMLView;
@@ -145,15 +146,15 @@
 
 	static void precomputeAttributeDependencies(DOM::DocumentImpl* doc, DOM::CSSSelector* sel);
     protected:
-
-	DOM::NodeImpl* checkSubSelectors(DOM::CSSSelector *sel, DOM::NodeImpl *n, bool isAncestor);
-
 	/* checks if the complete selector (which can be build up from a few CSSSelector's
 	    with given relationships matches the given Element */
 	void checkSelector(int selector, DOM::ElementImpl *e);
 	/* checks if the selector matches the given Element */
-	bool checkOneSelector(DOM::CSSSelector *selector, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector=false);
+	bool checkSimpleSelector(DOM::CSSSelector *selector, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector = false);
 
+       DOM::ElementImpl* checkSelector(DOM::CSSSelector *sel, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector = false);
+
+        void addDependency(StructuralDependencyType dependencyType, DOM::ElementImpl* dependency);
 #ifdef APPLE_CHANGES
 	/* This function fixes up the default font size if it detects that the
 	   current generic font family has changed. -dwh */
Index: khtml/css/quirks.css
===================================================================
--- khtml/css/quirks.css	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/quirks.css	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,6 +24,7 @@
     color: -khtml-text;
     font-size: medium;
     empty-cells: hide;
+    text-align: -khtml-auto;
 }
 
 LAYER {
Index: khtml/css/cssstyleselector.cpp
===================================================================
--- khtml/css/cssstyleselector.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/cssstyleselector.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -700,7 +700,7 @@
 
     // Table rows, sections and the table itself will support overflow:hidden and will ignore scroll/auto.
     // FIXME: Eventually table sections will support auto and scroll.
-    if (style->overflow() != OVISIBLE && style->overflow() != OHIDDEN && 
+    if (style->overflow() != OVISIBLE && style->overflow() != OHIDDEN &&
         (style->display() == TABLE || style->display() == INLINE_TABLE ||
          style->display() == TABLE_ROW_GROUP || style->display() == TABLE_ROW))
         style->setOverflow(OVISIBLE);
@@ -962,95 +962,74 @@
     precomputeAttributeDependenciesAux(doc, sel, false, true);
 }
 
-// Recursive check of combinators to support nondeterministic matching
-DOM::NodeImpl* CSSStyleSelector::checkSubSelectors(DOM::CSSSelector *sel, DOM::NodeImpl * n, bool isAncestor)
+// Recursive check of selectors and combinators
+DOM::ElementImpl* CSSStyleSelector::checkSelector(DOM::CSSSelector *sel, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector)
 {
-    if(!n->isElementNode()) return 0;
+    // The simple selector has to match
+    if(!checkSimpleSelector(sel, e, isAncestor, isSubSelector)) return 0;
 
+    // The rest of the selectors has to match
     CSSSelector::Relation relation = sel->relation;
+
+    // Prepare next sel
     sel = sel->tagHistory;
-    if (!sel) return n;
+    if (!sel) return e;
 
-    switch(relation)
-    {
-    case CSSSelector::Descendant:
-    {
-        ElementImpl *elem = 0;
-        while(true)
+    switch(relation) {
+        case CSSSelector::Descendant:
         {
-            n = n->parentNode();
-            if(!n || !n->isElementNode()) return 0;
-            elem = static_cast<ElementImpl *>(n);
-            // Found one matching element
-            if(checkOneSelector(sel, elem, true)) {
-                // Check the rest of the combinators
-                if (checkSubSelectors(sel, n, true)) {
-                    return n;
-                }
+            while(true)
+            {
+                DOM::NodeImpl* n = e->parentNode();
+                if(!n || !n->isElementNode()) return 0;
+                e = static_cast<ElementImpl *>(n);
+                if(checkSelector(sel, e, true)) return e;
             }
+            break;
         }
-        return 0;
-    }
-    case CSSSelector::Child:
-    {
-        n = n->parentNode();
-        if (!strictParsing)
-            while (n && n->implicitNode()) n = n->parentNode();
-        if(!n || !n->isElementNode()) return 0;
-        ElementImpl *elem = static_cast<ElementImpl *>(n);
-        if(!checkOneSelector(sel, elem, true)) return 0;
-        break;
-    }
-    case CSSSelector::IndirectAdjacent:
-    {
-        // Sibling selectors always generate structural dependencies
-        // because new inserted element might fullfill them.
-        if (n->parentNode()->isElementNode())
-            element->getDocument()->dynamicDomRestyler().addDependency(element,
-                        static_cast<ElementImpl*>(n->parentNode()),
-                        StructuralDependency);
-        ElementImpl *elem = 0;
-        while(true)
+        case CSSSelector::Child:
         {
-            n = n->previousSibling();
+            DOM::NodeImpl* n = e->parentNode();
+            if (!strictParsing)
+                while (n && n->implicitNode()) n = n->parentNode();
+            if(!n || !n->isElementNode()) return 0;
+            e = static_cast<ElementImpl *>(n);
+            if(checkSelector(sel, e, true)) return e;
+            break;
+        }
+        case CSSSelector::IndirectAdjacent:
+        {
+            // Sibling selectors always generate structural dependencies
+            // because newly inserted element might fullfill them.
+            if (e->parentNode()->isElementNode())
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
+            while(true)
+            {
+                DOM::NodeImpl* n = e->previousSibling();
+                while( n && !n->isElementNode() )
+                    n = n->previousSibling();
+                if( !n ) return 0;
+                e = static_cast<ElementImpl *>(n);
+                if(checkSelector(sel, e, false)) return e;
+            };
+            break;
+        }
+        case CSSSelector::DirectAdjacent:
+        {
+            if (e->parentNode()->isElementNode())
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
+            DOM::NodeImpl* n = e->previousSibling();
             while( n && !n->isElementNode() )
                 n = n->previousSibling();
             if( !n ) return 0;
-            elem = static_cast<ElementImpl *>(n);
-            if (checkOneSelector(sel, elem, false)) {
-                // Check the rest of the combinators
-                if (checkSubSelectors(sel, n, false)) {
-                    return n;
-                }
-            }
-        };
-        return 0;
+            e = static_cast<ElementImpl *>(n);
+            if(checkSelector(sel, e, false)) return e;
+            break;
+        }
+        case CSSSelector::SubSelector:
+            return checkSelector(sel, e, isAncestor, true);
     }
-    case CSSSelector::DirectAdjacent:
-    {
-        if (n->parentNode()->isElementNode())
-            element->getDocument()->dynamicDomRestyler().addDependency(element,
-                        static_cast<ElementImpl*>(n->parentNode()),
-                        StructuralDependency);
-        n = n->previousSibling();
-        while( n && !n->isElementNode() )
-            n = n->previousSibling();
-        if( !n ) return 0;
-        ElementImpl *elem = static_cast<ElementImpl *>(n);
-        if(!checkOneSelector(sel, elem, false)) return 0;
-        break;
-    }
-    case CSSSelector::SubSelector:
-    {
-        //kdDebug() << "CSSOrderedRule::checkSelector" << endl;
-        ElementImpl *elem = static_cast<ElementImpl *>(n);
-
-        if(!checkOneSelector(sel, elem, isAncestor, true)) return 0;
-        //kdDebug() << "CSSOrderedRule::checkSelector: passed" << endl;
-        break;
-    }
-    }
-    return checkSubSelectors(sel, n, isAncestor);
+    return 0;
 }
 
 void CSSStyleSelector::checkSelector(int selIndex, DOM::ElementImpl * e)
@@ -1062,12 +1041,9 @@
     selectorCache[ selIndex ].state = Invalid;
     CSSSelector *sel = selectors[ selIndex ];
 
-    // first selector has to match
-    if(!checkOneSelector(sel, e,  true)) return;
+    // Check the selector
+    if(!checkSelector(sel, e, true)) return;
 
-    // check the subselectors
-    if(!checkSubSelectors(sel, e, true)) return;
-
     if ( dynamicPseudo != RenderStyle::NOPSEUDO ) {
 	selectorCache[selIndex].state = AppliesPseudo;
 	selectors[ selIndex ]->pseudoId = dynamicPseudo;
@@ -1078,8 +1054,13 @@
     return;
 }
 
-bool CSSStyleSelector::checkOneSelector(DOM::CSSSelector *sel, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector)
+void CSSStyleSelector::addDependency(StructuralDependencyType dependencyType, ElementImpl* dependency)
 {
+    element->getDocument()->dynamicDomRestyler().addDependency(element, dependency, dependencyType);
+}
+
+bool CSSStyleSelector::checkSimpleSelector(DOM::CSSSelector *sel, DOM::ElementImpl *e, bool isAncestor, bool isSubSelector)
+{
     if(!e)
         return false;
 
@@ -1101,8 +1082,6 @@
         if (selNS != anyNamespace && ns != selNS) return false;
     }
 
-    DOM::DocumentImpl* doc = e->getDocument();
-
     if(sel->attr)
     {
         DOMStringImpl* value = e->getAttributeImpl(sel->attr);
@@ -1113,7 +1092,7 @@
         case CSSSelector::Exact:
             /* attribute values are case insensitive in all HTML modes,
                even in the strict ones */
-            if ( doc->htmlMode() != DocumentImpl::XHtml ) {
+            if ( e->getDocument()->htmlMode() != DocumentImpl::XHtml ) {
                 if ( strcasecmp(sel->value, value) )
                     return false;
             } else {
@@ -1211,7 +1190,7 @@
 	switch (sel->pseudoType()) {
         // Pseudo classes:
 	case CSSSelector::PseudoEmpty:
-            doc->dynamicDomRestyler().addDependency(element, e, BackwardsStructuralDependency);
+	    addDependency(BackwardsStructuralDependency, e);
             // If e is not closed yet we don't know the number of children
             if (!e->closed()) {
                 return false;
@@ -1234,9 +1213,7 @@
 	    // first-child matches the first child that is an element!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
                 // Handle dynamic DOM changes
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            StructuralDependency);
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 DOM::NodeImpl* n = e->previousSibling();
                 while ( n && !n->isElementNode() )
                     n = n->previousSibling();
@@ -1249,9 +1226,7 @@
             // last-child matches the last child that is an element!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
                 // Handle unfinished parsing and dynamic DOM changes
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
 //                     kdDebug(6080) << e->nodeName().string() << "::last-child: Parent unclosed" << endl;
                     return false;
@@ -1267,9 +1242,7 @@
         case CSSSelector::PseudoOnlyChild: {
             // If both first-child and last-child apply, then only-child applies.
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
                     return false;
                 }
@@ -1289,9 +1262,7 @@
         case CSSSelector::PseudoNthChild: {
 	    // nth-child matches every (a*n+b)th element!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            StructuralDependency);
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 int count = 1;
                 DOM::NodeImpl* n = e->previousSibling();
                 while ( n ) {
@@ -1306,9 +1277,7 @@
         }
         case CSSSelector::PseudoNthLastChild: {
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
                     return false;
                 }
@@ -1327,9 +1296,7 @@
 	case CSSSelector::PseudoFirstOfType: {
 	    // first-of-type matches the first element of its type!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            StructuralDependency);
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 const DOMString& type = e->tagName();
                 DOM::NodeImpl* n = e->previousSibling();
                 while ( n ) {
@@ -1345,9 +1312,7 @@
         case CSSSelector::PseudoLastOfType: {
             // last-child matches the last child that is an element!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
                     return false;
                 }
@@ -1366,9 +1331,7 @@
         case CSSSelector::PseudoOnlyOfType: {
             // If both first-of-type and last-of-type apply, then only-of-type applies.
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
                     return false;
                 }
@@ -1389,9 +1352,7 @@
         case CSSSelector::PseudoNthOfType: {
 	    // nth-of-type matches every (a*n+b)th element of this type!
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            StructuralDependency);
+                addDependency(StructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 int count = 1;
                 const DOMString& type = e->tagName();
                 DOM::NodeImpl* n = e->previousSibling();
@@ -1407,9 +1368,7 @@
         }
         case CSSSelector::PseudoNthLastOfType: {
             if (e->parentNode() && e->parentNode()->isElementNode()) {
-                doc->dynamicDomRestyler().addDependency(element,
-                            static_cast<ElementImpl*>(e->parentNode()),
-                            BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, static_cast<ElementImpl*>(e->parentNode()));
                 if (!e->parentNode()->closed()) {
                     return false;
                 }
@@ -1427,11 +1386,11 @@
             break;
         }
         case CSSSelector::PseudoTarget:
-            if (e == doc->getCSSTarget())
+            if (e == e->getDocument()->getCSSTarget())
                 return true;
             break;
         case CSSSelector::PseudoRoot:
-            if (e == doc->documentElement())
+            if (e == e->getDocument()->documentElement())
                 return true;
             break;
 	case CSSSelector::PseudoLink:
@@ -1455,10 +1414,9 @@
                 return checkPseudoState( encodedurl, e ) == PseudoVisited;
 	    break;
         case CSSSelector::PseudoHover: {
-	    // If we're in quirks mode, then *:active should only match focusable elements, and never
-	    // unfocusable anchors.
-	    if (strictParsing || ((sel->tag != anyQName || isSubSelector) && e->id() != ID_A) || e->isFocusable()) {
-                doc->dynamicDomRestyler().addDependency(element, e, HoverDependency);
+	    // If we're in quirks mode, then *:hover should only match focusable elements.
+	    if (strictParsing || (sel->tag != anyQName) || isSubSelector || e->isFocusable() ) {
+                addDependency(HoverDependency, e);
 
                 if (e->hovered())
                     return true;
@@ -1467,8 +1425,8 @@
         }
 	case CSSSelector::PseudoActive:
 	    // If we're in quirks mode, then *:active should only match focusable elements
-	    if (strictParsing || ((sel->tag != anyQName || isSubSelector) && e->id() != ID_A) || e->isFocusable()) {
-                doc->dynamicDomRestyler().addDependency(element, e, ActiveDependency);
+	    if (strictParsing || (sel->tag != anyQName) || isSubSelector || e->isFocusable()) {
+                addDependency(ActiveDependency, e);
 
 		if (e->active())
 		    return true;
@@ -1477,20 +1435,20 @@
 	case CSSSelector::PseudoFocus:
 	    if (e != element && e->isFocusable()) {
                 // *:focus is a default style, no need to track it.
-                doc->dynamicDomRestyler().addDependency(element, e, OtherStateDependency);
+                addDependency(OtherStateDependency, e);
             }
             if (e->focused()) return true;
             break;
         case CSSSelector::PseudoLang: {
             // Set dynamic attribute dependency
             if (e == element) {
-                doc->dynamicDomRestyler().addDependency(ATTR_LANG, PersonalDependency);
-                doc->dynamicDomRestyler().addDependency(ATTR_LANG, AncestorDependency);
+                e->getDocument()->dynamicDomRestyler().addDependency(ATTR_LANG, PersonalDependency);
+                e->getDocument()->dynamicDomRestyler().addDependency(ATTR_LANG, AncestorDependency);
             }
             else if (isAncestor)
-                doc->dynamicDomRestyler().addDependency(ATTR_LANG, AncestorDependency);
+                e->getDocument()->dynamicDomRestyler().addDependency(ATTR_LANG, AncestorDependency);
             else
-                doc->dynamicDomRestyler().addDependency(ATTR_LANG, PredecessorDependency);
+                e->getDocument()->dynamicDomRestyler().addDependency(ATTR_LANG, PredecessorDependency);
             // ### check xml:lang attribute in XML and XHTML documents
             DOMString value = e->getAttribute(ATTR_LANG);
             // The LANG attribute is inherited like a property
@@ -1524,14 +1482,14 @@
                 // but it is, so let's honor it.
                 if (subSel->simpleSelector)
                     break;
-                if (!checkOneSelector(subSel, e, isAncestor))
+                if (!checkSimpleSelector(subSel, e, isAncestor, true))
                     return true;
             }
             break;
         }
         case CSSSelector::PseudoEnabled: {
             if (e->isGenericFormElement()) {
-                doc->dynamicDomRestyler().addDependency(element, e, OtherStateDependency);
+                addDependency(OtherStateDependency, e);
                 HTMLGenericFormElementImpl *form;
                 form = static_cast<HTMLGenericFormElementImpl*>(e);
                 return !form->disabled();
@@ -1540,7 +1498,7 @@
         }
         case CSSSelector::PseudoDisabled: {
             if (e->isGenericFormElement()) {
-                doc->dynamicDomRestyler().addDependency(element, e, OtherStateDependency);
+                addDependency(OtherStateDependency, e);
                 HTMLGenericFormElementImpl *form;
                 form = static_cast<HTMLGenericFormElementImpl*>(e);
                 return form->disabled();
@@ -1549,7 +1507,7 @@
         }
         case CSSSelector::PseudoContains: {
             if (e->isHTMLElement()) {
-                doc->dynamicDomRestyler().addDependency(element, e, BackwardsStructuralDependency);
+                addDependency(BackwardsStructuralDependency, e);
                 if (!e->closed()) {
                    return false;
                 }
@@ -1564,7 +1522,7 @@
         }
 	case CSSSelector::PseudoChecked: {
            if (e->isHTMLElement() && e->id() == ID_INPUT) {
-               doc->dynamicDomRestyler().addDependency(element, e, OtherStateDependency);
+               addDependency(OtherStateDependency, e);
                return (static_cast<HTMLInputElementImpl*>(e)->checked());
            }
            return false;
Index: khtml/css/cssparser.h
===================================================================
--- khtml/css/cssparser.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/css/cssparser.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -137,6 +137,9 @@
 	bool parseFont(bool important);
         bool parseCounter(int propId, bool increment, bool important);
 
+        bool parseColorParameters(Value*, int* colorValues, bool parseAlpha);
+        bool parseHSLParameters(Value*, double* colorValues, bool parseAlpha);
+
         // returns the found property
         // 0 if nothing found (or ok == false)
         // @param forward if true, it parses the next in the list
Index: khtml/misc/helper.cpp
===================================================================
--- khtml/misc/helper.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/misc/helper.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -2,6 +2,7 @@
  * This file is part of the CSS implementation for KDE.
  *
  * Copyright (C) 1999-2003 Lars Knoll (knoll@kde.org)
+ *           (C) David Carson  <dacarson@gmail.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -45,6 +46,34 @@
 }
 
 
+double calcHue(double temp1, double temp2, double hueVal)
+{
+    if (hueVal < 0)
+        hueVal++;
+    else if (hueVal > 1)
+        hueVal--;
+    if (hueVal * 6 < 1)
+        return temp1 + (temp2 - temp1) * hueVal * 6;
+    if (hueVal * 2 < 1)
+        return temp2;
+    if (hueVal * 3 < 2)
+        return temp1 + (temp2 - temp1) * (2.0 / 3.0 - hueVal) * 6;
+    return temp1;
+}
+
+// Explanation of this algorithm can be found in the CSS3 Color Module
+// specification at http://www.w3.org/TR/css3-color/#hsl-color with further
+// explanation available at http://en.wikipedia.org/wiki/HSL_color_space
+
+// all values are in the range of 0 to 1.0
+QRgb khtml::qRgbaFromHsla(double h, double s, double l, double a)
+{
+    double temp2 = l < 0.5 ? l * (1.0 + s) : l + s - l * s;
+    double temp1 = 2.0 * l - temp2;
+
+    return qRgba(calcHue(temp1, temp2, h + 1.0 / 3.0) * 255, calcHue(temp1, temp2, h) * 255, calcHue(temp1, temp2, h - 1.0 / 3.0) * 255, a * 255);
+}
+
 /** finds out the background color of an element
  * @param obj render object
  * @return the background color. It is guaranteed that a valid color is returned.
Index: khtml/misc/loader.cpp
===================================================================
--- khtml/misc/loader.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/misc/loader.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -527,6 +527,13 @@
 const QPixmap &CachedImage::tiled_pixmap(const QColor& newc, int xWidth, int xHeight)
 {
     static QRgb bgTransparent = qRgba( 0, 0, 0, 0xFF );
+
+    QSize s(pixmap_size());
+    int w = xWidth;
+    int h = xHeight;
+    if (w == -1) xWidth = w = s.width();
+    if (h == -1) xHeight = h = s.height();
+
     if ( ( (bgColor != bgTransparent) && (bgColor != newc.rgb()) ) ||
          ( bgSize != QSize(xWidth, xHeight)) )
     {
@@ -544,23 +551,18 @@
     if(m_hadError||m_wasBlocked) return *Cache::nullPixmap;
 
     bool isvalid = newc.isValid();
-    QSize s(pixmap_size());
-    int w = xWidth;
-    int h = xHeight;
-    if (w == -1) xWidth = w = s.width();
-    if (h == -1) xHeight = h = s.height();
 
     const QPixmap* src; //source for pretiling, if any
 
     //See whether we should scale
     if (xWidth != s.width() || xHeight != s.height()) {
         src = &scaled_pixmap(xWidth, xHeight);
-        bgSize = QSize(xWidth, xHeight);
     } else {
         src = &r;
-        bgSize = QSize(-1,-1);
     }
 
+    bgSize = QSize(xWidth, xHeight);
+
     //See whether we can - and should - pre-blend
     if (isvalid && (r.hasAlphaChannel() || r.mask() )) {
         bg = new QPixmap(xWidth, xHeight, r.depth());
Index: khtml/misc/helper.h
===================================================================
--- khtml/misc/helper.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/misc/helper.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -40,6 +40,7 @@
     
     bool hasSufficientContrast(const QColor &c1, const QColor &c2);
     QColor retrieveBackgroundColor(const RenderObject *obj);
+    QRgb qRgbaFromHsla(double h, double s, double l, double a);
 
     //enumerator for findSelectionNode
     enum FindSelectionResult { SelectionPointBefore,
Index: khtml/test_regression.cpp
===================================================================
--- khtml/test_regression.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/test_regression.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -422,6 +422,13 @@
     KCmdLineLastOption
 };
 
+static bool existsDir(QCString dir)
+{
+    struct stat st;
+
+    return (!stat(dir.data(), &st) && S_ISDIR(st.st_mode));
+}
+
 int main(int argc, char *argv[])
 {
     // forget about any settings
@@ -476,14 +483,26 @@
         }
         
         QCString xvfbPath8 = QFile::encodeName(xvfbPath);
+        QStringList fpaths;
+        fpaths.append(baseDir+"/resources");
 
+        const char* const fontdirs[] = { "75dpi", "misc", "Type1" };
+        const char* const fontpaths[] =  {"/usr/share/fonts/", "/usr/X11/lib/X11/fonts/",
+            "/usr/lib/X11/fonts" };
+
+        for (size_t fp=0; fp < sizeof(fontpaths)/sizeof(*fontpaths); ++fp)
+            for (size_t fd=0; fd < sizeof(fontdirs)/sizeof(*fontdirs); ++fd)
+                if (existsDir(QCString(fontpaths[fp])+QCString(fontdirs[fd])))
+                    if (strcmp(fontdirs[fd] , "Type1"))
+                        fpaths.append(QCString(fontpaths[fp])+QCString(fontdirs[fd])+":unscaled");
+                    else
+                        fpaths.append(QCString(fontpaths[fp])+QCString(fontdirs[fd]));
+
         xvfb = fork();
         if ( !xvfb ) {
-            char buffer[2000];
-            sprintf( buffer, "%s/resources,/usr/X11R6/lib/X11/fonts/75dpi:unscaled,/usr/X11R6/lib/X11/fonts/misc:unscaled,/usr/X11R6/lib/X11/fonts/Type1,/usr/share/fonts/X11/misc,/usr/share/fonts/X11/75dpi:unscaled,/usr/share/fonts/X11/Type1,"
-            "/usr/lib/X11/fonts/75dpi:unscaled,/usr/lib/X11/fonts/misc:unscaled,/usr/lib/X11/fonts/Type1",
-             (const char *)baseDir );
-            execl( xvfbPath8.data(), xvfbPath8.data(), "-once", "-dpi", "100", "-screen", "0", "1024x768x16", "-ac", "-fp", buffer, ":47", (char*)NULL );
+            QCString buffer = fpaths.join(",").latin1();
+            execl( xvfbPath8.data(), xvfbPath8.data(), "-once", "-dpi", "100", "-screen", "0",
+                    "1024x768x16", "-ac", "-fp", buffer.data(), ":47", (char*)NULL );
         }
 
         setenv( "DISPLAY", ":47", 1 );
Index: khtml/xml/dom_nodeimpl.cpp
===================================================================
--- khtml/xml/dom_nodeimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/xml/dom_nodeimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -137,16 +137,14 @@
     return 0;
 }
 
-NodeImpl *NodeImpl::replaceChild( NodeImpl *, NodeImpl *, int &exceptioncode )
+void NodeImpl::replaceChild( NodeImpl *, NodeImpl *, int &exceptioncode )
 {
   exceptioncode = DOMException::HIERARCHY_REQUEST_ERR;
-  return 0;
 }
 
-NodeImpl *NodeImpl::removeChild( NodeImpl *, int &exceptioncode )
+void NodeImpl::removeChild( NodeImpl *, int &exceptioncode )
 {
   exceptioncode = DOMException::NOT_FOUND_ERR;
-  return 0;
 }
 
 NodeImpl *NodeImpl::appendChild( NodeImpl *, int &exceptioncode )
@@ -1052,6 +1050,10 @@
 
         // If child is already present in the tree, first remove it
         NodeImpl *newParent = child->parentNode();
+
+        //...guard it in case we need to move it..
+        SharedPtr<NodeImpl> guard(child);
+
         if(newParent)
             newParent->removeChild( child, exceptioncode );
         if ( exceptioncode )
@@ -1086,22 +1088,22 @@
     return newChild;
 }
 
-NodeImpl *NodeBaseImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
+void NodeBaseImpl::replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode )
 {
     exceptioncode = 0;
 
     if ( oldChild == newChild ) // nothing to do
-	return oldChild;
+	return;
 
     // Make sure adding the new child is ok
     checkAddChild(newChild, exceptioncode);
     if (exceptioncode)
-        return 0;
+        return;
 
     // NOT_FOUND_ERR: Raised if oldChild is not a child of this node.
     if (!oldChild || oldChild->parentNode() != this) {
         exceptioncode = DOMException::NOT_FOUND_ERR;
-        return 0;
+        return;
     }
 
     bool isFragment = newChild->nodeType() == Node::DOCUMENT_FRAGMENT_NODE;
@@ -1115,7 +1117,7 @@
 
     removeChild(oldChild, exceptioncode);
     if (exceptioncode)
-        return 0;
+        return;
 
     // Add the new child(ren)
     while (child) {
@@ -1127,10 +1129,12 @@
 	    next = child->nextSibling();
 	if ( child == prev )
 	    prev = child->previousSibling();
+        //...guard it in case we need to move it..
+        SharedPtr<NodeImpl> guard(child);
         if(newParent)
             newParent->removeChild( child, exceptioncode );
         if (exceptioncode)
-            return 0;
+            return;
 
         // Add child in the correct position
         if (prev) prev->setNextSibling(child);
@@ -1157,29 +1161,31 @@
 
     // ### set style in case it's attached
     dispatchSubtreeModifiedEvent();
-    return oldChild;
+    return;
 }
 
-NodeImpl *NodeBaseImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
+void NodeBaseImpl::removeChild ( NodeImpl *oldChild, int &exceptioncode )
 {
     exceptioncode = 0;
 
     // NO_MODIFICATION_ALLOWED_ERR: Raised if this node is readonly.
     if (isReadOnly()) {
         exceptioncode = DOMException::NO_MODIFICATION_ALLOWED_ERR;
-        return 0;
+        return;
     }
 
     // NOT_FOUND_ERR: Raised if oldChild is not a child of this node.
     if (!oldChild || oldChild->parentNode() != this) {
         exceptioncode = DOMException::NOT_FOUND_ERR;
-        return 0;
+        return;
     }
 
     dispatchChildRemovalEvents(oldChild,exceptioncode);
     if (exceptioncode)
-        return 0;
+        return;
 
+    SharedPtr<NodeImpl> memManage(oldChild); //Make sure to free if needed
+
     // Remove from rendering tree
     if (oldChild->attached())
         oldChild->detach();
@@ -1210,8 +1216,6 @@
 	for (NodeImpl *c = oldChild; c; c = c->traverseNextNode(oldChild))
 	    c->removedFromDocument();
     }
-
-    return oldChild;
 }
 
 void NodeBaseImpl::removeChildren()
@@ -1266,6 +1270,7 @@
 
         // If child is already present in the tree, first remove it
         NodeImpl *oldParent = child->parentNode();
+        SharedPtr<NodeImpl> guard(child); //Guard in case we move it
         if(oldParent) {
             oldParent->removeChild( child, exceptioncode );
             if (exceptioncode)
Index: khtml/xml/dom2_traversalimpl.cpp
===================================================================
--- khtml/xml/dom2_traversalimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/xml/dom2_traversalimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -113,22 +113,22 @@
   if( n->hasChildNodes() )
     return n->firstChild();
 
-  if( n->nextSibling() )
-    return n->nextSibling();
-
   if( m_root == n)
      return 0;
 
+  if( n->nextSibling() )
+    return n->nextSibling();
+
   NodeImpl *parent = n->parentNode();
   while( parent )
     {
+      if( m_root == parent )
+           return 0;
+
       n = parent->nextSibling();
       if( n )
         return n;
 
-      if( m_root == parent )
-        return 0;
-
       parent = parent->parentNode();
     }
   return 0;
@@ -171,7 +171,7 @@
  */
   NodeImpl *_tempCurrent;
 
-  if( !n )
+  if( !n || m_root == n )
     return 0;
 
   _tempCurrent = n->previousSibling();
@@ -187,13 +187,8 @@
         return _tempCurrent;
     }
 
-
-  if(n == m_root)
-    return 0;
-
   return n->parentNode();
 
-
 }
 
 void NodeIteratorImpl::detach(int &/*exceptioncode*/)
Index: khtml/xml/dom_elementimpl.cpp
===================================================================
--- khtml/xml/dom_elementimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/xml/dom_elementimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -175,8 +175,10 @@
     m_value = v.implementation();
     m_value->ref();
 
-    if (m_element)
+    if (m_element) {
         m_element->parseAttribute(m_attrId,m_value);
+        m_element->attributeChanged(m_attrId);
+    }
 }
 
 void AttrImpl::setNodeValue( const DOMString &v, int &exceptioncode )
@@ -263,8 +265,10 @@
 	m_data.value = value;
 	m_data.value->ref();
 
-	if (element)
+	if (element) {
 	    element->parseAttribute(this);
+	    element->attributeChanged(m_attrId);
+        }
     }
     else {
 	int exceptioncode = 0;
@@ -362,7 +366,6 @@
         return;
     }
     attributes()->setValue(id, value.implementation(), (qName.isEmpty() ? 0: qName.implementation()));
-    attributeChanged(id);
 }
 
 void ElementImpl::setAttributeNS( const DOMString &namespaceURI, const DOMString &qualifiedName,
@@ -384,14 +387,12 @@
                             prefix.implementation(), localName.implementation(), false, true /*lookupHTML*/);
     attributes()->setValue(id, value.implementation(), 0, prefix.implementation(),
                            true /*nsAware*/, !namespaceURI.isNull() /*hasNS*/);
-    attributeChanged(id);
 }
 
 void ElementImpl::setAttribute(NodeImpl::Id id, const DOMString &value)
 {
     int exceptioncode = 0;
     setAttribute(id,value,DOMString(),exceptioncode);
-    attributeChanged(id);
 }
 
 void ElementImpl::setAttributeMap( NamedAttrMapImpl* list )
@@ -417,8 +418,10 @@
         assert(namedAttrMap->m_element == 0);
         namedAttrMap->setElement(this);
         unsigned long len = namedAttrMap->length();
-        for (unsigned long i = 0; i < len; i++)
+        for (unsigned long i = 0; i < len; i++) {
             parseAttribute(&namedAttrMap->m_attrs[i]);
+            attributeChanged(namedAttrMap->m_attrs[i].id());
+        }
     }
 }
 
@@ -994,6 +997,7 @@
 	    m_attrCount--;
 	    m_attrs = (AttributeImpl*)realloc(m_attrs,m_attrCount*sizeof(AttributeImpl));
 	    m_element->parseAttribute(id,0);
+	    m_element->attributeChanged(id);
 	    return removed;
 	}
     }
@@ -1062,6 +1066,7 @@
 	    m_attrs[i].m_data.attr->ref();
 	    attr->setElement(m_element);
 	    m_element->parseAttribute(&m_attrs[i]);
+	    m_element->attributeChanged(m_attrs[i].id());
 	    // ### dispatch mutation events
 	    return replaced;
 	}
@@ -1077,6 +1082,7 @@
     if (id == ATTR_ID)
         m_element->updateId(0, attr->val());
     m_element->parseAttribute(&m_attrs[m_attrCount-1]);
+    m_element->attributeChanged(m_attrs[m_attrCount-1].id());
     // ### dispatch mutation events
 
     return 0;
@@ -1184,6 +1190,7 @@
 	if (id == ATTR_ID)
 	    m_element->updateId(0, value);
 	m_element->parseAttribute(&m_attrs[m_attrCount-1]);
+	m_element->attributeChanged(m_attrs[m_attrCount-1].id());
     }
     // ### dispatch mutation events
 }
@@ -1201,6 +1208,7 @@
 	    m_attrCount--;
 	    m_attrs = (AttributeImpl*)realloc(m_attrs,m_attrCount*sizeof(AttributeImpl));
 	    m_element->parseAttribute(id,0);
+	    m_element->attributeChanged(id);
 	    // ### dispatch mutation events
 	    return removed;
 	}
@@ -1244,6 +1252,7 @@
 	if (m_attrs[i].id() == ATTR_ID)
 	   m_element->updateId(0, m_attrs[i].val());
 	m_element->parseAttribute(&m_attrs[i]);
+	m_element->attributeChanged(m_attrs[i].id());
     }
 }
 
Index: khtml/xml/dom_nodeimpl.h
===================================================================
--- khtml/xml/dom_nodeimpl.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ khtml/xml/dom_nodeimpl.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -131,8 +131,10 @@
     // insertBefore, replaceChild and appendChild also close newChild
     // unlike the speed optimized addChild (which is used by the parser)
     virtual NodeImpl *insertBefore ( NodeImpl *newChild, NodeImpl *refChild, int &exceptioncode );
-    virtual NodeImpl *replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
-    virtual NodeImpl *removeChild ( NodeImpl *oldChild, int &exceptioncode );
+    
+    /* These two methods may delete the old node, so make sure to reference it if you need it */
+    virtual void replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
+    virtual void removeChild ( NodeImpl *oldChild, int &exceptioncode );
     virtual NodeImpl *appendChild ( NodeImpl *newChild, int &exceptioncode );
     virtual bool hasChildNodes (  ) const;
     virtual NodeImpl *cloneNode ( bool deep ) = 0;
@@ -489,8 +491,8 @@
     virtual NodeImpl *firstChild() const;
     virtual NodeImpl *lastChild() const;
     virtual NodeImpl *insertBefore ( NodeImpl *newChild, NodeImpl *refChild, int &exceptioncode );
-    virtual NodeImpl *replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
-    virtual NodeImpl *removeChild ( NodeImpl *oldChild, int &exceptioncode );
+    virtual void replaceChild ( NodeImpl *newChild, NodeImpl *oldChild, int &exceptioncode );
+    virtual void removeChild ( NodeImpl *oldChild, int &exceptioncode );
     virtual NodeImpl *appendChild ( NodeImpl *newChild, int &exceptioncode );
     virtual bool hasChildNodes (  ) const;
 
Index: kresources/kresources_manager.desktop
===================================================================
--- kresources/kresources_manager.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kresources/kresources_manager.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,6 +16,7 @@
 Comment[es]=Administrador de KResource
 Comment[et]=KResource'i haldur
 Comment[eu]=KResource kudeatzailea
+Comment[fa]=مدیر KResource 
 Comment[fi]=KResource hallinta
 Comment[fr]=Gestionnaire de KResource
 Comment[fy]=KResource-behearder 
Index: kresources/kresources.desktop
===================================================================
--- kresources/kresources.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kresources/kresources.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -24,6 +24,7 @@
 Name[es]=Recursos de KDE
 Name[et]=KDE ressursid
 Name[eu]=KDEren baliabideak
+Name[fa]=منابع KDE
 Name[fi]=KDE:n resurssiasetukset
 Name[fr]=Ressources de KDE
 Name[fy]=KDE Helpboarnen
@@ -84,6 +85,7 @@
 Comment[es]=Configurar recursos de KDE
 Comment[et]=KDE ressurside seadistamine
 Comment[eu]=Konfiguratu KDEren baliabideak
+Comment[fa]=پیکربندی منابع KDE
 Comment[fi]=Muokkaa KDE:n resursseja
 Comment[fr]=Configure les ressources de KDE
 Comment[fy]=KDE helpboarne Ynstelle
@@ -143,6 +145,7 @@
 Keywords[es]=recursos, recurso konnector, recurso de contacto, recurso de calendario, recurso de notas, konnector, contacto, calendario, notas, imap
 Keywords[et]=ressursid,konnectori ressurss,kontakti ressurss,kalendri ressurss,sedelite ressurss,imap
 Keywords[eu]=baliabideak,konnector baliabidea,contact baliabidea,egutegi baliabidea,oharren baliabidea,imap
+Keywords[fa]=منابع،منبع konnector،منبع تماس،منبع تقویم،منبع یادداشتها،imap
 Keywords[fi]=resurssit,konnektor-resurssi,yhteystietojen resurssi,muistiinpanojen resurssi,imap
 Keywords[fr]=resources,konnector,contact,calendrier,notes,imap,agenda,rendez-vous
 Keywords[fy]=helpboarne,ferbinings-helpboarne,kontakt-helpboarne,kalinder-helpboarne,notysje-helpboarne,imap,kontakt,kalinder,notysje,ferbining
Index: kresources/kresources_plugin.desktop
===================================================================
--- kresources/kresources_plugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kresources/kresources_plugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Plugin del entorno de KResource
 Comment[et]=KResource'i raamistiku plugin
 Comment[eu]=KResource sistemako plugin-a
-Comment[fa]=متصل کننده‌ی قالب‌گار برای KResource
+Comment[fa]=وصلۀ چارچوب KResource
 Comment[fi]=KResource Framework -lisäosa
 Comment[fr]=Module externe du cadre de KResource
 Comment[gl]=Plugin do entorno de KResource
@@ -37,7 +37,7 @@
 Comment[mk]=KResource рамковен приклучок
 Comment[mn]=Нөөц Тодорхойлох-Файлын плугин (RDF)
 Comment[ms]=Plug masuk Kerangka KResource
-Comment[nb]=KRessursrammeverk tilleggsprogram
+Comment[nb]=KRessursrammeverk programtillegg
 Comment[nds]=Plugin för dat KResource-Rahmenwark
 Comment[nl]=KResource Framework-plugin
 Comment[nn]=Programtillegg for KResource-rammeverket
Index: kjs/lexer.cpp
===================================================================
--- kjs/lexer.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kjs/lexer.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -39,6 +39,7 @@
 #include "identifier.h"
 #include "lookup.h"
 #include "internal.h"
+#include "dtoa.h"
 
 // we can't specify the namespace in yacc's C output, so do it here
 using namespace KJS;
@@ -453,7 +454,7 @@
 
   long double dval = 0;
   if (state == Number) {
-    dval = strtod(buffer8, 0L);
+    dval = kjs_strtod(buffer8, 0L);
   } else if (state == Hex) { // scan hex numbers
     dval = 0;
     if (buffer8[0] == '0' && (buffer8[1] == 'x' || buffer8[1] == 'X')) {
Index: kjs/date_object.cpp
===================================================================
--- kjs/date_object.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kjs/date_object.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -417,6 +417,14 @@
     case GetSeconds:
     case GetMilliSeconds:
     case GetTimezoneOffset:
+    case SetTime:
+    case SetMilliSeconds:
+    case SetSeconds:
+    case SetMinutes:
+    case SetHours:
+    case SetDate:
+    case SetMonth:
+    case SetFullYear:
       return Number(NaN);
     }
   }
Index: pics/hicolor/index.theme
===================================================================
--- pics/hicolor/index.theme	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ pics/hicolor/index.theme	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -8,7 +8,7 @@
 Name[el]=KDE-Πολλά χρώματα
 Name[eo]=KDE-multkolora
 Name[es]=Color de alta profundidad de KDE
-Name[fa]=رنگ‌بالای KDE
+Name[fa]=چهرۀ گلگون KDE
 Name[fi]=KDE-monivärinen
 Name[fy]=KDE Hege Kleuren
 Name[he]=KDE ברמת צבע גבוהה
@@ -64,6 +64,7 @@
 Comment[es]=Tema de iconos de respaldo
 Comment[et]=Vaikimisi ikooniteema
 Comment[eu]=Fallback ikono-gaia
+Comment[fa]=چهرۀ شمایل اصلاح حالت عمل
 Comment[fi]=Varmistuskuvaketeema
 Comment[fr]=Revenir au thème d'icônes
 Comment[fy]=Standert Ikoan tema
Index: pics/crystalsvg/index.theme
===================================================================
--- pics/crystalsvg/index.theme	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ pics/crystalsvg/index.theme	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -4,6 +4,7 @@
 Name[bn]=কৃস্টাল এস-ভি-জি
 Name[br]=Strink SVG
 Name[es]=SVG estilo Crystal
+Name[fa]=بلور SVG
 Name[hi]=क्रिस्टल एसवीजी
 Name[ja]=クリスタル SVG
 Name[lb]=Crystal-SVG
@@ -34,6 +35,7 @@
 Comment[es]=Tema de iconoss de Everaldo.com Design Studio
 Comment[et]=Disainistuudio Everaldo.com ikooniteema
 Comment[eu]=Everaldoren ikono-gaia (www.everaldo.com)
+Comment[fa]=چهرۀ شمایل توسط استادیو طرح Everaldo.com
 Comment[fi]=Everaldo.com-suunnittelutoimiston tekemä kuvaketeema
 Comment[fr]=Thème d'icônes par Everaldo.com Design Studio
 Comment[fy]=ikoan tema makke troch Everaldo.com Design Studio
Index: kdoctools/customization/fr/user.entities
===================================================================
--- kdoctools/customization/fr/user.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/fr/user.entities	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,6 +20,8 @@
 <!ENTITY traducteurAdrienBoillot        '<othercredit role="translator"><firstname>Adrien</firstname><surname>Boillot</surname><affiliation><address><email>bec.bunsen@laposte.net</email></address> </affiliation><contrib>Traduction française</contrib></othercredit>'>
 <!ENTITY relecteurAdrienBoillot         '<othercredit role="reviewer"><firstname>Adrien</firstname><surname>Boillot</surname><affiliation><address><email>bec.bunsen@laposte.net</email></address> </affiliation><contrib>Relecture de la documentation française</contrib></othercredit>'>
 
+<!ENTITY traducteurDanielBourrion        '<othercredit role="translator"><firstname>Daniel</firstname><surname>Bourrion</surname><affiliation><address><email>daniel.bourrion@free.fr</email></address> </affiliation><contrib>Traduction française</contrib></othercredit>'>
+<!ENTITY relecteurDanielBourrion         '<othercredit role="reviewer"><firstname>Daniel</firstname><surname>Bourrion</surname><affiliation><address><email>daniel.bourrion@free.fr</email></address> </affiliation><contrib>Relecture de la documentation française</contrib></othercredit>'>
 
 <!ENTITY traducteurYvesBrenner        '<othercredit role="translator"><firstname>Yves</firstname><surname>Brenner</surname><affiliation><address><email>ybrenner@chez.com</email></address> </affiliation><contrib>Traduction française</contrib></othercredit>'>
 <!ENTITY relecteurYvesBrenner         '<othercredit role="reviewer"><firstname>Yves</firstname><surname>Brenner</surname><affiliation><address><email>ybrenner@chez.com</email></address> </affiliation><contrib>Relecture de la documentation française</contrib></othercredit>'>
@@ -196,6 +198,7 @@
 <!ENTITY JeromeBlanc       'Jérôme Blanc <email>01246774@brookes.ac.uk</email>'>
 <!ENTITY YvesBrenner       'Yves Brenner <email>ybrenner@chez.com</email>'>
 <!ENTITY AdrienBoillot     'Adrien Boillot <email>bec.bunsen@laposte.net</email>'>
+<!ENTITY DanielBourrion    'DanielBourrion <email>daniel.bourrion@free.fr</email>'>
 <!ENTITY DanielCartron     'Daniel Cartron <email>d.cartron@senat.fr</email>'>
 <!ENTITY GillesCaulier     'Gilles Caulier <email>caulier.gilles@free.fr</email>'>
 <!ENTITY PatrickChavas     'Patrick Chavas <email>pachavas@sun.cpe.fr</email>'>
Index: kdoctools/customization/pt/user.entities
===================================================================
--- kdoctools/customization/pt/user.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/pt/user.entities	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -40,3 +40,4 @@
 <!ENTITY kinfocenter "<application>Centro de Informação do KDE</application>" >
 <!ENTITY ksystemlog "<application>KSystemLog</application>" >
 <!ENTITY kleopatra "<application>Kleopatra</application>" >
+<!ENTITY qt "<trademark>Qt</trademark>" >
Index: kdoctools/customization/entities/contributor.entities
===================================================================
--- kdoctools/customization/entities/contributor.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/entities/contributor.entities	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -443,3 +443,5 @@
 <!ENTITY Alex.Zepeda.mail '<email>zipzippy@sonic.net</email>'>
 <!ENTITY Nikolas.Zimmermann '<personname><firstname>Nikolas</firstname><surname>Zimmermann</surname></personname>'>
 <!ENTITY Nikolas.Zimmermann.mail '<email>wildfox@kde.org</email>'>
+<!ENTITY Danny.Allen '<personname><firstname>Danny</firstname><surname>Allen</surname></personname>'>
+<!ENTITY Danny.Allen.mail '<email>danny@dannyallen.co.uk</email>'>
Index: kdoctools/customization/zh-TW/user.entities
===================================================================
--- kdoctools/customization/zh-TW/user.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/user.entities	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -6,3 +6,33 @@
      names (which if they occur will cost you a _lot_ of time)
  -->
 
+<!ENTITY Alt	"<keycap>Alt</keycap>">
+<!ENTITY Backspace	"<keycap>Backspace</keycap>">
+<!ENTITY cdrom	'<hardware>光碟機</hardware>'>
+<!ENTITY Ctrl	"<keycap>Ctrl</keycap>">
+<!ENTITY dpi	'<acronym>dpi</acronym>'>
+<!ENTITY eg     "例如，">
+<!ENTITY Enter	"<keycap>Enter</keycap>">
+<!ENTITY Esc	"<keycap>Esc</keycap>">
+<!ENTITY etc    "... 等等。">
+<!ENTITY FAQ	'<acronym>FAQ</acronym>'>
+<!ENTITY ie     "也就是說，">
+<!ENTITY infocenter	"<application>KDE 資訊中心</application>">
+<!ENTITY kcontrolcenter	"<application>KDE 控制中心</application>">
+<!ENTITY khelpcenter "<application>KDE 輔助中心</application>">
+<!ENTITY kicon	"<guiicon>
+<inlinemediaobject>
+ <objectinfo><title>KDE 的 K 圖示</title></objectinfo>
+ <imageobject><imagedata fileref='common/kmenu.png' format='PNG'/></imageobject>
+ <textobject><phrase>K</phrase></textobject>
+</inlinemediaobject>
+</guiicon> 圖示"><!-- if image is localised, then entityref should be used 
+                      instead of fileref -->
+<!ENTITY kmenu  "<guimenu>K</guimenu> 選單">
+<!ENTITY LMB    "滑鼠<mousebutton>左鍵</mousebutton>">
+<!ENTITY MMB    "滑鼠<mousebutton>中鍵</mousebutton>">
+<!ENTITY OS	"作業系統"><!-- <acronym>OS</acronym>-->
+<!ENTITY RMB    "滑鼠<mousebutton>右鍵</mousebutton>">
+<!ENTITY Shift	"<keycap>Shift</keycap>">
+<!ENTITY systemtray "<application>系統匣</application>">
+<!ENTITY Tab	"<keycap>Tab</keycap>">
Index: kdoctools/customization/zh-TW/entities/underGPL.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underGPL.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/entities/underGPL.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,3 +1,3 @@
 <para>
-{v覡ĥ <ulink url="common/gpl-translated.html">GNU qΤ@\i</ulink>C
+本程式的授權方式採用 <ulink url="common/gpl-translated.html">GNU 通用公共許可證</ulink>。
 </para>
Index: kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,2 +1,2 @@
-<para>{v覡ĥ <ulink
-url="common/artistic-license.html">Artistic \i(Artistic License)</ulink>C</para>
+<para>本程式的授權方式採用 <ulink
+url="common/artistic-license.html">Artistic 許可證(Artistic License)</ulink>。</para>
Index: kdoctools/customization/zh-TW/entities/underFDL.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underFDL.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/entities/underFDL.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1 +1 @@
-<para id="gnu-fdl" xreflabel="the section entitled &quot;GNU Free Documentation License&quot;">󪺱v覡ĥ <ulink url="common/fdl-translated.html">GNU ۥѤ\i</ulink>C</para>
+<para id="gnu-fdl" xreflabel="the section entitled &quot;GNU Free Documentation License&quot;">本文件的授權方式採用 <ulink url="common/fdl-translated.html">GNU 自由文件許可證</ulink>。</para>
Index: kdoctools/customization/zh-TW/entities/underBSDLicense.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underBSDLicense.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/entities/underBSDLicense.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,2 +1,2 @@
-<para>{v覡ĥ <ulink
-url="common/bsd-license.html">BSD \i(BSD License)</ulink>C</para>
+<para>本程式的授權方式採用 <ulink
+url="common/bsd-license.html">BSD 許可證(BSD License)</ulink>。</para>
Index: kdoctools/customization/zh-TW/entities/underX11License.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underX11License.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdoctools/customization/zh-TW/entities/underX11License.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -1,2 +1,2 @@
-<para>{v覡ĥ <ulink
-url="common/x11-license.html">X11 \i(X11 License)</ulink>C</para>
+<para>本程式的授權方式採用 <ulink
+url="common/x11-license.html">X11 許可證(X11 License)</ulink>。</para>
Index: kparts/krop.desktop
===================================================================
--- kparts/krop.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/krop.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Componente de KDE
 Comment[et]=KDE komponent
 Comment[eu]=KDEren osagaia
-Comment[fa]=بخش KDE
+Comment[fa]=مولفۀ KDE
 Comment[fi]=KDE-komponentti
 Comment[fr]=Composant de KDE
 Comment[fy]=KDE-komponint
Index: kparts/krwp.desktop
===================================================================
--- kparts/krwp.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/krwp.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Componente de KDE
 Comment[et]=KDE komponent
 Comment[eu]=KDEren osagaia
-Comment[fa]=بخش KDE
+Comment[fa]=مولفۀ KDE
 Comment[fi]=KDE-komponentti
 Comment[fr]=Composant de KDE
 Comment[fy]=KDE-komponint
Index: kparts/browserrun.h
===================================================================
--- kparts/browserrun.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/browserrun.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -63,9 +63,10 @@
          * @param part the part going to open this URL - can be 0L if not created yet
          * @param window the mainwindow - passed to KIO::Job::setWindow()
          * @param removeReferrer if true, the "referrer" metadata from @p args isn't passed on
-         * @param trustedSource if false, a warning will be shown before launching an executable
+         * @param trustedSource if false, a warning will be shown before launching an executable.
+         * Always pass false for @p  trustedSource, except for local directory views.
          * @param hideErrorDialog if true, no dialog will be shown in case of errors.
-         * Always pass false for @p trustedSource, except for local directory views.
+         * 
          */
         BrowserRun( const KURL& url, const KParts::URLArgs& args,
                     KParts::ReadOnlyPart *part, QWidget *window,
Index: kparts/tests/notepad.desktop
===================================================================
--- kparts/tests/notepad.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/tests/notepad.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Name[es]=Bloc de notas (ejemplo)
 Name[et]=Notepad (näidis)
 Name[eu]=Notepad (adibidea)
-Name[fa]=دفتر یادداشت (مثال)
+Name[fa]=دفترچه یادداشت)مثال(
 Name[fi]=Muistio (esimerkki)
 Name[fr]=Bloc-notes (exemple)
 Name[fy]=Skriuwboekje (foarbyld)
Index: kparts/browserextension.h
===================================================================
--- kparts/browserextension.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/browserextension.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -686,6 +686,13 @@
    */
   void setPageSecurity( int );
 
+#define KPARTS_BROWSEREXTENSION_HAS_ITEMS_REMOVED
+  /**
+   * Inform the host about items that have been removed.
+   * @since 3.5.5
+   */
+  void itemsRemoved( const KFileItemList &items );
+
 private slots:
   void slotCompleted();
   void slotOpenURLRequest( const KURL &url, const KParts::URLArgs &args );
Index: kparts/browserview.desktop
===================================================================
--- kparts/browserview.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/browserview.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Name[es]=Vista de navegador
 Name[et]=Brauseri vaade
 Name[eu]=Arakatzailearen ikuspegia
-Name[fa]=نمایش مرورگر
+Name[fa]=نمای مرورگر
 Name[fi]=Selainnäkymä
 Name[fr]=Affichage du navigateur
 Name[fy]=Browserwerjefte
Index: kparts/kpart.desktop
===================================================================
--- kparts/kpart.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kparts/kpart.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Componente de KDE
 Comment[et]=KDE komponent
 Comment[eu]=KDEren osagaia
-Comment[fa]=بخش KDE
+Comment[fa]=مولفۀ KDE
 Comment[fi]=KDE-komponentti
 Comment[fr]=Composant de KDE
 Comment[fy]=KDE-komponint
Index: kded/test/test.desktop
===================================================================
--- kded/test/test.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kded/test/test.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,7 +26,7 @@
 Name[es]=Módulo de prueba de KDED
 Name[et]=KDED testmoodul
 Name[eu]=KDED probako modulua
-Name[fa]=بخش آزمایش KDED
+Name[fa]=پیمانۀ آزمون KDED
 Name[fi]=KDED-testimoduuli
 Name[fr]=Module de test KDED
 Name[fy]=KDED Testmodule
@@ -100,7 +100,7 @@
 Comment[es]=Un módulo de prueba para KDED
 Comment[et]=KDED testmoodul
 Comment[eu]=KDEDren probako modulua
-Comment[fa]=بخش آزمایشی برای KDED
+Comment[fa]=پیمانۀ آزمون برای KDED
 Comment[fi]=Testimoduuli KDED:lle
 Comment[fr]=Un module de test pour KDED
 Comment[fy]=In testmodule foar KDED
Index: kded/kdedmodule.desktop
===================================================================
--- kded/kdedmodule.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kded/kdedmodule.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -20,7 +20,7 @@
 Comment[es]=Módulo de KDED
 Comment[et]=KDED moodul
 Comment[eu]=KDED modulua
-Comment[fa]=بخش KDED
+Comment[fa]=پیمانه KDED
 Comment[fi]=KDED-moduuli
 Comment[fr]=Module KDED
 Comment[fy]=KDED-module
Index: kded/kded.cpp
===================================================================
--- kded/kded.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kded/kded.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -129,7 +129,11 @@
   delete m_pTimer;
   delete m_pDirWatch;
 
-  m_modules.setAutoDelete(true);
+  // We have to delete the modules while we're still able to process incoming
+  // DCOP messages, since modules might make DCOP calls in their destructors.
+  QAsciiDictIterator<KDEDModule> it(m_modules);
+  for(; it.current(); ++it)
+    delete it.current();
 }
 
 bool Kded::process(const QCString &obj, const QCString &fun,
Index: kded/vfolder_menu.cpp
===================================================================
--- kded/vfolder_menu.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kded/vfolder_menu.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -747,7 +747,7 @@
 
    while( !result.isEmpty() && (result[0] != basePath))
       result.remove(result.begin());
-      
+
    if (result.count() <= 1)
    {
       m_docInfo.path = QString::null; // No parent found
@@ -847,11 +847,15 @@
    if (domElem.tagName() == "And")
    {
       QDomNode n = domElem.firstChild();
-      if (!n.isNull())
+      // Look for the first child element
+      while (!n.isNull()) // loop in case of comments
       {
          QDomElement e = n.toElement();
-         processCondition(e, items);
          n = n.nextSibling();
+         if ( !e.isNull() ) {
+             processCondition(e, items);
+             break; // we only want the first one
+         }
       }
 
       QDict<KService> andItems;
@@ -881,19 +885,25 @@
    else if (domElem.tagName() == "Or")
    {
       QDomNode n = domElem.firstChild();
-      if (!n.isNull())
+      // Look for the first child element
+      while (!n.isNull()) // loop in case of comments
       {
          QDomElement e = n.toElement();
-         processCondition(e, items);
          n = n.nextSibling();
+         if ( !e.isNull() ) {
+             processCondition(e, items);
+             break; // we only want the first one
+         }
       }
 
       QDict<KService> orItems;
       while( !n.isNull() ) {
          QDomElement e = n.toElement();
-         orItems.clear();
-         processCondition(e, &orItems);
-         includeItems(items, &orItems);
+         if ( !e.isNull() ) {
+             orItems.clear();
+             processCondition(e, &orItems);
+             includeItems(items, &orItems);
+         }
          n = n.nextSibling();
       }
    }
@@ -910,9 +920,11 @@
       QDomNode n = domElem.firstChild();
       while( !n.isNull() ) {
          QDomElement e = n.toElement();
-         notItems.clear();
-         processCondition(e, &notItems);
-         excludeItems(items, &notItems);
+         if ( !e.isNull() ) {
+             notItems.clear();
+             processCondition(e, &notItems);
+             excludeItems(items, &notItems);
+         }
          n = n.nextSibling();
       }
    }
Index: Makefile.am.in
===================================================================
--- Makefile.am.in	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ Makefile.am.in	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -33,7 +33,7 @@
 
 $(top_srcdir)/acinclude.m4: $(top_srcdir)/libltdl/ltdl.m4
 
-AUTOMAKE_OPTIONS = foreign 1.5
+AUTOMAKE_OPTIONS = foreign 1.6.1
 
 potdir = $(kde_includes)
 pot_DATA = kde.pot
Index: kdeprint/tools/escputil/escputil.desktop
===================================================================
--- kdeprint/tools/escputil/escputil.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/tools/escputil/escputil.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -8,7 +8,7 @@
 Name[bn]=এপসন ইঙ্কজেট
 Name[de]=Epson InkJet
 Name[eo]=Epson-Inkĵet-ilo
-Name[fa]=جوهرافشان EPSON
+Name[fa]=چاپگرجوهر افشان EPSON
 Name[fr]=Imprimante jet d'encre Epson
 Name[ga]=Scairdphrintéir EPSON
 Name[hi]=एप्सन इंकजेट
Index: kdeprint/filters/poster.desktop
===================================================================
--- kdeprint/filters/poster.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/poster.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -90,7 +90,6 @@
 Description[es]=Aplicación para imprimir posters grandes en varias hojas de papel. Para usar el comando, el ejecutable <b>poster</b> debe estar accesible en su <tt>PATH</tt>. El código fuente de esta utilidad puede encontrarse en la <a href="http://printing.kde.org/downloads">página web de KDEPrint</a>. <p><b><u>AVISO:</u></b> el paquete en la página web KDEPrint es una versión modificada de la original que se puede encontrar en cualquier réplica de archivos de CTAN. Pero el paquete original <b>no</b> funciona con KDE,. Usted <b>debe</b> usar el paquete que se encuentra en <a href="http://printing.kde.org/downloads">el servidor web de KDEPrint</a>.
 Description[et]=Vahend suurte postrite trükkimiseks mitmele väikesele paberilehele. Käsu kasutamiseks peab <b>postri</b> käivitusfail asuma sinu otsingurajal. Rakenduse lähtekoodi leiab <a href="http://printing.kde.org/downloads">KDEPrinti veebileheküljel</a>. <p><b><u>HOIATUS</u></b> KDEPrinti veebileheküljel olev pakett on muudetud võrreldes algsega, mille leiab suvaliselt CTAN-i arhiivi peeglilt, kuid originaalpakett <b>ei</b> toimi KDE-s. Sa lihtsalt <b>pead</b> kasutama paketti, mis asub <a href="http://printing.kde.org/downloads">KDEPrinti veebileheküljel</a>.
 Description[eu]=Poster handiak orri txiki askotan inprimatzeko tresna. Komando hau erabiltzeko <b>poster</b> exekutagarriak zure <tt>BIDE-IZENEA</tt>an egon behar du. Tresna honen iturburua <a href="http://printing.kde.org/downloads">KDEPrint web gunen</a> egon daiteke. <p><b><u>ABISUA:</u></b> KDEPrint web gunean dagoen paketea jatorrizkoaren  bertsio eraldatua da, edozein CTAN fitxategi-ispilutan aurki dezakezuna, baina jatorrizko paketeak <b>ez</b> du KDErekin funtzionatzen.<a href="http://printing.kde.org/downloads"> gunean dagoen paketea erabili <b>behar</b> duzu.</a>
-Description[fa]=برنامه‌ای برای چاپ پوسترهای بزرگ بر روی صفحات کاغذ کوچک. برای استفاده از این دستور <b>پوستر</b> باید در <tt>مسیر</tt> شما قابل دسترسی باشد. کد مرجع این ابزار می‌تواند در <a href="http://printing.kde.org/downloads">وب‌گاه KDEPrint</a> یافت شود. <p><b><u>اخطار:</u></b> بسته‌ی موجود در وب‌گاه KDEPrint نسخه‌ی تغییر یافته‌ای از بسته‌ی اصلی است، که آن را می‌توان در هر آیینه آرشیو CTAN پیدا کرد، ولی نسخه‌ی اصلی با KDE کار <b>نمی‌کند</b>. شما باید از بسته‌ی <a href="http://printing.kde.org/downloads">وب‌گاه KDEPrint</a> استفاده کنید.
 Description[fi]=Työkalu isojen julisteiden tulostamiseen pienille paperiarkeille. Käyttääksesi komentoa <b>poster</b> ohjelman tulee olla polussasi. Tämän työkalun lähdekoodi löytyy KDEPrintin <a href="http://printing.kde.org/downloads">WWW-sivustolta</a>. <p><b><u>VAROITUS:</u></b>KDEPrintin sivuilla oleva paketti on muokattu versio alkuperäisestä CTAN-arkistossa olevasta paketista. Alkuperäinen paketti <b>ei</b> toimi KDE:n kanssa. Sinun <b>täytyy</b> käyttää KDEPrint WWW-sivuilta löytyvää versiota.
 Description[fr]=Utilitaire pour imprimer de grandes affiches sur de multiples petites feuilles de papier. Pour utiliser cette commande, l'exécutable <b>poster</b> doit être accessible dans votre <tt>PATH</tt>. Vous pouvez trouver le code source de cet utilitaire à l'adresse <a href="http://printing.kde.org/downloads">KDEPrint web site</a>. <p><b><u>Attention :</u></b> le paquetage présent sur le site web de KDEPrint est une version modifiée de l'original se trouvant sur n'importe quel miroir des archives du CTAN, mais le paquetage d'origine <b>ne fonctionnera pas</b> avec KDE. Vous <b>devez</b> utiliser le paquetage qui se trouve sur le <a href="http://printing.kde.org/downloads">site web de KDEPrint</a>.
 Description[fy]=Helpprogramma foar it printsjen fan grutte posterformaten op lytse bôgen papier. Om dit kommando te brûken moat it programmma <b>poster</b> yn jo (<tt>$PATH</tt>) wêze. De boarnekoade foar dit helpprogramma fine jo op de <a href="http://printing.kde.org/downloads">webside</a> fan KDEPrint. <p><b><u>Warskôging:</u></b>It pakket dat oanbean wurdt op de webside fan KDEPrint is in fariant fan it orizjineel dat jo fine op eltse CTAN-argyfmirror, mar dit orizjineel wurket <b>net</b> op KDE. Jo moatte hjirre it pakket hawwe dat oanbean wurdt op de <a href="http://printing.kde.org/downloads">webside</a> fan KDEPrint.
@@ -117,7 +116,7 @@
 Description[nso]=Sebereka sago gatisa diswantsho tse kgolo go matlakala a mantshi a mannyane. Go somisa taelo ye, phethagatsego ya <b>seswantsho</b> e swanetse go tsenelega kago <tt>TSEJANA</tt> ya gago. Khoutu ya mothopo wa sebereka se ekaba ele go <a href="http://printing.kde.org/downloads">Lefelo la web la Kgatiso ya KDE</a>. <p> <b><u>TEMOSO:</u></b> Pakana yeo e hweditswego kago lefelo la web la Kgatiso ya KDE ke tsweletso yeo e kaonafaditswego ya ya mathomothomo yeo eka hwetswago kago seipone sa polokelo ya CTAN, efela pakana ya mathomothomo e <b>kase</b> beereke le KDE. O <b>swanetse</b> go somisa pakana yeo e hweditswego kago <a href="http://printing.kde.org/downloads">lefelo la web la Kgatiso ya KDE</a>.
 Description[pa]=ਕਈ ਛੋਟੇ ਆਕਾਰ ਦੇ ਸਫਿਆ ਤੇ ਵੱਡਾ ਪੋਸਟਰ ਛਾਪਣ ਦੀ ਸਹੂਲਤ। ਇਹ ਕਮਾਂਡ , <b>ਪੋਸਟਰ</b> ਚੱਲਣਯੋਗ ਤੁਹਾਡੇ <tt>ਰਸਤੇ</tt> ਵਿੱਚ ਹੋਣੀ ਲਾਜ਼ਮੀ ਹੈ। ਇਸ ਦਾ ਸਰੋਤ <a href="http://printing.kde.org/downloads">KDEPrint ਵੈੱਬ ਸਾਈਟ</a> ਤੋਂ ਲਿਆ ਜਾ ਸਕਦਾ ਹੈ <p><b><u>ਚੇਤਾਵਨੀ:</u></b> ਵੈੱਬ ਸਾਇਟ KDEPrint ਅਸਲੀ ਵਰਜਨ, ਜੋ ਕਿ CTAN ਸੰਕੁਚਿਤ ਤੇ ਮਿਲ ਸਕਦਾ ਹੈ, ਤੋਂ ਬਿਲਕੁੱਲ ਵੱਖਰਾ ਹੈ, ਪਰ ਅਸਲੀ ਪੈਕੇਜ KDE ਨਾਲ ਕੰਮ <b>ਨਹੀਂ</b> ਕਰਦਾ ਹੈ। ਤੁਹਾਨੂੰ <b>ਇੱਥੇ</b>ਉਪਲੱਬਧ ਪੈਕੇਜ ਹੀ ਵਰਤਣਾ ਚਾਹੀਦਾ ਹੈ <a href="http://printing.kde.org/downloads">KDEPrint ਵੈੱਬ ਸਾਇਟ</a>।
 Description[pl]=Narzędzie do drukowania dużych plakatów (posterów) na wielu małych kartkach papieru. Aby z niego skorzystać na ścieżce (zmienna <tt>PATH</tt>) musi być dostępny program <b>poster</>. Kod źródłowy do tego programu można znaleźć <a href="http://printing.kde.org/downloads"> na stronie internetowej Systemu Druku KDE</a>. <p><b><u>UWAGA:</u></b> Pakiet na stronie Systemu Druku KDE jest zmodyfikowaną wersją pakietu, którego oryginał dostępny jest w każdym archiwum CPAN. Niestety oryginał <b>nie</b> działa pod KDE. Konieczna jest wersja ze <a href="http://printing.kde.org/downloads">strony Systemu Druku KDE</a>.
-Description[pt]=Um utilitário para imprimir posters grandes em várias folhas de papel mais pequenas. Para usar este comando, o executável <b>poster</b> deve estar acessível no seu <tt>PATH</tt>. O código-fonte para este utilitário pode ser encontrado no <a href="http://printing.kde.org/downloads">'site' Web do KDEPrint</a>. <p><b><u>ATENÇÃO:</u></b> O pacote existente no 'site' Web do KDEPrint é uma versão modificada do original que pode ser encontrado em qualquer réplica do CTAN, contudo o pacote original <b>não</b> irá funcionar no KDE. O utilizador <b>deve</b> usar o pacote existente no <a href="http://printing.kde.org/downloads">'site' Web do KDEPrint</a>.
+Description[pt]=Um utilitário para imprimir posters grandes em várias folhas de papel mais pequenas. Para usar este comando, o executável <b>poster</b> deve estar acessível no seu <tt>PATH</tt>. O código-fonte para este utilitário pode ser encontrado no <a href="http://printing.kde.org/downloads">'site' Web do KDEPrint</a>. <p><b><u>ATENÇÃO:</u></b> O pacote existente no 'site' Web do KDEPrint é uma versão modificada do original que pode ser encontrado em qualquer réplica do CTAN, contudo o pacote original <b>não</b> irá funcionar no KDE. O utilizador <b>deve</b> usar o pacote existente no <a href="http://printing.kde.org/downloads">sítio Web do KDEPrint</a>.
 Description[pt_BR]=Utilitário para a impressão de grandes cartazes em múltiplos papéis.  Para usar este comando, o executável <b>poster</b> deve estar acessível em suia variável <tt>PATH</tt>. O código fonte para este utilitário pode ser encontrado no  <a href="http://printing.kde.org/downloads">site do KDEPrint</a>. <p><b><u>AVISO:</u></b> O pacote encontrado no site do KDEPrint é uma versão modificada da original, que pode ser encontrada em qualquer mirror da CTAN, mas o pacote original <b>não</b> funcionará com o KDE. Você<b>deve</b> usar o pacote encontrado em um site do <a href="http://printing.kde.org/downloads">KDEPrint</a>.
 Description[ro]=Utilitar de tipărit postere mari pe foi de hîrtie mici. Pentru a utiliza această comandă trebuie ca programul <b>poster</b> să fie accesibil prin variabila de mediu <tt>PATH</tt>. Codul sursă pentru acest utilitar poate fi găsit pe  <a href="http://printing.kde.org/downloads">site-ul de web KDEPrint</a>. <p><b><u>ATENŢIE:</u></b> Pachetul pe care îl găsiţi pe site-ul de web KDEPrint este o versiune modificată a celui original aflat în arhiva CTAN. Versiunea originală <b>nu</b> va funcţiona sub KDE. <b>Trebuie</b> să utilizaţi versiunea modificată.
 Description[ru]=Утилита печати больших плакатов на бумаге небольшого размера. Чтобы она работала, нужно чтобы программа <b>poster</b> была доступна в вашем <tt>PATH</tt>. Исходники этой утилиты можно найти на сайте <a href="http://printing.kde.org/downloads">KDEPrint</a>. <p><b><u>ВНИМАНИЕ:</u></b> Пакеты на сайте KDEPrint отличаются от тех, которые можно скачать с зеркала CTAN, но оригинальные пакеты <b>не будут</b> работать в KDE. Вам <b>необходимо</b> использовать пакеты с сайта <a href="http://printing.kde.org/downloads">KDEPrint</a>.
Index: kdeprint/filters/psbook1.desktop
===================================================================
--- kdeprint/filters/psbook1.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psbook1.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -3,7 +3,6 @@
 Name[af]=psboek1
 Name[de]=PS-Book 1
 Name[eo]=PS-libro 1
-Name[fa]=psbook۱
 Name[fr]=psbook 1
 Name[hi]=पीएस-बुक1
 Name[mn]=PS-ном 1
@@ -30,7 +29,7 @@
 Comment[es]=Impresión de folleto - páginas pares (paso 1)
 Comment[et]=Brošüüri trükkimine - paarislehed (1. samm)
 Comment[eu]=Liburuxka inprimatzea - Orrialde bikoitiak (1. urratsa)
-Comment[fa]=چاپ Pamphlet - صفحات زوج (مرحله‌ی ۱)
+Comment[fa]=چاپ جزوه - صفحات زوج )گام ۱(
 Comment[fi]=Lentolehtistulostus - parilliset sivut (vaihe 1)
 Comment[fr]=Impression au format livret - Pages paires (étape 1)
 Comment[fy]=Pamflet printsje - even bledsiden (stap 1)
Index: kdeprint/filters/psbook2.desktop
===================================================================
--- kdeprint/filters/psbook2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psbook2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -3,7 +3,6 @@
 Name[af]=psboek2
 Name[de]=PS-Book 2
 Name[eo]=PS-libro 2
-Name[fa]=psbook۲
 Name[fr]=psbook 2
 Name[hi]=पीएस-बुक2
 Name[mn]=PS-ном 2
@@ -30,7 +29,7 @@
 Comment[es]=Impresión de folleto - páginas impares (paso 2)
 Comment[et]=Brošüüri trükkimine - paaritud lehed (2. samm)
 Comment[eu]=Liburuxka inprimatzea - Orrialde bakoitiak (2 urratsa)
-Comment[fa]=چاپ Pamphlet - صفحات فرد (مرحله‌ی ۲)
+Comment[fa]=چاپ جزوه - صفحات فرد )گام ۲(
 Comment[fi]=Lentolehtistulostus - parittomat sivut (vaihe 2)
 Comment[fr]=Impression au format livret - Pages impaires (étape 2)
 Comment[fy]=Pamflet printsje - ûneven bledsiden (stap 2)
Index: kdeprint/filters/psselect.desktop
===================================================================
--- kdeprint/filters/psselect.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psselect.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,7 +26,7 @@
 Comment[es]=Filtro de ordenamiento/selección de página
 Comment[et]=Lehekülgede valimise/järjestamise filter
 Comment[eu]=Orrialdeak hautatzeko/ordenatzeko iragazkia
-Comment[fa]=صافی مرتبه/انتخاب صفحه
+Comment[fa]=گزینش صفحه/ پالایه مرتب
 Comment[fi]=Sivun valinta/järjestys-suodin
 Comment[fr]=Sélection de pages / Filtre de tri
 Comment[fy]=Bledsiden selektearje/op oarder bringe
Index: kdeprint/filters/pdfwrite.desktop
===================================================================
--- kdeprint/filters/pdfwrite.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/pdfwrite.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -31,7 +31,7 @@
 Comment[es]=Escritor de PDF (requiere Ghostscript)
 Comment[et]=PDF-i kirjutaja (vajab Ghostscripti)
 Comment[eu]=PDF idazlea (GhostScript behar du)
-Comment[fa]=نویسنده‌ی PDF (نیاز به Ghostscript دارد)
+Comment[fa]=نویسنده PDF)به Ghostscriptنیاز دارد(
 Comment[fi]=PDF-tulostussuodin (tarvitsee Ghostscriptin)
 Comment[fr]=Impression PDF (nécessite GhostScript)
 Comment[fy]=PDF Writer (hat Ghostskript nedich)
Index: kdeprint/filters/enscript.desktop
===================================================================
--- kdeprint/filters/enscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/enscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -33,7 +33,7 @@
 Comment[es]=Filtro de textos Enscript
 Comment[et]=Enscript tekstifilter
 Comment[eu]=Enscript testu-iragazkia
-Comment[fa]=ویرایشگر متن Enscript
+Comment[fa]=پالایۀ متن enscript
 Comment[fi]=Enscript-tekstisuodin
 Comment[fr]=Filtre de texte Enscript
 Comment[fy]=Enscript-tekstfilter
Index: kdeprint/filters/imagetops.desktop
===================================================================
--- kdeprint/filters/imagetops.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/imagetops.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -4,6 +4,7 @@
 Name[az]=rəsmlər
 Name[da]=billedtoppe
 Name[eo]=Bildsuproj
+Name[fa]=بالای تصویر
 Name[fr]=Imagetops
 Name[fy]=Imagetops
 Name[hi]=इमेजटॉप्स
@@ -34,7 +35,7 @@
 Comment[es]=Imagen genérica a filtro PS
 Comment[et]=Lihtne pilt->PostScript filter
 Comment[eu]=Irudi generikoa PS iragazkira
-Comment[fa]=صافی عمومی تصویر به PS
+Comment[fa]=تصویر عمومی به پالایه PS
 Comment[fi]=Muunnin yleisestä kuvasta PS-muotoon
 Comment[fr]=Filtre d'image générique vers PS
 Comment[fy]=Algemiene ôfbylding nei PS-filter
Index: kdeprint/filters/psbook.desktop
===================================================================
--- kdeprint/filters/psbook.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psbook.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -27,7 +27,7 @@
 Comment[es]=Impresión de folleto (usar con impresión de doble cara pequeña)
 Comment[et]=Brošüüri trükkimine - (kasutatakse duplekstrükkimisel)
 Comment[eu]=Liburuxka inprimatzea (erabili orrialde txikiko inprimatze-bikoitzean)
-Comment[fa]=چاپ Pamphlet (در چاپ‌های کوچک یک طرفه استفاده کنید)
+Comment[fa]=چاپ جزوه)با استفاده از سمت کوچک چاپ دوسویه(
 Comment[fi]=Lentolehtistulostus (käytä lyhyen sivun kaksipuoleistulostusta)
 Comment[fr]=Impression au format livret (à utiliser avec l'impression duplex de petits feuillets)
 Comment[fy]=Pamflet printsje(te brûken mei smelle kant fan dupleksôfdruk)
Index: kdeprint/filters/ps2pdf.desktop
===================================================================
--- kdeprint/filters/ps2pdf.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/ps2pdf.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Comment[es]=Conversor de PostScript a PDF
 Comment[et]=PostScript->PDF teisendamine
 Comment[eu]=PostScript-etik PDFrako bihurtzailea
-Comment[fa]=مبدل PostScript به PDF
+Comment[fa]=مبدل پست اسکریپت به PDF
 Comment[fi]=Muunnin PostScriptistä PDF-muotoon
 Comment[fr]=Convertisseur PostScript vers PDF
 Comment[fy]=Konversje fan PostSkript nei PDF
Index: kdeprint/filters/psresize.desktop
===================================================================
--- kdeprint/filters/psresize.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psresize.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -28,7 +28,7 @@
 Comment[es]=Escalar el contenido de la impresión para ajustar en otro tamaño del papel
 Comment[et]=Sisu suuruse muutmine mahutamaks teise suurusega paberile
 Comment[eu]=Eskalatu inprimatzeko edukiak beste paper-tamainari doitzeko
-Comment[fa]=کشیدن محتوای چاپ برای اندازه گردن آن در کاعذی دیگر
+Comment[fa]=مقیاس محتوای چاپ برای تناسب با اندازۀ کاغذ دیگر
 Comment[fi]=Skaalaa tulostettava sisältö mahtumaan erikokoiselle paperille
 Comment[fr]=Ajuste le contenu imprimé pour l'adapter à un autre format de papier
 Comment[fy]=Pas de ôfdruk oan oan in oar formaat papier
Index: kdeprint/filters/psnup.desktop
===================================================================
--- kdeprint/filters/psnup.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/filters/psnup.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=Filtro para múltiples páginas por hoja
 Comment[et]=Mitme lehekülje ühele lehele trükkimise filter
 Comment[eu]='Orrialde anitzak orriko' iragazkia
-Comment[fa]=صافی صفحات متعدد در برگ
+Comment[fa]=صفحات چندگانه در پالایه صفحه
 Comment[fi]=Useita sivuja samalle arkille
 Comment[fr]=Plusieurs pages par feuille
 Comment[fy]=Mear as ien side op in bôge
Index: kdeprint/cups/cups.print
===================================================================
--- kdeprint/cups/cups.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/cups/cups.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,7 +14,7 @@
 Comment[eo]=CUPS (Kapabla Uniks-pressistemo)
 Comment[es]=CUPS (sistema de impresión común para Unix)
 Comment[eu]=CUPS (Common UNIX Print System) 
-Comment[fa]=CUPS (سیستم چاپ عمومی یونیکس)
+Comment[fa]=CUPS)سیستم چاپ مشترک یونیکس(
 Comment[fr]=CUPS (Common Unix Print System)
 Comment[fy]=CUPS (Common Unix Print System)
 Comment[gl]=CUPS (Sistema Comun de Impresión para UNIX)
Index: kdeprint/cups/cupsdconf2/cups-util.c
===================================================================
--- kdeprint/cups/cupsdconf2/cups-util.c	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/cups/cupsdconf2/cups-util.c	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -443,8 +443,7 @@
 	the struct has changed in newer versions - PiggZ (adam@piggz.co.uk)
   */
 #if CUPS_VERSION_MAJOR == 1 && CUPS_VERSION_MINOR >= 2
-	if (ntohl(*(int*)&http->_hostaddr.sin_addr) != 0x7f000001 &&
-      strcasecmp(http->hostname, "localhost") != 0)
+        if (!httpAddrLocalhost(http))
 #else
 	if (ntohl(*(int*)&http->hostaddr.sin_addr) != 0x7f000001 &&
       strcasecmp(http->hostname, "localhost") != 0)
Index: kdeprint/foomatic/foomatic.print
===================================================================
--- kdeprint/foomatic/foomatic.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/foomatic/foomatic.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -6,7 +6,7 @@
 Comment[bn]=ফুম্যাটিক (CUPS, LPRng, PDQ)
 Comment[cy]=Foomatic (CUPS, LPRng, PDQ)  
 Comment[eo]=Presprogramo "Foomatic" (CUPS, LPRng, PDQ)
-Comment[fa]=Foomatic (CUPS،LPRng،PDQ)
+Comment[fa]=)Foomatic (CUPS,LPRng,PDQ
 Comment[hi]=फूमेटिक (CUPS, LPRng, PDQ)
 Comment[rw]=Fumatike (CUPS, LPRng, PDQ)
 Comment[sq]=Foomatik (CUPS, LPRng, PDQ)
Index: kdeprint/lpd/lpd.print
===================================================================
--- kdeprint/lpd/lpd.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/lpd/lpd.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -18,7 +18,7 @@
 Comment[es]=LPR (sistema de impresión estándar de BSD)
 Comment[et]=LPR (standardne BSD trükkimise süsteem)
 Comment[eu]=LPR (BSDren inprimatze-sistema estandarra)
-Comment[fa]=LPR (سیستم چاپ استاندارد BSD)
+Comment[fa]=LPR ( سیستم چاپ BSD استاندارد )
 Comment[fi]=LPR (standardi BSD-tulostusjärjestelmä)
 Comment[fr]=LPR (système d'impression BSD standard)
 Comment[fy]=LPR (standert BSD-ôfdruksysteem)
Index: kdeprint/kdeprintd.desktop
===================================================================
--- kdeprint/kdeprintd.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/kdeprintd.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -27,7 +27,7 @@
 Name[es]=Demonio de impresión de KDE
 Name[et]=KDE trükkimise deemon
 Name[eu]=KDEren inprimatze-daemona
-Name[fa]=برنامه‌ی چاپ KDE
+Name[fa]=شبح چاپ KDE
 Name[fi]=KDE:n tulostuspalvelin
 Name[fr]=Démon d'impression de KDE
 Name[fy]=KDE ôfdruk Daemon
@@ -98,6 +98,7 @@
 Comment[es]=Demonio de impresión para KDE
 Comment[et]=KDE trükkimise deemon
 Comment[eu]=KDEren inprimatze-daemona
+Comment[fa]=شبح چاپ برای KDE
 Comment[fi]=KDE:n tulostuspalvelin
 Comment[fr]=Un démon d'impression pour KDE
 Comment[fy]=ôfdruk deamon foar KDE
Index: kdeprint/management/kminfopage.cpp
===================================================================
--- kdeprint/management/kminfopage.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/management/kminfopage.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -135,7 +135,8 @@
 		{
 			// double decoding in case printer name contains
 			// annoying chars like '#'
-			m_device->setText(KURL::decode_string(p->device()));
+                        KURL dev(p->device());
+			m_device->setText(KURL::decode_string(dev.prettyURL()));
 		}
 		m_model->setText(p->driverInfo());
 	}
Index: kdeprint/rlpr/rlpr.print
===================================================================
--- kdeprint/rlpr/rlpr.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/rlpr/rlpr.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -15,7 +15,7 @@
 Comment[es]=Entorno RLPR (servidores LPD remotos)
 Comment[et]=RLPR keskkond (LPD võrguserverid)
 Comment[eu]=RLPR ingurunea (urruneko LPD zerbitzariak)
-Comment[fa]=محیط RLPR (کارگزار LPD از راه دور)
+Comment[fa]=محیط RLPR )کارسازهای LPD دور(
 Comment[fi]=RLPR-tulostus (LPD-palvelin)
 Comment[fr]=Environnement RLPR (serveurs LPD distants)
 Comment[fy]=RLPR-fermidden (LPD-tsjinners op ôfstân)
Index: kdeprint/lpdunix/lpdunix.print
===================================================================
--- kdeprint/lpdunix/lpdunix.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/lpdunix/lpdunix.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -17,7 +17,7 @@
 Comment[es]=Sistema de impresión genérico LPD de Unix (predeterminado)
 Comment[et]=Tavaline UNIX-i LPD trükkimise süsteem (vaikimisi)
 Comment[eu]=UNIX LPD inprimatze-sistema generikoa (lehenetsia)
-Comment[fa]=سیستم چاپ عمومی یونیکس LPD (پیش‌فرض)
+Comment[fa]=سیستم چاپUNIX LPD عمومی )پیش فرض(
 Comment[fi]=Yleinen UNIX LPD-tulostusjärjestelmä (oletus)
 Comment[fr]=Système d'impression LPD Unix générique (par défaut)
 Comment[fy]=Algemiene UNIX LPD-ôfdruksysteem (standert)
Index: kdeprint/ext/ext.print
===================================================================
--- kdeprint/ext/ext.print	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/ext/ext.print	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -16,7 +16,7 @@
 Comment[es]=Imprime a través de un programa externo (genérico)
 Comment[et]=Trükkimine läbi välise rakenduse (üldine)
 Comment[eu]=Inprimatu kanpoko programa bat erabiliz (orokorra)
-Comment[fa]=چاپ از طریق برنامه‌ای خارجی (عمومی)
+Comment[fa]=چاپ از طریق یک برنامۀ خارجی)عمومی(
 Comment[fi]=Tulosta ulkoisen sovelluksen kautta (yleinen)
 Comment[fr]=Imprimer via un programme externe (générique)
 Comment[fy]=Printsje mei help fan een ekstern programma (algemien)
Index: kdeprint/specials.desktop
===================================================================
--- kdeprint/specials.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeprint/specials.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -21,7 +21,7 @@
 Name[es]=Imprimir en archivo (PostScript)
 Name[et]=Faili trükkimine (Postscript)
 Name[eu]=Inprimatu fitxategian (PostScript)
-Name[fa]=چاپ در پرونده (PostScript)
+Name[fa]=چاپ در پرونده)پست اسکریپت(
 Name[fi]=Tulosta PostScript-tiedostoon
 Name[fr]=Imprimer dans un fichier (PostScript)
 Name[fy]=Nei triem printsje (PostScript)
@@ -98,7 +98,7 @@
 Description[es]=Escribir archivo PostScript
 Description[et]=PS-faili kirjutamine
 Description[eu]=Idatzi PostScript fitxategia
-Description[fa]=نوشتن پرونده‌ی PostScript
+Description[fa]=نوشتن پروندۀ پست‌اسکریپت 
 Description[fi]=Kirjoita PostScript-tiedosto
 Description[fr]=Imprimer dans un fichier PostScript
 Description[fy]=Skriuw PostScript-triem
@@ -175,7 +175,7 @@
 Comment[es]=Archivo local
 Comment[et]=Kohalik fail
 Comment[eu]=Fitxategi lokala
-Comment[fa]=پرونده‌ی محلی
+Comment[fa]=پروندۀ محلی
 Comment[fi]=Paikallinen tiedosto
 Comment[fr]=Fichier local
 Comment[fy]=Lokaal triem
@@ -259,7 +259,7 @@
 Name[es]=Imprimir en archivo (PDF)
 Name[et]=Faili trükkimine (PDF)
 Name[eu]=Inprimatu fitxategian (PDF)
-Name[fa]=چاپ در پرونده (PDF)
+Name[fa]=چاپ در پرونده )PDF(
 Name[fi]=Tulosta PDF-tiedostoon
 Name[fr]=Imprimer dans un fichier (PDF)
 Name[fy]=Nei triem printsje (PDF)
@@ -336,7 +336,7 @@
 Description[es]=Escribir archivo PDF/Acrobat
 Description[et]=PDF/Acrobat-faili kirjutamine
 Description[eu]=Idatzi PDF/Acrobat fitxategia
-Description[fa]=نوشتن پرونده‌ی PDF/Acrobat
+Description[fa]=نوشتن PDF/پروندۀ آکروبات
 Description[fi]=Kirjoita PDF/Acrobat-tiedosto
 Description[fr]=Imprime dans un fichier PDF / Acrobat
 Description[fy]=Skriuw PDF/Acrobat-triem
@@ -413,7 +413,7 @@
 Comment[es]=Archivo local
 Comment[et]=Kohalik fail
 Comment[eu]=Fitxategi lokala
-Comment[fa]=پرونده‌ی محلی
+Comment[fa]=پروندۀ محلی
 Comment[fi]=Paikallinen tiedosto
 Comment[fr]=Fichier local
 Comment[fy]=Lokaal triem
@@ -573,7 +573,7 @@
 Description[es]=Enviar a sistema de fax externo
 Description[et]=Välisele faksisüsteemile saatmine
 Description[eu]=Bidali kanpoko fax-sistemara
-Description[fa]=ارسال به سیستم دورنگار خارجی
+Description[fa]=ارسال به سیستم دور نگارخارجی
 Description[fi]=Lähetä faksille
 Description[fr]=Envoyer à un système de fax externe
 Description[fy]=Nei in ekstern faxsysteem stjoere
@@ -732,7 +732,7 @@
 Comment[es]=Adjunto para el editor de KMail
 Comment[et]=KMaili kirjale kaasamine
 Comment[eu]=KMail Composer-entzako eranskina
-Comment[fa]=ضمیمه برای ارسال کننده‌ی KMail
+Comment[fa]=پیوست برای  مولف KMail
 Comment[fi]=Sähköpostiliite KMailille
 Comment[fr]=Pièce jointe du logiciel de messagerie électronique KMail
 Comment[fy]=Taheakke foar nije berjochten yn KMail
@@ -805,7 +805,7 @@
 Description[es]=Crear archivo PDF/Acrobat como adjunto para KMail
 Description[et]=Tekitab PDF/Acrobat-faili ja kaasab selle KMaili kirjale
 Description[eu]=PDF/Acrobat fitxategiak sortzen ditu KMail-en eranskin gisa
-Description[fa]=ایجاد پرونده‌ی PDF/Acrobat به عنوان ضمیمه برای KMail
+Description[fa]=PDF/پروندۀ آکروبات را به‌عنوان پیوست برای KMail ایجاد می‌کند
 Description[fi]=Luo PDF/Acrobat-tiedoston sähköpostiliitteenä KMailille
 Description[fr]=Crée un fichier PDF en tant que pièce jointe pour KMail
 Description[fy]=Kreëart PDF/Acrobat-triem as taheakke foar KMail
@@ -882,6 +882,7 @@
 Name[es]=Enviar archivo PDF por correo
 Name[et]=PDF-faili kirjaga saatmine
 Name[eu]=Bidali PDF fitxategia
+Name[fa]=پرونده PDF نامه
 Name[fi]=Lähetä PDF-tiedosto sähköpostilla
 Name[fr]=Pièce jointe PDF
 Name[fy]=Ferstjoer PDF triem
@@ -935,6 +936,7 @@
 Comment[bg]=Външна програма KSendFax
 Comment[cy]=KAnfonFfacs
 Comment[eo]=SendFaksilo
+Comment[fa]=KSen
 Comment[hi]=के-सेंड-फ़ैक्स
 Comment[is]=KsendFax
 Comment[ko]=K팩스보내기
@@ -963,7 +965,7 @@
 Description[es]=Use ksendfax para enviar un fax del documento actual
 Description[et]=Ksendfax'i kasutamine aktiivse dokumendi faksimiseks
 Description[eu]=Erabili ksendfax uneko dokumentua faxez bidaltzeko
-Description[fa]=استفاده از ksendfax برای ارسال سند فعلی
+Description[fa]=از KSendFax برای دورنگاری سند جاری استفاده کنید
 Description[fi]=Käytä kdendfax-ohjelmaa faksataksesi asiakirja
 Description[fr]=Utiliser KSendfax pour faxer le document actuel
 Description[fy]=Brûk KSendfax foar it faksen fan it dokumint dat ûnder hannen is
@@ -1040,7 +1042,7 @@
 Name[es]=Herramienta avanzada de envio de faxes (ksendfax)
 Name[et]=Võimas faksimise rakendus (ksendfax)
 Name[eu]=Faxaren tresna aurreratua (ksendfax)
-Name[fa]=ابزار دورنگار پیشرفته (ksendfax)
+Name[fa]=ابزار دورنگار پیشرفته)KSendFax(
 Name[fi]=Edistynyt faksaustyökalu (ksendfax)
 Name[fr]=Outil de fax avancé (KSendfax)
 Name[fy]=Avansearre faksprogramma (ksendfax)
Index: kdeui/ksyntaxhighlighter.cpp
===================================================================
--- kdeui/ksyntaxhighlighter.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/ksyntaxhighlighter.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -507,7 +507,9 @@
 	int para, index;
 	textEdit()->getCursorPosition( &para, &index );
 	//rehighlight the current para only (undo/redo safe)
+	bool modified = textEdit()->isModified();
 	textEdit()->insertAt( "", para, index );
+	textEdit()->setModified( modified );
     }
     if (d->checksDone == d->checksRequested)
 	d->completeRehighlightRequired = false;
Index: kdeui/kpopupmenu.cpp
===================================================================
--- kdeui/kpopupmenu.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/kpopupmenu.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -108,9 +108,6 @@
                        AlignCenter | SingleLine, titleStr);
         }
     }
-
-    p.setPen(palette().active().highlight());
-    p.drawLine(0, 0, r.right(), 0);
 }
 
 QSize KPopupTitle::sizeHint() const
Index: kdeui/kkeydialog.cpp
===================================================================
--- kdeui/kkeydialog.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/kkeydialog.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -888,8 +888,11 @@
         KStdAccel::ShortcutList std_list;
         KShortcut newCut = origCut;
         removeFromShortcut(newCut, cut);
-        std_list.setShortcut( std_list.index( name ), newCut);
-        std_list.save();
+        int index = std_list.index( name );
+        if ( index >= 0 ) {
+            std_list.setShortcut( index, newCut );
+            std_list.save();
+        }
     }
 }
 
Index: kdeui/ktoolbar.cpp
===================================================================
--- kdeui/ktoolbar.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/ktoolbar.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -769,7 +769,7 @@
 KToolBar::BarPosition KToolBar::barPos() const
 {
     if ( !this->mainWindow() )
-        return KToolBar::Top;
+        return place() == QDockWindow::InDock ? KToolBar::Top : KToolBar::Floating;
     Dock dock;
     int dm1, dm2;
     bool dm3;
Index: kdeui/kdetrayproxy/kdetrayproxy.desktop
===================================================================
--- kdeui/kdetrayproxy/kdetrayproxy.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/kdetrayproxy/kdetrayproxy.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -14,6 +14,7 @@
 Name[es]=Módulo Proxy de bandeja de KDE
 Name[et]=KDE süsteemse salve proxy moodul
 Name[eu]=KDEren erretiluko proxy-modulua
+Name[fa]=پیمانه پیشکار سینی KDE
 Name[fi]=KDE:n ilmoitusalueen välityspalvelinmoduuli
 Name[fr]=Module proxy des miniatures de KDE
 Name[fy]=KDE Systeemfak Proxy Module
@@ -69,6 +70,7 @@
 Comment[es]=Activación de Proxy de aplicaciones systray de KDE sin KWin
 Comment[et]=Proxy, mis võimaldab KDE süsteemse salve rakendustel töötada ilma KWin'ita
 Comment[eu]=KDEren erretiluko proxy-gaitze aplikazioak KWin gabe lan egiteko
+Comment[fa]=پیشکار،کاربردهایKDE systrayرابرای کارکردن بدون KWinفعال می‌سازد
 Comment[fi]=Välimuistipalvelin, jonka avulla ilmoitusalueen sovellukset voivat toimia ilman KWiniä
 Comment[fr]=Proxy autorisant le fonctionnement des miniatures sans KWin
 Comment[fy]=Troch Proxy kinne KDE systeemfak applikaasjes wurkje sûnder KWin
Index: kdeui/kdatepicker.cpp
===================================================================
--- kdeui/kdatepicker.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/kdatepicker.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -370,10 +370,8 @@
 
   int day = calendar->day(date);
   // ----- construct a valid date in this month:
-  //date.setYMD(date.year(), month, 1);
-  //date.setYMD(date.year(), month, QMIN(day, date.daysInMonth()));
-  calendar->setYMD(date, calendar->year(date), month,
-                   QMIN(day, calendar->daysInMonth(date)));
+  calendar->setYMD(date, calendar->year(date), month, 1);
+  date = date.addDays(QMIN(day, calendar->daysInMonth(date)) - 1);
   // ----- set this month
   setDate(date);
 }
Index: kdeui/kwindowlistmenu.cpp
===================================================================
--- kdeui/kwindowlistmenu.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/kwindowlistmenu.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -45,6 +45,16 @@
 #include "kwindowlistmenu.h"
 #include "kwindowlistmenu.moc"
 
+static QCString kwinName() {
+    QCString appname;
+    int screen_number = DefaultScreen(qt_xdisplay());
+    if (screen_number == 0)
+        appname = "kwin";
+    else
+        appname.sprintf("kwin-screen-%d", screen_number);
+    return appname;
+}
+
 // helper class
 namespace
 {
@@ -232,12 +242,12 @@
 
 void KWindowListMenu::slotUnclutterWindows()
 {
-    kapp->dcopClient()->send("kwin", "KWinInterface", "unclutterDesktop()", "");
+    kapp->dcopClient()->send(kwinName(), "KWinInterface", "unclutterDesktop()", "");
 }
 
 void KWindowListMenu::slotCascadeWindows()
 {
-    kapp->dcopClient()->send("kwin", "KWinInterface", "cascadeDesktop()", "");
+    kapp->dcopClient()->send(kwinName(), "KWinInterface", "cascadeDesktop()", "");
 }
 
 void KWindowListMenu::virtual_hook( int id, void* data )
Index: kdeui/klistviewsearchline.h
===================================================================
--- kdeui/klistviewsearchline.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/klistviewsearchline.h	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -33,6 +33,9 @@
  * No changes to the application other than instantiating this class with an
  * appropriate KListView should be needed.
  *
+ * If you want the clear button and the search label, you should take a look at
+ * the KListViewSearchLineWidget
+ *
  * @note { When iterating over items in the KListView, make sure that
  * the iterator only includes visible items (for example, by adding
  * QListViewItemIterator::Visible to the iterator flags). Otherwise,
Index: kdeui/tests/kmainwindowtest.cpp
===================================================================
--- kdeui/tests/kmainwindowtest.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/tests/kmainwindowtest.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -26,10 +26,9 @@
 {
     KApplication app( argc, argv, "kmainwindowtest" );
 
-    MainWindow mw;
+    MainWindow* mw = new MainWindow; // deletes itself when closed
+    mw->show();
 
-    mw.show();
-
     return app.exec();
 }
 
Index: kdeui/keditlistbox.cpp
===================================================================
--- kdeui/keditlistbox.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 584592)
+++ kdeui/keditlistbox.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 584592)
@@ -102,6 +102,7 @@
     grid->addMultiCellWidget(editingWidget,1,1,0,1);
     grid->addMultiCellWidget(m_listBox, 2, 6, 0, 0);
 
+    d->buttons = 0;
     setButtons( buttons );
 
     connect(m_lineEdit,SIGNAL(textChanged(const QString&)),this,SLOT(typedSomething(const QString&)));

Property changes on: .
___________________________________________________________________
Name: svn:externals
   + admin https://svn.kde.org/home/kde/branches/KDE/3.5/kde-common/admin


