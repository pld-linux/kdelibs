diff -urN -x CVS kdelibs.orig/debian/Packaging.txt kdelibs/debian/Packaging.txt
--- kdelibs.orig/debian/Packaging.txt	Thu Oct 18 20:10:56 2001
+++ kdelibs/debian/Packaging.txt	Fri Jun  4 00:06:50 2004
@@ -21,54 +21,87 @@
 These templates include the bits mentioned in this file.
 
 
-======================
-Debian/KDE Menu System
-======================
-
-When building your package you will most likely end up with a debian/menu
-file for creation of menu entries with the Debian menu system.  There are
-2 customizations  you need to do for KDE specific packages.  The first is
-the use of hints.  If you are unfamiliar with hints you should read up on
-menu and it's features.  For all KDE based apps there needs to be a menu
-tag of hints="KDE".   
-
-   The other customization that is required is simple but it's necessity
-is a bit more complex.  The tag "kderemove" needs to be used to make sure
-there is no duplication in menu entries.  "What for?" you ask...well here's
-why.  For every KDE app there is a corresponding .desktop file under the
-/usr/share/applnk directory tree.  This is either provided by the package 
-itself or created by the maintainer when one doesn't exist.  This file is used
-by the KDE menu system to list the application within the KDE menu.  This
-is how KDE handles it's menus...there must be a .desktop (or .kdelnk) file 
-under /usr/share/applnk in order for it to show up on the KDE menu.  Well
-by default this will only show KDE applications and not any of the other 
-non-KDE apps you have installed on your computer.   So we use the Debian 
-menu package to pull in all of the non-KDE applications.  The kdebase package
-provides it's own menu-method which processes each of the menu items under
-/usr/lib/menu and creates .desktop files under /var/lib/kde/menu.  There
-is a symlink under /usr/share/applnk pointing to /var/lib/kde/menu so that
-all of the .desktop files that are dynamically created by the menu program
-and placed under /var/lib/kde/menu show up under a submenu of the KDE menu.
-So now with every Debian package (including all the KDE packages) a .desktop
-file is created.  In the case of all the KDE packages there is now 2 different
-.desktop files representing the app...one which is part of the actual package
-and one created by the Debian menu system.  One of these entries is in the
-main KDE menu and the other is under the Debian submenu.  You would think this
-isn't a real big problem..however KDE uses these .desktop files to handle
-much more than menu entries.  So we need to make sure we don't have this
-duplication.  The kderemove tag was created for this.  Basically if a menu
-entry has kderemove="1" in it it will not create a .desktop file for that
-application.  
+===============
+KDE Menu System
+===============
+
+With the release of 3.2, KDE adopted the freedesktop.org desktop entry
+specification for its menu system.  This specification is available at
+http://www.freedesktop.org/Standards/desktop-entry-spec.
+
+In versions of KDE prior to 3.2, a program's .desktop file existed in a
+subdirectory of /usr/share/applnk, where the subdirectory name corresponded to
+the desired submenu of the overall KDE menu.
+
+Now, however, a program's menu entry .desktop file should exist in the
+/usr/share/applications/kde directory, and should fully conform to the
+freedesktop.org specification format.  Note that the KDE submenu in which the
+program's entry will appear is now determined by the values given to the
+Categories key in the .desktop file.  A list of suggested categories is
+provided in the draft freedesktop.org menu specification, available at
+http://www.freedesktop.org/Standards/menu-spec.
+
+Up-to-date upstream source should use the freedesktop.org standard location and
+format.  Presently, .desktop files in /usr/share/applnk and its subdirectories
+are still incorporated into the KDE menu, for the sake of backwards
+compatibility.  However, unless backwards compatibility with pre-3.2 KDE
+releases is explicitly desired, a .desktop file under /usr/share/applnk and/or
+one which does not conform to the freedesktop.org format should be considered
+a bug.
+
+Note that with KDE 3.2, the KDE submenu of entries generated from .desktop
+files in /usr/share/applnk, and its subdirectories, is determined by the values
+of the Categories key in the .desktop file, if that key exists.  If it does
+not, then the KDE submenu of the entry will be determined by the name of the
+/usr/share/applnk subdirectory in which the .desktop file resides.
 
-With that said a typical menu file would look like this:
+
+==================
+Debian Menu System
+==================
+
+Though KDE and GNOME have adopted freedesktop.org standards and thus
+can share a common menu, most other desktop environments and window
+managers have not, nor have most non-KDE and non-GNOME applications.
+Thus Debian provides its own menu system (in the package "menu") that
+all DEs and WMs use, making all installed applications consistently
+accessible in all environments without configuration.  A KDE
+application must therefore provide a Debian menu entry, in addition to
+its entry in the native KDE menu system.
+
+The Debian menu is added to by installing a file in /usr/lib/menu with the name
+of the package.  This file contains one or more menu entries describing the one
+or more applications the package provides.
+
+The format of these menu files is described in the Debian menu policy
+document, available at http://www.debian.org/doc/packaging-manuals/menu.html.
+Note that Debian menu entries for KDE applications require the use of the hints
+feature. Specifically, KDE based apps must include the "KDE" hint.  The minimal
+hints line in a the proper menu entry of a KDE application is thus hints="KDE".
+
+A typical menu file would therefore look like this:
 
    ?package(konqueror):\
-        needs=x11\
-        section=Apps/Net\
+        needs="x11"\
+        section="Apps/Net"\
+        icon="/usr/share/pixmaps/konqueror.xpm"\
         hints="KDE,Web browsers"\
-        kderemove="y"\
         title="Konqueror"\
         command="kfmclient openProfile webbrowsing"
+						   
+In Debian, versions of KDE prior to 3.2 broke down the various categories of
+the Debian menu, and interspersed these menu entries throughout the KDE menu,
+in subfolders named "Debian".  To avoid the unnecessary and sometimes
+problematic duplication of entries, the Debian menu files of KDE applications
+contained the special "kderemove" tag, signalling KDE to hide the entries
+of applications which it presumably already had an entry for in the native
+KDE menu.
+
+With KDE 3.2, however, the Debian menu hierarchy is taken intact and placed
+into a single submenu of the KDE menu, named "Debian".  This greater separation
+between the KDE and Debian menus means that duplication is unobtrusive, and
+therefore that the "kderemove" tag is no longer required, and should be
+removed if present.
 
 
 =============
@@ -82,74 +115,78 @@
 be successful things like Build-Depends have to be accurate.  A typical 
 Build-Depends line for a KDE based application will look something like this:
 
-  Build-Depends: debhelper (>> 3.0.0), automake, autoconf, libtool, kdelibs4-dev (>= 3.0-0.alpha1-0)
+  Build-Depends: automake1.8, debhelper (>> 4.2.0), kdelibs4-dev (>= 3.2.0)
 
-Your app may need alot more than that to actually build however first take a
-look at the Dependencies for kdelibs-dev:
+Your app may need a lot more than that to actually build; however, first take a
+look at the Dependencies for kdelibs4-dev:
 
-   Depends: kdelibs3 (= 4:2.1.1-5), libarts-dev (= 4:2.1.1-5), libkmid-dev (= 4:2.1.1-5), libqt-dev (>= 2:2.3.0), libaudiofile-dev, gettext, libtiff3g-dev, jade, sgml-base, docbook, docbook-stylesheets, libpcre3-dev
+    Depends: kdelibs4 (= 4:3.2.1-1), kdelibs-bin (= 4:3.2.1-1), libart-2.0-dev, libarts1-dev (>> 1.2.1), libcupsys2-dev, libfam-dev, libpcre3-dev, libssl-dev, libxml2-utils, libxrender-dev
 
-and the Dependencies for libqt-dev:
-
-   Depends: libc6 (>= 2.2.2-2), libqt2 (>= 2:2.3.0-final-1) | libqt2-gl (>= 2:2.3.0-final-1), libstdc++2.10-glibc2.2, xlibs (>= 4.0.1-11), perl, libqutil1 (= 2:2.3.0-final-2), uic, xlibs-dev, libmng-dev, libpng2-dev, libjpeg62-dev, libz-dev, libfreetype6-dev, libc6-dev
+and the Dependencies for libqt3-mt-dev:
 
+    Depends: xlibs-dev (>= 4.2.1), libmng-dev (>= 1.0.3), libpng12-0-dev, libjpeg62-dev, zlib1g-dev, libfreetype6-dev, libc6-dev, libqt3c102-mt (= 3:3.2.3-2), libqt3-headers (= 3:3.2.3-2), qt3-dev-tools (= 3:3.2.3-2), xlibmesa-gl-dev | libgl-dev, xlibmesa-glu-dev | libglu1-mesa-dev | libglu-dev, libxft-dev, libxrender-dev, libxcursor-dev, libaudio-dev, xlibs-pic
 
 so between the 2 of them you have Build-Depends that equate to:
 
-  kdelibs-dev, libarts-dev, libkmid-dev, libqt-dev, libaudiofile-dev, gettext, libtiff3g-dev | libtiff-dev, jade, sgml-base, docbook, docbook-stylesheets, libpcre3-dev, xlibs-dev, libmng-dev, libpng2-dev, libjpeg62-dev, libz-dev, libfreetype6-dev
+  kdelibs4 (= 4:3.2.1-1), kdelibs-bin (= 4:3.2.1-1), libart-2.0-dev, libarts1-dev (>> 1.2.1), libaudio-dev, libc6-dev, libcupsys2-dev, libfam-dev, libfreetype6-dev, libjpeg62-dev, libmng-dev (>= 1.0.3), libpcre3-dev, libpng12-0-dev, libqt3c102-mt (= 3:3.2.3-2), libqt3-headers (= 3:3.2.3-2), libssl-dev, libxft-dev, libxml2-utils, libxcursor-dev, libxrender-dev, qt3-dev-tools (= 3:3.2.3-2), xlibmesa-gl-dev | libgl-dev, xlibmesa-glu-dev | libglu1-mesa-dev | libglu-dev, xlibs-dev (>= 4.2.1), zlib1g-dev
 
 99% of the time that will more than cover a KDE app.  There will of course
-be specific stuff you'll need to add....for example knetfilter requires iptables
-to be installed in order for it to build...kdemultimedia requires ncurses, 
-slang and other things to build.  Either way you should make sure you get them
-all.
+be specific stuff you'll need to add.  For example, knetfilter requires
+iptables to be installed in order for it to build, while kdemultimedia requires
+ncurses, slang and other things to build.  Either way you should make sure you
+get them all.
+
 
 ===========
 debianrules
 ===========
 
-   If your KDE based app uses the kde-common stuff you'll have a admin/ 
-subdir which if it's recent will contain a debianrules perl script.  The
-current version of it (sitting in /usr/share/doc/kdelibs-dev/dh-make) does very
-little. The biggest job it has is to make sure that all the KDE variables are 
-set properly for build...this includes a configure line.  
-
-   If you place the debianrules script into your debian/ directory (if it 
-doesn't already exist in admin/ or that one is a older version) you can modify
-your debian/rules script to make use of it like so:
-
-
-
-  configure: configure-stamp
- 
-  -include debian/debiandirs
- 
-  debian/debiandirs: debian/debianrules
-          perl -w debian/debianrules echodirs > debian/debiandirs
- 
-  configure-stamp:
-          dh_testdir
-
-          ./configure $(configkde)
-
-
-With this you can see we create a file called debian/debiandirs which contains
-all the variables like kde_htmldir set to the proper Debian settings.  It
-also sets up the configkde variable which currently looks like this:
-
-    configkde=--disable-debug --disable-rpath --prefix=$(kde_prefix) --libexecdir=$(kde_bindir) --with-qt-includes=/usr/include/qt --mandir=$(mandir) --infodir=$(infodir)
+    If your KDE based app uses the kde-common stuff you'll have a admin/
+subdir which if it's recent will contain a debianrules perl script.
+The current version of it does very little.  The biggest job it has is
+to make sure that all the KDE variables are set properly for
+build; this includes a configure line.
+
+With the code in the rules file of the kde dh-make template, you can
+see we create a file called debian/debiandirs which contains all the
+variables like kde_htmldir set to the proper Debian settings.  It also
+sets up the configkde variable which currently looks like this:
 
+    configkde=--disable-debug --disable-rpath --prefix=$(kde_prefix) --sysconfdir=$(sysconfdir) --includedir=$(kde_includedir) --infodir=$(infodir) --mandir=$(mandir) --with-qt-dir=$(qtdir)
 
 You can add your custom configure bits after the $(configkde).  However 9 times
 out of 10 you won't have to do a thing.
 
 
+====
+CDBS
+====
+
+You might also want to consider building your package with the Common
+Debian Build System (CDBS).  This system encapsulates the best-practices
+for packaging in a central system that can be kept up-to-date independent
+of the actual packages.
+
+The simplest way to get started with CDBS is probably to use the
+dh-make template described above, then add cdbs to your Build-Depends
+( versionned to some recent version, like >= 0.4.21 ) and replace the
+generated debian/rules file with something like the following 3 lines:
+
+    #!/usr/bin/make -f
+    include /usr/share/cdbs/1/rules/debhelper.mk
+    include /usr/share/cdbs/1/class/kde.mk
+
+Before you do anything though, you should install the cdbs package and read
+its documentation; especially look in /usr/share/doc/cdbs/examples for some
+more example rules files.
+
+
 ==================
 Missing something?
 ==================
 
 If there's something I'm missing from this document (and I'm sure there is)
-please send mail off to debian-kde@lists.debian.org and I'll get it added
+please send mail off to debian-qt-kde@lists.debian.org and I'll get it added
 for future releases.  I'd like it if this could answer 99% of the questions
 one might have about packaging up a KDE based app for Debian.
 
diff -urN -x CVS kdelibs.orig/debian/README.Debian kdelibs/debian/README.Debian
--- kdelibs.orig/debian/README.Debian	Mon Mar 11 09:23:03 2002
+++ kdelibs/debian/README.Debian	Fri Jun  4 00:06:50 2004
@@ -56,6 +56,18 @@
 of installed programs. Otherwise, you won't get any menus at all, so I do
 recommend you install the menu package.
 
+4. CUPS:
+-------
+It is possible to use cups printers from within kde,
+without running a cupsd from cupsys on every machine.
+to do this: create a ~/.cupsrc or /etc/cups/client.conf.
+
+it could be as short as:
+ServerName servername
+Encryption Never
+
+for a full example, see the client.conf from cupsys.
+
 ---
 
 There used to be two versions of kde.deb : one made by debian, and 
diff -urN -x CVS kdelibs.orig/debian/changelog kdelibs/debian/changelog
--- kdelibs.orig/debian/changelog	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/changelog	Fri Jun  4 00:06:50 2004
@@ -1,3 +1,33 @@
+kdelibs (4:3.2.2-2) unstable; urgency=high
+
+  * kdelibs-data Depends: hicolor-icon-theme. (Closes: #238839)
+  * Remove preinst bashism. (Closes: #242946, #242961, #243475)
+  * Do not remove /etc/kde3/system.kdeglobals. (Closes: #245149)
+  * kdelibs-bin Recommends: menu-xdg.
+
+ -- Christopher L Cheney <ccheney@debian.org>  Wed, 21 Apr 2004 18:00:00 -0500
+
+kdelibs (4:3.2.2-1) unstable; urgency=low
+
+  * New upstream release.
+  * Added CUPS usage information to README.Debian. (Closes: #132587)
+  * Update kdelibs-data Replaces: openoffice.org-mimlnk. (Closes: #233700,
+    #236508)
+  * Correct debian menu replacewith usage. (Closes: #237260, #238769,
+    #239260, #241083, #241420, #242266)
+  * debian/Packaging.txt, debian/dh-make/menu.ex: Removed references to
+    the obsolete kderemove menu tag in kdelibs' documentation.
+  * debian/Packaging.txt, debian/dh-make/menu.ex: Added quotes to the menu
+    file examples.
+  * debian/dh-make/rules, debian/Packaging.txt: updated the information to
+    the state that things currently are in sid.
+  * debian/dh-make/rules, debian/Packaging.txt: Added an example icon entry
+    to the example menu file content.
+  * debian/Packaging.txt: Added a paragraph by Nathaniel W. Turner
+    explaining how to use CDBS for packaging a KDE app.
+
+ -- Christopher L Cheney <ccheney@debian.org>  Mon,  5 Apr 2004 23:00:00 -0500
+
 kdelibs (4:3.2.1-1) unstable; urgency=low
 
   * New upstream release.
diff -urN -x CVS kdelibs.orig/debian/compat kdelibs/debian/compat
--- kdelibs.orig/debian/compat	Thu Jan  1 01:00:00 1970
+++ kdelibs/debian/compat	Fri Jun  4 00:06:50 2004
@@ -0,0 +1 @@
+4
diff -urN -x CVS kdelibs.orig/debian/control kdelibs/debian/control
--- kdelibs.orig/debian/control	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/control	Fri Jun  4 00:06:50 2004
@@ -24,7 +24,7 @@
 Section: libs
 Architecture: any
 Depends: ${shlibs:Depends}, netpbm, python
-Suggests: menu
+Recommends: menu-xdg
 Conflicts: kdelibs-dev (<< 4:3.0.0), kdelibs3-bin (<< 4:3.0.0), kdelibs3-cups (<< 4:3.0.0), libkmid (<< 4:3.0.0), libkmid-alsa (<< 4:3.0.0)
 Replaces: kdelibs-dev (<< 4:3.0.0), kdelibs3-bin (<< 4:3.0.0), kdelibs3-cups (<< 4:3.0.0), konqueror (<< 4:3.2.0), libkmid (<< 4:3.0.0), libkmid-alsa (<< 4:3.0.0)
 Description: KDE core binaries
@@ -41,8 +41,9 @@
 Package: kdelibs-data
 Section: libs
 Architecture: all
+Depends: hicolor-icon-theme
 Conflicts: kdelibs3 (<< 4:3.0.0), kdelibs3-cups (<< 4:3.0.0), kontour (<< 1:1.3.0)
-Replaces: kbabel (<< 4:3.2.0), kchart (<< 1:1.3.0), kdeartwork-style (<< 4:3.0.0), kdelibs3 (<< 4:3.0.0), kdelibs3-cups (<< 4:3.0.0), kformula (<< 1:1.3.0), kivio (<< 1:1.3.0), koffice-data (<< 1:1.3.0-2), koffice-libs (<< 1:1.3.0), kontour (<< 1:1.3.0), kpresenter (<< 1:1.3.0), krusader (<< 1.30-2), kspread (<< 1:1.3.0), kugar (<< 1:1.3.0), kword (<< 1:1.3.0), openoffice.org-mimelnk (<< 1.1.0-7)
+Replaces: kbabel (<< 4:3.2.0), kchart (<< 1:1.3.0), kdeartwork-style (<< 4:3.0.0), kdelibs3 (<< 4:3.0.0), kdelibs3-cups (<< 4:3.0.0), kformula (<< 1:1.3.0), kivio (<< 1:1.3.0), koffice-data (<< 1:1.3.0-2), koffice-libs (<< 1:1.3.0), kontour (<< 1:1.3.0), kpresenter (<< 1:1.3.0), krusader (<< 1.30-2), kspread (<< 1:1.3.0), kugar (<< 1:1.3.0), kword (<< 1:1.3.0), openoffice.org-mimelnk (<< 1.1.1-1)
 Description: KDE core shared data
  KDE is a powerful Open Source graphical desktop environment
  for Unix workstations. It combines ease of use, contemporary
diff -urN -x CVS kdelibs.orig/debian/dh-make/menu.ex kdelibs/debian/dh-make/menu.ex
--- kdelibs.orig/debian/dh-make/menu.ex	Sun Dec  9 13:01:22 2001
+++ kdelibs/debian/dh-make/menu.ex	Fri Jun  4 00:06:51 2004
@@ -1,2 +1,3 @@
-?package(#PACKAGE#):needs=X11|text|vc|wm section=Apps/see-menu-manual\
-  title="#PACKAGE#" hints="KDE" kderemove="y" command="/usr/bin/#PACKAGE#"
+?package(#PACKAGE#):needs="X11|text|vc|wm" section="Apps/see-menu-manual"\
+  title="#PACKAGE#" icon="/usr/share/pixmaps/#PACKAGE#.xpm" hints="KDE"\
+  command="/usr/bin/#PACKAGE#"
diff -urN -x CVS kdelibs.orig/debian/dh-make/rules kdelibs/debian/dh-make/rules
--- kdelibs.orig/debian/dh-make/rules	Thu Jan  2 22:10:29 2003
+++ kdelibs/debian/dh-make/rules	Fri Jun  4 00:06:51 2004
@@ -1,65 +1,44 @@
 #!/usr/bin/make -f
+# -*- makefile -*-
 # Sample debian/rules that uses debhelper.
 # GNU copyright 1997 to 1999 by Joey Hess.
 
 # Uncomment this to turn on verbose mode.
 #export DH_VERBOSE=1
 
-# This is the debhelper compatibility version to use.
-export DH_COMPAT=3
 
-# These are used for cross-compiling and for saving the configure script
-# from having to guess our platform (since we know it already)
-DEB_HOST_GNU_TYPE	?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
-DEB_BUILD_GNU_TYPE	?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
+#DPKG_ARCH#
 
-objdir = $(CURDIR)/obj-$(DEB_BUILD_GNU_TYPE)
+CFLAGS = -Wall -g
 
-ifneq (,$(findstring debug,$(DEB_BUILD_OPTIONS)))
-	CFLAGS += -g
+ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
+	CFLAGS += -O0
+else
+	CFLAGS += -O2
 endif
 ifeq (,$(findstring nostrip,$(DEB_BUILD_OPTIONS)))
 	INSTALL_PROGRAM += -s
 endif
 
-ifeq ($(DEB_BUILD_GNU_TYPE),i386-linux)
-  # Uncomment the following 2 lines to enable i686 optimziation
-  # You may want to tweak the settings to your likings
-  #export CFLAGS=-O3 -march=i686 -ffast-math -finline-functions
-  #export CXXFLAGS=-O3 -march=i686 -ffast-math -finline-functions
-endif
-
-ifeq ($(DEB_BUILD_GNU_TYPE),alpha-linux)
-  export CFLAGS +=-O0 -mieee
-  export CXXFLAGS +=-O0 -mieee
-endif
-
 -include debian/debiandirs
 
-# To be used with kde-style admin subdirectories if desired. debian/debiandirs is included in
-# this template. 
-#debian/debiandirs: admin/debianrules
-#	perl -w admin/debianrules echodirs > debian/debiandirs
-
-configure: configure-stamp
-configure-stamp:
-	dh_testdir
-	# Add here commands to configure the package.
-
- 	# run configure with build tree $(objdir)
-	./configure --host=$(DEB_HOST_GNU_TYPE) --build=$(DEB_BUILD_GNU_TYPE) $(configkde) 
+# To be used with kde-style admin subdirectories if desired.
+debian/debiandirs: admin/debianrules
+	perl -w admin/debianrules echodirs > debian/debiandirs
 
-	touch configure-stamp
+#CONFIGURE#
 
 build: build-stamp
-build-stamp: configure-stamp 
+
+build-stamp: #CONFIGURE_STAMP# #CONFIG_STATUS#
 	dh_testdir
 
 	# Add here commands to compile the package.
 	$(MAKE)
+	#/usr/bin/docbook-to-man debian/#PACKAGE#.sgml > #PACKAGE#.1
 
 	# generate manpages
-	#for i in debian/*.sgml; do \
+	#for i in debian/man/*.sgml; do \
 	#        docbook-to-man $$i > `dirname $$i`/`basename $$i .sgml`.1 ;\
 	#done
 
@@ -68,21 +47,21 @@
 clean:
 	dh_testdir
 	dh_testroot
-	rm -f build-stamp configure-stamp 
+	rm -f build-stamp #CONFIGURE_STAMP#
 
 	# Add here commands to clean up after the build process.
 	-#CLEAN#
 
-	dh_clean 
+	dh_clean #PRESERVE#
 
 install: build
 	dh_testdir
 	dh_testroot
-	dh_clean -k
+	dh_clean -k #PRESERVE#
 	dh_installdirs
 
-	# Add here commands to install the package into debian/#PACKAGE#
-	$(MAKE) install DESTDIR=$(CURDIR)/debian/#PACKAGE#
+	# Add here commands to install the package into debian/#PACKAGE#.
+	#INSTALL#
 
 
 # Build architecture-independent files here.
@@ -93,32 +72,32 @@
 binary-arch: build install
 	dh_testdir
 	dh_testroot
-
-#	dh_installdebconf	
+	dh_installchangelogs #CHANGELOGS#
 	dh_installdocs
 	dh_installexamples
-	dh_installmenu
+#	dh_install
+#	dh_installmenu
+#	dh_installdebconf
 #	dh_installlogrotate
 #	dh_installemacsen
 #	dh_installpam
 #	dh_installmime
 #	dh_installinit
-	dh_installcron
+#	dh_installcron
+#	dh_installinfo
 	dh_installman
-	dh_installinfo
-	dh_undocumented #PACKAGE#.1
-	dh_installchangelogs #CHANGELOGS#
 	dh_link
 	dh_strip
-	dh_compress -X.docbook -X.css -X-license -X.dcl -X.bz2
+	dh_compress -X.bz2 -X.css -X.dcl -X.docbook -X-license -X.tag
 	dh_fixperms
-	dh_makeshlibs
-	dh_installdeb
 #	dh_perl
+#	dh_python
+#	dh_makeshlibs
+	dh_installdeb
 	dh_shlibdeps
 	dh_gencontrol
 	dh_md5sums
 	dh_builddeb
 
 binary: binary-indep binary-arch
-.PHONY: build clean binary-indep binary-arch binary install configure
+.PHONY: build clean binary-indep binary-arch binary install #PHONY_CONFIGURE#
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.install kdelibs/debian/kdelibs-bin.install
--- kdelibs.orig/debian/kdelibs-bin.install	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-bin.install	Fri Jun  4 00:06:50 2004
@@ -1,5 +1,3 @@
-debian/local/freedesktop-desktop-entry-spec-apps        etc/menu-methods/
-debian/local/freedesktop-desktop-entry-spec-dirs        etc/menu-methods/
 debian/tmp/usr/bin/artsmessage
 debian/tmp/usr/bin/cupsdconf
 debian/tmp/usr/bin/cupsdoprint
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.links kdelibs/debian/kdelibs-bin.links
--- kdelibs.orig/debian/kdelibs-bin.links	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-bin.links	Thu Jan  1 01:00:00 1970
@@ -1 +0,0 @@
-/var/lib/kde/debian-menus/debian-menu.menu	/etc/xdg/menus/debian-menu.menu
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.menu-method kdelibs/debian/kdelibs-bin.menu-method
--- kdelibs.orig/debian/kdelibs-bin.menu-method	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-bin.menu-method	Thu Jan  1 01:00:00 1970
@@ -1,51 +0,0 @@
-#!/usr/sbin/install-menu
-# freedesktop menu spec - menu generation
-# http://www.freedesktop.org/Standards/menu-spec
-# Also used as /etc/menu-methods/kdelibs-bin
-# Copyright 2004 - Chris Cheney <ccheney@debian.org>
-# Licensed under the GNU General Public License, version 2.
-
-!include menu.h
-
-compat="menu-2"
-
-function Dirs() =
-	ifempty($section,ifroot(
-	"<AppDir>/var/lib/kde/debian-apps</AppDir>\n"
-	"<DirectoryDir>/var/lib/kde/debian-dirs</DirectoryDir>\n",
-	"<DirectoryDir>"
-	parent(parent(prefix()))
-	"/.local/share/desktop-directories/kde/debian</DirectoryDir>\n"));
-
-function DirEntry() =
-	Dirs()
-	"<Name>" title() "</Name>\n"
-	"<Directory>" "debian" replacewith(tolower($section),"/","-") ".directory" "</Directory>\n"
-	"<Include>\n"
-	"<Category>" "X-Debian" replacewith($section,"/","-") "</Category>\n"
-	"</Include>\n";
-
-outputencoding="UTF-8";
-
-supported;
- x11 = ;
- text = ;
-endsupported;
-
-startmenu = "<Menu>\n" DirEntry();
-endmenu = "</Menu>\n";
-submenutitle = "";
-
-treewalk = "(M)";
-
-genmenu = "debian-menu.menu";
-
-rootsection = "";
-
-prerun = "rm -rf " prefix() "/*";
-
-preoutput = "<!DOCTYPE Menu PUBLIC \"-//freedesktop//DTD Menu 0.8//EN\"\n \"http://www.freedesktop.org/standards/menu-spec/menu-0.8.dtd\">\n<!-- Automatically generated do not edit -->\n";
-
-rootprefix = "/var/lib/kde/debian-menus";
-
-userprefix = ".config/menus";
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.postinst kdelibs/debian/kdelibs-bin.postinst
--- kdelibs.orig/debian/kdelibs-bin.postinst	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-bin.postinst	Thu Jan  1 01:00:00 1970
@@ -1,53 +0,0 @@
-#! /bin/sh
-# postinst script for kdelibs-bin
-#
-# see: dh_installdeb(1)
-
-set -e
-
-# summary of how this script can be called:
-#        * <postinst> `configure' <most-recently-configured-version>
-#        * <old-postinst> `abort-upgrade' <new version>
-#        * <conflictor's-postinst> `abort-remove' `in-favour' <package>
-#          <new-version>
-#        * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
-#          <failed-install-package> <version> `removing'
-#          <conflicting-package> <version>
-# for details, see http://www.debian.org/doc/debian-policy/ or
-# the debian-policy package
-#
-# quoting from the policy:
-#     Any necessary prompting should almost always be confined to the
-#     post-installation script, and should be protected with a conditional
-#     so that unnecessary prompting doesn't happen if a package's
-#     installation fails and the `postinst' is called with `abort-upgrade',
-#     `abort-remove' or `abort-deconfigure'.
-
-desktop_apps=/etc/menu-methods/freedesktop-desktop-entry-spec-apps
-desktop_dirs=/etc/menu-methods/freedesktop-desktop-entry-spec-dirs
-
-case "$1" in
-    configure)
-	if [ -f $desktop_apps ]; then chmod a+x $desktop_apps; fi
-	if [ -f $desktop_dirs ]; then chmod a+x $desktop_dirs; fi
-	if [ -x /usr/bin/update-menus ]; then update-menus; fi
-    ;;
-
-    abort-upgrade|abort-remove|abort-deconfigure)
-
-    ;;
-
-    *)
-        echo "postinst called with unknown argument \`$1'" >&2
-        exit 1
-    ;;
-esac
-
-# dh_installdeb will replace this with shell code automatically
-# generated by other debhelper scripts.
-
-#DEBHELPER#
-
-exit 0
-
-
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.postrm kdelibs/debian/kdelibs-bin.postrm
--- kdelibs.orig/debian/kdelibs-bin.postrm	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-bin.postrm	Thu Jan  1 01:00:00 1970
@@ -1,42 +0,0 @@
-#! /bin/sh
-# postrm script for kdelibs-bin
-#
-# see: dh_installdeb(1)
-
-set -e
-
-# summary of how this script can be called:
-#        * <postrm> `remove'
-#        * <postrm> `purge'
-#        * <old-postrm> `upgrade' <new-version>
-#        * <new-postrm> `failed-upgrade' <old-version>
-#        * <new-postrm> `abort-install'
-#        * <new-postrm> `abort-install' <old-version>
-#        * <new-postrm> `abort-upgrade' <old-version>
-#        * <disappearer's-postrm> `disappear' <r>overwrit>r> <new-version>
-# for details, see http://www.debian.org/doc/debian-policy/ or
-# the debian-policy package
-
-desktop_apps=/etc/menu-methods/freedesktop-desktop-entry-spec-apps
-desktop_dirs=/etc/menu-methods/freedesktop-desktop-entry-spec-dirs
-
-case "$1" in
-    purge|remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
-	if [ -f $desktop_apps ]; then chmod a-x $desktop_apps ; fi
-	if [ -f $desktop_dirs ]; then chmod a-x $desktop_dirs ; fi
-	if [ -x /usr/bin/update-menus ]; then update-menus ; fi
-	rm -rf /var/lib/kde
-    ;;
-
-    *)
-        echo "postrm called with unknown argument \`$1'" >&2
-        exit 1
-    ;;
-esac
-
-# dh_installdeb will replace this with shell code automatically
-# generated by other debhelper scripts.
-
-#DEBHELPER#
-
-exit 0
diff -urN -x CVS kdelibs.orig/debian/kdelibs-bin.preinst kdelibs/debian/kdelibs-bin.preinst
--- kdelibs.orig/debian/kdelibs-bin.preinst	Thu Jan  1 01:00:00 1970
+++ kdelibs/debian/kdelibs-bin.preinst	Fri Jun  4 00:06:50 2004
@@ -0,0 +1,45 @@
+#! /bin/sh
+# preinst script for kdelibs-bin
+#
+# see: dh_installdeb(1)
+
+set -e
+
+# summary of how this script can be called:
+#        * <new-preinst> `install'
+#        * <new-preinst> `install' <old-version>
+#        * <new-preinst> `upgrade' <old-version>
+#        * <old-preinst> `abort-upgrade' <new-version>
+#
+# for details, see http://www.debian.org/doc/debian-policy/ or
+# the debian-policy package
+
+
+case "$1" in
+    install|upgrade)
+        if [ "$1" = "upgrade" ]
+        then
+	    # Debian unstable (Sid) files
+	    rm -f /etc/menu-methods/freedesktop-desktop-entry-spec-apps
+	    rm -f /etc/menu-methods/freedesktop-desktop-entry-spec-dirs
+	    rm -f /etc/menu-methods/kdelibs-bin
+        fi
+    ;;
+
+    abort-upgrade)
+    ;;
+
+    *)
+        echo "preinst called with unknown argument \`$1'" >&2
+        exit 1
+    ;;
+esac
+
+# dh_installdeb will replace this with shell code automatically
+# generated by other debhelper scripts.
+
+#DEBHELPER#
+
+exit 0
+
+
diff -urN -x CVS kdelibs.orig/debian/kdelibs-data.install kdelibs/debian/kdelibs-data.install
--- kdelibs.orig/debian/kdelibs-data.install	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/kdelibs-data.install	Fri Jun  4 00:06:50 2004
@@ -293,6 +293,7 @@
 debian/tmp/usr/share/apps/kio_uiserver/icons/crystalsvg/16x16/apps/kio_uiserver.png
 debian/tmp/usr/share/apps/kjava/kjava.jar
 debian/tmp/usr/share/apps/kjava/kjava.policy
+debian/tmp/usr/share/apps/kjava/pluginsinfo
 debian/tmp/usr/share/apps/knotify/eventsrc
 debian/tmp/usr/share/apps/ksgmltools2/customization/README
 debian/tmp/usr/share/apps/ksgmltools2/customization/af/catalog
@@ -3174,7 +3175,6 @@
 debian/tmp/usr/share/icons/crystalsvg/scalable/mimetypes/wordprocessing.svgz
 debian/tmp/usr/share/icons/crystalsvg/scalable/mimetypes/zip.svgz
 debian/tmp/usr/share/icons/default.kde
-debian/tmp/usr/share/icons/hicolor/index.theme
 debian/tmp/usr/share/locale/all_languages
 debian/tmp/usr/share/mimelnk/all/all.desktop
 debian/tmp/usr/share/mimelnk/all/allfiles.desktop
@@ -3267,11 +3267,9 @@
 debian/tmp/usr/share/mimelnk/application/x-kpovmodeler.desktop
 debian/tmp/usr/share/mimelnk/application/x-kpresenter.desktop
 debian/tmp/usr/share/mimelnk/application/x-krita.desktop
-debian/tmp/usr/share/mimelnk/application/x-kspread-crypt.desktop
 debian/tmp/usr/share/mimelnk/application/x-kspread.desktop
 debian/tmp/usr/share/mimelnk/application/x-kudesigner.desktop
 debian/tmp/usr/share/mimelnk/application/x-kugar.desktop
-debian/tmp/usr/share/mimelnk/application/x-kword-crypt.desktop
 debian/tmp/usr/share/mimelnk/application/x-kword.desktop
 debian/tmp/usr/share/mimelnk/application/x-lha.desktop
 debian/tmp/usr/share/mimelnk/application/x-linguist.desktop
diff -urN -x CVS kdelibs.orig/debian/kdelibs4-dev.install kdelibs/debian/kdelibs4-dev.install
--- kdelibs.orig/debian/kdelibs4-dev.install	Sat Feb 28 00:09:47 2004
+++ kdelibs/debian/kdelibs4-dev.install	Fri Jun  4 00:06:51 2004
@@ -1,4 +1,3 @@
-debian/debiandirs	usr/share/doc/kdelibs4-dev/dh-make/
 debian/dh-make/*	usr/share/doc/kdelibs4-dev/dh-make/
 debian/tmp/usr/bin/checkXML
 debian/tmp/usr/bin/dcopidl
diff -urN -x CVS kdelibs.orig/debian/kdelibs4.preinst kdelibs/debian/kdelibs4.preinst
--- kdelibs.orig/debian/kdelibs4.preinst	Thu Jan  1 01:00:00 1970
+++ kdelibs/debian/kdelibs4.preinst	Fri Jun  4 00:06:51 2004
@@ -0,0 +1,47 @@
+#! /bin/sh
+# preinst script for kdelibs4
+#
+# see: dh_installdeb(1)
+
+set -e
+
+# summary of how this script can be called:
+#        * <new-preinst> `install'
+#        * <new-preinst> `install' <old-version>
+#        * <new-preinst> `upgrade' <old-version>
+#        * <old-preinst> `abort-upgrade' <new-version>
+#
+# for details, see http://www.debian.org/doc/debian-policy/ or
+# the debian-policy package
+
+
+case "$1" in
+    install|upgrade)
+        if [ "$1" = "upgrade" ]
+        then
+	    # Debian 3.0 (Woody) files
+	    rm -f /etc/kderc
+	    rm -f /etc/pam.d/kde
+	    # Debian testing (Sarge) files
+	    #rm -f /etc/kde3/system.kdeglobals
+	    rm -f /etc/kderc
+        fi
+    ;;
+
+    abort-upgrade)
+    ;;
+
+    *)
+        echo "preinst called with unknown argument \`$1'" >&2
+        exit 1
+    ;;
+esac
+
+# dh_installdeb will replace this with shell code automatically
+# generated by other debhelper scripts.
+
+#DEBHELPER#
+
+exit 0
+
+
diff -urN -x CVS kdelibs.orig/debian/local/freedesktop-desktop-entry-spec-apps kdelibs/debian/local/freedesktop-desktop-entry-spec-apps
--- kdelibs.orig/debian/local/freedesktop-desktop-entry-spec-apps	Sat Apr  3 10:11:50 2004
+++ kdelibs/debian/local/freedesktop-desktop-entry-spec-apps	Thu Jan  1 01:00:00 1970
@@ -1,46 +0,0 @@
-#!/usr/sbin/install-menu
-# freedesktop desktop entry spec - applications generation
-# http://www.freedesktop.org/Standards/desktop-entry-spec
-# Copyright 2004 - Chris Cheney
-# Licensed under the GNU General Public License, version 2.
-
-!include menu.h
-
-compat="menu-2"
-
-function AppEntry($terminal) =
-	"[Desktop Entry]\n"
-	"Type=Application\n"
-	"Encoding=UTF-8\n"
-	"Name=" title() "\n"
-	"GenericName=" title() "\n"
-	"Comment=" ifnempty($longtitle,$longtitle) "\n"
-	"Icon=" icon() "\n"
-	"Exec=" $command "\n"
-	"Terminal=" $terminal "\n"
-	"Categories=X-Debian" replacewith($basesection,"/","-") "\n";
-
-outputencoding="UTF-8";
-
-supported;
- x11 = AppEntry("false");
- text = AppEntry("true");
-endsupported;
-
-startmenu = "";
-endmenu = "";
-submenutitle = "";
-
-treewalk = "M";
-
-genmenu = ifnempty($command,tolower(replacewith($title,"/ ","_") ".desktop"));
-
-rootsection = "";
-
-prerun = "rm -rf " prefix() "/*";
-
-preoutput = "";
-
-rootprefix = "/var/lib/kde/debian-apps";
-
-userprefix = ".local/share/applications/kde/debian";
diff -urN -x CVS kdelibs.orig/debian/local/freedesktop-desktop-entry-spec-dirs kdelibs/debian/local/freedesktop-desktop-entry-spec-dirs
--- kdelibs.orig/debian/local/freedesktop-desktop-entry-spec-dirs	Sat Apr  3 10:11:50 2004
+++ kdelibs/debian/local/freedesktop-desktop-entry-spec-dirs	Thu Jan  1 01:00:00 1970
@@ -1,43 +0,0 @@
-#!/usr/sbin/install-menu
-# freedesktop desktop entry spec - directory generation
-# http://www.freedesktop.org/Standards/desktop-entry-spec
-# Copyright 2004 - Chris Cheney
-# Licensed under the GNU General Public License, version 2.
-
-!include menu.h
-
-compat="menu-2"
-
-function DirEntry() =
-	"[Desktop Entry]\n"
-	"Type=Directory\n"
-	"Encoding=UTF-8\n"
-	"Name=" title() "\n"
-	"GenericName=" title() "\n"
-	"Comment=" ifnempty($longtitle,$longtitle) "\n"
-	"Icon=" "debian" replacewith(tolower($section),"/","-") "\n";
-
-outputencoding="UTF-8";
-
-supported;
- x11 = ;
- text = ;
-endsupported;
-
-startmenu = "";
-endmenu = "";
-submenutitle = DirEntry();
-
-treewalk = "M";
-
-genmenu = ifempty($command,tolower("debian" replacewith($section,"/ ","-") ".directory"));
-
-rootsection = "";
-
-prerun = "rm -rf " prefix() "/*";
-
-preoutput = "";
-
-rootprefix = "/var/lib/kde/debian-dirs";
-
-userprefix = ".local/share/desktop-directories/kde/debian";
diff -urN -x CVS kdelibs.orig/debian/local/freedesktop-menu-spec kdelibs/debian/local/freedesktop-menu-spec
--- kdelibs.orig/debian/local/freedesktop-menu-spec	Sat Apr  3 10:11:50 2004
+++ kdelibs/debian/local/freedesktop-menu-spec	Thu Jan  1 01:00:00 1970
@@ -1,51 +0,0 @@
-#!/usr/sbin/install-menu
-# freedesktop menu spec - menu generation
-# http://www.freedesktop.org/Standards/menu-spec
-# Also used as /etc/menu-methods/kdelibs-bin
-# Copyright 2004 - Chris Cheney <ccheney@debian.org>
-# Licensed under the GNU General Public License, version 2.
-
-!include menu.h
-
-compat="menu-2"
-
-function Dirs() =
-	ifempty($section,ifroot(
-	"<AppDir>/var/lib/kde/debian-apps</AppDir>\n"
-	"<DirectoryDir>/var/lib/kde/debian-dirs</DirectoryDir>\n",
-	"<DirectoryDir>"
-	parent(parent(prefix()))
-	"/.local/share/desktop-directories/kde/debian</DirectoryDir>\n"));
-
-function DirEntry() =
-	Dirs()
-	"<Name>" title() "</Name>\n"
-	"<Directory>" "debian" replacewith(tolower($section),"/","-") ".directory" "</Directory>\n"
-	"<Include>\n"
-	"<Category>" "X-Debian" replacewith($section,"/","-") "</Category>\n"
-	"</Include>\n";
-
-outputencoding="UTF-8";
-
-supported;
- x11 = ;
- text = ;
-endsupported;
-
-startmenu = "<Menu>\n" DirEntry();
-endmenu = "</Menu>\n";
-submenutitle = "";
-
-treewalk = "(M)";
-
-genmenu = "debian-menu.menu";
-
-rootsection = "";
-
-prerun = "rm -rf " prefix() "/*";
-
-preoutput = "<!DOCTYPE Menu PUBLIC \"-//freedesktop//DTD Menu 0.8//EN\"\n \"http://www.freedesktop.org/standards/menu-spec/menu-0.8.dtd\">\n<!-- Automatically generated do not edit -->\n";
-
-rootprefix = "/var/lib/kde/debian-menus";
-
-userprefix = ".config/menus";
diff -urN -x CVS kdelibs.orig/debian/rules kdelibs/debian/rules
--- kdelibs.orig/debian/rules	Sat Apr  3 10:11:49 2004
+++ kdelibs/debian/rules	Fri Jun  4 00:06:51 2004
@@ -9,9 +9,6 @@
 # Uncomment this to turn on verbose mode.
 #export DH_VERBOSE=1
 
-# This is the debhelper compatibility version to use.
-export DH_COMPAT=4
-
 # This has to be exported to make some magic below work.
 export DH_OPTIONS
 
@@ -168,7 +165,7 @@
 	cd $(objdir) && \
 	$(MAKE) install DESTDIR=$(CURDIR)/debian/tmp
 
-	dh_install -s --list-missing
+	dh_install -s
 
 install-indep:
 	dh_testdir
@@ -182,7 +179,7 @@
 	cd $(objdir) && \
 	$(MAKE) install-apidox DESTDIR=$(CURDIR)/debian/tmp
 
-	dh_install -i --list-missing
+	dh_install -i
 
 # Must not depend on anything. This is to be called by
 # binary-arch/binary-indep
@@ -193,7 +190,7 @@
 	dh_installchangelogs
 	dh_installdocs
 #	dh_installexamples
-	dh_installmenu
+#	dh_installmenu
 #	dh_installdebconf
 #	dh_installlogrotate
 #	dh_installemacsen
diff -urN -x CVS kdelibs.orig/kate/data/changelog.xml kdelibs/kate/data/changelog.xml
--- kdelibs.orig/kate/data/changelog.xml	Sat Dec  7 21:21:32 2002
+++ kdelibs/kate/data/changelog.xml	Sun Jun  6 15:17:27 2004
@@ -1,21 +1,28 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE language SYSTEM "language.dtd">
-<language name="ChangeLog" version="1.01" kateversion="2.1" section="Other" extensions="ChangeLog" mimetype="">
-        <highlighting>
-          <contexts>
-                <context attribute="Normal Text" lineEndContext="#stay" name="Normal">
-                <RegExpr attribute="Keyword" context="#stay" String="^\d\d\d\d\s*-\s*\d\d\s*-\s*\d\d.*$"/>
-                </context>
-          </contexts>
-          <itemDatas>
-                <itemData name="Normal Text" defStyleNum="dsNormal"/>
-                <itemData name="Keyword" defStyleNum="dsKeyword"/>
-                <itemData name="Identifier" defStyleNum="dsOthers"/>
-                <itemData name="Types" defStyleNum="dsDataType"/>
-                <itemData name="String" defStyleNum="dsString"/>
-                <itemData name="Comment" defStyleNum="dsComment"/>
-          </itemDatas>
-        </highlighting>
+<language name="ChangeLog" version="1.02" kateversion="2.1" section="Other" extensions="ChangeLog" mimetype="" author="Dominik Haumann (dhdev@gmx.de)" license="LGPL">
+  <highlighting>
+    <contexts>
+      <context attribute="Normal Text" lineEndContext="#stay" name="Normal">
+        <RegExpr attribute="Date" context="line" String="^\d\d\d\d\s*-\s*\d\d\s*-\s*\d\d\s*"/>
+        <RegExpr attribute="Entry" context="entry" String="^\s*\*\s+"/>
+      </context>
+      <context attribute="Normal Text" lineEndContext="#pop" name="line">
+        <RegExpr attribute="Name" context="#stay" String="(\w\s*)+"/> 
+        <RegExpr attribute="E-Mail" context="#pop" String="&lt;.*&gt;\s*$"/>
+      </context>
+      <context attribute="Normal Text" lineEndContext="#pop" name="entry">
+        <RegExpr attribute="Entry" context="#pop" String=".*:" minimal="true"/>
+      </context> 
+    </contexts>
+    <itemDatas>
+      <itemData name="Normal Text" defStyleNum="dsNormal"/>
+      <itemData name="Name" defStyleNum="dsKeyword"/>
+      <itemData name="E-Mail" defStyleNum="dsOthers"/>
+      <itemData name="Date" defStyleNum="dsDataType"/>
+      <itemData name="Entry" defStyleNum="dsDecVal"/>
+    </itemDatas>
+  </highlighting>
   <general>
     <keywords casesensitive="1" />
   </general>
diff -urN -x CVS kdelibs.orig/kate/part/kateviewinternal.cpp kdelibs/kate/part/kateviewinternal.cpp
--- kdelibs.orig/kate/part/kateviewinternal.cpp	Sat May 29 12:40:56 2004
+++ kdelibs/kate/part/kateviewinternal.cpp	Tue Jun  1 14:36:56 2004
@@ -161,6 +161,9 @@
   // event filter
   installEventFilter(this);
 
+  // im
+  setInputMethodEnabled(true);
+
   // set cursor
   setCursor( KCursor::ibeamCursor() );
 
diff -urN -x CVS kdelibs.orig/kde.pot kdelibs/kde.pot
--- kdelibs.orig/kde.pot	Sun May 30 10:36:17 2004
+++ kdelibs/kde.pot	Mon Jun  7 10:27:19 2004
@@ -6,7 +6,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"POT-Creation-Date: 2004-05-30 10:36+0200\n"
+"POT-Creation-Date: 2004-06-07 10:27+0200\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
diff -urN -x CVS kdelibs.orig/kdecore/kapplication.cpp kdelibs/kdecore/kapplication.cpp
--- kdelibs.orig/kdecore/kapplication.cpp	Sat May 29 15:42:37 2004
+++ kdelibs/kdecore/kapplication.cpp	Sun May 30 20:50:38 2004
@@ -18,7 +18,7 @@
     Boston, MA 02111-1307, USA.
         */
 
-// $Id$
+// $Id$
 
 #include "config.h"
 
@@ -726,7 +726,7 @@
 
       atoms[n] = &kde_net_wm_user_time;
       names[n++] = (char *) "_NET_WM_USER_TIME";
-      
+
       atoms[n] = &kde_xdnd_drop;
       names[n++] = (char *) "XdndDrop";
 
@@ -1584,7 +1584,7 @@
                     && _event->xclient.data.l[ 4 ] == 0
                     && _event->xclient.data.l[ 3 ] != 0 )
                     {
-                    if( qt_x_user_time == 0 
+                    if( qt_x_user_time == 0
                         || ( _event->xclient.data.l[ 3 ] - qt_x_user_time ) < 100000U )
                         { // and the timestamp looks reasonable
                         qt_x_user_time = _event->xclient.data.l[ 3 ]; // update our qt_x_user_time from it
@@ -2244,7 +2244,7 @@
 {
    QString error;
 
-   if (startServiceByDesktopName("kfmclient", url, &error, 0, 0, startup_id, true))
+   if (startServiceByDesktopName("kfmclient", url, &error, 0, 0, startup_id, false))
    {
       kdWarning() << "Could not launch browser:\n" << error << endl;
       return;
@@ -2786,7 +2786,7 @@
 {
   if (authorizeURLAction(action, _baseURL, _destURL))
      return;
-     
+
   d->urlActionRestrictions.append(new KApplicationPrivate::URLActionRule
         ( action, _baseURL.protocol(), _baseURL.host(), _baseURL.path(-1),
                   _destURL.protocol(), _destURL.host(), _destURL.path(-1), true));
diff -urN -x CVS kdelibs.orig/kdecore/kmacroexpander.cpp kdelibs/kdecore/kmacroexpander.cpp
--- kdelibs.orig/kdecore/kmacroexpander.cpp	Wed Mar 26 17:43:44 2003
+++ kdelibs/kdecore/kmacroexpander.cpp	Tue Jun  1 03:53:53 2004
@@ -401,7 +401,9 @@
     uint sl, rsl, rpos;
     if (str[pos + 1] == '{') {
         rpos = pos + 2;
-        for (sl = 0; str[rpos + sl] != '}'; sl++);
+        for (sl = 0; str[rpos + sl] != '}'; sl++)
+            if (rpos + sl >= str.length())
+                return 0;
         rsl = sl + 3;
     } else {
         rpos = pos + 1;
diff -urN -x CVS kdelibs.orig/kded/vfolder_menu.cpp kdelibs/kded/vfolder_menu.cpp
--- kdelibs.orig/kded/vfolder_menu.cpp	Mon May  3 10:33:29 2004
+++ kdelibs/kded/vfolder_menu.cpp	Tue Jun  1 13:23:24 2004
@@ -661,7 +661,12 @@
 {
    m_docInfoStack.push(m_docInfo);
    if (!baseDir.isEmpty())
-      m_docInfo.baseDir = baseDir;
+   {
+      if (baseDir.startsWith("/"))
+         m_docInfo.baseDir = KGlobal::dirs()->relativeLocation("xdgconf-menu", baseDir);
+      else
+         m_docInfo.baseDir = baseDir;
+   }
 
    QString baseName = fileName;
    if (baseName.startsWith("/"))
diff -urN -x CVS kdelibs.orig/kdeui/kmainwindow.cpp kdelibs/kdeui/kmainwindow.cpp
--- kdelibs.orig/kdeui/kmainwindow.cpp	Mon Jan 12 17:20:22 2004
+++ kdelibs/kdeui/kmainwindow.cpp	Thu Jun  3 01:31:25 2004
@@ -862,6 +862,8 @@
         // restore the size
         int scnum = QApplication::desktop()->screenNumber(parentWidget());
         QRect desk = QApplication::desktop()->screenGeometry(scnum);
+        if ( d->defaultWindowSize.isNull() ) // only once
+          d->defaultWindowSize = QRect(desk.width(), width(), desk.height(), height()); // store default values
         QSize size( config->readNumEntry( QString::fromLatin1("Width %1").arg(desk.width()), 0 ),
                     config->readNumEntry( QString::fromLatin1("Height %1").arg(desk.height()), 0 ) );
         if (size.isEmpty()) {
@@ -937,10 +939,6 @@
     connect( this, SIGNAL( dockWindowPositionChanged( QDockWindow * ) ),
              this, SLOT( setSettingsDirty() ) );
 
-    // Get default values
-    int scnum = QApplication::desktop()->screenNumber(parentWidget());
-    QRect desk = QApplication::desktop()->screenGeometry(scnum);
-    d->defaultWindowSize = QRect(desk.width(), width(), desk.height(), height());
     // Now read the previously saved settings
     applyMainWindowSettings( KGlobal::config(), groupName );
 }
diff -urN -x CVS kdelibs.orig/kdeui/ktabwidget.cpp kdelibs/kdeui/ktabwidget.cpp
--- kdelibs.orig/kdeui/ktabwidget.cpp	Thu Oct  9 00:10:45 2003
+++ kdelibs/kdeui/ktabwidget.cpp	Sat Jun  5 22:45:15 2004
@@ -167,12 +167,14 @@
     QPoint point( p );
     QSize size( tabBar()->sizeHint() );
     if ( ( tabPosition()==Top && point.y()< size.height() ) || ( tabPosition()==Bottom && point.y()>(height()-size.height() ) ) ) {
-#if QT_VERSION >= 0x030200
 	// QTabWidget::cornerWidget isn't const even it doesn't write any data ;(
 	KTabWidget *that = const_cast<KTabWidget*>(this);
-        if ( that->cornerWidget( TopLeft ) )
+        QWidget *leftcorner = that->cornerWidget( TopLeft );
+        if ( leftcorner ) {
+            if ( point.x()<=leftcorner->width() )
+                return true;
             point.setX( point.x()-size.height() );
-#endif
+        }
 	if ( tabPosition()==Bottom )
             point.setY( point.y()-( height()-size.height() ) );
         QTab *tab = tabBar()->selectTab( point);
diff -urN -x CVS kdelibs.orig/kdeui/ktoolbar.cpp kdelibs/kdeui/ktoolbar.cpp
--- kdelibs.orig/kdeui/ktoolbar.cpp	Tue May 25 15:37:16 2004
+++ kdelibs/kdeui/ktoolbar.cpp	Tue Jun  1 18:46:01 2004
@@ -1689,7 +1689,7 @@
     applyAppearanceSettings( config, configGroup );
 
     // ...and now the position stuff
-    if ( config->hasGroup(configGroup) )
+//    if ( config->hasGroup(configGroup) )
     {
         KConfigGroupSaver cgs(config, configGroup);
 
diff -urN -x CVS kdelibs.orig/khtml/khtml_part.cpp kdelibs/khtml/khtml_part.cpp
--- kdelibs.orig/khtml/khtml_part.cpp	Mon May 10 18:40:50 2004
+++ kdelibs/khtml/khtml_part.cpp	Thu Jun  3 20:08:51 2004
@@ -1226,6 +1226,7 @@
 
   d->m_delayRedirect = 0;
   d->m_redirectURL = QString::null;
+  d->m_redirectionTimer.stop();
   d->m_redirectLockHistory = true;
   d->m_bClearing = false;
   d->m_frameNameId = 1;
diff -urN -x CVS kdelibs.orig/kio/kio/job.cpp kdelibs/kio/kio/job.cpp
--- kdelibs.orig/kio/kio/job.cpp	Mon May 10 20:11:34 2004
+++ kdelibs/kio/kio/job.cpp	Fri Jun  4 14:52:33 2004
@@ -2595,6 +2595,7 @@
         if ( m_bAutoSkip )
         {
             skip( (*it).uSource );
+            m_fileProcessedSize = (*it).size;
             files.remove( it ); // Move on to next file
         }
         else
@@ -2621,6 +2622,7 @@
                 {
                     // Very special case, see a few lines below
                     // We are deleting the source of a symlink we successfully moved... ignore error
+                    m_fileProcessedSize = (*it).size;
                     files.remove( it );
                 } else {
                     // Go directly to the conflict resolution, there is nothing to stat
@@ -2767,6 +2769,7 @@
         case R_SKIP:
             // Move on to next file
             skip( (*it).uSource );
+            m_processedSize += (*it).size;
             files.remove( it );
             m_processedFiles++;
             break;
diff -urN -x CVS kdelibs.orig/kio/kssl/ksslcertificatehome.cc kdelibs/kio/kssl/ksslcertificatehome.cc
--- kdelibs.orig/kio/kssl/ksslcertificatehome.cc	Fri Feb 28 01:33:58 2003
+++ kdelibs/kio/kssl/ksslcertificatehome.cc	Sun Jun  6 17:33:31 2004
@@ -71,8 +71,8 @@
 
 
 // KDE 4: make it const QString &
-void KSSLCertificateHome::addCertificate(KSSLPKCS12 *cert, QString passToStore) {
-   if (!cert) return;
+bool KSSLCertificateHome::addCertificate(KSSLPKCS12 *cert, QString passToStore) {
+   if (!cert) return false;
 
 KSimpleConfig cfg("ksslcertificates", false);
 
@@ -80,8 +80,36 @@
    cfg.writeEntry("PKCS12Base64", cert->toString());
    cfg.writeEntry("Password", passToStore);
    cfg.sync();
+return true;
 }
 
+bool KSSLCertificateHome::deleteCertificate(const QString &filename, const QString &password) {
+KSSLPKCS12 *pkcs = KSSLPKCS12::loadCertFile(filename, password);
+
+   if (!pkcs) return false;
+
+   bool ok = deleteCertificate(pkcs);
+   delete pkcs;
+
+return ok;
+}
+
+bool KSSLCertificateHome::deleteCertificate(KSSLPKCS12 *cert) {
+   if (!cert) return false;
+   
+   return deleteCertificateByName(cert->name());
+}
+
+bool KSSLCertificateHome::deleteCertificateByName(const QString &name) {
+   if (name.isEmpty()) return false;
+
+KSimpleConfig cfg("ksslcertificates", false);
+
+   bool ok = cfg.deleteGroup(name);
+   cfg.sync();
+
+return ok;
+}
 
 // KDE 4: make it const QString &
 KSSLPKCS12* KSSLCertificateHome::getCertificateByName(QString name, QString password) {
diff -urN -x CVS kdelibs.orig/kio/kssl/ksslcertificatehome.h kdelibs/kio/kssl/ksslcertificatehome.h
--- kdelibs.orig/kio/kssl/ksslcertificatehome.h	Tue Feb 18 15:52:28 2003
+++ kdelibs/kio/kssl/ksslcertificatehome.h	Sun Jun  6 17:33:31 2004
@@ -65,7 +65,15 @@
 	 *   Returns: true on success, false error
 	 */
 	static bool addCertificate(QString filename, QString password, bool storePass = false);
-	static void addCertificate(KSSLPKCS12 *cert, QString passToStore = "");
+	static bool addCertificate(KSSLPKCS12 *cert, QString passToStore = QString::null);
+
+	/*
+	 *   These deletes a certificate from the repository.
+	 *   Returns: true on success, false error
+	 */
+	static bool deleteCertificate(const QString &filename, const QString &password);
+	static bool deleteCertificate(KSSLPKCS12 *cert);
+	static bool deleteCertificateByName(const QString &name);
  
 	/*
 	 *   Returns the list of certificates available
diff -urN -x CVS kdelibs.orig/kio/misc/kssld/Makefile.am kdelibs/kio/misc/kssld/Makefile.am
--- kdelibs.orig/kio/misc/kssld/Makefile.am	Tue Dec 10 10:45:40 2002
+++ kdelibs/kio/misc/kssld/Makefile.am	Sun Jun  6 17:33:30 2004
@@ -21,7 +21,7 @@
 kde_module_LTLIBRARIES = kded_kssld.la
 
 kded_kssld_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_kssld_la_LIBADD = $(LIB_KIO)
+kded_kssld_la_LIBADD = $(LIB_KIO) $(top_builddir)/kio/kssl/libkssl.la
 kded_kssld_la_SOURCES = kssld.cpp kssld.skel
 
 METASOURCES = AUTO
diff -urN -x CVS kdelibs.orig/kio/misc/kssld/kssld.cpp kdelibs/kio/misc/kssld/kssld.cpp
--- kdelibs.orig/kio/misc/kssld/kssld.cpp	Sat Jan 24 22:21:22 2004
+++ kdelibs/kio/misc/kssld/kssld.cpp	Sun Jun  6 17:33:30 2004
@@ -31,6 +31,8 @@
 #include <ksimpleconfig.h>
 #include <ksslcertchain.h>
 #include <ksslcertificate.h>
+#include <ksslcertificatehome.h>
+#include <ksslpkcs12.h>
 #include <ksslx509map.h>
 #include <qptrlist.h>
 #include <sys/types.h>
@@ -97,7 +99,7 @@
 				policy = KSSLCertificateCache::Unknown; 
 				permanent = true;
 			}
-		~KSSLCNode() { if (cert) delete cert; }
+		~KSSLCNode() { delete cert; }
 };
 
 
@@ -203,7 +205,7 @@
 		n->permanent = cfg->readBoolEntry("Permanent");
 		n->expires = cfg->readDateTimeEntry("Expires");
 		n->hosts = cfg->readListEntry("Hosts");
-		newCert->chain().setChain(cfg->readListEntry("Chain"));
+		newCert->chain().setCertChain(cfg->readListEntry("Chain"));
 		certList.append(n); 
 		searchAddCert(newCert);
 	}
@@ -635,6 +637,78 @@
 }
 
 
+/**
+  * @internal
+  * Returns a list of certificates as QStrings read from the given file
+  */
+static QStringList caReadCerticatesFromFile(QString filename) {
+
+	QStringList certificates;
+	QString certificate, temp;
+	QFile file(filename);
+
+	if (!file.open(IO_ReadOnly))
+		return certificates;
+
+	while (!file.atEnd()) {
+		file.readLine(temp, 999);
+		if (temp.startsWith("-----BEGIN CERTIFICATE-----")) {
+			certificate = QString::null;
+			continue;
+		}
+
+		if (temp.startsWith("-----END CERTIFICATE-----")) {
+			certificates.append(certificate);
+			certificate = QString::null;
+			continue;
+		}
+
+		certificate += temp.stripWhiteSpace();
+	}
+
+	file.close();
+
+	return certificates;
+}
+
+bool KSSLD::caAddFromFile(QString filename, bool ssl, bool email, bool code) {
+
+	QStringList certificates;
+	certificates = caReadCerticatesFromFile(filename);
+	if (certificates.isEmpty())
+		return false;
+
+	bool ok = true;
+
+	for (QStringList::Iterator it = certificates.begin();
+					it != certificates.end(); ++it ) {
+		ok &= caAdd(*it, ssl, email, code);
+	}
+
+	return ok;
+}
+
+bool KSSLD::caRemoveFromFile(QString filename) {
+
+	QStringList certificates;
+	certificates = caReadCerticatesFromFile(filename);
+	if (certificates.isEmpty())
+		return false;
+
+	bool ok = true;
+
+	for (QStringList::Iterator it = certificates.begin();
+					it != certificates.end(); ++it ) {
+		QString certificate = *it;
+		KSSLCertificate *x = KSSLCertificate::fromString(certificate.local8Bit());
+		ok &= x && caRemove(x->getSubject());
+		delete x;
+	}
+
+	return ok;
+}
+
+
 QStringList KSSLD::caList() {
 QStringList x;
 KConfig cfg("ksslcalist", true, false);
@@ -810,7 +884,41 @@
 
 ///////////////////////////////////////////////////////////////////////////
 
+//
+//  Certificate Home methods
+//
+
+QStringList KSSLD::getHomeCertificateList() {
+	return KSSLCertificateHome::getCertificateList();
+}
 
+bool KSSLD::addHomeCertificateFile(QString filename, QString password, bool storePass) {
+	return KSSLCertificateHome::addCertificate(filename, password, storePass);
+}
+
+bool KSSLD::addHomeCertificatePKCS12(QString base64cert, QString passToStore) {
+	bool ok;
+	KSSLPKCS12 *pkcs12 = KSSLPKCS12::fromString(base64cert, passToStore);
+	ok = KSSLCertificateHome::addCertificate(pkcs12, passToStore);
+	delete pkcs12;
+	return ok;
+}
+
+bool KSSLD::deleteHomeCertificateByFile(QString filename, QString password) {
+	return KSSLCertificateHome::deleteCertificate(filename, password);
+}
+
+bool KSSLD::deleteHomeCertificateByPKCS12(QString base64cert, QString password) {
+	bool ok;
+	KSSLPKCS12 *pkcs12 = KSSLPKCS12::fromString(base64cert, password);
+	ok = KSSLCertificateHome::deleteCertificate(pkcs12);
+	delete pkcs12;
+	return ok;
+}
+
+bool KSSLD::deleteHomeCertificateByName(QString name) {
+	return KSSLCertificateHome::deleteCertificateByName(name);
+}
 
 
 
diff -urN -x CVS kdelibs.orig/kio/misc/kssld/kssld.h kdelibs/kio/misc/kssld/kssld.h
--- kdelibs.orig/kio/misc/kssld/kssld.h	Sat Jan 24 22:21:22 2004
+++ kdelibs/kio/misc/kssld/kssld.h	Sun Jun  6 17:33:30 2004
@@ -99,8 +99,12 @@
 
   bool caAdd(QString certificate, bool ssl, bool email, bool code);
 
+  bool caAddFromFile(QString filename, bool ssl, bool email, bool code);
+
   bool caRemove(QString subject);
 
+  bool caRemoveFromFile(QString filename);
+
   QString caGetCert(QString subject);
 
   bool caSetUse(QString subject, bool ssl, bool email, bool code);
@@ -113,6 +117,18 @@
   //  Certificate Home methods
   //
 
+  QStringList getHomeCertificateList();
+
+  bool addHomeCertificateFile(QString filename, QString password, bool storePass /*=false*/);
+
+  bool addHomeCertificatePKCS12(QString base64cert, QString passToStore);
+
+  bool deleteHomeCertificateByFile(QString filename, QString password);
+
+  bool deleteHomeCertificateByPKCS12(QString base64cert, QString password);
+
+  bool deleteHomeCertificateByName(QString name);
+
 private:
 
   void cacheClearList();
