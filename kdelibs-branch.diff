Index: interfaces/kscript/sample/shellscript.desktop
===================================================================
--- interfaces/kscript/sample/shellscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ interfaces/kscript/sample/shellscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -46,7 +46,7 @@
 Name[ro]=Executor scripturi de interpretor
 Name[ru]=–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ bash
 Name[rw]=Mutangiza Gaporogaramu Bash Shell
-Name[se]=Sk√°l≈æu skripta
+Name[se]=Sk√°l≈æu-skriptavuodji
 Name[sk]=Spustenie Bash shell skriptu
 Name[sl]=Zaganjalnik lupinski skriptov
 Name[sq]=Egzekutuesi i skriptave t√´ Guac√´s Bash
Index: kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop
===================================================================
--- kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kate/plugins/wordcompletion/ktexteditor_docwordcompletion.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -43,7 +43,7 @@
 Name[ro]=Modul completare cuvinte pentru KTextEditor
 Name[ru]=–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–≤ KTextEditor
 Name[rw]=Icomeka ry'Iyuzuza Jambo rya KMuhinduziUmwandiko
-Name[se]=KTextEditor:a s√°tneolla≈°uhttin lassemoduvla
+Name[se]=KTextEditor:a s√°tneolla≈°uhttinlassemoduvla
 Name[sk]=Modul pre doplnenie slov pre KTextEditor
 Name[sl]=Vstavek KTextEditor za dopolnjevanje besed
 Name[sr]=KTextEditor –ø—Ä–∏–∫—ô—É—á–∞–∫ –∑–∞ –¥–æ–≤—Ä—à–∞–≤–∞—ö–µ —Ä–µ—á–∏
Index: kate/part/kateviewinternal.cpp
===================================================================
--- kate/part/kateviewinternal.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kate/part/kateviewinternal.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -2682,8 +2682,6 @@
           selStartCached = m_view->selectStart;
           selEndCached = m_view->selectEnd;
 
-          cursor.setCol(0);
-          updateCursor( cursor, true );
           e->accept ();
           return;
         }
@@ -2746,6 +2744,11 @@
         selectAnchor = KateTextCursor (m_view->selEndLine(), m_view->selEndCol());
         selStartCached = m_view->selectStart;
         selEndCached = m_view->selectEnd;
+
+        // if we didn't actually select anything, restore the selection mode
+        // -- see bug #131369 (kling)
+        if (!m_view->hasSelection())
+          m_selectionMode = Default;
       }
 
       // Move cursor to end of selected word
@@ -2755,9 +2758,6 @@
         m_view->copy();
         QApplication::clipboard()->setSelectionMode( false );
 
-        cursor.setPos(m_view->selectEnd);
-        updateCursor( cursor, true );
-
         selStartCached = m_view->selectStart;
         selEndCached = m_view->selectEnd;
       }
Index: kate/part/kateautoindent.cpp
===================================================================
--- kate/part/kateautoindent.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kate/part/kateautoindent.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -553,7 +553,8 @@
     bool insideDoxygen = false;
     if (textLine->attribute(first) == doxyCommentAttrib || textLine->attribute(textLine->lastChar()) == doxyCommentAttrib)
     {
-      if (!textLine->stringAtPos(textLine->lastChar()-1, "*/"))
+      const int last = textLine->lastChar();
+      if (last <= 0 || !textLine->stringAtPos(last-1, "*/"))
         insideDoxygen = true;
       while (textLine->attribute(first) != doxyCommentAttrib && first <= textLine->lastChar())
         first++;
@@ -1494,7 +1495,7 @@
   bool doxygenAutoInsert = doc->config()->configFlags() & KateDocumentConfig::cfDoxygenAutoTyping;
 
   // starts with *: indent one space more to line up *s
-  if ( textLine->stringAtPos(first, "*") )
+  if ( first >= 0 && textLine->stringAtPos(first, "*") )
     indent = indent + " ";
   // does not start with *: insert one if user wants that
   else if ( doxygenAutoInsert )
Index: kate/data/cpp.xml
===================================================================
--- kate/data/cpp.xml	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kate/data/cpp.xml	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE language SYSTEM "language.dtd">
-<language name="C++" version="1.36" kateversion="2.4" section="Sources" extensions="*.c++;*.cxx;*.cpp;*.cc;*.C;*.h;*.H;*.h++;*.hxx;*.hpp;*.hcc;*.moc" mimetype="text/x-c++src;text/x-c++hdr;text/x-chdr" priority="9">
+<language name="C++" version="1.37" kateversion="2.4" section="Sources" extensions="*.c++;*.cxx;*.cpp;*.cc;*.C;*.h;*.H;*.h++;*.hxx;*.hpp;*.hcc;*.moc" mimetype="text/x-c++src;text/x-c++hdr;text/x-chdr" priority="9">
   <highlighting>
     <list name="keywords">
       <item> asm </item>
@@ -88,6 +88,7 @@
       <item> Q_CLEANUP_RESOURCE </item>
       <item> Q_GLOBAL_STATIC </item>
       <item> Q_GLOBAL_STATIC_WITH_ARGS </item>
+      <item> Q_DECLARE_INTERFACE </item>
       <item> Q_DECLARE_TYPEINFO </item>
       <item> Q_DECLARE_SHARED </item>
       <item> Q_DECLARE_FLAGS </item>
Index: kdefx/kcpuinfo.cpp
===================================================================
--- kdefx/kcpuinfo.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdefx/kcpuinfo.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -35,14 +35,6 @@
 #  define HAVE_GNU_INLINE_ASM
 #endif
 
-
-// Copied from kdecore/kdemacros.h
-#if __GNUC__ - 0 > 3 || (__GNUC__ - 0 == 3 && __GNUC_MINOR__ - 0 > 4)
-#  define KDE_NO_EXPORT __attribute__ ((visibility("hidden")))
-#else
-#  define KDE_NO_EXPORT
-#endif
-
 typedef void (*kde_sighandler_t) (int);
 
 #ifdef __i386__
@@ -72,7 +64,7 @@
 
 static int getCpuFeatures()
 {
-    int features = 0;
+    volatile int features = 0;
 
 #if defined( HAVE_GNU_INLINE_ASM )
 #if defined( __i386__ )
Index: mimetypes/image/x-raw.desktop
===================================================================
--- mimetypes/image/x-raw.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/image/x-raw.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -27,12 +27,16 @@
 Comment[lt]=RAW foto atvaizdas
 Comment[mk]=RAW-—Å–ª–∏–∫–∞ –æ–¥ –∫–∞–º–µ—Ä–∞
 Comment[ms]=Imej Kamera RAW
+Comment[nb]=RAW-kamerabilde
 Comment[nds]=Kamerbild in RAW-Formaat
 Comment[nl]=RAW-camera-afbeelding
+Comment[nn]=RAW-kamerabilete
 Comment[pl]=Obrazek w formacie RAW
 Comment[pt]=Imagem RAW da M√°quina Fotogr√°fica
 Comment[pt_BR]=Imagem RAW da M√°quina Fotogr√°fica
 Comment[ro]=Imagine foto brutƒÉ
+Comment[ru]=–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç–∞
+Comment[se]=RAW-govvenappar√°httagovva
 Comment[sk]=RAW fotografick√Ω obr√°zok
 Comment[sl]=Slika RAW s fotoaparata
 Comment[sr]=–°–∏—Ä–æ–≤–∞ —Å–ª–∏–∫–∞ —Å–∞ –∫–∞–º–µ—Ä–µ
Index: mimetypes/application/x-mplayer2.desktop
===================================================================
--- mimetypes/application/x-mplayer2.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/x-mplayer2.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -7,18 +7,28 @@
 Icon=multimedia
 X-KDE-AutoEmbed=true
 Comment=Microsoft Media Format
+Comment[ca]=Format Microsoft Media
+Comment[cs]=Microsoft Media form√°t
 Comment[da]=Microsoft medieformat
 Comment[de]=Microsoft-Media-Format
+Comment[el]=Œ§œçœÄŒøœÇ Microsoft Media
 Comment[es]=Formator de medios de Microsoft
 Comment[et]=Microsoft Media
 Comment[fr]=Format Microsoft Media
+Comment[hr]=Microsoft Media oblik
 Comment[hu]=Microsoft Media-f√°jl
+Comment[it]=Formato Microsoft Media
 Comment[ja]=Microsoft „É°„Éá„Ç£„Ç¢„Éï„Ç©„Éº„Éû„ÉÉ„Éà
+Comment[km]=·ûë·üí·ûö·ûÑ·üã·ûë·üí·ûö·û∂·ûô Microsoft ·ûò·üÅ·ûå·üÄ
 Comment[nds]=Microsoft-Medienformaat
 Comment[nl]=Microsoft mediaformaat
+Comment[nn]=Microsoft Media-format
+Comment[pl]=Format Microsoft Media
 Comment[pt]=Formato Multim√©dia da Microsoft
 Comment[pt_BR]=Formato Multim√©dia da Microsoft
+Comment[ro]=Format media Microsoft
 Comment[sk]=Microsoft Media form√°t
+Comment[sl]=Microsoftov medijski format
 Comment[sr]=Microsoft-–æ–≤ –º–µ–¥–∏—ò—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç
 Comment[sr@Latn]=Microsoft-ov medijski format
 Comment[sv]=Microsoft media-format
Index: mimetypes/application/x-trash.desktop
===================================================================
--- mimetypes/application/x-trash.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/x-trash.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -56,7 +56,7 @@
 Comment[ro]=Fi≈üier de rezervƒÉ
 Comment[ru]=–§–∞–π–ª –∑–∞–ø–∞—Å–Ω–æ–π –∫–æ–ø–∏–∏
 Comment[rw]=Idosiye y'Ingoboka
-Comment[se]=Liigekopiija
+Comment[se]=Liigem√°≈ãgus
 Comment[sk]=Z√°lo≈æn√Ω s√∫bor
 Comment[sl]=Rezervna datoteka
 Comment[sq]=Sked√´ Rezerv√´
Index: mimetypes/application/x-java-applet.desktop
===================================================================
--- mimetypes/application/x-java-applet.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/x-java-applet.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -38,6 +38,7 @@
 Comment[mk]=Java-–∞–ø–ª–µ—Ç
 Comment[mn]=Java-–ê–ø–ø–ª–µ—Ç
 Comment[ms]=Aplet Java
+Comment[nb]=Java-miniprogram
 Comment[nds]=Java-Programm
 Comment[nn]=Java-miniprogram
 Comment[pa]=‡®ú‡®æ‡®µ‡®æ(Java) ‡®ê‡®™‡®≤‡®ø‡®ü
Index: mimetypes/application/x-desktop.desktop
===================================================================
--- mimetypes/application/x-desktop.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/x-desktop.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -40,7 +40,7 @@
 Comment[mn]=–ê–∂–∏–ª—ã–Ω —Ç–∞–ª–±–∞—Ä—ã–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ
 Comment[ms]=Fail Config Ruang Kerja
 Comment[mt]=Fajl konfigurazzjoni desktop
-Comment[nb]=Konfigurasjonsfil til skrivebord
+Comment[nb]=Oppsettsfil til skrivebord
 Comment[nds]=Instellen-Datei
 Comment[nl]=Configuratiegegevens
 Comment[nn]=Skrivebordsoppsett-fil
Index: mimetypes/application/x-shellscript.desktop
===================================================================
--- mimetypes/application/x-shellscript.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/x-shellscript.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -53,7 +53,7 @@
 Comment[ro]=Script de interpretor
 Comment[ru]=–°–∫—Ä–∏–ø—Ç shell
 Comment[rw]=Shell Iyandika
-Comment[se]=Sk√°l3/43/4u skripta
+Comment[se]=Sk√°l≈æu-skripta
 Comment[sk]=Shellovsk√Ω skript
 Comment[sl]=Lupinski skript
 Comment[sq]=Skript Guacor
Index: mimetypes/application/mbox.desktop
===================================================================
--- mimetypes/application/mbox.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ mimetypes/application/mbox.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -31,11 +31,13 @@
 Comment[nb]=Mbox e-postmappe
 Comment[nds]=Mbox-Nettpostorner
 Comment[nl]=MBOX-postvakmap
+Comment[nn]=MBOX-e-postmappe
 Comment[pl]=Folder poczty w formacie MBOX
 Comment[pt]=Pasta de Correio MBOX
 Comment[pt_BR]=Pasta de Correio MBOX
 Comment[ro]=Folder de mail MBOX
 Comment[ru]=–ü–æ—á—Ç–æ–≤–∞—è –ø–∞–ø–∫–∞ MBOX
+Comment[se]=MBOX-boastam√°hppa
 Comment[sk]=MBOX po≈°tov√Ω prieƒçinok
 Comment[sl]=Mapa za po≈°to MBOX
 Comment[sr]=MBOX —Ñ–∞—Å—Ü–∏–∫–ª–∞ –ø–æ—à—Ç–µ
Index: kimgio/psd.kimgio
===================================================================
--- kimgio/psd.kimgio	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kimgio/psd.kimgio	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -39,6 +39,7 @@
 Name[pt_BR]=Imagem do Adobe Photoshop
 Name[ro]=Imagine Adobe Photoshop
 Name[ru]=–†–∏—Å—É–Ω–æ–∫ Adobe Photoshop
+Name[se]=Adobe Photoshop-govva
 Name[sk]=Adobe Photoshop obr√°zok
 Name[sl]=Slika Adobe Photoshop
 Name[sr]=–°–ª–∏–∫–∞ Adobe-–æ–≤–æ–≥ Photoshop-–∞
Index: kio/kio/kservicegroup.cpp
===================================================================
--- kio/kio/kservicegroup.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kio/kio/kservicegroup.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -48,6 +48,7 @@
 {
   d = new KServiceGroup::Private;
   m_bDeleted = false;
+  m_bDeep = false;
 }
 
 KServiceGroup::KServiceGroup( const QString &configFile, const QString & _relpath )
@@ -55,6 +56,7 @@
 {
   d = new KServiceGroup::Private;
   m_bDeleted = false;
+  m_bDeep = false;
 
   QString cfg = configFile;
   if (cfg.isEmpty())
Index: kio/misc/kwalletd/kwalletd.cpp
===================================================================
--- kio/misc/kwalletd/kwalletd.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kio/misc/kwalletd/kwalletd.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -260,31 +260,14 @@
 	KWalletTransaction *xact = new KWalletTransaction;
 	_transactions.append(xact);
 
-	if (_transactions.count() > 1) {
-		xact->appid = appid;
-		xact->client = callingDcopClient();
-		xact->transaction = xact->client->beginTransaction();
-		xact->wallet = wallet;
-		xact->wId = wId;
-		xact->tType = KWalletTransaction::Open;
-		return 0; // process later
-	}
-
-	int rc = doTransactionOpen(appid, wallet, wId);
-
-	_transactions.remove(xact);
-
-	if (rc < 0) {
-		// multiple requests from the same client should not produce multiple password dialogs on a failure
-		for (KWalletTransaction *x = _transactions.first(); x; x = _transactions.next()) {
-			if (appid == x->appid && x->tType == KWalletTransaction::Open && x->wallet == wallet && x->wId == wId)
-				x->tType = KWalletTransaction::OpenFail;
-		}
-	}
-
-	processTransactions();
-
-	return rc;
+	xact->appid = appid;
+	xact->client = callingDcopClient();
+	xact->transaction = xact->client->beginTransaction();
+	xact->wallet = wallet;
+	xact->wId = wId;
+	xact->tType = KWalletTransaction::Open;
+	QTimer::singleShot(0, this, SLOT(processTransactions()));
+	return 0; // process later
 }
 
 
Index: kio/misc/kpac/eventsrc
===================================================================
--- kio/misc/kpac/eventsrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kio/misc/kpac/eventsrc	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -389,6 +389,7 @@
 Name[ro]=Eroare de analizƒÉ a scriptului
 Name[ru]=–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ —Å–∫—Ä–∏–ø—Ç–∞
 Name[rw]=Ikosa ry'isuzuma ry'inyandikoporogaramu
+Name[se]=Meatt√°hus dulkodettiin skripta
 Name[sk]=Chyba kontroly skriptu
 Name[sl]=Napaka pri ocenjevanju skripta
 Name[sq]=Gabim i vler√´simit t√´ skript√´s
Index: kio/kssl/kssl.cc
===================================================================
--- kio/kssl/kssl.cc	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kio/kssl/kssl.cc	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -129,7 +129,7 @@
 		return false;
 
 	if (m_bAutoReconfig)
-	m_cfg->load();
+		m_cfg->load();
 
 	if (!m_cfg->tlsv1())
 		return false;
@@ -160,6 +160,9 @@
 bool KSSL::initialize() {
 #ifdef KSSL_HAVE_SSL
 	kdDebug(7029) << "KSSL initialize" << endl;
+	if (m_cfg->tlsv1())
+		return TLSInit();
+
 	if (m_bInit)
 		return false;
 
@@ -499,6 +502,7 @@
 		if (err != SSL_ERROR_NONE &&
 		    err != SSL_ERROR_ZERO_RETURN && err != SSL_ERROR_SYSCALL) {
 			rc = -1;      // OpenSSL returns 0 on error too
+			d->kossl->ERR_print_errors_fp(stderr);
 		}
 
 //		else if (err == SSL_ERROR_ZERO_RETURN)
Index: kutils/kplugininfo.desktop
===================================================================
--- kutils/kplugininfo.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kutils/kplugininfo.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -42,7 +42,7 @@
 Name[mk]=KDE –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—ò–∞ –∑–∞ –ø—Ä–∏–∫–ª—É—á–æ–∫
 Name[mn]=–ö–î–≠ –ø–ª—É–≥–∏–Ω –º—ç–¥—ç—ç–ª—ç–ª
 Name[ms]=Maklumat Plugmasuk KDE
-Name[nb]=KDEs informasjon om tilleggsprogram
+Name[nb]=KDEs informasjon om programtillegg
 Name[nds]=Plugin-Informatschoon
 Name[nl]=KDE-plugininformatie
 Name[nn]=Informasjon om KDE-programtillegg
Index: kdesu/configure.in.in
===================================================================
--- kdesu/configure.in.in	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdesu/configure.in.in	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -6,6 +6,14 @@
     AC_DEFINE_UNQUOTED(__PATH_SU, "$path_su", [path to su])
 fi
 
+dnl Check for sudo
+AC_PATH_PROG(path_sudo, "sudo", "no")
+if test "$path_sudo" = "no"; then
+    AC_MSG_WARN(sudo was not found)
+else
+    AC_DEFINE_UNQUOTED(__PATH_SUDO, "$path_sudo", [path to sudo])
+fi
+
 dnl Check for POSIX.1b scheduling
 AC_MSG_CHECKING([POSIX.1b scheduling])
 AC_TRY_LINK([
Index: kdesu/process.cpp
===================================================================
--- kdesu/process.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdesu/process.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -48,6 +48,7 @@
 #include <qcstring.h>
 #include <qfile.h>
 
+#include <kconfig.h>
 #include <kdebug.h>
 #include <kstandarddirs.h>
 
@@ -73,7 +74,15 @@
 */
 bool PtyProcess::checkPid(pid_t pid)
 {
+	KConfig* config = KGlobal::config();
+	config->setGroup("super-user-command");
+	QString superUserCommand = config->readEntry("super-user-command", "sudo");
+	//sudo does not accept signals from user so we except it
+	if (superUserCommand == "sudo") {
+		return true;
+	} else {
 	return kill(pid,0) == 0;
+	}
 }
 
 /*
Index: kdesu/su.cpp
===================================================================
--- kdesu/su.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdesu/su.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -5,6 +5,9 @@
 * This file is part of the KDE project, module kdesu.
 * Copyright (C) 1999,2000 Geert Jansen <jansen@kde.org>
 * 
+* Sudo support added by Jonathan Riddell <jriddell@ ubuntu.com>
+* Copyright (C) 2005 Canonical Ltd
+*
 * This is free software; you can use this library under the GNU Library 
 * General Public License, version 2. See the file "COPYING.LIB" for the 
 * exact licensing terms.
@@ -30,6 +33,7 @@
 #include <qcstring.h>
 #include <qfile.h>
 
+#include <kconfig.h>
 #include <kdebug.h>
 #include <klocale.h>
 #include <kstandarddirs.h>
@@ -42,11 +46,25 @@
 #define __PATH_SU "false"
 #endif
 
+#ifndef __PATH_SUDO
+#define __PATH_SUDO "false"
+#endif
 
+//change to sudo or su according to your preferences
+#define DEFAULT_SUPER_USER_COMMAND "sudo"
+
 SuProcess::SuProcess(const QCString &user, const QCString &command)
 {
     m_User = user;
     m_Command = command;
+
+    KConfig* config = KGlobal::config();
+    config->setGroup("super-user-command");
+    superUserCommand = config->readEntry("super-user-command", DEFAULT_SUPER_USER_COMMAND);
+    if ( superUserCommand != "sudo" && superUserCommand != "su" ) {
+	kdWarning() << "unknown super user command" << endl;
+	superUserCommand = "su";
+    }
 }
 
 
@@ -74,6 +92,9 @@
         setTerminal(true);
 
     QCStringList args;
+    if (superUserCommand == "sudo") {
+        args += "-u";
+    }
 
 #ifdef Q_OS_DARWIN
     args += "-c";
@@ -85,16 +106,27 @@
     else
         args += m_User;
     
-    args += "-c";
+    if (superUserCommand == "su") {
+        args += "-c";
+    }
     args += QCString(__KDE_BINDIR) + "/kdesu_stub";
 #ifndef Q_OS_DARWIN
     args += "-";
 #endif
 
-    QCString command = __PATH_SU;
-    if (::access(__PATH_SU, X_OK) != 0)
+    ///    QCString command = __PATH_SU;
+    ///    if (::access(__PATH_SU, X_OK) != 0)
+    QCString command;
+    if (superUserCommand == "sudo") {
+        command = __PATH_SUDO;
+    } else {
+        command = __PATH_SU;
+    }
+ 
+    if (::access(command, X_OK) != 0)
     {
-        command = QFile::encodeName(KGlobal::dirs()->findExe("su"));
+      ///        command = QFile::encodeName(KGlobal::dirs()->findExe("su"));
+        command = QFile::encodeName( KGlobal::dirs()->findExe(superUserCommand.ascii()) );
         if (command.isEmpty())
             return check ? SuNotFound : -1;
     }
@@ -119,10 +151,20 @@
     {
         if (ret == killme)
         {
-            if (kill(m_Pid, SIGKILL) < 0)
-            {
-                ret=error;
-            }
+	  ///            if (kill(m_Pid, SIGKILL) < 0)
+	  ///            {
+	  ///                ret=error;
+	  ///            }
+            if ( superUserCommand == "sudo" ) {
+ 	        // sudo can not be killed, just return
+ 	        return ret;
+ 	    }
+ 	    if (kill(m_Pid, SIGKILL) < 0) {
+ 	        kdDebug() << k_funcinfo << "kill < 0" << endl;
+ 		//FIXME SIGKILL doesn't work for sudo,
+ 		//why is this different from su?
+ 		ret=error;
+ 	    }
             else
             {
                 int iret = waitForChild();
@@ -144,7 +186,9 @@
     if (ret == notauthorized)
     {
         kill(m_Pid, SIGKILL);
-        waitForChild();
+        if (superUserCommand != "sudo") {
+            waitForChild();
+        }
         return SuIncorrectPassword;
     }
 
@@ -277,6 +321,10 @@
                 {
                     unreadLine(line);
                     return ok;
+ 	        } else if (superUserCommand == "sudo") {
+ 	            // sudo gives a "sorry" line so reaches here
+ 	            // with the wrong password
+ 	            return notauthorized;
                 }
                 break;
             //////////////////////////////////////////////////////////////////////////
Index: kdesu/su.h
===================================================================
--- kdesu/su.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdesu/su.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -57,6 +57,7 @@
 private:
     class SuProcessPrivate;
     SuProcessPrivate *d;
+    QString superUserCommand;
 };
 
 #endif
Index: kdecore/netwm.h
===================================================================
--- kdecore/netwm.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/netwm.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1269,7 +1269,7 @@
     /**
        Returns an icon.  If width and height are passed, the icon returned will be
        the closest it can find (the next biggest).  If width and height are omitted,
-       then the first icon in the list is returned.
+       then the largest icon in the list is returned.
 
        @param width the preferred width for the icon, -1 to ignore
 
Index: kdecore/kaccelmanager.cpp
===================================================================
--- kdecore/kaccelmanager.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kaccelmanager.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -167,7 +167,7 @@
 {
     if (!widget)
     {
-        kdDebug(125) << "null pointer given to manage" << endl;
+        kdDebug(131) << "null pointer given to manage" << endl;
         return;
     }
 
@@ -239,8 +239,6 @@
         if ( dynamic_cast<QLabel*>( it->m_widget ) && it->m_widget->inherits("KURLLabel") )
              continue;
 
-        kdDebug(125) << "write " << cnt << " " << it->m_widget->className() << " " <<contents[cnt].accelerated() << endl;
-
         int tprop = it->m_widget->metaObject()->findProperty("text", true);
         if (tprop != -1)  {
             if (checkChange(contents[cnt]))
@@ -256,7 +254,6 @@
     for (Item *it = item->m_children->first(); it != 0;
          it = item->m_children->next())
     {
-        kdDebug(125) << "children " << it->m_widget->className() << endl;
         if (it->m_widget && it->m_widget->isVisibleTo( item->m_widget ) )
             calculateAccelerators(it, used);
     }
@@ -456,7 +453,7 @@
 
 void KAcceleratorManager::manage(QWidget *widget, bool programmers_mode)
 {
-    kdDebug(125) << "KAcceleratorManager::manage\n";
+    kdDebug(131) << "KAcceleratorManager::manage\n";
     KAcceleratorManagerPrivate::changed_string = QString::null;
     KAcceleratorManagerPrivate::added_string = QString::null;
     KAcceleratorManagerPrivate::removed_string = QString::null;
@@ -496,7 +493,6 @@
 
     m_orig_accel = m_accel = stripAccelerator(m_pureText);
 
-    kdDebug(125) << input << " " << m_orig_accel << " " << m_accel << " " << m_pureText << endl;
     if (initialWeight == -1)
         initialWeight = KAccelManagerAlgorithm::DEFAULT_WEIGHT;
 
@@ -575,7 +571,7 @@
     // try to preserve the wanted accelarators
     if ((int)pos == accel()) {
         weight += KAccelManagerAlgorithm::WANTED_ACCEL_EXTRA_WEIGHT;
-        // kdDebug(125) << "wanted " << m_pureText << " " << KAcceleratorManagerPrivate::standardName(m_origText) << endl;
+        // kdDebug(131) << "wanted " << m_pureText << " " << KAcceleratorManagerPrivate::standardName(m_origText) << endl;
         if (KAcceleratorManagerPrivate::standardName(m_origText))  {
             weight += KAccelManagerAlgorithm::STANDARD_ACCEL;
         }
@@ -685,19 +681,17 @@
 
 void KAccelManagerAlgorithm::findAccelerators(KAccelStringList &result, QString &used)
 {
-    kdDebug(125) << "findAccelerators\n";
+    kdDebug(131) << "findAccelerators\n";
   KAccelStringList accel_strings = result;
 
   // initally remove all accelerators
   for (KAccelStringList::Iterator it = result.begin(); it != result.end(); ++it) {
-      kdDebug(125) << "reset " << ( *it ).pure() << endl;
     (*it).setAccel(-1);
   }
 
   // pick the highest bids
   for (uint cnt=0; cnt<accel_strings.count(); ++cnt)
   {
-      kdDebug(125) << "cnt " << accel_strings[cnt].pure() << endl;
     int max = 0, index = -1, accel = -1;
 
     // find maximum weight
@@ -862,7 +856,7 @@
 {
     if (!child)
     {
-        kdDebug(125) << "null pointer given to aboutToShow" << endl;
+        kdDebug(131) << "null pointer given to aboutToShow" << endl;
         return;
     }
 
Index: kdecore/kglobalaccel_x11.h
===================================================================
--- kdecore/kglobalaccel_x11.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kglobalaccel_x11.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -96,12 +96,14 @@
 	virtual bool isEnabledInternal() const;
 	static void blockShortcuts( bool block );
 	void disableBlocking( bool disable );
+        void suspend( bool s );
 
  protected slots:
 	void slotActivated( int iAction );
  private:
 	bool m_blocked;
 	bool m_blockingDisabled;
+        bool m_suspended;
 };
 
 #endif // _KGLOBALACCEL_X11_H
Index: kdecore/eventsrc
===================================================================
--- kdecore/eventsrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/eventsrc	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -138,7 +138,7 @@
 Name[uz]=–ß–∏“õ–∏–Ω–¥–∏–ª–∞—Ä “õ—É—Ç–∏—Å–∏ –±—û—à–∞—Ç–∏–ª–¥–∏
 Name[vi]=R√°c: ƒë√£ ƒë·ªï
 Name[zh_CN]=ÂõûÊî∂Á´ôÔºöÂ∑≤Ê∏ÖÁ©∫
-Name[zh_TW]=ÂûÉÂúæÊ°∂Â∑≤Ê∏ÖÁ©∫
+Name[zh_TW]=Ë≥áÊ∫êÂõûÊî∂Ê°∂Â∑≤Ê∏ÖÁ©∫
 Comment=The trash has been emptied
 Comment[af]=Die gemors is leeggemaak
 Comment[bg]=–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ –∞ –∫–æ—à—á–µ—Ç–æ –µ –∏–∑—Ç—Ä–∏—Ç–æ
@@ -195,7 +195,7 @@
 Comment[uz]=–ß–∏“õ–∏–Ω–¥–∏–ª–∞—Ä “õ—É—Ç–∏—Å–∏ –±—û—à–∞—Ç–∏–ª–¥–∏
 Comment[vi]=R√°c ƒë√£ ƒë∆∞·ª£c ƒë·ªï.
 Comment[zh_CN]=ÂõûÊî∂Á´ôÂ∑≤Ë¢´Ê∏ÖÁ©∫
-Comment[zh_TW]=ÂûÉÂúæÊ°∂Â∑≤Ê∏ÖÁ©∫„ÄÇ
+Comment[zh_TW]=Ë≥áÊ∫êÂõûÊî∂Ê°∂Â∑≤Ê∏ÖÁ©∫„ÄÇ
 default_presentation=1
 
 [Textcompletion: rotation]
@@ -2132,6 +2132,7 @@
 Name[ro]=Mesaj situa≈£ie criticƒÉ
 Name[ru]=–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
 Name[rw]=Ubutumwa bunenga
+Name[se]=Heahttediehtu
 Name[sk]=Kritick√° spr√°va
 Name[sl]=Kritiƒçno sporoƒçilo
 Name[sq]=Porosi Kritik
@@ -2201,6 +2202,7 @@
 Comment[ro]=A fost afi≈üat un mesaj de situa≈£ie criticƒÉ
 Comment[ru]=–í—ã–≤–æ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
 Comment[rw]=Ubutumwa bunenga bwerekanwe
+Comment[se]=Heahttediehtu ƒç√°jehuvvo
 Comment[sk]=Je zobrazen√° kritick√° spr√°va
 Comment[sl]=Prikazano je kritiƒçno sporoƒçilo
 Comment[sq]=Nj√´ porosi kritike √´sht√´ paraqitur
Index: kdecore/kiconloader.cpp
===================================================================
--- kdecore/kiconloader.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kiconloader.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -850,34 +850,35 @@
 	*img = d->mpEffect.apply(*img, group, state);
     }
 
-    pix.convertFromImage(*img);
-
-    delete img;
-
     if (favIconOverlay)
     {
-        QPixmap favIcon(name, "PNG");
-        int x = pix.width() - favIcon.width() - 1,
-            y = pix.height() - favIcon.height() - 1;
-        if (pix.mask())
+        QImage favIcon(name, "PNG");
+        int x = img->width() - favIcon.width() - 1,
+            y = img->height() - favIcon.height() - 1;
+        if( favIcon.depth() != 32 )
+            favIcon = favIcon.convertDepth( 32 );
+        if( img->depth() != 32 )
+            *img = img->convertDepth( 32 );
+        for( int line = 0;
+             line < favIcon.height();
+             ++line )
         {
-            QBitmap mask = *pix.mask();
-            QBitmap fmask;
-            if (favIcon.mask())
-		fmask = *favIcon.mask();
-	    else {
-		// expensive, but works
-		fmask = favIcon.createHeuristicMask();
-	    }
-
-            bitBlt(&mask, x, y, &fmask,
-                   0, 0, favIcon.width(), favIcon.height(),
-                   favIcon.mask() ? Qt::OrROP : Qt::SetROP);
-            pix.setMask(mask);
+            QRgb* fpos = reinterpret_cast< QRgb* >( favIcon.scanLine( line ));
+            QRgb* ipos = reinterpret_cast< QRgb* >( img->scanLine( line + y )) + x;
+            for( int i = 0;
+                 i < favIcon.width();
+                 ++i, ++fpos, ++ipos )
+                *ipos = qRgba( ( qRed( *ipos ) * ( 255 - qAlpha( *fpos )) + qRed( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qGreen( *ipos ) * ( 255 - qAlpha( *fpos )) + qGreen( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qBlue( *ipos ) * ( 255 - qAlpha( *fpos )) + qBlue( *fpos ) * qAlpha( *fpos )) / 255,
+                               ( qAlpha( *ipos ) * ( 255 - qAlpha( *fpos )) + qAlpha( *fpos ) * qAlpha( *fpos )) / 255 );
         }
-        bitBlt(&pix, x, y, &favIcon);
     }
 
+    pix.convertFromImage(*img);
+
+    delete img;
+
     QPixmapCache::insert(key, pix);
     return pix;
 }
Index: kdecore/kglobalaccel_x11.cpp
===================================================================
--- kdecore/kglobalaccel_x11.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kglobalaccel_x11.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -82,6 +82,7 @@
 : KAccelBase( KAccelBase::NATIVE_KEYS )
 , m_blocked( false )
 , m_blockingDisabled( false )
+, m_suspended( false )
 {
         if( all_accels == NULL )
             all_accels = new QValueList< KGlobalAccelPrivate* >;
@@ -133,6 +134,13 @@
         return KAccelBase::isEnabled() && !m_blocked;
 }
 
+// see #117169 - the bug is hard to reproduce, probably somewhere in X, testcase would be probably
+// difficult to make, and so on - just don't release the grabs and only ignore the events instead
+void KGlobalAccelPrivate::suspend( bool s )
+{
+	m_suspended = s;
+}
+
 bool KGlobalAccelPrivate::emitSignal( Signal )
 {
 	return false;
@@ -267,7 +275,7 @@
                 XFlush( qt_xdisplay()); // avoid X(?) bug
         }
 
-	if( !isEnabledInternal())
+	if( !isEnabledInternal() || m_suspended )
 		return false;
 
 	CodeMod codemod;
@@ -317,6 +325,7 @@
 #endif
 		return false;
 	}
+        
 	KAccelAction* pAction = m_rgCodeModToAction[codemod];
 
 	if( !pAction ) {
Index: kdecore/all_languages.desktop
===================================================================
--- kdecore/all_languages.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/all_languages.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -7566,11 +7566,13 @@
 Name[nb]=Romani
 Name[nds]=Roomsch
 Name[nl]=Roma
+Name[nn]=Romani
 Name[pl]=Romski
 Name[pt]=Romeno
 Name[pt_BR]=Romeno
 Name[ro]=≈¢igƒÉneascƒÉ
 Name[ru]=–¶—ã–≥–∞–Ω—Å–∫–∏–π
+Name[se]=Rom√°nigiella
 Name[sk]=Rom√°nsky
 Name[sl]=romsko
 Name[sr]=–†–æ–º—Å–∫–∏
@@ -8544,11 +8546,13 @@
 Name[nb]=Serbisk (latinsk)
 Name[nds]=Serbsch (latiensch Schrift)
 Name[nl]=Servisch Latijn
+Name[nn]=Serbisk, latinsk
 Name[pl]=Serbski ≈Çaci≈Ñski
 Name[pt]=S√©rvio Latino
 Name[pt_BR]=S√©rvio Latino
 Name[ro]=S√ÆrbƒÉ latinƒÉ
 Name[ru]=–°–µ—Ä–±—Å–∫–∏–π –ª–∞—Ç–∏–Ω–Ω–∏—Ü–µ–π
+Name[se]=Serbiala≈° latiidnagiella
 Name[sk]=Srbsk√Ω Latinka
 Name[sl]=srbsko latinsko
 Name[sr]=–°—Ä–ø—Å–∫–∏ –ª–∞—Ç–∏–Ω–∏—á–Ω–∏
@@ -10437,11 +10441,13 @@
 Name[nb]=Kinesisk (Hong kong)
 Name[nds]=Chineesch (Hong Kong)
 Name[nl]=Chinees (Hong Kong)
+Name[nn]=Kinesisk (Hong Kong)
 Name[pl]=Chi≈Ñski (Hong Kong)
 Name[pt]=Chin√™s (Hong Kong)
 Name[pt_BR]=Chin√™s (Hong Kong)
 Name[ro]=ChinezƒÉ (Hong Kong)
 Name[ru]=–ö–∏—Ç–∞–π—Å–∫–∏–π (–ì–æ–Ω–∫–æ–Ω–≥)
+Name[se]=Kiinn√°giella (Hong Kong)
 Name[sk]=ƒå√≠nsky (Hong Kong)
 Name[sl]=kitajsko (Hong Kong)
 Name[sr]=–ö–∏–Ω–µ—Å–∫–∏ (–•–æ–Ω–≥–∫–æ–Ω–≥)
Index: kdecore/kwin.h
===================================================================
--- kdecore/kwin.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kwin.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -179,7 +179,8 @@
      *    enum for details) - passing 0 means all properties. Unlisted properties
      *    cause related information to be invalid in the returned data, but
      *    make this function faster when not all data is needed.
-     * @param properties2 additional properties (see NET::Property2 enum)
+     * @param properties2 additional properties (see NET::Property2 enum). Note that
+     *    specifying 0 means no properties, not all.
      * @return the window information
      * @since 3.2
      */
@@ -260,12 +261,8 @@
     /**
      * Sets the type of window @p win to @p windowType.
      *
-     * Possible values are NET::Normal, NET::Desktop, NET::Dock,
-     * NET::Tool, NET::Menu, NET::Dialog, NET::Override (== no
-     * decoration frame), NET::TopMenu, NET::Utility or NET::Splash
-     *
      * @param win the id of the window
-     * @param windowType the type of the window
+     * @param windowType the type of the window (see NET::WindowType)
      */
     static void setType( WId win, NET::WindowType windowType );
 
Index: kdecore/kdebug.areas
===================================================================
--- kdecore/kdebug.areas	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kdebug.areas	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -11,6 +11,7 @@
 128        kdecore (KRegExp)
 129        kdecore (KAction)
 130        kio (KPasswdServer)
+131        kdecore (KAcceleratorManager)
 150        kdecore (KLibLoader)
 160        kdecore (KNotifyClient)
 170        kdecore (KNetwork socket)
Index: kdecore/kglobalaccel.h
===================================================================
--- kdecore/kglobalaccel.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kglobalaccel.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -215,6 +215,12 @@
          * @internal
          */
         void disableBlocking( bool disable );
+        
+        /**
+         * @internal
+         */
+        // like setEnabled(), but doesn't ungrab (see in KGlobalAccelPrivate)
+        void suspend( bool s );
 
 private:
 
Index: kdecore/kglobalaccel.cpp
===================================================================
--- kdecore/kglobalaccel.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kglobalaccel.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -65,6 +65,9 @@
 void KGlobalAccel::setEnabled( bool bEnabled )
 	{ d->setEnabled( bEnabled ); }
 
+void KGlobalAccel::suspend( bool s )
+	{ d->suspend( s ); }
+
 void KGlobalAccel::blockShortcuts( bool block )
         { KGlobalAccelPrivate::blockShortcuts( block ); }
 
Index: kdecore/netwm_def.h
===================================================================
--- kdecore/netwm_def.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/netwm_def.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -270,10 +270,7 @@
        @li Dialog indicates that this is a dialog window. If _NET_WM_WINDOW_TYPE is
        not set, then windows with WM_TRANSIENT_FOR set must be taken as this type.
 
-       @li Override indicates that this window wants to have no Window Manager
-       decorations. This is for windows that would normally use either override_redirect
-       or Motif hints to give no decorations.  This is a KDE extension to the
-       _NET_WM_WINDOW_TYPE mechanism.
+       @li Override - deprecated, has unclear meaning and is KDE-only.
        
        @li TopMenu indicates a toplevel menu (AKA macmenu). This is a KDE extension to the
        _NET_WM_WINDOW_TYPE mechanism.
@@ -287,7 +284,7 @@
 	Toolbar  = 3,
        	Menu     = 4,
 	Dialog   = 5,
-	Override = 6, // NON STANDARD
+	Override = 6, ///< @deprecated
         TopMenu  = 7, // NON STANDARD
 	Tool     = Toolbar, // This will go away soon, COMPAT (How soon? :)
 	Utility  = 8,	///< @since 3.2
Index: kdecore/netwm.cpp
===================================================================
--- kdecore/netwm.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/netwm.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -3467,14 +3467,19 @@
 	return result;
     }
 
+    // find the largest icon
     result = icons[0];
+    for (int i = 1; i < icons.size(); i++) {
+	if( icons[i].size.width >= result.size.width &&
+	     icons[i].size.height >= result.size.height )
+	    result = icons[i];
+    }
 
+    // return the largest icon if w and h are -1
+    if (width == -1 && height == -1) return result;
+
     // find the icon that's closest in size to w x h...
-    // return the first icon if w and h are -1
-    if (width == height && height == -1) return result;
-
-    int i;
-    for (i = 0; i < icons.size(); i++) {
+    for (int i = 0; i < icons.size(); i++) {
 	if ((icons[i].size.width >= width &&
 	     icons[i].size.width < result.size.width) &&
 	    (icons[i].size.height >= height &&
Index: kdecore/kdebugrc
===================================================================
--- kdecore/kdebugrc	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdecore/kdebugrc	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -36,6 +36,10 @@
 [125]
 InfoOutput=4
 
+# KCheckAccel debug info off
+[131]
+InfoOutput=4
+
 # KAction debug info off
 [129]
 InfoOutput=4
Index: khtml/html/html_formimpl.cpp
===================================================================
--- khtml/html/html_formimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ khtml/html/html_formimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1917,10 +1917,10 @@
 
 	if (act) {
 	    NodeImpl* const formNode=getFormElement();
-	    if (formNode) {
+	    if (formNode && evt->target() != formNode) {
 		getDocument()->setFocusNode(formNode);
 		if (formNode->id()==ID_INPUT)
-		    static_cast<DOM::HTMLInputElementImpl*>(formNode)->defaultEventHandler(evt);
+		    static_cast<DOM::HTMLInputElementImpl*>(formNode)->click();
 		evt->setDefaultHandled();
 	    }
 	}
Index: khtml/html/html_baseimpl.cpp
===================================================================
--- khtml/html/html_baseimpl.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ khtml/html/html_baseimpl.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -624,6 +624,9 @@
         else
             removeCSSProperty(CSS_PROP_HEIGHT);
         break;
+    case ATTR_ALIGN:
+        addHTMLAlignment( attr->value() );
+        break;
     case ATTR_SRC:
         needWidgetUpdate = true; // ### do this for scrolling, margins etc?
         HTMLFrameElementImpl::parseAttribute( attr );
Index: khtml/rendering/render_table.h
===================================================================
--- khtml/rendering/render_table.h	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ khtml/rendering/render_table.h	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -306,6 +306,8 @@
 
     virtual void layout();
 
+    virtual RenderObject* removeChildNode(RenderObject* child);
+
     // The only time rows get a layer is when they have transparency.
     virtual bool requiresLayer() const { return /* style()->opacity() < 1.0f; */ false ; }
     virtual void paint(PaintInfo& i, int tx, int ty);
Index: khtml/rendering/render_table.cpp
===================================================================
--- khtml/rendering/render_table.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ khtml/rendering/render_table.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1984,6 +1984,15 @@
     setInline(false);   // our object is not Inline
 }
 
+RenderObject* RenderTableRow::removeChildNode(RenderObject* child)
+{
+    RenderTableSection *s = section();
+    if (s)
+        s->setNeedCellRecalc();
+
+    return RenderContainer::removeChildNode( child );
+}
+
 void RenderTableRow::detach()
 {
     RenderTableSection *s = section();
@@ -2235,6 +2244,9 @@
     kdDebug( 6040 ) << renderName() << "(TableCell)::calcMinMaxWidth() known=" << minMaxKnown() << endl;
 #endif
 
+    if (section()->needCellRecalc)
+        section()->recalcCells();
+
     RenderBlock::calcMinMaxWidth();
     if (element() && style()->whiteSpace() == NORMAL) {
         // See if nowrap was set.
Index: kresources/kresources_plugin.desktop
===================================================================
--- kresources/kresources_plugin.desktop	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kresources/kresources_plugin.desktop	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -37,7 +37,7 @@
 Comment[mk]=KResource —Ä–∞–º–∫–æ–≤–µ–Ω –ø—Ä–∏–∫–ª—É—á–æ–∫
 Comment[mn]=–ù”©”©—Ü –¢–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö-–§–∞–π–ª—ã–Ω –ø–ª—É–≥–∏–Ω (RDF)
 Comment[ms]=Plug masuk Kerangka KResource
-Comment[nb]=KRessursrammeverk tilleggsprogram
+Comment[nb]=KRessursrammeverk programtillegg
 Comment[nds]=Plugin f√∂r dat KResource-Rahmenwark
 Comment[nl]=KResource Framework-plugin
 Comment[nn]=Programtillegg for KResource-rammeverket
Index: kdoctools/customization/pt/user.entities
===================================================================
--- kdoctools/customization/pt/user.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/pt/user.entities	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -40,3 +40,4 @@
 <!ENTITY kinfocenter "<application>Centro de Informa√ß√£o do KDE</application>" >
 <!ENTITY ksystemlog "<application>KSystemLog</application>" >
 <!ENTITY kleopatra "<application>Kleopatra</application>" >
+<!ENTITY qt "<trademark>Qt</trademark>" >
Index: kdoctools/customization/zh-TW/user.entities
===================================================================
--- kdoctools/customization/zh-TW/user.entities	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/user.entities	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -6,3 +6,32 @@
      names (which if they occur will cost you a _lot_ of time)
  -->
 
+<!ENTITY Alt	"<keycap>Alt</keycap>">
+<!ENTITY Backspace	"<keycap>Backspace</keycap>">
+<!ENTITY cdrom	'<hardware>ÂÖâÁ¢üÊ©ü</hardware>'>
+<!ENTITY Ctrl	"<keycap>Ctrl</keycap>">
+<!ENTITY dpi	'<acronym>dpi</acronym>'>
+<!ENTITY eg     "‰æãÂ¶ÇÔºå">
+<!ENTITY Enter	"<keycap>Enter</keycap>">
+<!ENTITY Esc	"<keycap>Esc</keycap>">
+<!ENTITY etc    "... Á≠âÁ≠â„ÄÇ">
+<!ENTITY FAQ	'<acronym>FAQ</acronym>'>
+<!ENTITY ie     "‰πüÂ∞±ÊòØË™™Ôºå">
+<!ENTITY infocenter	"<application>KDE Ë≥áË®ä‰∏≠ÂøÉ</application>">
+<!ENTITY kcontrolcenter	"<application>KDE ÊéßÂà∂‰∏≠ÂøÉ</application>">
+<!ENTITY kicon	"<guiicon>
+<inlinemediaobject>
+ <objectinfo><title>KDE ÁöÑ K ÂúñÁ§∫</title></objectinfo>
+ <imageobject><imagedata fileref='common/kmenu.png' format='PNG'/></imageobject>
+ <textobject><phrase>K</phrase></textobject>
+</inlinemediaobject>
+</guiicon> ÂúñÁ§∫"><!-- if image is localised, then entityref should be used 
+                      instead of fileref -->
+<!ENTITY kmenu  "<guimenu>K</guimenu> ÈÅ∏ÂñÆ">
+<!ENTITY LMB    "ÊªëÈº†<mousebutton>Â∑¶Èçµ</mousebutton>">
+<!ENTITY MMB    "ÊªëÈº†<mousebutton>‰∏≠Èçµ</mousebutton>">
+<!ENTITY OS	"‰ΩúÊ•≠Á≥ªÁµ±"><!-- <acronym>OS</acronym>-->
+<!ENTITY RMB    "ÊªëÈº†<mousebutton>Âè≥Èçµ</mousebutton>">
+<!ENTITY Shift	"<keycap>Shift</keycap>">
+<!ENTITY systemtray "<application>Á≥ªÁµ±Âå£</application>">
+<!ENTITY Tab	"<keycap>Tab</keycap>">
Index: kdoctools/customization/zh-TW/entities/underGPL.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underGPL.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/entities/underGPL.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1,3 +1,3 @@
 <para>
-•ªµ{¶°™∫±¬≈v§Ë¶°±ƒ•Œ <ulink url="common/gpl-translated.html">GNU ≥q•Œ§Ω¶@≥\•i√“</ulink>°C
+Êú¨Á®ãÂºèÁöÑÊéàÊ¨äÊñπÂºèÊé°Áî® <ulink url="common/gpl-translated.html">GNU ÈÄöÁî®ÂÖ¨ÂÖ±Ë®±ÂèØË≠â</ulink>„ÄÇ
 </para>
Index: kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/entities/underArtisticLicense.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1,2 +1,2 @@
-<para>•ªµ{¶°™∫±¬≈v§Ë¶°±ƒ•Œ <ulink
-url="common/artistic-license.html">Artistic ≥\•i√“(Artistic License)</ulink>°C</para>
+<para>Êú¨Á®ãÂºèÁöÑÊéàÊ¨äÊñπÂºèÊé°Áî® <ulink
+url="common/artistic-license.html">Artistic Ë®±ÂèØË≠â(Artistic License)</ulink>„ÄÇ</para>
Index: kdoctools/customization/zh-TW/entities/underFDL.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underFDL.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/entities/underFDL.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1 +1 @@
-<para id="gnu-fdl" xreflabel="the section entitled &quot;GNU Free Documentation License&quot;">•ª§Â•Û™∫±¬≈v§Ë¶°±ƒ•Œ <ulink url="common/fdl-translated.html">GNU ¶€•—§Â•Û≥\•i√“</ulink>°C</para>
+<para id="gnu-fdl" xreflabel="the section entitled &quot;GNU Free Documentation License&quot;">Êú¨Êñá‰ª∂ÁöÑÊéàÊ¨äÊñπÂºèÊé°Áî® <ulink url="common/fdl-translated.html">GNU Ëá™Áî±Êñá‰ª∂Ë®±ÂèØË≠â</ulink>„ÄÇ</para>
Index: kdoctools/customization/zh-TW/entities/underBSDLicense.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underBSDLicense.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/entities/underBSDLicense.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1,2 +1,2 @@
-<para>•ªµ{¶°™∫±¬≈v§Ë¶°±ƒ•Œ <ulink
-url="common/bsd-license.html">BSD ≥\•i√“(BSD License)</ulink>°C</para>
+<para>Êú¨Á®ãÂºèÁöÑÊéàÊ¨äÊñπÂºèÊé°Áî® <ulink
+url="common/bsd-license.html">BSD Ë®±ÂèØË≠â(BSD License)</ulink>„ÄÇ</para>
Index: kdoctools/customization/zh-TW/entities/underX11License.docbook
===================================================================
--- kdoctools/customization/zh-TW/entities/underX11License.docbook	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdoctools/customization/zh-TW/entities/underX11License.docbook	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -1,2 +1,2 @@
-<para>•ªµ{¶°™∫±¬≈v§Ë¶°±ƒ•Œ <ulink
-url="common/x11-license.html">X11 ≥\•i√“(X11 License)</ulink>°C</para>
+<para>Êú¨Á®ãÂºèÁöÑÊéàÊ¨äÊñπÂºèÊé°Áî® <ulink
+url="common/x11-license.html">X11 Ë®±ÂèØË≠â(X11 License)</ulink>„ÄÇ</para>
Index: kdeui/kpopupmenu.cpp
===================================================================
--- kdeui/kpopupmenu.cpp	(.../tags/KDE/3.5.4/kdelibs)	(revision 570931)
+++ kdeui/kpopupmenu.cpp	(.../branches/KDE/3.5/kdelibs)	(revision 570931)
@@ -108,9 +108,6 @@
                        AlignCenter | SingleLine, titleStr);
         }
     }
-
-    p.setPen(palette().active().highlight());
-    p.drawLine(0, 0, r.right(), 0);
 }
 
 QSize KPopupTitle::sizeHint() const

Property changes on: .
___________________________________________________________________
Name: svn:externals
   + admin https://svn.kde.org/home/kde/branches/KDE/3.5/kde-common/admin


